<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure IaaS Core Support Blog</title>
  
  <subtitle>æ—¥æœ¬ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã® Azure IaaS ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã‚ˆã‚Šã€æƒ…å ±ã‚’ãŠå±Šã‘ã—ã¾ã™ï¼</subtitle>
  <link href="https://jpaztech.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpaztech.github.io/blog/"/>
  <updated>2023-12-26T02:55:51.120Z</updated>
  <id>https://jpaztech.github.io/blog/</id>
  
  <author>
    <name>Japan Azure IaaS Core Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Artifact Streaming ã¨ã¯ï¼Ÿ ACR ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ AKS ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦è©¦ã—ã¦ã¿ãŸ</title>
    <link href="https://jpaztech.github.io/blog/containers/aks-artifact-streaming/"/>
    <id>https://jpaztech.github.io/blog/containers/aks-artifact-streaming/</id>
    <published>2023-12-24T03:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.120Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã®è¨˜äº‹ã¯ <a href="https://qiita.com/advent-calendar/2023/microsoft-azure-tech">Microsoft Azure Tech Advent Calendar 2023</a> ã® 24 æ—¥ç›®ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ğŸ…</p><p>ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®æ¡äº•ã§ã™ã€‚</p><p><a href="https://techcommunity.microsoft.com/t5/apps-on-azure-blog/aks-welcomes-you-to-ignite-2023/ba-p/3983317">Ignite 2023</a> ã§ã€ACR/AKS é–¢é€£ã®æ©Ÿèƒ½ã¨ã—ã¦Artifact Streaming ãŒç™ºè¡¨ã•ã‚Œã¾ã—ãŸã€‚<br>æœ¬è¨˜äº‹ã§ã¯ã€Artifact Streaming ã‚’ä½¿ã£ã¦ ACR ã«ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ§˜å­ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚</p><p>Artifact Streaming ã¯ 2023/12 ç¾åœ¨ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã¨ã—ã¦æä¾›ã•ã‚Œã¦ãŠã‚Šã¾ã™ã€‚<br>ä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«ã‚ˆã‚Šã€å°†æ¥ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸå†…å®¹ã‹ã‚‰å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã‚’ä½•å’ã”äº†æ‰¿ãã ã•ã„ï¼</p><span id="more"></span><h2 id="Artifact-Streaming-ã¨ã¯"><a href="#Artifact-Streaming-ã¨ã¯" class="headerlink" title="Artifact Streaming ã¨ã¯"></a>Artifact Streaming ã¨ã¯</h2><blockquote><p>ã”å‚è€ƒ) Public preview: Artifact streaming support in Azure Kubernetes Service (AKS)<br><a href="https://azure.microsoft.com/ja-jp/updates/public-review-artifact-streaming-support-in-azure-kubernetes-service-aks/">https://azure.microsoft.com/ja-jp/updates/public-review-artifact-streaming-support-in-azure-kubernetes-service-aks/</a></p></blockquote><p>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®å®Ÿä½“ã‚’è¡¨ã™è¤‡æ•°ã®<code>ãƒ¬ã‚¤ãƒ¤ãƒ¼</code>ã¨ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æƒ…å ±ã‚’ã¾ã¨ã‚ãŸ<code>ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ</code>ã«ã‚ˆã£ã¦æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>é€šå¸¸ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼åŒ–ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã™ã‚‹ã«ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Pull (ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨å±•é–‹) ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚<br>ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Pull ã§ã¯æ¬¡ã®ã‚ˆã†ãªå‡¦ç†ãŒè¡Œã‚ã‚Œã¾ã™:</p><ol><li>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‹ã‚‰ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹</li><li>ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ã‹ç¢ºèªã™ã‚‹ (ãƒ­ãƒ¼ã‚«ãƒ« ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåˆ©ç”¨ã§ãã‚‹ã‹ç¢ºèªã™ã‚‹)</li><li>å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</li><li>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å±•é–‹ã™ã‚‹</li><li>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’èµ·å‹•ã™ã‚‹</li></ol><p>ã“ã®ã‚ˆã†ã«ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®èµ·å‹•ã«è‡³ã‚‹ã¾ã§ã«ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ§‹æˆã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨å±•é–‹ã®å‡¦ç†ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚<br>ãã®ãŸã‚ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ ã‚µã‚¤ã‚ºãŒå¤§ãã„å ´åˆã‚„ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ãŒå¤šã„ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å ´åˆã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãŒèµ·å‹•ã™ã‚‹ã¾ã§ã«æ™‚é–“ã‚’è¦ã™ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ç‰¹ã«ã€Pod ã®ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã‚’ã™ã‚‹ã‚·ãƒŠãƒªã‚ªã§ã¯ã€Pod ã®èµ·å‹•æ™‚é–“ãŒã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã®é€Ÿåº¦ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚</p><p>ã¾ãŸã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ©ãƒ¼ã«ã‚ˆã£ã¦ãƒãƒ¼ãƒ‰ãŒå‰Šæ¸›ã•ã‚Œã€ãã®å¾Œæ–°è¦ãƒãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆã«ã¯ã€ãƒãƒ¼ãƒ‰å†…ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ (AKS ã§ã¯ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã® <a href="https://learn.microsoft.com/ja-jp/azure/aks/scale-down-mode">ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ ãƒ¢ãƒ¼ãƒ‰</a>ãŒ <code>Delete</code> ã®å ´åˆ)ã€‚<br>æ–°è¦ãƒãƒ¼ãƒ‰ã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨å±•é–‹ãŒå†ã³å¿…è¦ã¨ãªã£ã¦ã—ã¾ã†ãŸã‚ã€Pod ã®èµ·å‹•å®Œäº†ã¾ã§ã«æ™‚é–“ã‚’è¦ã™ã‚‹è¦å› ã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚</p><p>ã“ã‚Œã‚‰ã®å•é¡Œã¯ã€Artifact Streaming ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€è§£æ±ºã‚’å›³ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>Artifact Streaming ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸å…¨ä½“ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨å±•é–‹ã‚’å¾…ã¤ã“ã¨ãªãã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’é–‹å§‹ã§ãã¾ã™ã€‚</p><h2 id="Artifact-Streaming-ã‚’è©¦ã—ã¦ã¿ã‚ˆã†"><a href="#Artifact-Streaming-ã‚’è©¦ã—ã¦ã¿ã‚ˆã†" class="headerlink" title="Artifact Streaming ã‚’è©¦ã—ã¦ã¿ã‚ˆã†"></a>Artifact Streaming ã‚’è©¦ã—ã¦ã¿ã‚ˆã†</h2><p>å®Ÿéš›ã« AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¸ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã€Artifact Streaming ã«ã‚ˆã£ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Pull æ™‚é–“ãŒå¤‰åŒ–ã™ã‚‹ã‹ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><p>ä»Šå›ã®æ¤œè¨¼ã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ <code>docker.io/jupyter/all-spark-notebook:latest</code> ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚<br>AKS ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã™ã‚‹å‰ã«ã€ã¾ãšã¯æ‰‹å…ƒã® PC ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Pull ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚<br>æ¬¡ã®ã‚ˆã†ã«ã€å¤šæ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ˆã£ã¦æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker pull docker.io/jupyter/all-spark-notebook:latest</span></span><br><span class="line">latest: Pulling from jupyter/all-spark-notebook</span><br><span class="line">aece8493d397: Pull complete</span><br><span class="line">fd92c719666c: Pull complete</span><br><span class="line">088f11eb1e74: Pull complete</span><br><span class="line">4f4fb700ef54: Pull complete</span><br><span class="line">ef8373d600b0: Pull complete</span><br><span class="line">77e45ee945dc: Pull complete</span><br><span class="line">a30f89a0af6c: Download complete</span><br><span class="line">dc42adc7eb73: Download complete</span><br><span class="line">abaa8376a650: Downloading [==&gt;                                                ]  4.314MB/104.8MB</span><br><span class="line">aa099bb9e49a: Download complete</span><br><span class="line">822c4cbcf6a6: Download complete</span><br><span class="line">d25166dcdc7b: Downloading [====&gt;                                              ]  2.494MB/30.5MB</span><br><span class="line">964fc3e4ff9f: Waiting</span><br><span class="line">2c4c69587ee4: Waiting</span><br><span class="line">de2cdd875fa8: Waiting</span><br><span class="line">75d33599f5f2: Waiting</span><br><span class="line">31973ea82470: Waiting</span><br><span class="line">96ee7e4439c7: Waiting</span><br><span class="line">1f9ad23c07ac: Waiting</span><br><span class="line">d19266e0cb17: Waiting</span><br><span class="line">9a165b6e9dc7: Pulling fs layer</span><br><span class="line">5689442fd4e1: Pulling fs layer</span><br><span class="line">9a6a202f62a6: Waiting</span><br><span class="line">734ea0c3d94e: Waiting</span><br><span class="line">a21a167f7127: Waiting</span><br><span class="line">467e20fcd668: Waiting</span><br><span class="line">7024bb03412a: Waiting</span><br><span class="line">7c128e9d2ddd: Waiting</span><br><span class="line">80782ae10995: Waiting</span><br><span class="line">691924032e73: Waiting</span><br><span class="line">05c5a5d9ae5f: Waiting</span><br><span class="line">15a3d66e1b80: Waiting</span><br><span class="line">688c0dcd61fc: Waiting</span><br><span class="line">ed7d16094f4e: Waiting</span><br></pre></td></tr></table></figure><h3 id="Artifact-Streaming-ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™"><a href="#Artifact-Streaming-ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™" class="headerlink" title="Artifact Streaming ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™"></a>Artifact Streaming ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™</h3><p>æœ¬è¨˜äº‹ã®æ‰‹é †ã¯ã€æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æ‰‹é †ã«æ²¿ã£ã¦ã„ã¾ã™ã€‚<br>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚ã‚ã›ã¦ã”å‚ç…§ãã ã•ã„ã€‚</p><blockquote><p>Azure Kubernetes Service (AKS) ã®æˆæœç‰©ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ (ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)<br><a href="https://learn.microsoft.com/ja-jp/azure/aks/artifact-streaming">https://learn.microsoft.com/ja-jp/azure/aks/artifact-streaming</a></p></blockquote><p>Artifact Streaming ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€Azure Container Registry (ACR) ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚</p><p>ã¯ã˜ã‚ã«ã€ä»Šå›åˆ©ç”¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ ACR ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr import -n &#123;ACR_NAME&#125; \</span></span><br><span class="line"><span class="bash">    --<span class="built_in">source</span> docker.io/jupyter/all-spark-notebook:latest \</span></span><br><span class="line"><span class="bash">    -t jupyter/all-spark-notebook:latest</span></span><br></pre></td></tr></table></figure><p>ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ãŸã‚‰ã€Artifact Streaming ã‚’ä½œæˆã—ã¾ã™ã€‚<br>ä½œæˆã«ã¯ã—ã°ã‚‰ãæ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr artifact-streaming create -n &#123;ACR_NAME&#125; \</span></span><br><span class="line"><span class="bash">    --image jupyter/all-spark-notebook:latest</span></span><br></pre></td></tr></table></figure><p><code>az acr artifact-streaming create</code> ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä½œæˆã®é€²æ—ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ä¾‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br><code>az acr artifact-streaming operation show</code> ã‚³ãƒãƒ³ãƒ‰ã§é€²æ—ãŒç¢ºèªã§ãã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr artifact-streaming operation show -n &#123;ACR_NAME&#125; \</span></span><br><span class="line"><span class="bash">    --repository jupyter/all-spark-notebook \</span></span><br><span class="line"><span class="bash">    --id d7ea8de0-1810-48a1-b9b8-ed7f667ae1f6</span></span><br><span class="line"></span><br><span class="line">Command group &#x27;acr artifact-streaming&#x27; is in preview and under development. Reference and support levels: https://aka.ms/CLI_refstatus</span><br><span class="line">&#123;</span><br><span class="line">  &quot;details&quot;: &quot;Conversion ongoing for resource jupyter/all-spark-notebook@sha256:b63bae2d9d34779ac969deeb4834efd838991f77269ca9a76bf6b0d1f8678d29&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;ArtifactStreamingConversion&quot;,</span><br><span class="line">  &quot;progress&quot;: &quot;8%&quot;,</span><br><span class="line">  &quot;resource&quot;: &quot;jupyter/all-spark-notebook@sha256:b63bae2d9d34779ac969deeb4834efd838991f77269ca9a76bf6b0d1f8678d29&quot;,</span><br><span class="line">  &quot;startTime&quot;: &quot;2023-12-07T07:27:12Z&quot;,</span><br><span class="line">  &quot;status&quot;: &quot;Running&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Artifact Streaming ã®ä½œæˆãŒå®Œäº†ã—ãŸã‚‰ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å­˜åœ¨ã™ã‚‹ Artifact Streaming ã®ä¸€è¦§ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br><code>az acr manifest list-referrers</code> ã‚³ãƒãƒ³ãƒ‰ã«ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªåã¨ã‚¤ãƒ¡ãƒ¼ã‚¸åã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚<br><code>&quot;artifactType&quot;</code> ãŒ <code>&quot;application/vnd.azure.artifact.streaming.v1&quot;</code> ã¨ãªã£ã¦ã„ã¾ã™ã­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr manifest list-referrers -r &#123;ACR_NAME&#125; \</span></span><br><span class="line"><span class="bash">    -n jupyter/all-spark-notebook:latest</span></span><br><span class="line"></span><br><span class="line">Command group &#x27;acr manifest&#x27; is in preview and under development. Reference and support levels: https://aka.ms/CLI_refstatus</span><br><span class="line">&#123;</span><br><span class="line">  &quot;manifests&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;annotations&quot;: &#123;</span><br><span class="line">        &quot;streaming.format&quot;: &quot;overlaybd&quot;,</span><br><span class="line">        &quot;streaming.platform.arch&quot;: &quot;amd64&quot;,</span><br><span class="line">        &quot;streaming.platform.os&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;streaming.version&quot;: &quot;v1&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;artifactType&quot;: &quot;application/vnd.azure.artifact.streaming.v1&quot;,</span><br><span class="line">      &quot;digest&quot;: &quot;sha256:2cba83dae18f99b6c958e9e34421dadaeee0db1cde4adc0241180de80efd4f34&quot;,</span><br><span class="line">      &quot;mediaType&quot;: &quot;application/vnd.oci.image.manifest.v1+json&quot;,</span><br><span class="line">      &quot;size&quot;: 17266</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¶šã„ã¦ AKS å´ã®è¨­å®šã‚’ã—ã¾ã™ã€‚<br>Artifact Streaming ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€Artifact Streaming ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ãŸ AKS ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚</p><p><code>az aks nodepool add</code> ã‚³ãƒãƒ³ãƒ‰ã« <code>--enable-artifact-streaming</code> ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã—ã¦ã€æ–°ã—ã„ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az aks nodepool add \</span></span><br><span class="line"><span class="bash">    --resource-group myResourceGroup \</span></span><br><span class="line"><span class="bash">    --cluster-name myAKSCluster \</span></span><br><span class="line"><span class="bash">    --name acrtest \</span></span><br><span class="line"><span class="bash">    --node-count 1 \</span></span><br><span class="line"><span class="bash">    --enable-artifact-streaming</span></span><br></pre></td></tr></table></figure><p>ã“ã“ã§ã¯ <code>acrtest</code> ã¨ã„ã†åå‰ã§ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚<br><code>kubectl get nodes</code> ã‚³ãƒãƒ³ãƒ‰ã§ãƒãƒ¼ãƒ‰ã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã€æ–°ã—ã„ãƒãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get nodes</span></span><br><span class="line">NAME                                STATUS   ROLES   AGE     VERSION</span><br><span class="line">aks-acrtest-29138108-vmss000000     Ready    agent   4h15m   v1.27.3</span><br><span class="line">aks-nodepool2-20356098-vmss00001d   Ready    agent   27h     v1.27.3</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§ ACR ã¨ AKS ã®æº–å‚™ã¯å®Œäº†ã§ã™ï¼</p><h3 id="AKS-ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è©¦ã—ã¦ã¿ã‚‹"><a href="#AKS-ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è©¦ã—ã¦ã¿ã‚‹" class="headerlink" title="AKS ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è©¦ã—ã¦ã¿ã‚‹"></a>AKS ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è©¦ã—ã¦ã¿ã‚‹</h3><p>æº–å‚™ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã€Artifact Streaming ã«ã‚ˆã£ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Pull æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºã‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><p>æ¤œè¨¼ã§ã¯ã€Artifact Streaming ãŒç„¡åŠ¹ã®ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã¨ã€æœ‰åŠ¹ã®ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã®ãã‚Œãã‚Œã«ã€åŒã˜ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ Deployment ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚</p><h4 id="Artifact-Streaming-ãŒç„¡åŠ¹ã®å ´åˆ"><a href="#Artifact-Streaming-ãŒç„¡åŠ¹ã®å ´åˆ" class="headerlink" title="Artifact Streaming ãŒç„¡åŠ¹ã®å ´åˆ"></a>Artifact Streaming ãŒç„¡åŠ¹ã®å ´åˆ</h4><p><code>nodeSelector</code> ã‚’ä½¿ç”¨ã—ã¦ã€Artifact Streaming ãŒç„¡åŠ¹ã®ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã« Pod ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jupyter</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">jupyter</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">jupyter</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">jupyter</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">&quot;agentpool&quot;:</span> <span class="string">nodepool2</span>  <span class="comment"># Artifact Streaming ãŒç„¡åŠ¹ã®ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jupyter</span></span><br><span class="line">        <span class="attr">image:</span> &#123;<span class="string">ACR_NAME</span>&#125;<span class="string">.azurecr.io/jupyter/all-spark-notebook:latest</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure><p>YAML ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚<br><code>jupyter-79c4469c65-5cfpf</code> Pod ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get pods -o wide</span></span><br><span class="line">NAME                                          READY   STATUS    RESTARTS   AGE     IP            NODE                                NOMINATED NODE   READINESS GATES</span><br><span class="line">jupyter-79c4469c65-5cfpf                      1/1     Running   0          3m16s   10.244.0.19   aks-nodepool2-20356098-vmss00001i   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p><code>kubectl describe pod</code> ã‚³ãƒãƒ³ãƒ‰ã®çµæœã‹ã‚‰ã€Events ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><p><code>Pulled</code> ã‚¤ãƒ™ãƒ³ãƒˆã§ã¯ã€<code>Successfully pulled image &quot;&#123;ã‚¤ãƒ¡ãƒ¼ã‚¸å&#125;&quot; in 1m25.27926119s</code> ã®ã‚ˆã†ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚<br>ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Pull ã« 1åˆ†25ç§’ ã»ã©è¦ã—ãŸã‚ˆã†ã§ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl describe pod jupyter-79c4469c65-5cfpf</span></span><br><span class="line">Name:             jupyter-79c4469c65-5cfpf</span><br><span class="line">  ...</span><br><span class="line">Node:             aks-nodepool2-20356098-vmss00001i/10.240.0.4</span><br><span class="line">  ...</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age    From               Message</span><br><span class="line">  ----    ------     ----   ----               -------</span><br><span class="line">  Normal  Scheduled  3m25s  default-scheduler  Successfully assigned default/jupyter-79c4469c65-5cfpf to aks-nodepool2-20356098-vmss00001i</span><br><span class="line">  Normal  Pulling    3m25s  kubelet            Pulling image &quot;&#123;ACR_NAME&#125;.azurecr.io/jupyter/all-spark-notebook:latest&quot;</span><br><span class="line">  Normal  Pulled     2m     kubelet            Successfully pulled image &quot;&#123;ACR_NAME&#125;.azurecr.io/jupyter/all-spark-notebook:latest&quot; in 1m25.27926119s (1m25.279277391s including waiting)</span><br><span class="line">  Normal  Created    2m     kubelet            Created container jupyter</span><br><span class="line">  Normal  Started    119s   kubelet            Started container jupyter</span><br></pre></td></tr></table></figure><h4 id="Artifact-Streaming-ãŒæœ‰åŠ¹ã®å ´åˆ"><a href="#Artifact-Streaming-ãŒæœ‰åŠ¹ã®å ´åˆ" class="headerlink" title="Artifact Streaming ãŒæœ‰åŠ¹ã®å ´åˆ"></a>Artifact Streaming ãŒæœ‰åŠ¹ã®å ´åˆ</h4><p>ç¶šã„ã¦ Artifact Streaming ã‚’åˆ©ç”¨ã—ãŸå ´åˆã®å‹•ä½œã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><p><code>nodeSelector</code> ã‚’ä½¿ç”¨ã—ã¦ã€Artifact Streaming ãŒæœ‰åŠ¹ã®ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã« Pod ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚<br>Pod åã‚„ã‚³ãƒ³ãƒ†ãƒŠãƒ¼åã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ãŒã€ä½¿ç”¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯å…ˆã»ã©ã¨åŒã˜ <code>&#123;ACR_NAME&#125;.azurecr.io/jupyter/all-spark-notebook:latest</code> ã§ã™ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jupyter-artifact-streaming</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">jupyter-artifact-streaming</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">jupyter-artifact-streaming</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">jupyter-artifact-streaming</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">&quot;agentpool&quot;:</span> <span class="string">acrtest</span>  <span class="comment"># Artifact Streaming ãŒæœ‰åŠ¹ã®ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jupyter</span></span><br><span class="line">        <span class="attr">image:</span> &#123;<span class="string">ACR_NAME</span>&#125;<span class="string">.azurecr.io/jupyter/all-spark-notebook:latest</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure><p>YAML ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚<br><code>jupyter-artifact-streaming-5b58c9c797-pxs4l</code> Pod ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’æŒ‡å®šã—ãŸã®ã§ã€<code>acrtest</code>ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã®ãƒãƒ¼ãƒ‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get pods -o wide</span></span><br><span class="line">NAME                                          READY   STATUS    RESTARTS   AGE     IP            NODE                                NOMINATED NODE   READINESS GATES</span><br><span class="line">jupyter-79c4469c65-c8hm6                      1/1     Running   0          2m10s   10.244.1.24   aks-nodepool2-20356098-vmss00001d   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">jupyter-artifact-streaming-5b58c9c797-pxs4l   1/1     Running   0          6s      10.244.2.5    aks-acrtest-29138108-vmss000000     &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p><code>kubectl describe pod</code> ã‚³ãƒãƒ³ãƒ‰ã®çµæœã‹ã‚‰ã€Events ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><p><code>Pulling</code> ã‚¤ãƒ™ãƒ³ãƒˆã§ã¯ã€<code>Streaming enabled for &quot;&#123;ã‚¤ãƒ¡ãƒ¼ã‚¸å&#125;&quot;</code> ã®ã‚ˆã†ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ãŠã‚Šã€Artifact Streaming ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚</p><p>ã¾ãŸã€<code>Pulled</code> ã‚¤ãƒ™ãƒ³ãƒˆã§ã¯ã€<code>Successfully pulled image &quot;&#123;ã‚¤ãƒ¡ãƒ¼ã‚¸å&#125;&quot; in 3.442267417s</code> ã®ã‚ˆã†ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚<br>ãŠã‚ˆã 3.44 ç§’ã»ã©ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ Pull ãŒå®Œäº†ã—ã¾ã—ãŸï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl describe pod jupyter-artifact-streaming-5b58c9c797-pxs4l</span></span><br><span class="line">Name:             jupyter-artifact-streaming-5b58c9c797-pxs4l</span><br><span class="line">  ...</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age        From                                                   Message</span><br><span class="line">  ----    ------     ----       ----                                                   -------</span><br><span class="line">  Normal  Pulling    &lt;unknown&gt;  acr-nodemon, kubelet, aks-acrtest-29138108-vmss000000  Streaming enabled for &quot;&#123;ACR_NAME&#125;.azurecr.io/jupyter/all-spark-notebook:latest&quot;, upgraded to streaming artifact with digest &quot;sha256:2cba83dae18f99b6c958e9e34421dadaeee0db1cde4adc0241180de80efd4f34&quot;, container started in 5s</span><br><span class="line">  Normal  Scheduled  19s        default-scheduler                                      Successfully assigned default/jupyter-artifact-streaming-5b58c9c797-pxs4l to aks-acrtest-29138108-vmss000000</span><br><span class="line">  Normal  Pulling    19s        kubelet                                                Pulling image &quot;&#123;ACR_NAME&#125;.azurecr.io/jupyter/all-spark-notebook:latest&quot;</span><br><span class="line">  Normal  Pulled     15s        kubelet                                                Successfully pulled image &quot;&#123;ACR_NAME&#125;.azurecr.io/jupyter/all-spark-notebook:latest&quot; in 3.442267417s (3.442273818s including waiting)</span><br><span class="line">  Normal  Created    14s        kubelet                                                Created container jupyter</span><br><span class="line">  Normal  Started    14s        kubelet                                                Started container jupyter</span><br></pre></td></tr></table></figure><p>Artifact Streaming ã‚’ä½¿ã‚ãªã„å ´åˆã§ã¯ 1åˆ†25ç§’ ã»ã©è¦ã—ãŸãŸã‚ã€å¤§å¹…ã«çŸ­ç¸®ã•ã‚Œã¦ã„ã¾ã™ã­ï¼</p><h3 id="Artifact-Streaming-ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯ï¼Ÿ"><a href="#Artifact-Streaming-ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯ï¼Ÿ" class="headerlink" title="Artifact Streaming ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯ï¼Ÿ"></a>Artifact Streaming ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯ï¼Ÿ</h3><p><code>az acr artifact-streaming delete</code> ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã¯å­˜åœ¨ã—ãªã„ã‚ˆã†ã§ã™ã€‚</p><p>ä½œæˆã—ãŸ Artifact Streaming ã‚’å‰Šé™¤ã—ãŸã„å ´åˆã«ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã«å­˜åœ¨ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸è‡ªä½“ã‚’å‰Šé™¤ã—ã¾ã™ã€‚<br>ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å‰Šé™¤ã«ã¨ã‚‚ãªã„ Artifact Streaming ã‚‚ä¸€ç·’ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr repository delete -n &#123;ACR_NAME&#125; --repository jupyter/all-spark-notebook</span></span><br></pre></td></tr></table></figure><h3 id="ã©ã®ã‚ˆã†ãªã—ãã¿ãªã®ã‹ï¼Ÿ"><a href="#ã©ã®ã‚ˆã†ãªã—ãã¿ãªã®ã‹ï¼Ÿ" class="headerlink" title="ã©ã®ã‚ˆã†ãªã—ãã¿ãªã®ã‹ï¼Ÿ"></a>ã©ã®ã‚ˆã†ãªã—ãã¿ãªã®ã‹ï¼Ÿ</h3><p>Artifact Streaming ã‚’ä½¿ã†ã¨ã€ãªãœã‚¤ãƒ¡ãƒ¼ã‚¸ Pull ã®æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><p>Artifact Streaming ã§ã¯ã€OverlayBD ã‚¤ãƒ¡ãƒ¼ã‚¸ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã„ã†ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚</p><blockquote><p>ã”å‚è€ƒ) containerd/overlaybd<br><a href="https://github.com/containerd/overlaybd">https://github.com/containerd/overlaybd</a></p></blockquote><blockquote><p>ã”å‚è€ƒ) containerd/accelerated-container-image<br><a href="https://github.com/containerd/accelerated-container-image">https://github.com/containerd/accelerated-container-image</a></p></blockquote><p>OverlayBD ã¯ã€ã‚¢ãƒªãƒãƒã‚¯ãƒ©ã‚¦ãƒ‰ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸åŠ é€ŸæŠ€è¡“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ DADI ã§é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚</p><blockquote><p>DADI: Alibaba Cloudâ€™s Open-Source Accelerated Container Image Technology<br><a href="https://www.alibabacloud.com/blog/dadi-alibaba-clouds-open-source-accelerated-container-image-technology_597956">https://www.alibabacloud.com/blog/dadi-alibaba-clouds-open-source-accelerated-container-image-technology_597956</a></p></blockquote><p>OverlayBD ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä»®æƒ³ãƒ–ãƒ­ãƒƒã‚¯ ãƒ‡ãƒã‚¤ã‚¹ã¨ã—ã¦æä¾›ã—ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚<br>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¯ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’é€šã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã—ã¾ã™ã€‚<br>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®èµ·å‹•å‰ã«ã‚¤ãƒ¡ãƒ¼ã‚¸å…¨ä½“ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚„å±•é–‹ã™ã‚‹ã“ã¨ãªãã€å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã«èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ‰ãƒ©ã‚¤ãƒ–ã«ä¿å­˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€æ‰‹å…ƒã®ãƒã‚·ãƒ³ã«ä¸€åº¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰é–‹ãã®ã§ã¯ãªãã€SMB/CIFS ã§ãƒã‚¦ãƒ³ãƒˆã—ã¦ç›´æ¥é–‹ãæ§˜å­ã«ä¼¼ã¦ã„ã¾ã™ã­ã€‚</p><p>Pod ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€<code>df</code> ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å‡ºåŠ›çµæœã®ä¸­ã« <code>io.containerd.snapshotter.v1.overlaybd</code> ã®æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@aks-acrtest-29138108-vmss000000:/# df -h | grep overlaybd</span><br><span class="line">/dev/sdc        252G  5.6G  234G   3% /var/lib/containerd/io.containerd.snapshotter.v1.overlaybd/snapshots/239/block/mountpoint</span><br></pre></td></tr></table></figure><hr><h2 id="ã•ã„ã”ã«"><a href="#ã•ã„ã”ã«" class="headerlink" title="ã•ã„ã”ã«"></a>ã•ã„ã”ã«</h2><p>æœ¬è¨˜äº‹ã§ã¯ã€Artifact Streaming ã®æ¦‚è¦ã¨ã€å®Ÿéš›ã« AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¸ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸæ§˜å­ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚<br>ã‚µã‚¤ã‚ºã®å¤§ãã„ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ Pod ã§èµ·å‹•æ™‚é–“ã‚’çŸ­ç¸®ã—ãŸã„å ´åˆã«ã€åˆ©ç”¨ã‚’æ¤œè¨ã—ã¦ã¿ã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚</p><p>ä»Šå›ç´¹ä»‹ã—ã¾ã—ãŸ Artifact Streaming ãŒã€ä»Šå¾Œã®æŠ€è¡“é¸å®šã‚„ AKS ã‚’ã‚ˆã‚Šã”æ´»ç”¨ã„ãŸã ãã†ãˆã§ã®ã”å‚è€ƒã«ãªã‚Šã¾ã—ãŸã‚‰å¹¸ã„ã§ã™ã€‚</p><p>Artifact Streaming ã¯2023å¹´12æœˆç¾åœ¨ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã—ã¦æä¾›ã•ã‚Œã¦ãŠã‚Šã¾ã™ã€‚ã”åˆ©ç”¨ã„ãŸã ãã¾ã—ãŸéš›ã«ãŠæ°—ã¥ãã®ç‚¹ã‚„ã”è¦æœ›ãªã©ãŒã”ã–ã„ã¾ã—ãŸéš›ã¯ã€ãŠæ°—å…¼ã­ãªããƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã„ãŸã ã‘ã¾ã—ãŸã‚‰å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚<br>ã¾ãŸã€AKS ã®ã”åˆ©ç”¨ã«ãŠã„ã¦ã€ãŠå›°ã‚Šã®ç‚¹ã‚„ã”ä¸æ˜ç‚¹ãŒã‚ã‚Šã¾ã—ãŸéš›ã¯ã€ã„ã¤ã§ã‚‚ Azure ã‚µãƒãƒ¼ãƒˆã¾ã§ãŠæ°—å…¼ã­ãªãã”ç›¸è«‡ãã ã•ã„ã€‚</p><hr><p>æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼<br><a href="https://qiita.com/advent-calendar/2023/microsoft-azure-tech">Microsoft Azure Tech Advent Calendar 2023</a> ã¯æ˜æ—¥ãŒæœ€çµ‚æ—¥ã¨ãªã‚Šã¾ã™ã€‚æ˜¯éã”è¦§ãã ã•ã„ãƒ¼ï¼</p><p>æœ¬å¹´ã¯å¤šãã®ãŠå®¢æ§˜ã«ãŠä¸–è©±ã«ãªã‚Šã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚<br>æ¥å¹´ã‚‚ã¿ãªã•ã¾ã«ã¨ã£ã¦ç´ æ™´ã‚‰ã—ã„å¹´ã§ã‚ã‚Šã¾ã™ã‚ˆã†ã«ã€å¿ƒã‚ˆã‚ŠãŠç¥ˆã‚Šç”³ã—ä¸Šã’ã¾ã™ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ã“ã®è¨˜äº‹ã¯ &lt;a href=&quot;https://qiita.com/advent-calendar/2023/microsoft-azure-tech&quot;&gt;Microsoft Azure Tech Advent Calendar 2023&lt;/a&gt; ã® 24 æ—¥ç›®ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ğŸ…&lt;/p&gt;
&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®æ¡äº•ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://techcommunity.microsoft.com/t5/apps-on-azure-blog/aks-welcomes-you-to-ignite-2023/ba-p/3983317&quot;&gt;Ignite 2023&lt;/a&gt; ã§ã€ACR/AKS é–¢é€£ã®æ©Ÿèƒ½ã¨ã—ã¦Artifact Streaming ãŒç™ºè¡¨ã•ã‚Œã¾ã—ãŸã€‚&lt;br&gt;æœ¬è¨˜äº‹ã§ã¯ã€Artifact Streaming ã‚’ä½¿ã£ã¦ ACR ã«ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ§˜å­ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚&lt;/p&gt;
&lt;p&gt;Artifact Streaming ã¯ 2023/12 ç¾åœ¨ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã¨ã—ã¦æä¾›ã•ã‚Œã¦ãŠã‚Šã¾ã™ã€‚&lt;br&gt;ä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«ã‚ˆã‚Šã€å°†æ¥ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸå†…å®¹ã‹ã‚‰å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã‚’ä½•å’ã”äº†æ‰¿ãã ã•ã„ï¼&lt;/p&gt;</summary>
    
    
    
    
    <category term="Containers" scheme="https://jpaztech.github.io/blog/tags/Containers/"/>
    
    <category term="Azure Kubernetes Service (AKS)" scheme="https://jpaztech.github.io/blog/tags/Azure-Kubernetes-Service-AKS/"/>
    
    <category term="Azure Container Registry (ACR)" scheme="https://jpaztech.github.io/blog/tags/Azure-Container-Registry-ACR/"/>
    
  </entry>
  
  <entry>
    <title>ACR ã® Firewall æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã§ ACR ã®æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦</title>
    <link href="https://jpaztech.github.io/blog/containers/acr-how-to-build-image-with-firewall/"/>
    <id>https://jpaztech.github.io/blog/containers/acr-how-to-build-image-with-firewall/</id>
    <published>2023-12-22T03:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.108Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã®è¨˜äº‹ã¯<a href="https://qiita.com/advent-calendar/2023/microsoft-azure-tech">Microsoft Azure Tech Advent Calendar 2023</a> ã® 22 æ—¥ç›®ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚</p><p>ã“ã‚“ã«ã¡ã¯ï¼ Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å·ç•‘ã§ã™ã€‚<br>az acr buildã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«ã€ACR ã® Firewall æ©Ÿèƒ½ã«ã‚ˆã£ã¦å¤±æ•—ã™ã‚‹ãŠå•ã„åˆã‚ã›ã‚’é ‚ãã¾ã™ã€‚<br>ã“ã®è¨˜äº‹ã§ã¯ã€ACR ã®Firewall æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã§ ACR ã®æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚</p><span id="more"></span><hr><h2 id="ACR-ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯-ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯-ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã¨ã¯"><a href="#ACR-ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯-ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯-ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã¨ã¯" class="headerlink" title="ACR ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã¨ã¯"></a>ACR ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã¨ã¯</h2><p>ACR ã§ã¯ã€ãŠå®¢æ§˜ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ãªã© OCI ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ã‚ˆã‚Šå®‰å…¨ã«ç®¡ç†ã„ãŸã ããŸã‚ã«ã€ACR ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªç«¯æœ«ã‚’åˆ¶é™ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã®è¨­å®šã«ã¯ã€æ¬¡ã®3 ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚</p><ul><li><p>ã€Œã™ã¹ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€<br>åå‰ã®é€šã‚Šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ã‚’å®Ÿæ–½ã„ãŸã—ã¾ã›ã‚“ã€‚<br>ãã®ãŸã‚ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å—ã‘ä»˜ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚</p></li><li><p>ã€Œé¸æŠã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€<br>ACR ã® Firewall æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ™ãƒ¼ã‚¹ã§ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚’è¨­ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ãªãŠã€ã“ã“ã§è¨±å¯å¯èƒ½ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã¯ CIDR å½¢å¼ã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ¬ãƒ³ã‚¸ã‚’è¨±å¯ã™ã‚‹ã“ã¨ãªã©ã‚‚å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚</p><div class="alert is-warning"><p class="alert-title">è­¦å‘Š</p><p>è¨±å¯å¯èƒ½ãª IP è¦å‰‡ã¯æœ€å¤§ 100 å€‹ã¾ã§ã¨ãªã‚Šã¾ã™ã€‚</br></p><p>ã€€ã”å‚è€ƒæƒ…å ±ï¼šãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ«ãƒ¼ãƒ«ã‚’æ§‹æˆã™ã‚‹ </br></p><p>ã€€<a href="https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-access-selected-networks">https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-access-selected-networks</a> </br></p></div><div class="alert is-warning"><p class="alert-title">è­¦å‘Š</p><p>ã“ã®è¨­å®šã‚’å…¥ã‚Œã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€Azure Portal ã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã®æƒ…å ±ã‚’å‚ç…§ã§ããªããªã‚‹ å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</br></p><p>ã“ã‚Œã¯ã€Azure Portal ã‚’ç”¨ã„ã¦ ACR ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç«¯æœ«ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„ãŸã‚ã¨ãªã‚Šã¾ã™ã€‚</br></p><p>ãã®ãŸã‚ã€Azure Portal ã‚ˆã‚Š ACR å†…ã®æƒ…å ±ã‚’å‚ç…§ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç«¯æœ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚</p></div></li><li><p>ã€Œç„¡åŠ¹ã€<br>åå‰ã®é€šã‚Šãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹çµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å…¨ã¦é˜²ãã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã®è¨­å®šã ã‘ã§ã¯ã€ACR ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªç«¯æœ«ãŒå­˜åœ¨ã—ãªããªã‚‹ãŸã‚ã€ã‚ã‚ã›ã¦ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’çµŒç”±ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ãªã‚ˆã†ã«æ§‹æˆã„ãŸã ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>ä¸‹è¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨­å®šæ–¹æ³•ãŒã¾ã¨ã¾ã£ã¦ãŠã‚Šã¾ã™ã®ã§ã€ã‚ã‚ã›ã¦ã”å‚ç…§ãã ã•ã„ã€‚<br>ã€€ã”å‚è€ƒæƒ…å ±ï¼šAzure Private Link ã‚’ä½¿ç”¨ã—ã¦ Azure Container Registry ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§æ¥ç¶šã™ã‚‹<br>ã€€<a href="https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-private-link">https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-private-link</a></p></li></ul><h2 id="ACR-ãƒ“ãƒ«ãƒ‰ã¨ã¯"><a href="#ACR-ãƒ“ãƒ«ãƒ‰ã¨ã¯" class="headerlink" title="ACR ãƒ“ãƒ«ãƒ‰ã¨ã¯"></a>ACR ãƒ“ãƒ«ãƒ‰ã¨ã¯</h2><p>ACR ãƒ“ãƒ«ãƒ‰ã¨ã¯ã€ãŠå®¢æ§˜ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç«¯æœ«ä¸Šã§ã¯ãªãã€Azure ãŒç®¡ç†ã—ã¦ã„ã‚‹å„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«å­˜åœ¨ã™ã‚‹ ACR ç”¨ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹æ©Ÿèƒ½ã¨ãªã‚Šã¾ã™ã€‚</p><p>ã“ã®æ©Ÿèƒ½ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ãŠå®¢æ§˜ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç«¯æœ«ã«ã¦ Docker ãªã©ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãªãã€Azure ãŒç”¨æ„ã—ã¦ã„ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã€ACR ã¸ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚</p><p>ä¸‹è¨˜ ã¯ ACR ãƒ“ãƒ«ãƒ‰ã®å®Ÿè¡Œçµæœã®ä¸€ä¾‹ã¨ãªã‚Šã¾ã™ã€‚<br>ä»Šå›ã®ä¾‹ã§ã¯ã€ å¤–éƒ¨ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãƒ¼ (mcr.microsoft.com) ã‚ˆã‚Š hello-world ã¨ã„ã†ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã—ã€èµ·å‹•ã™ã‚‹ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã€ACR ã¸ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚</p><p>ã¾ãšã¯ã€Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ãŸã‚ã« Dockerfile ã‚’ç”¨æ„ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;FROM mcr.microsoft.com/hello-world&quot;</span> &gt; Dockerfile</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat Dockerfile</span> </span><br><span class="line">FROM mcr.microsoft.com/hello-world</span><br></pre></td></tr></table></figure><p>ãã‚Œã§ã¯ã€ã“ã® Dockerfile ã‚’åŸºã« ACR ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ã£ã¦ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã€ACR ã¸ãƒ—ãƒƒã‚·ãƒ¥ã‚’è¡Œã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr build --registry blogbuildtest --image buildtest/hello-world:v1 --file Dockerfile .</span></span><br><span class="line">Packing source code into tar to upload...</span><br><span class="line">Uploading archived source code from &#x27;/tmp/build_archive_6d41a3f0c1e24e1cbac736d1b271ad6c.tar.gz&#x27;...</span><br><span class="line">Sending context (345.000 Bytes) to registry: blogbuildtest...</span><br><span class="line">Queued a build with ID: ca1</span><br><span class="line">Waiting for an agent...</span><br><span class="line">2023/12/11 05:16:49 Downloading source code...</span><br><span class="line">2023/12/11 05:16:49 Finished downloading source code</span><br><span class="line">2023/12/11 05:16:50 Using acb_vol_4cfc16ec-0963-4b43-8581-f87207679198 as the home volume</span><br><span class="line">2023/12/11 05:16:50 Setting up Docker configuration...</span><br><span class="line">2023/12/11 05:16:50 Successfully set up Docker configuration</span><br><span class="line">2023/12/11 05:16:50 Logging in to registry: blogbuildtest.azurecr.io</span><br><span class="line">2023/12/11 05:16:51 Successfully logged into blogbuildtest.azurecr.io</span><br><span class="line">2023/12/11 05:16:51 Executing step ID: build. Timeout(sec): 28800, Working directory: &#x27;&#x27;, Network: &#x27;&#x27;</span><br><span class="line">2023/12/11 05:16:51 Scanning for dependencies...</span><br><span class="line">2023/12/11 05:16:51 Successfully scanned dependencies</span><br><span class="line">2023/12/11 05:16:51 Launching container with name: build</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/1 : FROM mcr.microsoft.com/hello-world</span><br><span class="line">latest: Pulling from hello-world</span><br><span class="line">1b930d010525: Pulling fs layer</span><br><span class="line">1b930d010525: Verifying Checksum</span><br><span class="line">1b930d010525: Download complete</span><br><span class="line">1b930d010525: Pull complete</span><br><span class="line">Digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a</span><br><span class="line">Status: Downloaded newer image for mcr.microsoft.com/hello-world:latest</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> fce289e99eb9</span></span><br><span class="line">Successfully built fce289e99eb9</span><br><span class="line">Successfully tagged blogbuildtest.azurecr.io/buildtest/hello-world:v1</span><br><span class="line">2023/12/11 05:16:52 Successfully executed container: build</span><br><span class="line">2023/12/11 05:16:52 Executing step ID: push. Timeout(sec): 3600, Working directory: &#x27;&#x27;, Network: &#x27;&#x27;</span><br><span class="line">2023/12/11 05:16:52 Pushing image: blogbuildtest.azurecr.io/buildtest/hello-world:v1, attempt 1</span><br><span class="line">The push refers to repository [blogbuildtest.azurecr.io/buildtest/hello-world]</span><br><span class="line">af0b15c8625b: Preparing</span><br><span class="line">af0b15c8625b: Pushed</span><br><span class="line">v1: digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a size: 524</span><br><span class="line">2023/12/11 05:16:54 Successfully pushed image: blogbuildtest.azurecr.io/buildtest/hello-world:v1</span><br><span class="line">2023/12/11 05:16:54 Step ID: build marked as successful (elapsed time in seconds: 1.093391)</span><br><span class="line">2023/12/11 05:16:54 Populating digests for step ID: build...</span><br><span class="line">2023/12/11 05:16:54 Successfully populated digests for step ID: build</span><br><span class="line">2023/12/11 05:16:54 Step ID: push marked as successful (elapsed time in seconds: 1.829038)</span><br><span class="line">2023/12/11 05:16:54 The following dependencies were found:</span><br><span class="line">2023/12/11 05:16:54 </span><br><span class="line">- image:</span><br><span class="line">    registry: blogbuildtest.azurecr.io</span><br><span class="line">    repository: buildtest/hello-world</span><br><span class="line">    tag: v1</span><br><span class="line">    digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a</span><br><span class="line">  runtime-dependency:</span><br><span class="line">    registry: mcr.microsoft.com</span><br><span class="line">    repository: hello-world</span><br><span class="line">    tag: latest</span><br><span class="line">    digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a</span><br><span class="line">  git: &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Run ID: ca1 was successful after 6s</span><br></pre></td></tr></table></figure><p>ã—ã‹ã—ãªãŒã‚‰ã€ä¸Šè¿°ã®é€šã‚Šã€ACR ãƒ“ãƒ«ãƒ‰ã¯ Azure ã«ã¦ç®¡ç†ã—ã¦ã„ã‚‹å„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«å­˜åœ¨ã™ã‚‹ ACR ç”¨ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã€ACR ã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚’ã™ã‚‹æ©Ÿèƒ½ã§ã‚ã‚‹ãŸã‚ã€<strong>ACR ç”¨ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ãŠå®¢æ§˜ã® ACR ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹</strong>ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</p><p>ã“ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ãŸã‚ã€ACR ã® Firewall æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ãŒã‚Œã¦ã„ã‚‹ ACR ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¤±æ•—ã™ã‚‹ã“ã¨ãŒäºˆæƒ³ã•ã‚Œã¾ã™ã€‚</p><p>è©¦ã—ã« Azure VM ã‚’ç”¨æ„ã—ã€ã“ã® Azure VM ãŒåˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ ACR ã® Firewall æ©Ÿèƒ½ã«ã‚ˆã£ã¦è¨±å¯ã—ã¾ã™ã€‚</p><p>ã“ã®è¨­å®šã®å ´åˆã€Azure VM ã‹ã‚‰ ACR ã¸ã®é€šä¿¡ã¯æˆåŠŸã™ã‚‹ãŸã‚ã€ACR ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å–å¾—ç­‰ã¯å®Ÿè¡Œã§ãã¾ã™ãŒã€ACR ãƒ“ãƒ«ãƒ‰ã¯å¤±æ•—ã—ã¾ã™ã€‚</p><p>ä½œæˆã—ãŸ Azure VM ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã‚ã‚Šã€å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ 4.xxx.xxx.xxx ã¨ãªã‚Šã¾ã™ã€‚</p><p><img src="/blog/containers/acr-how-to-build-image-with-firewall/vm_information.png"><br>ãã‚Œã§ã¯ã€ã“ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ ACR ã® Firewall æ©Ÿèƒ½ã§è¨±å¯ã—ã¾ã™ã€‚</p><p><img src="/blog/containers/acr-how-to-build-image-with-firewall/acr_information.png"><br>ã§ã¯ã€Azure VM ã« SSH ã‚’ã—ã¦ã€Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ ACR ã‹ã‚‰å–å¾—ã—ã¦ã¿ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker pull blogbuildtest.azurecr.io/buildtest/hello-world:v1</span></span><br><span class="line">v1: Pulling from buildtest/hello-world</span><br><span class="line">1b930d010525: Pull complete</span><br><span class="line">Digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a</span><br><span class="line">Status: Downloaded newer image for blogbuildtest.azurecr.io/buildtest/hello-world:v1</span><br><span class="line">blogbuildtest.azurecr.io/buildtest/hello-world:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker images</span></span><br><span class="line">REPOSITORY                                       TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">blogbuildtest.azurecr.io/buildtest/hello-world   v1        fce289e99eb9   4 years ago   1.84kB</span><br></pre></td></tr></table></figure><p>docker pull ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ ACR ã‹ã‚‰å–å¾—å‡ºæ¥ã¾ã—ãŸã€‚<br>æ¬¡ã« ACR ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã‚’ã—ã¦ã¿ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr build --registry blogbuildtest --image buildtestfromvm/hello-world:v1 --file Dockerfile .</span></span><br><span class="line">Packing source code into tar to upload...</span><br><span class="line">Uploading archived source code from &#x27;/tmp/build_archive_ba9f4b643e5b4b79b251d6213e8abd99.tar.gz&#x27;...</span><br><span class="line">Sending context (26.336 KiB) to registry: blogbuildtest...</span><br><span class="line">Queued a build with ID: ca2</span><br><span class="line">Waiting for an agent...</span><br><span class="line">2023/12/11 06:06:48 Downloading source code...</span><br><span class="line">2023/12/11 06:06:48 Finished downloading source code</span><br><span class="line">2023/12/11 06:06:48 Using acb_vol_f6e0b320-1247-4584-b5c3-c620a4d138e5 as the home volume</span><br><span class="line">2023/12/11 06:06:48 Setting up Docker configuration...</span><br><span class="line">2023/12/11 06:06:49 Successfully set up Docker configuration</span><br><span class="line">2023/12/11 06:06:49 Logging in to registry: blogbuildtest.azurecr.io</span><br><span class="line">failed to login, ran out of retries: failed to set docker credentials: Error response from daemon: Get &quot;https://blogbuildtest.azurecr.io/v2/&quot;: denied: client with IP &#x27;52.xxx. xxx.  xxx &#x27; is not allowed access. Refer https://aka.ms/acr/firewall to grant access.</span><br><span class="line">: exit status 1</span><br><span class="line">Run ID: ca2 failed after 5s. Error: failed during run, err: exit status 1</span><br><span class="line">Run failed</span><br></pre></td></tr></table></figure><p>äºˆæƒ³é€šã‚Š Failed ã¨ãªã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚<br>ãªãŠã€ã“ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ 52.xxx.xxx.xxx ãŒ ACR ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãªã‚Šã€ã“ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‹ã‚‰å‡¦ç†ãŒå¤±æ•—ã—ãŸã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚</p><h2 id="ACR-ãƒ“ãƒ«ãƒ‰ã®ä»£æ›¿ç­–"><a href="#ACR-ãƒ“ãƒ«ãƒ‰ã®ä»£æ›¿ç­–" class="headerlink" title="ACR ãƒ“ãƒ«ãƒ‰ã®ä»£æ›¿ç­–"></a>ACR ãƒ“ãƒ«ãƒ‰ã®ä»£æ›¿ç­–</h2><p>å‰ç½®ããŒé•·ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ä¸Šè¿°ã®ã‚ˆã†ã« ACR ãƒ“ãƒ«ãƒ‰ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹å ´åˆã€ACR ã® Firewall æ©Ÿèƒ½ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ãŒé˜²ãŒã‚Œã¦ã—ã¾ã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>ã“ã®å›é¿ç­–ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚</p><ol><li><p>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã®è¨­å®šã‚’ã€Œã™ã¹ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã«å¤‰æ›´ã™ã‚‹<br>ACR ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ ACR ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„ã“ã¨ã§æœ¬äº‹è±¡ã¯ç™ºç”Ÿã™ã‚‹ãŸã‚ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å…¨ã¦å—ã‘ä»˜ã‘ã‚‹ã‚ˆã†å¤‰æ›´ã„ãŸã ãã“ã¨ã§äº‹è±¡ãŒæ”¹å–„ã—ã¾ã™ã€‚</p></li><li><p>ACR ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåˆ©ç”¨ã™ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹<br>ACR ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåˆ©ç”¨ã™ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã€Œé¸æŠã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã® IP è¦å‰‡ã«è¿½åŠ ã™ã‚‹æ–¹æ³•ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚<br>Azure ã§ã¯ã€ä¸‹è¨˜ã‚µã‚¤ãƒˆã«ã¦  Azure ã®å„ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨ã™ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã¡ã‚‰ã® AzureContainerRegistry.<region> ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã„ãŸã ãã“ã¨ã§äº‹è±¡ãŒæ”¹å–„ã™ã‚‹ã“ã¨ãŒæƒ³å®šã•ã‚Œã¾ã™ã€‚<br>ã€€ã”å‚è€ƒæƒ…å ±ï¼šDownload Azure IP Ranges and Service Tags â€“ Public Cloud from Official Microsoft Download Center<br>ã€€<a href="https://www.microsoft.com/en-us/download/confirmation.aspx?id=56519">https://www.microsoft.com/en-us/download/confirmation.aspx?id=56519</a></p><div class="alert is-warning"><p class="alert-title">è­¦å‘Š</p><p>ACR å«ã‚ Azure ãŒåˆ©ç”¨ã™ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å‹•çš„ãªã‚‚ã®ã§ã‚ã‚Šã€ä»Šå¾Œå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ãã®ãŸã‚ã€å®šæœŸçš„ã‚‚ã—ãã¯ã‚¢ã‚¯ã‚»ã‚¹ãŒå¤±æ•—ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã‚‰ã€æœ€æ–°ã® ACR ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã”ç¢ºèªãƒ»æ›´æ–°ã„ãŸã ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p></div></li><li><p>ACR ã‚¿ã‚¹ã‚¯ã‚’åˆ©ç”¨ã™ã‚‹<br>ACR ã® Firewall æ©Ÿèƒ½ã§ã¯ã€ã€Œä¿¡é ¼ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã€ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¤ã„ã¦ã¯åˆ¥é€” IP è¦å‰‡ã‚’è¿½åŠ ã„ãŸã ãã“ã¨ãªãã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ãã—ã¦ã€ã“ã® ã€Œä¿¡é ¼ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã€ã«ã€ä¸‹è¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã®é€šã‚Š ACR ã‚¿ã‚¹ã‚¯ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚<br>ã€€ã”å‚è€ƒæƒ…å ±ï¼šä¿¡é ¼ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹<br>ã€€<a href="https://learn.microsoft.com/ja-jp/azure/container-registry/allow-access-trusted-services#trusted-services">https://learn.microsoft.com/ja-jp/azure/container-registry/allow-access-trusted-services#trusted-services</a> </p><p>ACR ã‚¿ã‚¹ã‚¯ã¯ã€ACR ãƒ“ãƒ«ãƒ‰ã®åˆ¶å¾¡ç­‰ã‚’è¡Œã†ã“ã¨ãŒã§ãã€ACR ãƒ“ãƒ«ãƒ‰åŒæ§˜ã«ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ãã®ãŸã‚ã€ACR ãƒ“ãƒ«ãƒ‰ã®ä»£æ›¿æ–¹æ³•ã¨ã—ã¦ ACR ã‚¿ã‚¹ã‚¯ã‚’ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ã§ ACR ã® Firewall æ©Ÿèƒ½ã§ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ã„ã ã¾ã¾ ACR ã®æ©Ÿèƒ½ã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã¦ ACR ã‚¿ã‚¹ã‚¯ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆæ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚</p></li></ol><h2 id="ACR-ã‚¿ã‚¹ã‚¯ã®ã”ç´¹ä»‹"><a href="#ACR-ã‚¿ã‚¹ã‚¯ã®ã”ç´¹ä»‹" class="headerlink" title="ACR ã‚¿ã‚¹ã‚¯ã®ã”ç´¹ä»‹"></a>ACR ã‚¿ã‚¹ã‚¯ã®ã”ç´¹ä»‹</h2><p>ä¸Šè¿°ã®é€šã‚Šã€ACR ã‚¿ã‚¹ã‚¯ã§ã¯ã€ACR ãƒ“ãƒ«ãƒ‰ã¨åŒæ§˜ã« ACR ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ãã‚Œã§ã¯ã€æ—©é€Ÿ ACR ã‚¿ã‚¹ã‚¯ã‚’ä½¿ã£ã¦ Firewall æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã—ãŸ ACR ã«å¯¾ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã€ãƒ—ãƒƒã‚·ãƒ¥ã‚’ã—ã¦ã¿ã¾ã™ã€‚</p><p>ãªãŠã€ãŠãŠã¾ã‹ãªæ‰‹é †ã«ã¤ãã¾ã—ã¦ã¯ã€ä¸‹è¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚<br>ã“ã¡ã‚‰ã‚’å‚è€ƒã«å®Ÿæ–½ã—ã¦ã¿ã¾ã™ã€‚<br>ã€€ã”å‚è€ƒæƒ…å ±ï¼šä¾‹:ACR ã‚¿ã‚¹ã‚¯<br>ã€€<a href="https://learn.microsoft.com/ja-jp/azure/container-registry/allow-access-trusted-services#example-acr-tasks">https://learn.microsoft.com/ja-jp/azure/container-registry/allow-access-trusted-services#example-acr-tasks</a></p><p>ACR ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹å‰ã«äº‹å‰æº–å‚™ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚</p><p>ACR ãƒ“ãƒ«ãƒ‰ã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã«ä½¿ç”¨ã—ã¦ã„ãŸ Dockerfile ã‚’ az acr build ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç«¯æœ«ã«å­˜åœ¨ã—ã¦ã„ã¾ã—ãŸãŒã€ACR ã‚¿ã‚¹ã‚¯ã§ã¯ ACR ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¦ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ãªå ´æ‰€ã«é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>ã“ã“ã§ã¯ã€Dockerfile ã‚’ ACR ä¸Šã«é…ç½®ã—ã€ACR ä¸Šã«é…ç½®ã—ãŸ Dockerfile ã‚’ ACR ã‚¿ã‚¹ã‚¯ã‚ˆã‚Šä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ã¿ã¾ã™ã€‚</p><p>ACR ã« Dockerfile ã‚’é…ç½®ã™ã‚‹ã«ã‚ãŸã‚Šã€ã‚ªãƒ¼ãƒ—ãƒ³ ã‚½ãƒ¼ã‚¹ã«ã¦é–‹ç™ºãŒã•ã‚Œã¦ã„ã‚‹ ORAS ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚<br>ç°¡å˜ãªä½¿ç”¨æ–¹æ³•ã«ã¤ãã¾ã—ã¦ã¯ã€ä¸‹è¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ãŠã‚Šã¾ã™ã®ã§ã€ã”å‚è€ƒãã ã•ã„ã€‚<br>ã€€ã”å‚è€ƒæƒ…å ±ï¼šAzure ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ä½¿ã£ã¦ OCI æˆæœç‰©ã‚’ãƒ—ãƒƒã‚·ãƒ¥ãŠã‚ˆã³ãƒ—ãƒ«ã™ã‚‹<br>ã€€<a href="https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-oci-artifact">https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-oci-artifact</a></p><p>ãã‚Œã§ã¯ã€ORAS ã‚’ä½¿ã£ã¦ Dockerfile ã‚’ ACR ã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> oras push blogbuildtest.azurecr.io/hello-world.dockerfile:1.0 Dockerfile</span></span><br></pre></td></tr></table></figure><p>ä»Šå›ã¯ hello-world.dockerfile ã¨ã„ã†ãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã—ãŸã€‚<br>ã§ã¯ã€ã“ã® hello-world.dockerfile ã‚’ç”¨ã„ã‚‹ã‚ˆã† ACR ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¦ã¿ã¾ã™ã€‚<br>ã‚³ãƒãƒ³ãƒ‰ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªå½¢å¼ã¨ãªã‚Šã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr task create -t &lt;ã‚¤ãƒ¡ãƒ¼ã‚¸å&gt; --registry &lt;ACR å&gt; --name &lt;ã‚¿ã‚¹ã‚¯å&gt; --context oci://&lt;ACR å&gt;.azurecr.io/&lt;Dockerfile ã® OCI ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆå&gt;:&lt;Tag&gt;  --file &lt;Dockerfileå&gt; --assign-identity &lt;[system] | ãƒãƒãƒ¼ã‚¸ãƒ‰ ID ã®ãƒªã‚½ãƒ¼ã‚¹ ID&gt; -g &lt;ãƒªã‚½ãƒ¼ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ—å&gt;</span></span><br></pre></td></tr></table></figure><p>ä»Šå›ã®ç’°å¢ƒã§ã¯ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr task create -t helloworld --registry blogbuildtest --name helloworldtask  --context oci://blogbuildtest.azurecr.io/hello-world.dockerfile:1.0  --file hello-world.dockerfile --assign-identity [system]</span></span><br></pre></td></tr></table></figure><p>ãªãŠã€ã€Œä¿¡é ¼ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã€ã‚’åˆ©ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†å ´åˆã«ã¯ã€ACR ã‚¿ã‚¹ã‚¯ã«ãƒãƒãƒ¼ã‚¸ãƒ‰ ID ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>å…ˆã»ã©å®Ÿè¡Œã—ãŸã‚³ãƒãƒ³ãƒ‰ã«ã¦ã€ä»Šå›ä½œæˆã—ãŸ ACR ã‚¿ã‚¹ã‚¯ã«ã¯ã‚·ã‚¹ãƒ†ãƒ å‰²ã‚Šå½“ã¦ãƒãƒãƒ¼ã‚¸ãƒ‰ ID ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†è¨­å®šã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®ã‚·ã‚¹ãƒ†ãƒ å‰²ã‚Šå½“ã¦ãƒãƒãƒ¼ã‚¸ãƒ‰ ID ã«å¿…è¦ãªæ¨©é™ (ACRPUSH) ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> principalID=$(az acr task show --name helloworldtask --registry tasktest --query identity.principalId --output tsv -g blog</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> baseregID=$(az acr show --name blogbuildtest --query id --output tsv -g blog )</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> az role assignment create --assignee <span class="variable">$principalID</span> --scope <span class="variable">$baseregID</span> --role acrpush</span></span><br></pre></td></tr></table></figure><p>æ¬¡ã«ã€ACR ã‚¿ã‚¹ã‚¯ â€œhelloworldtaskâ€ ã«å¯¾ã—ã¦  ACR â€œblogbuildtestâ€ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ãƒãƒãƒ¼ã‚¸ãƒ‰ ID ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr task credential add --name helloworldtask --registry blogbuildtest --login-server blogbuildtest.azurecr.io --use-identity [system] -g blog</span></span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§æº–å‚™ã¯å®Œäº†ã§ã™ã€‚ãã‚Œã§ã¯ã€ACR ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az acr task run --name helloworldtask --registry blogbuildtest -g blog                                                                                              Queued a run with ID: cad</span></span><br><span class="line">Waiting for an agent...</span><br><span class="line">2023/12/14 19:29:42 Downloading source code...</span><br><span class="line">2023/12/14 19:29:45 Finished downloading source code</span><br><span class="line">2023/12/14 19:29:45 Using acb_vol_efd7cb79-502a-47b0-8e44-9689138ae1cb as the home volume</span><br><span class="line">2023/12/14 19:29:46 Setting up Docker configuration...</span><br><span class="line">2023/12/14 19:29:46 Successfully set up Docker configuration</span><br><span class="line">2023/12/14 19:29:46 Logging in to registry: blogbuildtest.azurecr.io</span><br><span class="line">2023/12/14 19:29:47 Successfully logged into blogbuildtest.azurecr.io</span><br><span class="line">2023/12/14 19:29:47 Executing step ID: build. Timeout(sec): 28800, Working directory: &#x27;&#x27;, Network: &#x27;&#x27;</span><br><span class="line">2023/12/14 19:29:47 Scanning for dependencies...</span><br><span class="line">2023/12/14 19:29:47 Successfully scanned dependencies</span><br><span class="line">2023/12/14 19:29:47 Launching container with name: build</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/1 : FROM mcr.microsoft.com/hello-world</span><br><span class="line">latest: Pulling from hello-world</span><br><span class="line">1b930d010525: Pulling fs layer</span><br><span class="line">1b930d010525: Verifying Checksum</span><br><span class="line">1b930d010525: Download complete</span><br><span class="line">1b930d010525: Pull complete</span><br><span class="line">Digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a</span><br><span class="line">Status: Downloaded newer image for mcr.microsoft.com/hello-world:latest</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> fce289e99eb9</span></span><br><span class="line">Successfully built fce289e99eb9</span><br><span class="line">Successfully tagged blogbuildtest.azurecr.io/helloworld:latest</span><br><span class="line">2023/12/14 19:29:48 Successfully executed container: build</span><br><span class="line">2023/12/14 19:29:48 Executing step ID: push. Timeout(sec): 3600, Working directory: &#x27;&#x27;, Network: &#x27;&#x27;</span><br><span class="line">2023/12/14 19:29:48 Pushing image: blogbuildtest.azurecr.io/helloworld:latest, attempt 1</span><br><span class="line">The push refers to repository [blogbuildtest.azurecr.io/helloworld]</span><br><span class="line">af0b15c8625b: Preparing</span><br><span class="line">af0b15c8625b: Layer already exists</span><br><span class="line">latest: digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a size: 524</span><br><span class="line">2023/12/14 19:29:49 Successfully pushed image: blogbuildtest.azurecr.io/helloworld:latest</span><br><span class="line">2023/12/14 19:29:49 Step ID: build marked as successful (elapsed time in seconds: 1.140930)</span><br><span class="line">2023/12/14 19:29:49 Populating digests for step ID: build...</span><br><span class="line">2023/12/14 19:29:49 Successfully populated digests for step ID: build</span><br><span class="line">2023/12/14 19:29:49 Step ID: push marked as successful (elapsed time in seconds: 0.898327)</span><br><span class="line">2023/12/14 19:29:49 The following dependencies were found:</span><br><span class="line">2023/12/14 19:29:49</span><br><span class="line">- image:</span><br><span class="line">    registry: blogbuildtest.azurecr.io</span><br><span class="line">    repository: helloworld</span><br><span class="line">    tag: latest</span><br><span class="line">    digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a</span><br><span class="line">  runtime-dependency:</span><br><span class="line">    registry: mcr.microsoft.com</span><br><span class="line">    repository: hello-world</span><br><span class="line">    tag: latest</span><br><span class="line">    digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a</span><br><span class="line">  git: &#123;&#125;</span><br><span class="line"></span><br><span class="line">Run ID: cad was successful after 8s</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§ã€Firewall ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã„ã‚‹ ACR ã«å¯¾ã—ã¦ã€ACR ã‚¿ã‚¹ã‚¯ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚</p><h3 id="ã•ã„ã”ã«"><a href="#ã•ã„ã”ã«" class="headerlink" title="ã•ã„ã”ã«"></a>ã•ã„ã”ã«</h3><p>ã“ã®è¨˜äº‹ã§ã¯ã€ACR ã®Firewall æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã§ ACR ã®æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã—ãŸã€‚<br>ã”å‚è€ƒã«ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p><p>æœ¬ç¨¿ãŒçš†æ§˜ã®ãŠå½¹ã«ç«‹ã¡ã¾ã—ãŸã‚‰å¹¸ã„ã§ã™ã€‚</p><p>æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ã“ã®è¨˜äº‹ã¯&lt;a href=&quot;https://qiita.com/advent-calendar/2023/microsoft-azure-tech&quot;&gt;Microsoft Azure Tech Advent Calendar 2023&lt;/a&gt; ã® 22 æ—¥ç›®ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;
&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï¼ Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å·ç•‘ã§ã™ã€‚&lt;br&gt;az acr buildã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«ã€ACR ã® Firewall æ©Ÿèƒ½ã«ã‚ˆã£ã¦å¤±æ•—ã™ã‚‹ãŠå•ã„åˆã‚ã›ã‚’é ‚ãã¾ã™ã€‚&lt;br&gt;ã“ã®è¨˜äº‹ã§ã¯ã€ACR ã®Firewall æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã§ ACR ã®æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Containers" scheme="https://jpaztech.github.io/blog/tags/Containers/"/>
    
    <category term="Azure Container Registry (ACR)" scheme="https://jpaztech.github.io/blog/tags/Azure-Container-Registry-ACR/"/>
    
  </entry>
  
  <entry>
    <title>ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã«ã¤ã„ã¦</title>
    <link href="https://jpaztech.github.io/blog/vm/network-setting-of-disk-and-snapshot/"/>
    <id>https://jpaztech.github.io/blog/vm/network-setting-of-disk-and-snapshot/</id>
    <published>2023-12-18T08:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.440Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚<br>ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã«ã¤ã„ã¦ã€ã©ã†ã„ã£ãŸã‚‚ã®ã§ã‚ã‚‹ã‹ã¨ã„ã£ãŸç‚¹ã‚’ãŠå•ã„åˆã‚ã›ã„ãŸã ãã“ã¨ãŒã”ã–ã„ã¾ã™ã®ã§ã€ã“ã®ç‚¹ã‚’è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><hr><h2 id="ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š"><a href="#ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š" class="headerlink" title="ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š"></a>ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š</h2><p>ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã‚„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ–°è¦ä½œæˆã™ã‚‹éš›ã«ã€ä½œæˆç”»é¢ã«ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã¨ã„ã†ã‚¿ãƒ–ã§ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>ï¼ˆä½œæˆå¾Œã«ã€å¾Œã‹ã‚‰ç·¨é›†ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ï¼‰  </p><p><img src="/blog/vm/network-setting-of-disk-and-snapshot/2023-12-12-14-03-30.png"></p><p>æ—¢å®šã§ã¯ã€ã€Œã™ã¹ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€ã¨ãªã£ã¦ãŠã‚Šã¾ã™ãŸã‚ã€ã€Œãƒ‡ã‚£ã‚¹ã‚¯ã«å¯¾ã—å¤–éƒ¨ã‹ã‚‰ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¦ã—ã¾ã†ã®ã§ã¯ï¼Ÿã€ã¨ã„ã†ãŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ãã“ã¨ã‚‚ã”ã–ã„ã¾ã™ã€‚<br>ã“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨­å®šã¯<strong>ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ã™ã‚‹éš›ã«ã€ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è¨­å®šã™ã‚‹</strong>ã‚‚ã®ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚<br>ã™ãªã‚ã¡ã€æ˜ç¤ºçš„ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ URL ã®ç”Ÿæˆã‚’è¡Œã‚ãªã„å ´åˆã¯ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ä¸Šã®ä¸ç‰¹å®šå¤šæ•°ã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ã¨ã„ã£ãŸã“ã¨ã¯ã”ã–ã„ã¾ã›ã‚“ã®ã§ã”å®‰å¿ƒãã ã•ã„ã€‚<br>ã¾ãŸ Azure VM ã‹ã‚‰æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¸ã®é€šä¿¡ã«å½±éŸ¿ã‚’åŠã¼ã™è¨­å®šã§ã‚‚ã”ã–ã„ã¾ã›ã‚“ã€‚  </p><blockquote><p>â– ã”å‚è€ƒï¼šãƒãƒãƒ¼ã‚¸ãƒ‰ ãƒ‡ã‚£ã‚¹ã‚¯ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã¾ãŸã¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã‚‹æ“ä½œã‚’åˆ¶é™ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/disks-restrict-import-export-overview">https://learn.microsoft.com/ja-jp/azure/virtual-machines/disks-restrict-import-export-overview</a></p></blockquote><hr><h2 id="ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯-ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¤ã„ã¦"><a href="#ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯-ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¤ã„ã¦" class="headerlink" title="ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ / ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¤ã„ã¦"></a>ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ / ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¤ã„ã¦</h2><p>ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã€ãƒãƒ¼ã‚¿ãƒ«ç­‰ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ URL ã‚’ç™ºè¡Œã—ã€VHD ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã†ã¨ã„ã£ãŸã“ã¨ãŒå¯èƒ½ã§ã™ã€‚<br>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è¦³ç‚¹ã‚ˆã‚Šã€æ˜ç¤ºçš„ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ URL ã‚’ç™ºè¡Œã—ãªã„å ´åˆã¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯ã§ããšã€URL ã‚‚æœ‰åŠ¹æœŸé™ã‚’è¨­ã‘ã‚‹å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚  </p><p><img src="/blog/vm/network-setting-of-disk-and-snapshot/2023-12-12-14-05-35.png"></p><blockquote><p>â– ã”å‚è€ƒï¼šAzure ã‹ã‚‰ Windows VHD ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/download-vhd">https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/download-vhd</a></p></blockquote><blockquote><p>â– ã”å‚è€ƒï¼šAzure ã‹ã‚‰ Linux VHD ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/linux/download-vhd">https://learn.microsoft.com/ja-jp/azure/virtual-machines/linux/download-vhd</a></p></blockquote><p>ã“ã®éš›ã€ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ãŠã‚ˆã³ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã«ã¦æ—¢å®šã®ã€Œã™ã¹ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€ã¨ã„ã†è¨­å®šã«ã—ã¦ã„ã‚‹å ´åˆã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ URL ãŒã‚ã‚Œã°ã©ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã‚‚ VHD ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç­‰ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ã—ã‹ã—ãªãŒã‚‰ã€ä¸‡ãŒä¸€æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ URL ãŒå…¥æ‰‹ã•ã‚Œã¦ã—ã¾ã£ãŸå ´åˆã«ã‚‚ VHD ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’ä¸å¯ã¨ã•ã›ã‚‹ãŸã‚ã®è¨­å®šã¨ã—ã¦ã€  </p><ul><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹ã«ã—ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹</li><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹ã«ã™ã‚‹</li></ul><p>ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã”ç”¨æ„ã—ã¦ã„ã‚‹ã¨ã„ã£ãŸã“ã¨ã¨ãªã‚Šã¾ã™ã€‚  </p><p>ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹ã«ã—ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€ã®è¨­å®šã¨ã—ãŸå ´åˆã¯ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ URL ãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã§ããšã€Azure ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ãƒªãƒ³ã‚¯ã‚’ä»‹ã—ã¦ã§ãªã„ã¨ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã¨ã„ã£ãŸã€ã‚ˆã‚Šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é«˜ã„è¨­å®šã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã®ç‚¹è©³ç´°ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®å…¬é–‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚  </p><blockquote><p>â– ã”å‚è€ƒï¼šAzure Private Link ã‚’ä½¿ç”¨ã—ã¦ãƒãƒãƒ¼ã‚¸ãƒ‰ ãƒ‡ã‚£ã‚¹ã‚¯ã«å¯¾ã™ã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŠã‚ˆã³ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/disks-enable-private-links-for-import-export-portal">https://learn.microsoft.com/ja-jp/azure/virtual-machines/disks-enable-private-links-for-import-export-portal</a></p></blockquote><p>ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ã‚¯ã‚»ã‚¹ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã€ã®è¨­å®šã«ã—ãŸå ´åˆã¯ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ URL ã®ç™ºè¡Œè‡ªä½“ãŒä¸å¯ã«ãªã‚Šã¾ã™ã€‚  </p><p>ä¸Šè¨˜ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’ä¾‹ã¨ã—ã¦è¨˜è¼‰ã—ã¾ã—ãŸãŒä»¥ä¸‹ã®ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã«å¯¾ã™ã‚‹ VHD ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã¤ã„ã¦ã‚‚åŒã˜ã‚ˆã†ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åˆ¶é™ã®è¨­å®šã‹å¯èƒ½ã§ã™ã€‚</p><blockquote><p>â– ã”å‚è€ƒï¼šãŠä½¿ã„ã® VHD ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/managed-disks-overview#upload-your-vhd">https://learn.microsoft.com/ja-jp/azure/virtual-machines/managed-disks-overview#upload-your-vhd</a></p></blockquote><hr><p>ä¸Šè¿°ã®é€šã‚Šã€ã“ã¡ã‚‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã¯ã‚ãã¾ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™ã®è¨­å®šã‚’è¡Œã†ã‚‚ã®ã§ã‚ã‚‹ç‚¹ã€ã”ç†è§£è³œã‚Šã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚&lt;br&gt;ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã«ã¤ã„ã¦ã€ã©ã†ã„ã£ãŸã‚‚ã®ã§ã‚ã‚‹ã‹ã¨ã„ã£ãŸç‚¹ã‚’ãŠå•ã„åˆã‚ã›ã„ãŸã ãã“ã¨ãŒã”ã–ã„ã¾ã™ã®ã§ã€ã“ã®ç‚¹ã‚’è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 i</summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
    <category term="Disk" scheme="https://jpaztech.github.io/blog/tags/Disk/"/>
    
  </entry>
  
  <entry>
    <title>AKSãƒãƒ¼ãƒ‰ä¸Šã§ã®OOMKillã®æŒ™å‹•ã¨èª¿æŸ»æ–¹æ³•</title>
    <link href="https://jpaztech.github.io/blog/containers/aks-oom-202312/"/>
    <id>https://jpaztech.github.io/blog/containers/aks-oom-202312/</id>
    <published>2023-12-17T03:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.152Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã®è¨˜äº‹ã¯<a href="https://qiita.com/advent-calendar/2023/microsoft-azure-tech">Microsoft Azure Tech Advent Calendar 2023</a> ã® 17 æ—¥ç›®ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚</p><p>ã“ã‚“ã«ã¡ã¯ã€ Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®é«˜ç”°ã§ã™ã€‚<br>AKS(ã«é™ã‚‰ãšã€Kuberneteså…¨èˆ¬)ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«é›£ã—ã„ã“ã¨ã®ä¸€ã¤ã¨ã—ã¦ã€ãƒ¡ãƒ¢ãƒªã®å‰²ã‚Šå½“ã¦ã‚„åˆ¶é™ã®ç®¡ç†ãŒã‚ã‚Šã¾ã™ã€‚<br>ãƒãƒ¼ãƒ‰ã‚„ãã®ä¸Šã®ãƒ¡ãƒ¢ãƒª(ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®äºˆç®—)ã«ã‚‚é™ã‚ŠãŒã‚ã‚‹ã®ã§<br>å¿…è¦ååˆ†ã§æ¸ˆã¾ã›ã‚ˆã†ã¨ã—ãŸã‚‚ã®ã®ã€æ€ã‚ã¬ã¨ãã«OOMKillã§ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«<br>å½±éŸ¿ãŒç™ºç”Ÿã—ãŸã€ã¨ã„ã†çµŒé¨“ã‚’ã•ã‚ŒãŸæ–¹ã‚‚å¤šã„ã‹ã¨æ€ã„ã¾ã™ã€‚</p><p>ã“ã®è¨˜äº‹ã§ã¯ã€OOMKillãŒç™ºç”Ÿã—ãŸã¨ãã«ã›ã‚ã¦é€Ÿã‚„ã‹ã«å¯¾å‡¦ã§ãã‚‹ã‚ˆã†ã€<br>OOMKillã®éš›ã®æŒ™å‹•ã‚„ã“ã‚Œã«åŸºã¥ãåŸå› èª¿æŸ»æ–¹æ³•ã«ã¤ã„ã¦<br>ã„ãã¤ã‹ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’ç´¹ä»‹ã•ã›ã¦é ‚ãã¾ã™ã€‚</p><h2 id="æ‰±ã†ãƒˆãƒ”ãƒƒã‚¯ã€æ‰±ã‚ãªã„ãƒˆãƒ”ãƒƒã‚¯"><a href="#æ‰±ã†ãƒˆãƒ”ãƒƒã‚¯ã€æ‰±ã‚ãªã„ãƒˆãƒ”ãƒƒã‚¯" class="headerlink" title="æ‰±ã†ãƒˆãƒ”ãƒƒã‚¯ã€æ‰±ã‚ãªã„ãƒˆãƒ”ãƒƒã‚¯"></a>æ‰±ã†ãƒˆãƒ”ãƒƒã‚¯ã€æ‰±ã‚ãªã„ãƒˆãƒ”ãƒƒã‚¯</h2><p>æœ¬è¨˜äº‹ã§ã¯ã€AKSãƒãƒ¼ãƒ‰ä¸Šã«é…ç½®ã•ã‚ŒãŸPodã®ãƒ¡ãƒ¢ãƒªåˆ©ç”¨ã«èµ·å› ã—ã¦OOMKillãŒç™ºç”Ÿã—ãŸå ´åˆã®<br>æŒ™å‹•ã‚„ã€åŸå› ã®èª¿æŸ»æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚</p><p>ãã‚‚ãã‚‚ãƒãƒ¼ãƒ‰ã®ãƒªã‚½ãƒ¼ã‚¹ä¸è¶³ã§PodãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã•ã‚Œãªã„(Pendingã®ã¾ã¾ã¨ãªã‚‹)å ´åˆã«ã¤ãã¾ã—ã¦ã¯<br>ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã¨ã•ã›ã¦é ‚ãã¾ã™ã®ã§ã”äº†æ‰¿ä¸‹ã•ã„ã€‚</p><h2 id="2ç¨®é¡ã®ãƒ¡ãƒ¢ãƒªåˆ©ç”¨åˆ¶é™"><a href="#2ç¨®é¡ã®ãƒ¡ãƒ¢ãƒªåˆ©ç”¨åˆ¶é™" class="headerlink" title="2ç¨®é¡ã®ãƒ¡ãƒ¢ãƒªåˆ©ç”¨åˆ¶é™"></a>2ç¨®é¡ã®ãƒ¡ãƒ¢ãƒªåˆ©ç”¨åˆ¶é™</h2><p>AKSãƒãƒ¼ãƒ‰ä¸Šã§PodãŒãƒ¡ãƒ¢ãƒªã‚’ç¢ºä¿ãƒ»åˆ©ç”¨ã™ã‚‹éš›ã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã€<br>ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®2ã¤ã®è¦³ç‚¹ã«ã¦åˆ©ç”¨é‡ãŒåˆ¶é™ã•ã‚Œã¾ã™ã€‚OOMKillã¯å„ãƒ¬ãƒ™ãƒ«ã§ç™ºç”Ÿã—å¾—ã¾ã™ã€‚</p><h3 id="Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill"><a href="#Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill" class="headerlink" title="Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill"></a>Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill</h3><p>Podå†…ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãŒç¢ºä¿ãƒ»åˆ©ç”¨å¯èƒ½ãªãƒ¡ãƒ¢ãƒªã®ä¸Šé™ã¯ã€Podã®manifest(YAML)ä¸­ã®<br><code>spec.containers[].resources.limits.memory</code>ã«ã¦æŒ‡å®šã§ãã¾ã™ã€‚<br>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãŒã“ã®åˆ¶é™ã‚’è¶…ãˆã¦ãƒ¡ãƒ¢ãƒªã‚’ç¢ºä¿ãƒ»åˆ©ç”¨ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã«ã€OOMKillãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><p>(è¨­å®šæ–¹æ³•ã‚„è€ƒãˆæ–¹ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç­‰ã‚’ã”å‚ç…§ä¸‹ã•ã„)</p><p><a href="https://learn.microsoft.com/ja-jp/azure/aks/developer-best-practices-resource-management">Azure Kubernetes Service (AKS) ã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºè€…ã®ãƒ™ã‚¹ãƒˆ ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</a></p><p><a href="https://kubernetes.io/ja/docs/tasks/configure-pod-container/assign-memory-resource/">ã‚³ãƒ³ãƒ†ãƒŠãŠã‚ˆã³Podã¸ã®ãƒ¡ãƒ¢ãƒªãƒ¼ãƒªã‚½ãƒ¼ã‚¹ã®å‰²ã‚Šå½“ã¦</a></p><p><a href="https://kubernetes.io/ja/docs/concepts/configuration/manage-resources-containers/">ã‚³ãƒ³ãƒ†ãƒŠã®ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†</a></p><h3 id="ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill"><a href="#ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill" class="headerlink" title="ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill"></a>ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãƒ»OOMKill</h3><p>PodãŒãƒãƒ¼ãƒ‰ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã‚‹éš›ã€ãƒãƒ¼ãƒ‰ãŒæä¾›å¯èƒ½ãªãƒ¡ãƒ¢ãƒªãŒ<br>Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«å¯¾ã—ã¦ååˆ†ã‹å¦ã‹ã®åˆ¤å®šã¯ã€<code>spec.containers[].resources.limits.memory</code><br>(åˆ¶é™)ã§ã¯ãªãã€<code>spec.containers[].resources.limits.memory</code>(è¦æ±‚)ã«åŸºã¥ã„ã¦<br>è¡Œã‚ã‚Œã¾ã™ã€‚ã“ã®ãŸã‚ã€ã‚ã‚‹ãƒãƒ¼ãƒ‰ä¸Šã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚ŒãŸPodãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®<br>åˆ¶é™å€¤ã®åˆè¨ˆãŒã€å®Ÿéš›ã«ãã®ãƒãƒ¼ãƒ‰ä¸Šã§åˆ©ç”¨å¯èƒ½ãªãƒ¡ãƒ¢ãƒªé‡ã‚ˆã‚Šã¯ã‚‹ã‹ã«å¤šã„ã€ã¨ã„ã†ã“ã¨ãŒ<br>èµ·ã“ã‚Šå¾—ã¾ã™ã€‚</p><p>ã“ã®å ´åˆã€ã¾ãšã€ Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®åˆè¨ˆãŒå‰²ã‚Šå½“ã¦å¯èƒ½(Allocatable)ãª<br>ãƒ¡ãƒ¢ãƒªé‡ã‚’è¶…ãˆãŸæ™‚ç‚¹ã§ã€evict(é€€å»)ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªé€¼è¿«ã®è§£æ¶ˆãŒè©¦ã¿ã‚‰ã‚Œã¾ã™ã€‚<br>ãŸã ã€evict(é€€å»)ãŒé–“ã«åˆã‚ãšã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå‰²ã‚Šå½“ã¦å¯èƒ½ãªãƒ¡ãƒ¢ãƒªé‡ + eviction-threshold<br>ã®å€¤ã‚’è¶…éã—ãŸå ´åˆã«ã€ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®OOMKillãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><p>å‰²ã‚Šå½“ã¦å¯èƒ½ãªãƒ¡ãƒ¢ãƒªé‡ã¯ã€ãƒãƒ¼ãƒ‰ã«æ­è¼‰ã•ã‚Œã¦ã„ã‚‹(=VMã‚µã‚¤ã‚ºã«ã¦æä¾›ã•ã‚Œã‚‹)<br>ãƒ¡ãƒ¢ãƒªé‡ã‹ã‚‰ã€ kube-reserved, system-reserved, å‰è¿°ã®eviction-thresholdã®å€¤ã‚’<br>å¼•ã„ãŸå€¤ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p><p><a href="https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/#node-allocatable">Reserve Compute Resources for System Daemons: Node Allocatable</a></p><p>AKS(Kubernetes ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.28ä»¥ä¸‹)ã®å ´åˆã€eviction-thresholdã¯750MiBã€kube-reservedã¯<br>ãƒãƒ¼ãƒ‰ã«æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¢ãƒªé‡ã«åŸºã¥ãä¸€å®šã®æ³•å‰‡ã«ã¦ç®—å‡ºã•ã‚ŒãŸå€¤ã®é‡ã¨ãªã‚Šã¾ã™ã€‚<br>(system-reservedã¯å®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“)</p><p><a href="https://learn.microsoft.com/ja-jp/azure/aks/concepts-clusters-workloads#memory">Azure Kubernetes Services (AKS) ã«ãŠã‘ã‚‹ Kubernetes ã®ä¸­å¿ƒæ¦‚å¿µ:<br>ãƒ¡ãƒ¢ãƒª</a></p><p>ãƒãƒ¼ãƒ‰ã«æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¢ãƒªé‡ã€å‰²ã‚Šå½“ã¦å¯èƒ½ãªé‡ã¯å„ã€…ã€<code>kubectl describe node</code>ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›ä¸­ã®<br>Capacityã®é …ã€Allocatableã®é …ãªã©ã«ã¦ç¢ºèªã§ãã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe node &lt;ãƒãƒ¼ãƒ‰å&gt;</span><br><span class="line">(ç•¥)</span><br><span class="line">Capacity:</span><br><span class="line">  cpu:                2</span><br><span class="line">  ephemeral-storage:  129886128Ki</span><br><span class="line">  hugepages-1Gi:      0</span><br><span class="line">  hugepages-2Mi:      0</span><br><span class="line">  memory:             4007948Ki</span><br><span class="line">  pods:               110</span><br><span class="line">Allocatable:</span><br><span class="line">  cpu:                1900m</span><br><span class="line">  ephemeral-storage:  119703055367</span><br><span class="line">  hugepages-1Gi:      0</span><br><span class="line">  hugepages-2Mi:      0</span><br><span class="line">  memory:             2191372Ki</span><br><span class="line">  pods:               110</span><br><span class="line">(ç•¥)</span><br></pre></td></tr></table></figure><h2 id="Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®æƒ…å ±ã§ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨"><a href="#Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®æƒ…å ±ã§ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨" class="headerlink" title="Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®æƒ…å ±ã§ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨"></a>Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®æƒ…å ±ã§ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨</h2><p>ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«é–¢ã—ã¦OOMKillã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®å†èµ·å‹•ãŒç™ºç”Ÿã—ãŸå ´åˆã€<br>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®éå»ã®çŠ¶æ…‹ã¨ã—ã¦ãã®ã“ã¨ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod &lt;Podå&gt;</span><br><span class="line">(ç•¥)</span><br><span class="line">  &lt;ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å&gt;:</span><br><span class="line">    Last State:     Terminated</span><br><span class="line">      Reason:       OOMKilled</span><br><span class="line">      Exit Code:    0</span><br><span class="line">      Started:      Wed, 13 Dec 2023 06:23:20 +0000</span><br><span class="line">      Finished:     Wed, 13 Dec 2023 06:23:21 +0000</span><br></pre></td></tr></table></figure><p>ãŸã ã€ã“ã‚Œã®ã¿ã§ã¯ã€OOMKillãŒç™ºç”Ÿã—ãŸåŸå› <br>(Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã‹ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã‹)ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚<br>ã¾ãŸã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…ã®å­ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤§é‡ã«ãƒ¡ãƒ¢ãƒªã‚’ä½¿ç”¨ã—ã¦ã„ãŸå ´åˆã€<br>ãã®å­ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMkillã®å¯¾è±¡ã¨ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€<br>ã“ã®ã¨ãä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå‹•ä½œã‚’ç¶™ç¶šã—ã¦ã„ãŸå ´åˆã¯ã€<br>ãã‚‚ãã‚‚ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®å†èµ·å‹•ã¨ãªã‚‰ãšã€<code>kubectl describe pod</code>ã‚³ãƒãƒ³ãƒ‰ãªã©ã§ã¯<br>ç¢ºèªã§ãã¾ã›ã‚“ã€‚<br>(ã“ã®ã¨ãã®æŒ™å‹•ã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™)</p><h2 id="ãƒãƒ¼ãƒ‰ã®æƒ…å ±ã«ã¦ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨"><a href="#ãƒãƒ¼ãƒ‰ã®æƒ…å ±ã«ã¦ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨" class="headerlink" title="ãƒãƒ¼ãƒ‰ã®æƒ…å ±ã«ã¦ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨"></a>ãƒãƒ¼ãƒ‰ã®æƒ…å ±ã«ã¦ã‚ã‹ã‚‹ã“ã¨ã€ã‚ã‹ã‚‰ãªã„ã“ã¨</h2><p>ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ãƒ¡ãƒ¢ãƒªã®é€¼è¿«ãŒç™ºç”Ÿã—ã¦ã„ãŸå ´åˆã€<br>ãƒãƒ¼ãƒ‰ã®æƒ…å ±(<code>kubectl describe node</code>)ã‚„ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦ã€<br><code>NodeHasInsufficientMemory</code> ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe node &lt;ãƒãƒ¼ãƒ‰å&gt;</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason                     Age                   From            Message</span><br><span class="line">  ----     ------                     ----                  ----            -------</span><br><span class="line">  Normal   NodeHasInsufficientMemory  9m33s (x2 over 18m)   kubelet         Node &lt;ãƒãƒ¼ãƒ‰å&gt; status is now: NodeHasInsufficientMemory</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get events</span><br><span class="line">LAST SEEN   TYPE      REASON                      OBJECT               MESSAGE</span><br><span class="line">(ç•¥)</span><br><span class="line">8m21s       Warning   EvictionThresholdMet        node/&lt;ãƒãƒ¼ãƒ‰å&gt;       Attempting to reclaim memory</span><br><span class="line">10m         Normal    NodeHasInsufficientMemory   node/&lt;ãƒãƒ¼ãƒ‰å&gt;       Node &lt;ãƒãƒ¼ãƒ‰å&gt; status is now: NodeHasInsufficientMemory</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã‚‰ã®æƒ…å ±ã¯ã€ã‚ãã¾ã§ã‚‚ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ¡ãƒ¢ãƒªã®é€¼è¿«ãŒç™ºç”Ÿã—ã¦ã„ãŸã€ã¨ã„ã†ã“ã¨ã‚’ç¤ºã™ã‚‚ã®ã§ã‚ã‚Šã€<br>åŒæ™‚æœŸã«OOMKillãŒç™ºç”Ÿã—ã¦ã„ãŸå ´åˆã«ã‚‚ã€ãã‚ŒãŒPodãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã®ã‚‚ã®ã§ã‚ã‚‹å¯èƒ½æ€§ã¯<br>å¦å®šã§ãã¾ã›ã‚“ã€‚ãŸã ã€ã„ãšã‚Œã«ã›ã‚ˆãƒ¡ãƒ¢ãƒªã®é€¼è¿«ãŒç™ºç”Ÿã—ã¦ã„ãŸã“ã¨ã«ã¯é•ã„ãªã„ã®ã§ã€<br>è¦æ±‚(requests)ã®è¦‹ç›´ã—ã‚„ã€ã“ã‚Œã¨ã‚ã‚ã›ã¦ã®ãƒãƒ¼ãƒ‰ã®å¢—å¼·ãªã©ã‚’æ¤œè¨ã™ã¹ãã€ã¨ã„ã†<br>åˆ¤æ–­ã¯å¯èƒ½ã§ã™ã€‚</p><h2 id="ãƒãƒ¼ãƒ‰ã®ãƒ­ã‚°ã‹ã‚‰ã‚ã‹ã‚‹ã“ã¨"><a href="#ãƒãƒ¼ãƒ‰ã®ãƒ­ã‚°ã‹ã‚‰ã‚ã‹ã‚‹ã“ã¨" class="headerlink" title="ãƒãƒ¼ãƒ‰ã®ãƒ­ã‚°ã‹ã‚‰ã‚ã‹ã‚‹ã“ã¨"></a>ãƒãƒ¼ãƒ‰ã®ãƒ­ã‚°ã‹ã‚‰ã‚ã‹ã‚‹ã“ã¨</h2><p>ã¨ã¯ã„ãˆã€é–¢ä¿‚è€…ã¸ã®èª¬æ˜ã®ãŸã‚ãªã©ã€ç¢ºå®Ÿã«åŸå› ã‚’ç‰¹å®šã—ãŸã„å ´åˆã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚<br>ãã®ã‚ˆã†ãªå ´åˆã¯ã€ãƒãƒ¼ãƒ‰ã®ãƒ­ã‚°ã‚’è¦‹ã‚‹ã“ã¨ã§Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã‹<br>ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã‹ç¢ºèªãƒ»åˆ¤æ–­ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>OOMKillã¯Linuxã‚«ãƒ¼ãƒãƒ«ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€OOMKillãŒç™ºç”Ÿã—ãŸéš›ã«ã¯<br>ãƒãƒ¼ãƒ‰ã®ãƒ­ã‚°(/var/log/syslog, /var/log/kern.log ãªã©)ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚<br>ä¸‹è¨˜ã®ä¾‹ã®ã‚ˆã†ã«ã€OOMKillãŒç™ºç”Ÿã—ãŸéš›ã«ã¯<code>&lt;ãƒ—ãƒ­ã‚»ã‚¹å&gt;ã€€invoked oom-killer</code><br>ã‹ã‚‰å§‹ã¾ã‚Šã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æƒ…å ±ã€ç™ºç”Ÿæ™‚ã®ã‚¹ã‚¿ãƒƒã‚¯æƒ…å ±ã€ãƒ¡ãƒ¢ãƒªåˆ©ç”¨çŠ¶æ³ãªã©ã€<br>æ§˜ã€…ãªæƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036951] stress-ng-vm invoked oom-killer: gfp_mask=0xcc0(GFP_KERNEL), order=0, oom_score_adj=1000</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036958] CPU: 1 PID: 716580 Comm: stress-ng-vm Not tainted 5.15.0-1051-azure #59-Ubuntu</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036961] Hardware name: Microsoft Corporation Virtual Machine/Virtual Machine, BIOS 090008  12/07/2018</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036962] Call Trace:</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036964]  &lt;TASK&gt;</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036967]  show_stack+0x52/0x5c</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036973]  dump_stack_lvl+0x38/0x4d</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036978]  dump_stack+0x10/0x16</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036980]  dump_header+0x53/0x228</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036984]  oom_kill_process.cold+0xb/0x10</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036986]  out_of_memory+0x106/0x2e0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036989]  mem_cgroup_out_of_memory+0x13f/0x160</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036992]  try_charge_memcg+0x6cd/0x790</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036995]  charge_memcg+0x45/0xa0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.036997]  __mem_cgroup_charge+0x2d/0x90</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037000]  do_anonymous_page+0x104/0x4c0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037003]  handle_pte_fault+0x21b/0x260</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037006]  __handle_mm_fault+0x409/0x760</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037009]  ? sched_clock+0x9/0x10</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037014]  handle_mm_fault+0xc8/0x2a0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037017]  do_user_addr_fault+0x1bc/0x660</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037020]  exc_page_fault+0x71/0x160</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037024]  asm_exc_page_fault+0x27/0x30</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037027] RIP: 0033:0x55fbbb223b65</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037031] Code: 98 00 41 54 49 89 fa 55 48 89 cd 48 01 fa 53 4c 8b 59 10 4c 39 ca 0f 83 01 01 00 00 31 c9 0f 1f 80 00 00 00 00 89 cf 83 c1 01 &lt;40&gt; 88 3a 48 8b 3d 99 f7 98 00 48 01 fa 4c 39 ca 72 e9 48 89 f0 31</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037033] RSP: 002b:00007ffd1b287520 EFLAGS: 00010206</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037035] RAX: 0000000000000010 RBX: 00007f1d90825000 RCX: 0000000000734f41</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037036] RDX: 00007f1dad562000 RSI: 0000000040000000 RDI: 0000000000734f40</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037038] RBP: 00007f1dd2c1e398 R08: 0000000000000000 R09: 00007f1dd0825000</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037039] R10: 00007f1d90825000 R11: 0000000000000000 R12: 0000000040000000</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037040] R13: 0000000000000000 R14: 00007ffd1b287670 R15: 000055fbbb2224b0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037044]  &lt;/TASK&gt;</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037045] memory: usage 512000kB, limit 512000kB, failcnt 37</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037046] swap: usage 0kB, limit 9007199254740988kB, failcnt 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037047] Memory cgroup stats for /kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod479f327f_a27b_4eda_8523_90bdabcf0a27.slice:</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] anon 484630528</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] file 37752832</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] kernel_stack 65536</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] pagetables 1212416</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] percpu 11752</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] sock 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] shmem 37720064</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] file_mapped 37720064</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] file_dirty 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] file_writeback 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] swapcached 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] anon_thp 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] file_thp 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] shmem_thp 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] inactive_anon 522346496</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] active_anon 4096</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] inactive_file 16384</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] active_file 16384</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] unevictable 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] slab_reclaimable 303008</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] slab_unreclaimable 210008</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] slab 513016</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] workingset_refault_anon 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] workingset_refault_file 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] workingset_activate_anon 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] workingset_activate_file 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] workingset_restore_anon 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037069] workingset_restore_file 0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037071] Tasks state (memory values in pages):</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037072] [  pid  ]   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037073] [ 716518] 65535 716518      243        1    28672        0          -998 pause</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037077] [ 716566]     0 716566    13966    10178   139264        0           975 stress-ng</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037079] [ 716579]     0 716579    13967      424    73728        0          1000 stress-ng-vm</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037082] [ 716580]     0 716580   276111   118439  1015808        0          1000 stress-ng-vm</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037084] oom-kill:constraint=CONSTRAINT_MEMCG,nodemask=(null),cpuset=cri-containerd-679f9845995b4ae4812789eb3c3d1df88040a1bc3f0c046a05c9aa9b5b5f93be.scope,mems_allowed=0,oom_memcg=/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod479f327f_a27b_4eda_8523_90bdabcf0a27.slice,task_memcg=/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod479f327f_a27b_4eda_8523_90bdabcf0a27.slice/cri-containerd-679f9845995b4ae4812789eb3c3d1df88040a1bc3f0c046a05c9aa9b5b5f93be.scope,task=stress-ng-vm,pid=716580,uid=0</span><br><span class="line">Dec 13 07:23:21 aks-ubuntu-26835060-vmss000000 kernel: [36370.037095] Memory cgroup out of memory: Killed process 716580 (stress-ng-vm) total-vm:1104444kB, anon-rss:473048kB, file-rss:644kB, shmem-rss:64kB, UID:0 pgtables:992kB oom_score_adj:1000</span><br></pre></td></tr></table></figure><p>ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã€ã„ãã¤ã‹ã®ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</p><h3 id="ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«-ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®åˆ¤æ–­"><a href="#ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«-ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®åˆ¤æ–­" class="headerlink" title="ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«/ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®åˆ¤æ–­"></a>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«/ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®åˆ¤æ–­</h3><p><code>spec.containers[].resources.limits.memory</code>ã«ã¦æŒ‡å®šã—ãŸåˆ¶é™ã¯ã€<br>memcg(cgroupsã®ãƒ¡ãƒ¢ãƒªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©)ã«ã‚ˆã‚Šé©ç”¨ã•ã‚Œã¾ã™ã€‚</p><p>cgroupsã¯Linuxä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ä¸»è¦ãªæ©Ÿèƒ½ã®ä¸€ã¤ã§ã‚ã‚Šã€<br>control group(cgroup)ã«åˆ†é¡ã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ç¾¤ã«ã¤ã„ã¦ã€ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«<br>ãƒ¡ãƒ¢ãƒªã‚„CPUç­‰ã®ãƒªã‚½ãƒ¼ã‚¹ã®ä½¿ç”¨é‡ã‚’åˆ¶é™ã™ã‚‹ã‚‚ã®ã§ã™ã€‚</p><p><a href="https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html#memory">Control Group v2: Memory</a></p><p>ãƒ¡ãƒ¢ãƒªåˆ¶é™(limits)ã¯ã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«å¯¾å¿œã™ã‚‹cgroupã«é–¢ã—ã¦<br>ç¢ºä¿ãƒ»åˆ©ç”¨å¯èƒ½ãªãƒ¡ãƒ¢ãƒªé‡ã®ä¸Šé™ãŒè¨­å®šã•ã‚Œã€ä¸Šé™ã‚’è¶…éã—ãŸã¨ãã«<br>memcgãŒOOMKillã‚’ç™ºç”Ÿã•ã›ã‚‹ã“ã¨ã§å®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ä¸‹è¨˜ã®è¡Œã‹ã‚‰ã¯ã€<code>oom_memcg</code>ã¨ã—ã¦ã€OOMã®ç™ºç”Ÿè¦å› ã¨ãªã£ãŸcgroupãŒ<br><code>/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod479f327f_a27b_4eda_8523_90bdabcf0a27.slice</code><br>(ç‰¹å®šã®Podã«å¯¾å¿œã™ã‚‹cgroup)ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã™ãªã‚ã¡ã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã®OOMKillã§ã‚ã‚‹ã¨åˆ¤æ–­ã§ãã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oom-kill:constraint=CONSTRAINT_MEMCG,nodemask=(null),cpuset=cri-containerd-679f9845995b4ae4812789eb3c3d1df88040a1bc3f0c046a05c9aa9b5b5f93be.scope,mems_allowed=0,oom_memcg=/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod479f327f_a27b_4eda_8523_90bdabcf0a27.slice,task_memcg=/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod479f327f_a27b_4eda_8523_90bdabcf0a27.slice/cri-containerd-679f9845995b4ae4812789eb3c3d1df88040a1bc3f0c046a05c9aa9b5b5f93be.scope,task=stress-ng-vm,pid=716580,uid=0</span><br></pre></td></tr></table></figure><p>ä¸€æ–¹ã€ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®å ´åˆã¯ã€ä¾‹ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ã«ã€ <code>oom_memcg</code>ãŒ<code>/kubepods.slice</code>ã¨ãªã£ã¦ã„ã‚‹(å€‹ã€…ã®Podç­‰ã«å¯¾å¿œã™ã‚‹<br>cgroupã§ã¯ãªãã€ãã®ä¸Šä½ã®cgroupã¨ãªã£ã¦ã„ã‚‹)ã“ã¨ã‹ã‚‰ã€ãã®OOMKillãŒãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®ã‚‚ã®ã§ã‚ã‚‹ã¨åˆ¤æ–­ã§ãã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oom-kill:constraint=CONSTRAINT_MEMCG,nodemask=(null),cpuset=cri-containerd-4d2af8acef61505159dd1fb6e232eacd1b724e1d629f043fcaa47809544f6d92.scope,mems_allowed=0,oom_memcg=/kubepods.slice,task_memcg=/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-poda9d4b3f1_0189_4f5e_a8ee_94f0a3f53ab0.slice/cri-containerd-4d2af8acef61505159dd1fb6e232eacd1b724e1d629f043fcaa47809544f6d92.scope,task=stress-ng-vm,pid=728241,uid=0</span><br></pre></td></tr></table></figure><h3 id="ä»–ã«ã‚ã‹ã‚‹ã“ã¨"><a href="#ä»–ã«ã‚ã‹ã‚‹ã“ã¨" class="headerlink" title="ä»–ã«ã‚ã‹ã‚‹ã“ã¨"></a>ä»–ã«ã‚ã‹ã‚‹ã“ã¨</h3><p>ã“ã®ä»–ã€OOMKillãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ç™ºç”Ÿæ™‚ã®cgroupå†…ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å†…è¨³ã€ãƒ—ãƒ­ã‚»ã‚¹æ¯ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŠ¶æ³ãªã©ã®æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™ã€‚<br>ã‚‚ã—ã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãŒæ„å›³ã›ãšå¤§é‡ã®ãƒ¡ãƒ¢ãƒªã‚’ç¢ºä¿ãƒ»åˆ©ç”¨ã—ã¦ã„ãŸå ´åˆã€ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã§<br>åŸå› ã®çµã‚Šè¾¼ã¿ã«å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><h2 id="å­ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMKillã•ã‚ŒãŸã¨ãã®æŒ™å‹•"><a href="#å­ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMKillã•ã‚ŒãŸã¨ãã®æŒ™å‹•" class="headerlink" title="å­ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMKillã•ã‚ŒãŸã¨ãã®æŒ™å‹•"></a>å­ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMKillã•ã‚ŒãŸã¨ãã®æŒ™å‹•</h2><h3 id="Kubernetes-1-27-ã¾ã§"><a href="#Kubernetes-1-27-ã¾ã§" class="headerlink" title="Kubernetes 1.27 ã¾ã§"></a>Kubernetes 1.27 ã¾ã§</h3><p>æ—¢ã«è§£èª¬ã—ãŸé€šã‚Šã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã®OOMKillã¯ã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«å¯¾å¿œã™ã‚‹cgroupã«é–¢ã—ã¦<br>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒåˆ¶é™å€¤ã‚’è¶…éã™ã‚‹ã“ã¨ã§ç™ºç”Ÿã—ã¾ã™ã€‚<br>ãŸã ã€ã“ã®ã¨ãè¡Œã‚ã‚Œã‚‹OOMKillã®å¯¾è±¡ã¯ã€ã‚ãã¾ã§ã‚‚ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…ã§(ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç­‰ã®è¦³ç‚¹ã§)é¸ã°ã‚ŒãŸ<br>ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ãªã‚Šã¾ã™ã€‚å¾“ã£ã¦ã€ä¾‹ãˆã°ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…ã§ä½œæˆã•ã‚ŒãŸå­ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸€ã¤ãŒ<br>OOMKillã«ã‚ˆã‚Šçµ‚äº†ã—ãŸå ´åˆã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…ã®ãƒ—ãƒ­ã‚»ã‚¹ã®æ§‹æˆæ¬¡ç¬¬ã§ã¯<br>ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒ(å ´åˆã«ã‚ˆã£ã¦ã¯ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¨ã—ã¦ä¸å®Œå…¨ãªã¾ã¾)å‹•ä½œã‚’ç¶™ç¶šã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã“ã®ã¨ãã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¨ã—ã¦ã®å†èµ·å‹•ã¯ç™ºç”Ÿã—ãªã„ãŸã‚ã€<br><code>kubectl describe pod</code>ã‚³ãƒãƒ³ãƒ‰ã®çµæœãªã©ã‹ã‚‰ã¯ã€ãã‚‚ãã‚‚OOMKillãŒç™ºç”Ÿã—ãŸã“ã¨ã™ã‚‰ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚</p><p>ã“ã®ã‚ˆã†ãªå ´åˆã«OOMKillã®ç™ºç”Ÿã‚’æ¤œçŸ¥ã™ã‚‹ã«ã¯ã€ãƒãƒ¼ãƒ‰ã®ãƒ­ã‚°ç­‰ã‹ã‚‰<br>OOMKillã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ‰ç„¡ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>(memcgã®çµ±è¨ˆæƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã€ãªã©ã®æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ãŒå‰²æ„›ã•ã›ã¦é ‚ãã¾ã™)</p><h3 id="Kubernetes-1-28-ä»¥é™"><a href="#Kubernetes-1-28-ä»¥é™" class="headerlink" title="Kubernetes 1.28 ä»¥é™"></a>Kubernetes 1.28 ä»¥é™</h3><p>Kubernetes ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.28ä»¥é™ã§ã¯ã€cgroups v2ã®memcgã§æ¡ç”¨ã•ã‚ŒãŸ<br><code>memory.oom.group</code>ã¨ã„ã†æ©Ÿèƒ½ã‚’ã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®cgroupã«é–¢ã—ã¦<br>æœ‰åŠ¹åŒ–ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚<br>ã“ã®æ©Ÿèƒ½ã¯ã€cgroupå†…ã®ä»»æ„ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMKillã®å¯¾è±¡ã¨ãªã£ãŸå ´åˆã«<br>åŒã˜cgroupå†…ã®å…¨ãƒ—ãƒ­ã‚»ã‚¹ã«é–¢ã—ã¦OOMKillã‚’å®Ÿè¡Œã™ã‚‹ã€ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚<br>ã™ãªã‚ã¡ã€ Kubernetes ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ1.28ä»¥é™ã§ã‚ã‚Šã€<br>ã‹ã¤ã€åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹cgroupsãŒv2ã®å ´åˆã€<br>ä»»æ„ã®å­ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMKillã¨ãªã£ãŸéš›ã«ã€(<code>restartPolicy</code>ãŒNeverã§ãªã‘ã‚Œã°)<br>ç¢ºå®Ÿã«ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®å†èµ·å‹•ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><p><a href="https://github.com/kubernetes/kubernetes/issues/117070">[SIG-Node] Cgroups v2 memory.oom.group support (kill all pids in a pod on oom)</a></p><p><a href="https://github.com/kubernetes/kubernetes/pull/117793">use the cgroup aware OOM killer if available</a></p><p>AKS ã§ã¯ã€Kubernetes ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.25ä»¥é™ã®AKSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®<br>Ubuntuãƒãƒ¼ãƒ‰(Ubuntu 22.04ãƒãƒ¼ãƒ‰)ã§cgroups v2ãŒåˆ©ç”¨ã•ã‚Œã¦ãŠã‚Šã¾ã™ã€‚<br>Azure Linuxãƒãƒ¼ãƒ‰ã®å ´åˆã¯Kubernetes ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.28ã®æ™‚ç‚¹ã«ã¦<br>ã¾ã cgroups v1ãŒåˆ©ç”¨ã•ã‚Œã¾ã™ãŒã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.29ä»¥é™ã§ã¯<br>cgroups v2ã®åˆ©ç”¨ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹äºˆå®šã§ã™ã€‚</p><p><a href="https://github.com/Azure/AKS/releases/tag/2023-11-28">AKS Release 2023-11-28</a></p><p>ã¾ã¨ã‚ã‚‹ã¨ã€Ubuntuãƒãƒ¼ãƒ‰ã®å ´åˆã¯ Kuberenetes ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.28ä»¥é™ã€<br>Azure Linuxãƒãƒ¼ãƒ‰ã®å ´åˆã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.29ä»¥é™ã«ã¦ã€<br>Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®cgroupã«å¯¾ã—ã¦<code>memory.oom.group</code>ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã€<br>OOMKillã®ç™ºç”Ÿæ™‚ã«ã¯ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…ã®å…¨ãƒ—ãƒ­ã‚»ã‚¹ãŒOOMKillå¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚</p><p>ãªãŠã€<code>memory.oom.group</code>ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«é–¢ã—ã¦OOMKillãŒç™ºç”Ÿã—ãŸå ´åˆã€<br>ä¸‹è¨˜ã®ã‚ˆã†ã«ã€ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚‚cgroupå†…ã®å…¨ãƒ—ãƒ­ã‚»ã‚¹ãŒkillã•ã‚Œã‚‹æ—¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dec 13 07:54:24 aks-ubuntu-26253795-vmss000000 kernel: [41725.949137] Tasks in /kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podc9658b52_5194_4250_87f2_ec380cce2915.slice/cri-containerd-6793e00dcd36f430871d321242bbd79c1c186a3fad6615a98a1cc0b24c3e7f8f.scope are going to be killed due to memory.oom.group set</span><br></pre></td></tr></table></figure><h2 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h2><p>ã“ã®è¨˜äº‹ã§ã¯ã€AKSãƒãƒ¼ãƒ‰ã«ãŠã‘ã‚‹OOOMKillã®éš›ã®æŒ™å‹•ã‚„ã€ã“ã‚Œã«åŸºã¥ãåŸå› èª¿æŸ»æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚<br>OOMKillç™ºç”Ÿæ™‚ã«ã¯ã€ç´¹ä»‹ã—ãŸæ–¹æ³•ã«ã¦åŸå› ã‚’ç¢ºèªã®ä¸Šã€Podãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«ã®OOMKillã®å ´åˆã¯<br>åˆ¶é™(limits)ã®å¢—åŠ ã€ãƒãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®å ´åˆã¯è¦æ±‚(requests)ã®å¢—åŠ ã‚„ãƒãƒ¼ãƒ‰ã®å¢—å¼·ç­‰ã‚’<br>ã”æ¤œè¨ä¸‹ã•ã„ã€‚<br>ã¾ãŸã€<code>memory.oom.group</code>æœªå¯¾å¿œã®æ§‹æˆã§ã¯ã€Kubernetes ãƒªã‚½ãƒ¼ã‚¹ã®æƒ…å ±ã¨ã—ã¦ã¯<br>ã‚ã‹ã‚‰ãªã„å½¢ã§OOMKillãŒç™ºç”Ÿã—ã¦ã„ãŸã€ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã®ã§ã€<br>ãƒ—ãƒ­ã‚»ã‚¹ãŒã„ã¤ã®é–“ã«ã‹çµ‚äº†ã—ã¦ã„ãŸã€ã¨ã„ã£ãŸå ´åˆã«ã¯<br>OOMKillãŒç™ºç”Ÿã—ã¦ã„ãŸå¯èƒ½æ€§ã‚‚ã”ç¢ºèªä¸‹ã•ã„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã®è¨˜äº‹ã¯&lt;a href=&quot;https://qiita.com/advent-calendar/2023/microsoft-azure-tech&quot;&gt;Microsoft Azure Tech Advent Calendar 2023&lt;/a&gt; ã® 17 æ—¥ç›®ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚</summary>
      
    
    
    
    
    <category term="Containers" scheme="https://jpaztech.github.io/blog/tags/Containers/"/>
    
    <category term="Azure Kubernetes Service (AKS)" scheme="https://jpaztech.github.io/blog/tags/Azure-Kubernetes-Service-AKS/"/>
    
  </entry>
  
  <entry>
    <title>Azure Cloud Shell ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ã®ã”ç´¹ä»‹</title>
    <link href="https://jpaztech.github.io/blog/vm/UseCloudShellinAzureVirtualNetwork/"/>
    <id>https://jpaztech.github.io/blog/vm/UseCloudShellinAzureVirtualNetwork/</id>
    <published>2023-12-13T14:09:00.000Z</published>
    <updated>2023-12-26T02:55:51.256Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®å°ç”°ã§ã™ã€‚<br>ä»Šå›ã¯ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ Azure Cloud Shell ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ã‚’ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚</p><span id="more"></span><h2 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h2><p>é€šå¸¸ Azure Cloud Shell ã®ãƒã‚·ãƒ³ã¯ã€ãŠå®¢æ§˜ãŒç®¡ç†ã•ã‚Œã¦ã„ã‚‹ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã¯ç•°ãªã‚‹ Azure ãŒç®¡ç†ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦å±•é–‹ã•ã‚Œã¾ã™ã€‚<br>Azure Cloud Shell ãŒå­˜åœ¨ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ã€ãŠå®¢æ§˜ã§ã¯ãªããƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆãŒç®¡ç†ã‚’è¡Œã£ã¦ãŠã‚Šã¾ã™ã€‚ </p><p>ãã®ãŸã‚ã€Azure Cloud Shell ã®ã”åˆ©ç”¨ã«ãŠã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ¶ç´„ã§ãŠå›°ã‚Šã®ãŠå®¢æ§˜ã‹ã‚‰ã€ãŠå•ã„åˆã‚ã›ã‚’é ‚ãã“ã¨ãŒã—ã°ã—ã°ã”ã–ã„ã¾ã™ã€‚</p><ul><li>Azure Cloud Shell ã‹ã‚‰ä»®æƒ³ãƒã‚·ãƒ³ãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ãŒæŒã¤ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã—ã¦æ¥ç¶šãŒã§ããªã„</li><li>Azure Cloud Shell ãŒä½¿ç”¨ã™ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãŠå®¢æ§˜ãŒè¨­å®š / ç®¡ç†ã§ããªã„ãŸã‚ã€Azure Cloud Shell ã‹ã‚‰ã®é€šä¿¡ã‚’ NSG ãªã©ã«ã‚ˆã‚Šã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ããªã„</li></ul><p>ã“ã®ã‚ˆã†ãªå ´åˆã«ã¯Azure Cloud Shell ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã§ã€Azure Cloud Shell ãŒä½¿ç”¨ã™ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãŠå®¢æ§˜ãŒç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã‚‰ã®åˆ¶ç´„ãŒè§£æ¶ˆã•ã‚Œã¾ã™ã€‚<br>ãªãŠè£œè¶³ã¨ãªã‚Šã¾ã™ãŒã€ã“ã® Azure Cloud Shell ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚’ â€œVNET ã®åˆ†é›¢â€ ã¨ã‚‚å‘¼ã³ã¾ã™ã€‚<br>å¿…è¦ã«å¿œã˜ã¦ã€Azure Cloud Shell ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã«ã¤ã„ã¦ã”æ¤œè¨ã‚’ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p><h2 id="ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦ã®æ³¨æ„äº‹é …"><a href="#ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦ã®æ³¨æ„äº‹é …" class="headerlink" title="ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦ã®æ³¨æ„äº‹é …"></a>ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦ã®æ³¨æ„äº‹é …</h2><p>ã”åˆ©ç”¨ã«éš›ã—ã¦ä»¥ä¸‹ 2 ç‚¹ã®æ³¨æ„äº‹é …ãŒã”ã–ã„ã¾ã™ã®ã§ã”ç¢ºèªãã ã•ã„ã€‚</p><h3 id="æ³¨æ„äº‹é …â‘ -Azure-Relay-ãƒªã‚½ãƒ¼ã‚¹ã®åˆ©ç”¨ã¯æœ‰å„Ÿã¨ãªã‚Šã¾ã™"><a href="#æ³¨æ„äº‹é …â‘ -Azure-Relay-ãƒªã‚½ãƒ¼ã‚¹ã®åˆ©ç”¨ã¯æœ‰å„Ÿã¨ãªã‚Šã¾ã™" class="headerlink" title="æ³¨æ„äº‹é …â‘  Azure Relay ãƒªã‚½ãƒ¼ã‚¹ã®åˆ©ç”¨ã¯æœ‰å„Ÿã¨ãªã‚Šã¾ã™"></a>æ³¨æ„äº‹é …â‘  Azure Relay ãƒªã‚½ãƒ¼ã‚¹ã®åˆ©ç”¨ã¯æœ‰å„Ÿã¨ãªã‚Šã¾ã™</h3><p>Azure Cloud Shell ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã«ã¯ã€Azure Relay ã‚’ã”åˆ©ç”¨ã„ãŸã ãå¿…è¦ãŒã”ã–ã„ã¾ã™ãŒã€Azure Relay ã¯æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã®ç‚¹ã«ã¤ãã¾ã—ã¦ã”ç•™æ„ã‚’ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p><blockquote><p>ãƒ»ã”å‚è€ƒ: <a href="https://learn.microsoft.com/ja-jp/azure/cloud-shell/private-vnet#things-to-consider-before-deploying-azure-cloud-shell-in-a-vnet">VNET ã« Azure Cloud Shell ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å‰ã«è€ƒæ…®ã™ã¹ãäº‹é …</a><br>â€”- æŠœç²‹ â€”â€“<br>VNET ã®åˆ†é›¢ã§ã¯ã€æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹ Azure Relay ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>â€”- æŠœç²‹ â€”â€“</p></blockquote><h3 id="æ³¨æ„äº‹é …â‘¡-ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒé™ã‚‰ã‚Œã¾ã™"><a href="#æ³¨æ„äº‹é …â‘¡-ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒé™ã‚‰ã‚Œã¾ã™" class="headerlink" title="æ³¨æ„äº‹é …â‘¡ ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒé™ã‚‰ã‚Œã¾ã™"></a>æ³¨æ„äº‹é …â‘¡ ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒé™ã‚‰ã‚Œã¾ã™</h3><p>ã¾ãŸã€Azure Cloud Shell ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã«ã‚‚ã€ Azure Cloud Shell  ã‚’å±•é–‹ã§ãã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯é™ã‚‰ã‚Œã¾ã™ã€‚æ±æ—¥æœ¬ã‚„è¥¿æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¯ Cloud Shell ç«¯æœ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ããªã„ç‚¹ã«ã¤ã„ã¦ã”ç•™æ„ã‚’ãã ã•ã„ã€‚</p><blockquote><p>ãƒ»ã”å‚è€ƒ: <a href="https://learn.microsoft.com/ja-jp/azure/cloud-shell/persisting-shell-storage#supported-storage-regions">ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ãƒªãƒ¼ã‚¸ãƒ§ãƒ³</a><br>â€”- æŠœç²‹ â€”â€“<br>Azure Cloud Shellã¯ã€æ¬¡ã®å„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«å­˜åœ¨ã—ã¾ã™ã€‚</p><table><thead><tr><th>é ˜åŸŸ</th><th>ãƒªãƒ¼ã‚¸ãƒ§ãƒ³</th></tr></thead><tbody><tr><td>ã‚¢ãƒ¡ãƒªã‚«</td><td>ç±³å›½æ±éƒ¨ã€ç±³å›½ä¸­å—éƒ¨ã€ç±³å›½è¥¿éƒ¨</td></tr><tr><td>ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘</td><td>åŒ—ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã€è¥¿ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘</td></tr><tr><td>ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹</td><td>ã‚¤ãƒ³ãƒ‰ä¸­éƒ¨ã€æ±å—ã‚¢ã‚¸ã‚¢</td></tr><tr><td>â€”- æŠœç²‹ â€”â€“</td><td></td></tr></tbody></table></blockquote><p>ãã®ãŸã‚ VNET ã«å¯¾ã—ã¦ Azure Cloud Shell ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã«ã‚‚ã€Azure Cloud Shell ã‹ã‚‰æ±æ—¥æœ¬ã‚„è¥¿æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ãŸæ¥ç¶šã‚’ã”å¸Œæœ›ã®å ´åˆã«ã¯ã€Azure Cloud Shell ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ VNET ã¨æ±æ—¥æœ¬ã‚„è¥¿æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã® VNET é–“ã§ VNET ãƒ”ã‚¢ãƒªãƒ³ã‚°ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚</p><blockquote><p>ãƒ»ã”å‚è€ƒ: <a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/virtual-network-peering-overview">Azure ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ”ã‚¢ãƒªãƒ³ã‚°</a></p></blockquote><h2 id="ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †"><a href="#ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †" class="headerlink" title="ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †"></a>ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †</h2><p>æœ¬ç¨¿ã§ã¯ã€Azure Cloud Shell ã‚„ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã‚Šæ–°è¦ã«ä½œæˆã—ã€ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã« Azure Cloud Shell ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ã‚’ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚<br>ä»¥ä¸‹ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå¯¾å¿œã„ãŸã—ã¾ã™ã®ã§ã€ä½µã›ã¦ã”å‚è€ƒãã ã•ã„ã€‚</p><blockquote><p>ãƒ»ã”å‚è€ƒ: <a href="https://learn.microsoft.com/ja-jp/azure/cloud-shell/quickstart-deploy-vnet">ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ VNET ã« Azure Cloud Shell ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹</a></p></blockquote><h3 id="æ‰‹é †ã®æ¦‚è¦"><a href="#æ‰‹é †ã®æ¦‚è¦" class="headerlink" title="æ‰‹é †ã®æ¦‚è¦"></a>æ‰‹é †ã®æ¦‚è¦</h3><p>å…·ä½“çš„ãªæ‰‹é †ã®èª¬æ˜ã«å…¥ã‚‹å‰ã«ã€ã¾ãšã¯æ‰‹é †ã®æ¦‚è¦ã‚’èª¬æ˜ã•ã›ã¦é ‚ãã¾ã™ã€‚<br>ä½œæ¥­ã¯ä»¥ä¸‹ 7 ã¤ã®æ‰‹é †ã«ã¦å®Ÿæ–½ã„ãŸã—ã¾ã™ã€‚</p><p>æ‰‹é †â‘  ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ<br>æ‰‹é †â‘¡ ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä½œæˆ<br>æ‰‹é †â‘¢ ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç™»éŒ²<br>æ‰‹é †â‘£ Azure Container Instance ID ã®ç¢ºèª<br>æ‰‹é †â‘¤ ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä»¥å¤–ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ<br>æ‰‹é †â‘¥ ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ<br>æ‰‹é †â‘¦ ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã« Cloud Shell ã‚’æ§‹æˆ</p><h3 id="æ‰‹é †ã®è©³ç´°"><a href="#æ‰‹é †ã®è©³ç´°" class="headerlink" title="æ‰‹é †ã®è©³ç´°"></a>æ‰‹é †ã®è©³ç´°</h3><p>å…·ä½“çš„ãªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’ä»¥ä¸‹ã«ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚</p><h4 id="æ‰‹é †â‘ -ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹"><a href="#æ‰‹é †â‘ -ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹" class="headerlink" title="æ‰‹é †â‘  ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹"></a>æ‰‹é †â‘  ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹</h4><p>Cloud Shell ç«¯æœ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ï¼ˆä»¥ä¸‹ã®ç”»é¢ä¾‹ã§ã¯ â€southeastasiaâ€ã‚’æŒ‡å®šï¼‰ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã„ãŸã—ã¾ã™ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step1-1.jpg" alt="æ‰‹é †â‘ "></p><h4 id="æ‰‹é †â‘¡-ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹"><a href="#æ‰‹é †â‘¡-ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹" class="headerlink" title="æ‰‹é †â‘¡ã€€ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹"></a>æ‰‹é †â‘¡ã€€ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹</h4><p>å‰é …ã§ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ãŠã‚ˆã³å¯¾è±¡ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã€ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã„ãŸã—ã¾ã™ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step2-1.jpg" alt="æ‰‹é †â‘¡"></p><p>IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ã‚¿ãƒ–ã«ã¦ã€ã”å¸Œæœ›ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ¬ãƒ³ã‚¸ã‚’ã”æŒ‡å®šãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step2-2.jpg" alt="æ‰‹é †â‘¡"></p><h4 id="æ‰‹é †â‘¢ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç™»éŒ²"><a href="#æ‰‹é †â‘¢ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç™»éŒ²" class="headerlink" title="æ‰‹é †â‘¢ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç™»éŒ²"></a>æ‰‹é †â‘¢ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç™»éŒ²</h4><p>Azure Cloud Shell ã¯ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ã”åˆ©ç”¨ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ã€â€Microsoft.ContainerInstancesâ€ ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>å½“è©²ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯è‡ªå‹•çš„ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã®ã§ã€ã¾ãšã¯ Azure PowerShell ã‚ˆã‚Šä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒªã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç™»éŒ²çŠ¶æ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-AzContext</span> <span class="literal">-Subscription</span> &lt;ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å&gt;</span><br><span class="line"><span class="built_in">Get-AzResourceProvider</span> <span class="literal">-ProviderNamespace</span> Microsoft.ContainerInstance |</span><br><span class="line">    <span class="built_in">Select-Object</span> ResourceTypes, RegistrationState</span><br></pre></td></tr></table></figure><p>ç™»éŒ²ãŒã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®å‡ºåŠ›ä¾‹ã®ã‚ˆã†ã«å„ RegistrationState  ãŒNotRegistered ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\shoheioda&gt; <span class="built_in">Get-AzResourceProvider</span> <span class="literal">-ProviderNamespace</span> Microsoft.ContainerInstance | <span class="built_in">select</span> ResourceTypes,RegistrationState</span><br><span class="line"> </span><br><span class="line">ResourceTypes                                     RegistrationState</span><br><span class="line">-------------                                     -----------------</span><br><span class="line">&#123;containerGroups&#125;                                 NotRegistered</span><br><span class="line">&#123;serviceAssociationLinks&#125;                         NotRegistered</span><br><span class="line">&#123;locations&#125;                                       NotRegistered</span><br><span class="line">&#123;locations/capabilities&#125;                          NotRegistered</span><br><span class="line">&#123;locations/usages&#125;                                NotRegistered</span><br><span class="line">&#123;locations/operations&#125;                            NotRegistered</span><br><span class="line">&#123;locations/operationresults&#125;                      NotRegistered</span><br><span class="line">&#123;operations&#125;                                      NotRegistered</span><br><span class="line">&#123;locations/cachedImages&#125;                          NotRegistered</span><br><span class="line">&#123;locations/validateDeleteVirtualNetworkOrSubnets&#125; NotRegistered</span><br><span class="line">&#123;locations/deleteVirtualNetworkOrSubnets&#125;         NotRegistered</span><br></pre></td></tr></table></figure><p>ç™»éŒ²ã‚’è¡Œã†ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\shoheioda&gt; <span class="built_in">Get-AzResourceProvider</span> <span class="literal">-ProviderNamespace</span> Microsoft.ContainerInstance | <span class="built_in">select</span> ResourceTypes,RegistrationState</span><br><span class="line"> </span><br><span class="line">ResourceTypes                                     RegistrationState</span><br><span class="line">-------------                                     -----------------</span><br><span class="line">&#123;containerGroups&#125;                                 Registered</span><br><span class="line">&#123;serviceAssociationLinks&#125;                         Registered</span><br><span class="line">&#123;locations&#125;                                       Registered</span><br><span class="line">&#123;locations/capabilities&#125;                          Registered</span><br><span class="line">&#123;locations/usages&#125;                                Registered</span><br><span class="line">&#123;locations/operations&#125;                            Registered</span><br><span class="line">&#123;locations/operationresults&#125;                      Registered</span><br><span class="line">&#123;operations&#125;                                      Registered</span><br><span class="line">&#123;locations/cachedImages&#125;                          Registered</span><br><span class="line">&#123;locations/validateDeleteVirtualNetworkOrSubnets&#125; Registered</span><br><span class="line">&#123;locations/deleteVirtualNetworkOrSubnets&#125;         Registered</span><br></pre></td></tr></table></figure><h4 id="æ‰‹é †â‘£-Azure-Container-Instance-ID-ã‚’ç¢ºèªã™ã‚‹"><a href="#æ‰‹é †â‘£-Azure-Container-Instance-ID-ã‚’ç¢ºèªã™ã‚‹" class="headerlink" title="æ‰‹é †â‘£ Azure Container Instance ID ã‚’ç¢ºèªã™ã‚‹"></a>æ‰‹é †â‘£ Azure Container Instance ID ã‚’ç¢ºèªã™ã‚‹</h4><p>å¾Œç¶šã®æ‰‹é †ã«ãŠã„ã¦å¿…è¦ã¨ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ« â€œAzure Container Instanceâ€ ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸ Azure Container Instance ID ã‚’ã€Azure PowerShell ã‚ˆã‚Šä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AzADServicePrincipal</span> <span class="literal">-DisplayNameBeginsWith</span> <span class="string">&#x27;Azure Container Instance&#x27;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ã®å‡ºåŠ›ä¾‹ã®å ´åˆã«ã¯ã€ Azure Container Instance Id ã¯ â€œ8fe7fd25-33fe-4f89-ade3-0e705fcf4370â€ ã¨ãªã‚Šã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DisplayName                      Id                                   AppId</span><br><span class="line">-----------                      --                                   -----</span><br><span class="line">Azure Container Instance Service <span class="number">8</span>fe7fd25<span class="literal">-33fe</span><span class="literal">-4f89</span><span class="literal">-ade3</span><span class="literal">-0e705fcf4370</span> <span class="number">34</span>fbe509<span class="literal">-d6cb</span><span class="literal">-4813</span><span class="literal">-99df</span><span class="literal">-52d944bfd95a</span></span><br></pre></td></tr></table></figure><h4 id="æ‰‹é †â‘¤-ARM-ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹"><a href="#æ‰‹é †â‘¤-ARM-ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹" class="headerlink" title="æ‰‹é †â‘¤ ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹"></a>æ‰‹é †â‘¤ ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹</h4><p>ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ Cloud Shell ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã„ãŸã—ã¾ã™ã€‚</p><p><a href="https://aka.ms/cloudshell/docs/vnet/template">https://aka.ms/cloudshell/docs/vnet/template</a></p><p>ä¸Šè¨˜ãƒªãƒ³ã‚¯ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã«ãŠã„ã¦ã€ã® â€œDeploy to Azureâ€ ã®ãƒªãƒ³ã‚¯ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step5-1.jpg" alt="æ‰‹é †â‘¤"></p><p>è¡¨ç¤ºã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å„é …ç›®ã«å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€â€ç¢ºèªã¨ä½œæˆâ€ã‚’ é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step5-2.jpg" alt="æ‰‹é †â‘¤"></p><p>å…¥åŠ›ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã®åç§°ãªã©ç¢ºèªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€å•é¡Œãªã‘ã‚Œã° â€œä½œæˆâ€ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step5-3.jpg" alt="æ‰‹é †â‘¤"></p><p>å¯¾è±¡ã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å†…ã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ãŒ ã¾ã¨ã‚ã¦ä½œæˆã•ã‚Œã¾ã™ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step5-4.jpg" alt="æ‰‹é †â‘¤"></p><h4 id="æ‰‹é †â‘¥-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚"><a href="#æ‰‹é †â‘¥-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚" class="headerlink" title="æ‰‹é †â‘¥ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚"></a>æ‰‹é †â‘¥ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚</h4><p>ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦Cloud Shell ãŒä½¿ç”¨ã™ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</p><p><a href="https://azure.microsoft.com/resources/templates/cloud-shell-vnet-storage/">https://azure.microsoft.com/resources/templates/cloud-shell-vnet-storage/</a></p><p>ä¸Šè¨˜ãƒªãƒ³ã‚¯ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã«ãŠã„ã¦ â€œDeploy to Azureâ€ ã®ãƒªãƒ³ã‚¯ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step6-1.jpg" alt="æ‰‹é †â‘¥"></p><p>è¡¨ç¤ºã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å„é …ç›®ã«å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€â€ç¢ºèªã¨ä½œæˆâ€ã‚’ é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step6-2.jpg" alt="æ‰‹é †â‘¥"></p><p>å…¥åŠ›ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã®åç§°ãªã©ç¢ºèªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€å•é¡Œãªã‘ã‚Œã° â€œä½œæˆâ€ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step6-3.jpg" alt="æ‰‹é †â‘¥"></p><p>å¯¾è±¡ã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å†…ã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step6-4.jpg" alt="æ‰‹é †â‘¥"></p><h4 id="æ‰‹é †â‘¦-ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«-Cloud-Shell-ã‚’æ§‹æˆã™ã‚‹"><a href="#æ‰‹é †â‘¦-ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«-Cloud-Shell-ã‚’æ§‹æˆã™ã‚‹" class="headerlink" title="æ‰‹é †â‘¦ ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã« Cloud Shell ã‚’æ§‹æˆã™ã‚‹"></a>æ‰‹é †â‘¦ ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã« Cloud Shell ã‚’æ§‹æˆã™ã‚‹</h4><p>Azure ãƒãƒ¼ã‚¿ãƒ«ç”»é¢ä¸Šéƒ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Š Cloud Shell ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠã„ãŸã—ã¾ã™ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step7-1.jpg" alt="æ‰‹é †â‘¦"></p><p>åˆæœŸæ™‚ç‚¹ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« â€œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“â€ ã¨Cloud Shell ç«¯æœ«ã‚’æ–°è¦ã«ä½œæˆã•ã‚Œã‚‹ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€ã“ã“ã§ãƒªãƒ³ã‚¯ â€œè©³ç´°è¨­å®šã®è¡¨ç¤ºâ€ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step7-2.jpg" alt="æ‰‹é †â‘¦"></p><p>ãªãŠã€æ—¢ã«æ—¢å®šã®è¨­å®šã§ Cloud Shell ã‚’ã”åˆ©ç”¨ã•ã‚Œã¦ãŠã‚Šã€ä¸Šè¨˜ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« Cloud Shell ç”»é¢ã‚ˆã‚Šã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®æ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰ â€œãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®ãƒªã‚»ãƒƒãƒˆâ€ ã‚’é¸æŠã—ã¦è¨­å®šã‚’åˆæœŸåŒ–ã•ã›ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step7-3.jpg" alt="æ‰‹é †â‘¦"></p><p>å†åº¦ Cloud Shell ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ã€ä¸Šè¿°ã® â€œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“â€ ã¨Cloud Shell ç«¯æœ«ã‚’æ–°è¦ã«ä½œæˆã•ã‚Œã‚‹ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€â€œè©³ç´°è¨­å®šã®è¡¨ç¤ºâ€ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p>â€œè©³ç´°è¨­å®šã®è¡¨ç¤ºâ€ ã‚ˆã‚Šä»¥ä¸‹ã®ã‚ˆã†ã«å¿…è¦ãªé …ç›®ã‚’å…¥åŠ›ã—ã¦ã€â€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä½œæˆâ€ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/UseCloudShellinAzureVirtualNetwork/step7-4.jpg" alt="æ‰‹é †â‘¦"></p><h4 id="è£œè¶³ï¼š-ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸå ´åˆã®çŠ¶æ…‹ç¢ºèª"><a href="#è£œè¶³ï¼š-ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸå ´åˆã®çŠ¶æ…‹ç¢ºèª" class="headerlink" title="è£œè¶³ï¼š ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸå ´åˆã®çŠ¶æ…‹ç¢ºèª"></a>è£œè¶³ï¼š ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸå ´åˆã®çŠ¶æ…‹ç¢ºèª</h4><p>Cloud Shell ç«¯æœ«ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸçŠ¶æ³ã«ã¤ã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§</p><p>Get-CloudDrive ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã«ã‚ˆã‚Šã€Cloud Shell ãŒãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ã®ãƒªã‚½ãƒ¼ã‚¹æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> /home/user&gt; <span class="built_in">Get-CloudDrive</span>                                                                  ter<span class="string">&#x27; -PassThru</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">FileShareName      : acsshare</span></span><br><span class="line"><span class="string">FileSharePath      : //srtrgaccctcloudshellvnet.file.core.windows.net/acsshare</span></span><br><span class="line"><span class="string">MountPoint         : /home/user/clouddrive</span></span><br><span class="line"><span class="string">Name               : srtrgaccctcloudshellvnet</span></span><br><span class="line"><span class="string">ResourceGroupName  : rg-cloudshellvnet</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">StorageAccountName : srtrgaccctcloudshellvnet</span></span><br><span class="line"><span class="string">SubscriptionId     : XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ã®ã‚ˆã†ã«å¯¾è±¡ã® VNET ã‹ã‚‰åˆ°é”å¯èƒ½ãª ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP  ã«å¯¾ã—ã¦ Ping ã‚„SSH ã«ã‚ˆã‚Šæ¥ç¶šãŒå¯èƒ½ã§ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> /home/user&gt; ping <span class="number">10.8</span>.<span class="number">0.20</span></span><br><span class="line">PING <span class="number">10.8</span>.<span class="number">0.20</span> (<span class="number">10.8</span>.<span class="number">0.20</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">10.8</span>.<span class="number">0.20</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">68.7</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">10.8</span>.<span class="number">0.20</span>: icmp_seq=<span class="number">4</span> ttl=<span class="number">64</span> time=<span class="number">68.5</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">10.8</span>.<span class="number">0.20</span>: icmp_seq=<span class="number">5</span> ttl=<span class="number">64</span> time=<span class="number">68.2</span> ms</span><br><span class="line">^C</span><br><span class="line">--- <span class="number">10.8</span>.<span class="number">0.20</span> ping statistics ---</span><br><span class="line"><span class="number">5</span> packets transmitted, <span class="number">3</span> received, <span class="number">40</span>% packet loss, time <span class="number">4062</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">68.233</span>/<span class="number">68.479</span>/<span class="number">68.665</span>/<span class="number">0.181</span> ms</span><br><span class="line"><span class="built_in">PS</span> /home/user&gt;</span><br><span class="line"><span class="built_in">PS</span> /home/user&gt; ssh <span class="literal">-i</span> rhel<span class="literal">-86</span><span class="literal">-02_20230912</span>.pem azureuser@<span class="number">10.8</span>.<span class="number">0.20</span></span><br><span class="line">Activate the web console with: systemctl enable -<span class="literal">-now</span> cockpit.socket</span><br><span class="line"></span><br><span class="line">Register this system with Red Hat Insights: insights<span class="literal">-client</span> -<span class="literal">-register</span></span><br><span class="line">Create an account or view all your systems at https://red.ht/insights<span class="literal">-dashboard</span></span><br><span class="line">Last login: Tue Sep <span class="number">12</span> <span class="number">04</span>:<span class="number">16</span>:<span class="number">23</span> <span class="number">2023</span> from XX.XX.XX.XX</span><br><span class="line">[<span class="type">azureuser</span>@<span class="type">rhel</span>-<span class="number">86</span>-<span class="number">02</span> ~]<span class="variable">$</span> </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®å°ç”°ã§ã™ã€‚&lt;br&gt;ä»Šå›ã¯ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ Azure Cloud Shell ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ã‚’ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure Cloud Shell" scheme="https://jpaztech.github.io/blog/tags/Azure-Cloud-Shell/"/>
    
    <category term="Token" scheme="https://jpaztech.github.io/blog/tags/Token/"/>
    
    <category term="OAuth" scheme="https://jpaztech.github.io/blog/tags/OAuth/"/>
    
  </entry>
  
  <entry>
    <title>AKS ãƒãƒ¼ãƒ‰ãŒèµ·å‹•ã—ãªã„å ´åˆã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</title>
    <link href="https://jpaztech.github.io/blog/containers/aks-vmsscse/"/>
    <id>https://jpaztech.github.io/blog/containers/aks-vmsscse/</id>
    <published>2023-12-12T03:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.152Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®æ¡äº•ã§ã™ã€‚</p><p><a href="https://learn.microsoft.com/ja-jp/azure/aks/intro-kubernetes">Azure Kubernetes Service (AKS)</a> ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã€ãƒãƒ¼ãƒ‰ã®æ–°è¦ä½œæˆãŒæˆåŠŸã—ãªã„äº‹è±¡ã‚„ã€åœæ­¢ã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®èµ·å‹•ãŒæˆåŠŸã—ãªã„ã¨ã„ã£ãŸäº‹è±¡ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚</p><p>ã“ã®ã‚ˆã†ãªäº‹è±¡ã¯ã€ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ãŒæˆåŠŸã—ã¦ã„ãªã„å ´åˆã«ç™ºç”Ÿã™ã‚‹ã‚‚ã®ã§ã€å¼Šç¤¾ã‚µãƒãƒ¼ãƒˆäº‹ä¾‹ã«ãŠã„ã¦ã‚‚å¤šãã®ãŠå®¢æ§˜ã‚ˆã‚Šã”ç›¸è«‡ã‚’ã„ãŸã ãã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚</p><p>æœ¬è¨˜äº‹ã§ã¯ã€AKS ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ã‚’æ‹…ã† vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã«ã¤ã„ã¦ã®è§£èª¬ã¨ã€ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ãŒæˆåŠŸã—ãªã„ä»£è¡¨çš„ãªè¦å› ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚</p><span id="more"></span><hr><h2 id="vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ã¨ã¯"><a href="#vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ã¨ã¯" class="headerlink" title="vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã¨ã¯"></a>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã¨ã¯</h2><p>AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ãƒãƒ¼ãƒ‰ã«ã¯ VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚AKS ãƒãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ã¨ã€ãã‚Œã«å¿œã˜ã¦ VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™ã€‚</p><p>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã¯ã€VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ AKS ãƒãƒ¼ãƒ‰ã¨ã—ã¦åˆ©ç”¨å¯èƒ½ãªçŠ¶æ…‹ã«ã™ã‚‹ãŸã‚ã«åˆæœŸåŒ–ã™ã‚‹å½¹å‰²ã‚’æ‹…ã„ã¾ã™ã€‚<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/extensions/overview">Azure ä»®æƒ³ãƒã‚·ãƒ³ã®æ‹¡å¼µæ©Ÿèƒ½</a>ã‚’åˆ©ç”¨ã—ã¦ã€AKS ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ã‚’ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚<br>vmssCSE ã¯ VMSS (Virtual Machine Scale Set) Custom Script Extension ã®ç•¥ç§°ã§ã™ã€‚</p><p>åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ã¯ã˜ã‚ã«ã€<a href="https://learn.microsoft.com/ja-jp/azure/aks/outbound-rules-control-egress#required-outbound-network-rules-and-fqdns-for-aks-clusters">AKS ãƒãƒ¼ãƒ‰ã«å¿…è¦ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦ä»¶</a>ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã‹æ¤œè¨¼ã•ã‚Œã¾ã™ã€‚<br>AKS ã®API ã‚µãƒ¼ãƒãƒ¼ã‚„ã€ã‚·ã‚¹ãƒ†ãƒ  ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å–å¾—å…ƒã¨ãªã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‹æ¤œè¨¼ã—ã€å¿…è¦ãªé€šä¿¡ãŒã§ãã‚‹çŠ¶æ…‹ã§ã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã™ã€‚<br>ãã®å¾Œã€AKS ãƒãƒ¼ãƒ‰ã¨ã—ã¦å‹•ä½œã•ã›ã‚‹ãŸã‚ã«å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (kubelet ã‚„ CNI ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãªã©) ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚<br>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã™ã‚‹ã¨ã€AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚</p><p>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã¯ã€Azure ä»®æƒ³ãƒã‚·ãƒ³ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸€éƒ¨ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚<br>ä½•ã‚‰ã‹ã®è¦å› ã«ã‚ˆã£ã¦ vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã«ã‚ˆã‚‹ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ãŒæˆåŠŸã—ãªã‹ã£ãŸå ´åˆã«ã¯ã€æ–°è¦ä½œæˆã•ã‚ŒãŸ AKS ãƒãƒ¼ãƒ‰ã®èµ·å‹•ãŒå®Œäº†ã—ãªã„çŠ¶æ…‹ã¨ãªã‚Šã¾ã™ã€‚</p><p>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã«ã‚ˆã‚‹ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ãŒæˆåŠŸã—ãªã„ã¨ã€æ¬¡ã®ã‚ˆã†ãªäº‹è±¡ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><ul><li>AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆå¤±æ•—</li><li>AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚„ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¤±æ•—</li><li>ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«è¿½åŠ ã‚„ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå¤±æ•—</li><li>åœæ­¢ã•ã‚ŒãŸ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®èµ·å‹•å¤±æ•—</li></ul><p>ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ãŒæˆåŠŸã—ãªã„ç†ç”±ã®å¤šãã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã«é–¢é€£ã™ã‚‹è¦å› ã§ã™ã€‚<br>ç‰¹ã«ã€ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã‚„ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼ãªã©ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã„ã‚‹ç’°å¢ƒã«ãŠã„ã¦ã€AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å‹•ä½œã«å¿…è¦ãªé€šä¿¡ãŒæˆåŠŸã—ãªã„ã“ã¨ã«ã‚ˆã£ã¦äº‹è±¡ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><p><img src="/blog/containers/aks-vmsscse/aks-vmsscse01.png" alt="ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ãŒæˆåŠŸã—ãªã„å ´åˆã«æƒ³å®šã•ã‚Œã‚‹è¦å› ç®‡æ‰€"></p><p>Azure ä»®æƒ³ãƒã‚·ãƒ³ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€<a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/extensions/troubleshoot">å®Ÿè¡Œçµæœã‚’ãŠå®¢æ§˜ã«ã¦ã”ç¢ºèªã„ãŸã ãã“ã¨ãŒå¯èƒ½ã§ã™</a>ã€‚<br>ã¾ãŸã€vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã§å®Ÿè¡Œã•ã‚Œã‚‹ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æˆåŠŸã—ãªã‹ã£ãŸç†ç”±ã«å¿œã˜ã¦ã‚¨ãƒ©ãƒ¼ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚</p><p>ãã®ãŸã‚ã€ä¸Šè¨˜ã®ã‚ˆã†ãªäº‹è±¡ãŒç™ºç”Ÿã—ãŸå ´åˆã«ã¯ã€vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã®å®Ÿè¡Œçµæœã‚’ã”ç¢ºèªã„ãŸã ãã“ã¨ã§ã€è¦å› ç®‡æ‰€ã®ç‰¹å®šã«å½¹ç«‹ã¤æ‰‹ãŒã‹ã‚Šã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><h2 id="vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ç¢ºèªæ–¹æ³•"><a href="#vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ç¢ºèªæ–¹æ³•" class="headerlink" title="vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ç¢ºèªæ–¹æ³•"></a>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ç¢ºèªæ–¹æ³•</h2><p>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‹ã‚‰ã€AKS ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚ä¸»ãªç¢ºèªé …ç›®ã¯æ¬¡ã®2ã¤ã§ã™ã€‚</p><ol><li>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ã‚³ãƒ¼ãƒ‰ (code)<ul><li>æ‹¡å¼µæ©Ÿèƒ½ã®å®Ÿè¡Œçµæœã‚’ç¤ºã—ã¾ã™</li><li><code>ProvisioningState/succeeded</code> ã®å ´åˆã¯æˆåŠŸã§ã™</li><li><code>ProvisioningState/failed</code> ã®å ´åˆã¯å¤±æ•—ã§ã™</li></ul></li><li>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (message)<ul><li>åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œçµæœã¨ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™</li><li>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ç‰¹ã« <code>ExitCode</code> ã®å€¤ã«æ³¨ç›®ã—ã¾ã™</li><li><code>ExitCode</code> ãŒ <code>0</code> ã®å ´åˆã¯æˆåŠŸã§ã™</li><li><code>0</code> ä»¥å¤– (<code>50</code>, <code>51</code>, ãªã©) ã®å ´åˆã¯ä½•ã‚‰ã‹ã®è¦å› ã§å¤±æ•—ã—ã¦ã„ã¾ã™</li></ul></li></ol><p>æ¬¡ã«ã€Azure Portal ã¨ Azure CLI ã§ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚</p><h3 id="Azure-Portal-ã§ç¢ºèªã™ã‚‹æ–¹æ³•"><a href="#Azure-Portal-ã§ç¢ºèªã™ã‚‹æ–¹æ³•" class="headerlink" title="Azure Portal ã§ç¢ºèªã™ã‚‹æ–¹æ³•"></a>Azure Portal ã§ç¢ºèªã™ã‚‹æ–¹æ³•</h3><p>ãƒãƒ¼ãƒ‰ ãƒªã‚½ãƒ¼ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ— (æ—¢å®šã§ã¯ <code>MC_</code> ã§å§‹ã¾ã‚‹ãƒªã‚½ãƒ¼ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ—) ã‚’é–‹ãã€ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ VMSS ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹ãã¾ã™ã€‚<br>å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ [ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹] ã‚’é¸æŠã—ã€çŠ¶æ…‹ã‚’ç¢ºèªã—ãŸã„ VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚</p><p><img src="/blog/containers/aks-vmsscse/aks-vmsscse02.png"></p><p>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°ç”»é¢ã® [çŠ¶æ…‹] é …ç›®ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚</p><p><img src="/blog/containers/aks-vmsscse/aks-vmsscse03.png"></p><p>[æ‹¡å¼µæ©Ÿèƒ½ã®çŠ¶æ…‹] &gt; [vmssCSE] ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><p><img src="/blog/containers/aks-vmsscse/aks-vmsscse04.png"></p><h3 id="Azure-CLI-ã§ç¢ºèªã™ã‚‹æ–¹æ³•"><a href="#Azure-CLI-ã§ç¢ºèªã™ã‚‹æ–¹æ³•" class="headerlink" title="Azure CLI ã§ç¢ºèªã™ã‚‹æ–¹æ³•"></a>Azure CLI ã§ç¢ºèªã™ã‚‹æ–¹æ³•</h3><p>Azure CLI ã§ã¯ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™ã€‚<br>ãƒãƒ¼ãƒ‰ ãƒªã‚½ãƒ¼ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ—ã¨ VMSS ãƒªã‚½ãƒ¼ã‚¹åã‚’æŒ‡å®šã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">az vmss list-instances --resource-group &lt;NODE RESOURCE GROUP&gt; --name &lt;VMSS NAME&gt; \</span><br><span class="line">    --expand instanceView --query &quot;[].&#123;name:name, extensions: instanceView.extensions&#125;&quot;</span><br></pre></td></tr></table></figure><p>ä¸‹è¨˜ãŒå®Ÿè¡Œä¾‹ã¨ãªã‚Šã¾ã™ã€‚<br><code>&quot;extensions&quot;</code> ã®é…ä¸‹ã«<code>&quot;name&quot;: &quot;vmssCSE&quot;</code> ã¨ã„ã†åå‰ã§æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚<br><code>&quot;statuses&quot;</code> ã® <code>&quot;code&quot;</code> ã¨ã€<code>&quot;message&quot;</code> ã«å«ã¾ã‚Œã‚‹ <code>\&quot;ExitCode\&quot;</code> ã®å€¤ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss list-instances --resource-group MC_myResourceGroup_myAKSCluster_japaneast --name aks-agentpool-20329050-vmss \</span></span><br><span class="line"><span class="bash">    --expand instanceView --query <span class="string">&quot;[].&#123;name:name, extensions: instanceView.extensions&#125;&quot;</span></span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;extensions&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;vmssCSE&quot;,</span><br><span class="line">        &quot;statuses&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">            &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">            &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">            &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\n&#123; \&quot;ExitCode\&quot;: \&quot;0\&quot;, \&quot;Output\&quot;: \&quot;Wed Feb 2 10:21:47 UTC 2022,aks-agentpool-20329050-vmss000004\\n(çœç•¥)&quot;,</span><br><span class="line">            &quot;time&quot;: null</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;substatuses&quot;: null,</span><br><span class="line">        &quot;type&quot;: &quot;Microsoft.Azure.Extensions.CustomScript&quot;,</span><br><span class="line">        &quot;typeHandlerVersion&quot;: &quot;2.1.6&quot;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      (çœç•¥)</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    &quot;name&quot;: &quot;aks-agentpool-20329050-vmss_4&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ã®ä»£è¡¨çš„ãª-ExitCode"><a href="#vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ã®ä»£è¡¨çš„ãª-ExitCode" class="headerlink" title="vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã®ä»£è¡¨çš„ãª ExitCode"></a>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã®ä»£è¡¨çš„ãª ExitCode</h2><p>ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã§ç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚‹ä»£è¡¨çš„ãª ExitCode ã«ã¤ã„ã¦ã€åŸå› ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚</p><ul><li><a href="./#ExitCode-50">ExitCode: 50 (é€ä¿¡æ¥ç¶šã®å¤±æ•—)</a></li><li><a href="./#ExitCode-51">ExitCode: 51 (AKS API ã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—)</a></li><li><a href="./#ExitCode-52">ExitCode: 52 (AKS API ã‚µãƒ¼ãƒãƒ¼ã®åå‰è§£æ±ºãŒå¤±æ•—)</a></li><li><a href="./#ExitCode-53">ExitCode: 53 (Azure DNS Service ã«ã‚ˆã‚‹ AKS API ã‚µãƒ¼ãƒãƒ¼ã®åå‰è§£æ±ºãŒå¤±æ•—)</a></li></ul><h3 id="ExitCode-50"><a href="#ExitCode-50" class="headerlink" title="ExitCode: 50"></a>ExitCode: 50</h3><p>ExitCode: 50 ã®ã‚¨ãƒ©ãƒ¼ã¯ã€AKS ãƒãƒ¼ãƒ‰ã®å‹•ä½œã«å¿…è¦ã¨ãªã‚‹é€šä¿¡å…ˆã¸ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒæˆåŠŸã—ãªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚</p><blockquote><p><strong>OutboundConnFailVMExtensionError ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (50) - Azure / Microsoft Learn</strong><br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-outboundconnfailvmextensionerror">https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-outboundconnfailvmextensionerror</a></p></blockquote><h4 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h4><p>AKS ãƒãƒ¼ãƒ‰ã«å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€Microsoft Container Registry (MCR) ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (mcr.microsoft.com, 443/tcp) ã‹ã‚‰å–å¾—ã•ã‚Œã¾ã™ã€‚</p><p>ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ã¯ã˜ã‚ã« MCR ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸åˆ°é”å¯èƒ½ã§ã‚ã‚‹ã‹ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼ã‚’è¡Œã„ã¾ã™ã€‚<br>ã“ã®ã¨ãã€ãƒãƒ¼ãƒ‰ã‹ã‚‰ MCR ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒæˆåŠŸã—ãªã‹ã£ãŸå ´åˆã«ã€ExitCode: 50 ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><p>MCR ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒæˆåŠŸã—ãªã„è¦å› ã¨ã—ã¦ã¯ã€æ¬¡ã®ã‚ˆã†ãªç†ç”±ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚</p><ul><li>DNS ã«ã‚ˆã‚‹åå‰è§£æ±ºãŒå¤±æ•—ã—ã¦ã„ã‚‹</li><li>NSG ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹</li><li>Azure Firewall / ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä»®æƒ³ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ (NVA) ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹</li></ul><h4 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"><a href="#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°" class="headerlink" title="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"></a>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h4><p>AKS ãƒãƒ¼ãƒ‰ã‹ã‚‰ mcr.microsoft.com ã«å¯¾ã—ã¦ã€å®Ÿéš›ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹çŠ¶æ…‹ã§ã‚ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚<br><code>az vmss run-command</code> ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã€VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã§ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼ç”¨ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><p>ã¯ã˜ã‚ã«ã€mcr.microsoft.com ã®åå‰è§£æ±ºãŒæˆåŠŸã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚<br>æ¬¡ã®ã‚ˆã†ã«ã€<code>az vmss run-command</code> ã‚³ãƒãƒ³ãƒ‰ã® <code>--scripts</code> ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« <code>nslookup</code> ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">az vmss run-command invoke -g &lt;NODE RESOURCE GROUP&gt; -n &lt;VMSS NAME&gt; \</span><br><span class="line">    --command-id RunShellScript --instance-id &lt;INSTANCE_ID&gt; \</span><br><span class="line">    --scripts &quot;nslookup mcr.microsoft.com&quot;</span><br></pre></td></tr></table></figure><p><strong>æˆåŠŸã®ä¾‹</strong></p><p><code>&quot;message&quot;</code> ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« <code>nslookup</code> ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚<br><code>Address: 204.79.197.219</code> ã®ã‚ˆã†ã«ã€mcr.microsoft.com ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€åå‰è§£æ±ºã¯æˆåŠŸã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_myResourceGroup_myAKSCluster_japaneast -n aks-agentpool-20329050-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 0 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nslookup mcr.microsoft.com&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\nServer:\t\t168.63.129.16\nAddress:\t168.63.129.16#53\n\nNon-authoritative answer:\nmcr.microsoft.com\tcanonical name = global.fe.mscr.io.\nglobal.fe.mscr.io\tcanonical name = mcr-microsoft-com.a-0016.a-msedge.net.\nmcr-microsoft-com.a-0016.a-msedge.net\tcanonical name = a-0016.a-msedge.net.\nName:\ta-0016.a-msedge.net\nAddress: 204.79.197.219\n\n\n[stderr]\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤±æ•—ã®ä¾‹</strong></p><p>IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‡ºåŠ›ã•ã‚Œã¦ãŠã‚‰ãšã€<code>server can&#39;t find mcr.microsoft.com</code> ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ <code>NXDOMAIN</code> ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€åå‰è§£æ±ºãŒæˆåŠŸã—ã¦ã„ã¾ã›ã‚“ã€‚</p><p>ã”åˆ©ç”¨ã®ç’°å¢ƒã«ãŠã„ã¦<a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances?tabs=redhat#name-resolution-that-uses-your-own-dns-server">ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹</a>å ´åˆã¯ã€AKS ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ VNet ã«å¯¾ã—ã¦ã€ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼ãŒæ­£ã—ãæ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚<br>ã¾ãŸã€ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼ãŒ mcr.microsoft.com ã®åå‰è§£æ±ºã‚’ã§ãã‚‹çŠ¶æ…‹ã§ã‚ã‚‹ã‹ã€å‹•ä½œãƒ»è¨­å®šã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_myRG_myAKSCluster_japaneast -n aks-nodepool1-15399206-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 2 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nslookup mcr.microsoft.com&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\nServer:\t\t127.0.0.53\nAddress:\t127.0.0.53#53\n\n** server can&#x27;t find mcr.microsoft.com: SERVFAIL\n\n\n[stderr]\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå‰è§£æ±ºãŒæˆåŠŸã—ãŸã‚‰ã€mcr.microsoft.com ã¸ã®ç–é€šãŒã§ãã‚‹çŠ¶æ…‹ã§ã‚ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚<br>æ¬¡ã®ã‚ˆã†ã«ã€<code>nc</code> ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">az vmss run-command invoke -g &lt;NODE RESOURCE GROUP&gt; -n &lt;VMSS NAME&gt; \</span><br><span class="line">    --command-id RunShellScript --instance-id &lt;INSTANCE_ID&gt; \</span><br><span class="line">    --scripts &quot;nc -vz mcr.microsoft.com 443&quot;</span><br></pre></td></tr></table></figure><p><strong>æˆåŠŸã®ä¾‹</strong></p><p><code>Connection to mcr.microsoft.com 443 port [tcp/https] succeeded!</code> ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€ã‚¢ã‚¯ã‚»ã‚¹ãŒæˆåŠŸã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_myResourceGroup_myAKSCluster_japaneast -n aks-agentpool-20329050-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 1 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nc -vz mcr.microsoft.com 443&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\n\n[stderr]\nConnection to mcr.microsoft.com 443 port [tcp/https] succeeded!\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤±æ•—ã®ä¾‹</strong></p><p><code>nc: connect to mcr.microsoft.com port 443 (tcp) failed</code> ã¨è¡¨ç¤ºã•ã‚ŒãŸå ´åˆã«ã¯ã€é€šä¿¡ãŒå¤±æ•—ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_myRG_myAKSCluster_japaneast -n aks-nodepool1-20916290-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 1 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nc -vz mcr.microsoft.com 443&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\n\n[stderr]\nnc: connect to mcr.microsoft.com port 443 (tcp) failed: Connection timed out\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã“ã®å ´åˆã€ä½•ã‚‰ã‹ã®è¦å› ã«ã‚ˆã£ã¦ãƒãƒ¼ãƒ‰ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸé€šä¿¡ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚<br>NSG ã‚„ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã§é€šä¿¡åˆ¶å¾¡ã‚’ã—ã¦ã„ã‚‹å ´åˆã¯ã€AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å¿…è¦ãª FQDN ã¸ã®é€šä¿¡ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ã”ç¢ºèªãã ã•ã„ã€‚</p><blockquote><p>ã”å‚è€ƒ) AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å¿…è¦ãªé€ä¿¡ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦å‰‡ã¨ FQDN<br><a href="https://learn.microsoft.com/ja-jp/azure/aks/outbound-rules-control-egress#required-outbound-network-rules-and-fqdns-for-aks-clusters">https://learn.microsoft.com/ja-jp/azure/aks/outbound-rules-control-egress#required-outbound-network-rules-and-fqdns-for-aks-clusters</a></p></blockquote><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p>Azure Firewall ã§é€šä¿¡åˆ¶å¾¡ã‚’ã™ã‚‹å ´åˆã«ã¯ã€AKS ç”¨ã® FQDN ã‚¿ã‚° <code>AzureKubernetesService</code> ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚</p><p>ã“ã® FQDN ã‚¿ã‚°ã«ã¯ã€ã€Œ<a href="https://learn.microsoft.com/ja-jp/azure/aks/outbound-rules-control-egress#required-outbound-network-rules-and-fqdns-for-aks-clusters">AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å¿…è¦ãªé€ä¿¡ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦å‰‡ã¨ FQDN</a>ã€ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã® FQDN ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚</p><p>ä»¥å‰ã¯å„ FQDN ã‚’å€‹åˆ¥ã«è¨±å¯ã„ãŸã ãå¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€ç¾åœ¨ã¯ FQDN ã‚¿ã‚°ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ä¸€æ‹¬ã§é€šä¿¡è¨±å¯ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã¾ã™ã®ã§ã€ã”æ´»ç”¨ãã ã•ã„ã€‚</p><p>ã€€</p><p>ã”å‚è€ƒ) Azure Kubernetes Service (AKS) ã§ Azure Firewall ã‚’ä½¿ç”¨ã—ã¦ã‚¨ã‚°ãƒ¬ã‚¹ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’åˆ¶å¾¡ã™ã‚‹</p><p><a href="https://learn.microsoft.com/ja-jp/azure/aks/limit-egress-traffic">https://learn.microsoft.com/ja-jp/azure/aks/limit-egress-traffic</a></p></div><h3 id="ExitCode-51"><a href="#ExitCode-51" class="headerlink" title="ExitCode: 51"></a>ExitCode: 51</h3><p>ExitCode: 51 ã®ã‚¨ãƒ©ãƒ¼ã¯ã€AKS ãƒãƒ¼ãƒ‰ãŒã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã® API ã‚µãƒ¼ãƒãƒ¼ã¸æ¥ç¶šã§ããªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚</p><blockquote><p><strong>K8SAPIServerConnFailVMExtensionError ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° - Azure / Microsoft Learn</strong><br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-k8sapiserverconnfailvmextensionerror">https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-k8sapiserverconnfailvmextensionerror</a></p></blockquote><h4 id="åŸå› -1"><a href="#åŸå› -1" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>ExitCode: 51 ã®ç™ºç”ŸçŠ¶æ³ã¯ã€ä¸Šè¿°ã—ãŸ <a href="./#ExitCode-50">ExitCode: 50</a> ã¨ä¼¼ã¦ã„ã¾ã™ã€‚ç•°ãªã‚‹ç‚¹ã¯é€šä¿¡å…ˆã§ã™ã€‚</p><p>ExitCode: 50 ã¯ã€mcr.microsoft.com ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæˆåŠŸã—ãªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚<br>ä¸€æ–¹ ExitCode: 51 ã¯ã€AKS ã® API ã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæˆåŠŸã—ãªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚<br>NSG ã‚„ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦é€šä¿¡åˆ¶é™ã‚’ã—ã¦ã„ã‚‹ç’°å¢ƒã«ãŠã„ã¦ã€mcr.microsoft.com ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯è¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã€AKS API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚„ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã™ã‚‹é€šä¿¡ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„å ´åˆã«ã€ç™ºç”ŸãŒæƒ³å®šã•ã‚Œã¾ã™ã€‚</p><h4 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-1"><a href="#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-1" class="headerlink" title="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"></a>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h4><p>AKS ãƒãƒ¼ãƒ‰ã‹ã‚‰ AKS API ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦ã€å®Ÿéš›ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹çŠ¶æ…‹ã§ã‚ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><p>ã¯ã˜ã‚ã«ã€å¯¾è±¡ã® AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az aks show -g &lt;RESOURCE GROUP&gt; --name &lt;CLUSTER&gt; --query fqdn</span><br></pre></td></tr></table></figure><p><code>az vmss run-command</code> ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã€VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã§ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼ç”¨ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<br>æ¬¡ã®ã‚ˆã†ã«ã€<code>nc</code> ã‚³ãƒãƒ³ãƒ‰ã« API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">az vmss run-command invoke -g &lt;NODE RESOURCE GROUP&gt; -n &lt;VMSS NAME&gt; \</span><br><span class="line">    --command-id RunShellScript --instance-id &lt;INSTANCE_ID&gt; \</span><br><span class="line">    --scripts &quot;nc -vz &lt;API Server FQDN&gt; 443&quot;</span><br></pre></td></tr></table></figure><p><strong>æˆåŠŸã®ä¾‹</strong></p><p><code>Connection to &lt;API Server FQDN&gt; 443 port [tcp/https] succeeded!</code> ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€ã‚¢ã‚¯ã‚»ã‚¹ãŒæˆåŠŸã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_my-ResourceGroup_myAKSCluster_japaneast -n aks-nodepool1-27512147-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 2 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nc -vz myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io 443&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\n\n[stderr]\nConnection to myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io 443 port [tcp/https] succeeded!\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤±æ•—ä¾‹</strong></p><p><code>nc: connect to &lt;API Server FQDN&gt; port 443 (tcp) failed</code> ã¨è¡¨ç¤ºã•ã‚ŒãŸå ´åˆã«ã¯ã€é€šä¿¡ãŒå¤±æ•—ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_my-ResourceGroup_myAKSCluster_japaneast -n aks-nodepool1-27512147-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 3 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nc -vz myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io 443&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\n\n[stderr]\nnc: connect to myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io port 443 (tcp) failed: No route to host\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã“ã®å ´åˆã€ä½•ã‚‰ã‹ã®è¦å› ã«ã‚ˆã£ã¦ãƒãƒ¼ãƒ‰ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸé€šä¿¡ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚<br>NSG ã‚„ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã§é€šä¿¡åˆ¶å¾¡ã‚’ã—ã¦ã„ã‚‹å ´åˆã¯ã€AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å¿…è¦ãª FQDN ã¸ã®é€šä¿¡ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ã”ç¢ºèªãã ã•ã„ã€‚</p><blockquote><p>ã”å‚è€ƒ) AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å¿…è¦ãªé€ä¿¡ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦å‰‡ã¨ FQDN<br><a href="https://learn.microsoft.com/ja-jp/azure/aks/outbound-rules-control-egress#required-outbound-network-rules-and-fqdns-for-aks-clusters">https://learn.microsoft.com/ja-jp/azure/aks/outbound-rules-control-egress#required-outbound-network-rules-and-fqdns-for-aks-clusters</a></p></blockquote><p>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã¯ã€API ã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚<br>VNet ã«ç‹¬è‡ªã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ã„ã‚‹å ´åˆã¯ã€å¯¾è±¡ã® AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ­£ã—ãæ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ã”ç¢ºèªãã ã•ã„ã€‚</p><blockquote><p>ã”å‚è€ƒ) ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ¥ç¶šã‚’ä½¿ç”¨ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#use-a-private-endpoint-connection">https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#use-a-private-endpoint-connection</a><br>ç‰¹ã«ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åœæ­¢ãƒ»å†èµ·å‹•ã‚’ã—ãŸå ´åˆã«ã¯ã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã€Œè­¦å‘Šã€ã«è¨˜è¼‰ã®å†…å®¹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p></blockquote><h3 id="ExitCode-52"><a href="#ExitCode-52" class="headerlink" title="ExitCode: 52"></a>ExitCode: 52</h3><p>ExitCode: 52 ã®ã‚¨ãƒ©ãƒ¼ã¯ã€DNS ã‚’ä½¿ç”¨ã—ã¦ã€AKS ãƒãƒ¼ãƒ‰ãŒ AKS API ã‚µãƒ¼ãƒãƒ¼ã®å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å (FQDN) ã‚’åå‰è§£æ±ºã§ããªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚</p><blockquote><p><strong>K8SAPIServerDNSLookupFailVMExtensionError ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (52) - Azure / Microsoft Learn</strong><br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-k8sapiserverdnslookupfailvmextensionerror">https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-k8sapiserverdnslookupfailvmextensionerror</a></p></blockquote><h4 id="åŸå› -2"><a href="#åŸå› -2" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>AKS ãƒãƒ¼ãƒ‰ãŒå‹•ä½œã™ã‚‹ãŸã‚ã«ã¯ã€AKS ã® API ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>AKS ãƒãƒ¼ãƒ‰ãŒ AKS API ã‚µãƒ¼ãƒãƒ¼ã«æ­£å¸¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„å ´åˆã«ã¯ã€ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ãŒæˆåŠŸã—ã¾ã›ã‚“ã€‚<br>ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„è¦å› ãŒã€DNS ã‚’åˆ©ç”¨ã—ã¦ AKS API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚’ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸åå‰è§£æ±ºã§ããªã„ã“ã¨ã§ã‚ã‚‹å ´åˆã« ExitCode: 52 ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><p>ExitCode: 52 ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€DNS ã«ã‚ˆã‚‹åå‰è§£æ±ºãŒé–¢é€£ã—ã¦ã„ã‚‹ã‚‚ã®ã¨è¦å› ç®‡æ‰€ã‚’çµã‚Šè¾¼ã‚ã¾ã™ã€‚</p><h4 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-2"><a href="#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-2" class="headerlink" title="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"></a>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h4><p>ã¯ã˜ã‚ã«ã€å¯¾è±¡ã® AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az aks show -g &lt;RESOURCE GROUP&gt; --name &lt;CLUSTER&gt; --query fqdn</span><br></pre></td></tr></table></figure><p><code>az vmss run-command</code> ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã€VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã§åå‰è§£æ±ºã®æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<br>æ¬¡ã®ã‚ˆã†ã«ã€<code>nslookup</code> ã‚³ãƒãƒ³ãƒ‰ã« API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">az vmss run-command invoke -g &lt;NODE RESOURCE GROUP&gt; -n &lt;VMSS NAME&gt; \</span><br><span class="line">    --command-id RunShellScript --instance-id &lt;INSTANCE_ID&gt; \</span><br><span class="line">    --scripts &quot;nslookup &lt;API Server FQDN&gt;&quot;</span><br></pre></td></tr></table></figure><p><strong>æˆåŠŸã®ä¾‹</strong></p><p><code>&quot;message&quot;</code> ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« <code>nslookup</code> ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚<br><code>Address: 10.240.0.5</code> ã®ã‚ˆã†ã«ã€AKS API ã‚µãƒ¼ãƒãƒ¼ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€åå‰è§£æ±ºã¯æˆåŠŸã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_my-ResourceGroup_myAKSCluster_japaneast -n aks-nodepool1-27512147-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 4 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nslookup myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\nServer:\t\t168.63.129.16\nAddress:\t168.63.129.16#53\n\nNon-authoritative answer:\nName:\tmyakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io\nAddress: 10.240.0.4\n\n\n[stderr]\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åå‰è§£æ±ºã®ãŸã‚ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ VNet ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p><p><strong>å¤±æ•—ã®ä¾‹</strong></p><p>IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‡ºåŠ›ã•ã‚Œã¦ãŠã‚‰ãšã€<code>server can&#39;t find &lt;API Server FQDN&gt;</code> ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ <code>NXDOMAIN</code> ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€åå‰è§£æ±ºãŒæˆåŠŸã—ã¦ã„ã¾ã›ã‚“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_test-RG_myAKSCluster-test_japaneast -n aks-nodepool1-73583151-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 0 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nslookup myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\nServer:\t\t192.168.1.4\nAddress:\t192.168.1.4#53\n\n** server can&#x27;t find myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io: NXDOMAIN\n\n\n[stderr]\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€DNS ã‚µãƒ¼ãƒãƒ¼ <code>192.168.1.4</code> ãŒåå‰è§£æ±ºã®çµæœã‚’å¿œç­”ã—ã¦ã„ã¾ã™ã€‚ã“ã® DNS ã‚µãƒ¼ãƒãƒ¼ã¯ã€Azure æ—¢å®šã§æä¾›ã•ã‚Œã‚‹ DNS ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ãªãã€VNet ã«è¨­å®šã—ãŸ<a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances?tabs=redhat#name-resolution-that-uses-your-own-dns-server">ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼</a>ã§ã™ã€‚</p><p>åå‰è§£æ±ºã®çµæœãŒ <code>NXDOMAIN</code> ã¨ãªã£ã¦ã„ã¾ã™ã€‚è¦æ±‚ã•ã‚ŒãŸ FQDN ã«è©²å½“ã™ã‚‹ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼å†…ã§è¦‹ã¤ã‹ã‚‰ãšã€ã€Œãã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã¯å­˜åœ¨ã—ãªã„ã€ã¨ã„ã†çµæœã‚’å¿œç­”ã—ã¦ã„ã¾ã™ã€‚<br>ã“ã®å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼ã®å‹•ä½œãƒ»è¨­å®šã‚’ç¢ºèªã—ã€AKS API ã‚µãƒ¼ãƒãƒ¼ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«åå‰è§£æ±ºã§ãã‚‹çŠ¶æ…‹ã§ã‚ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><p>ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼ä¸Šã« DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã„ã‚‹å ´åˆã¯ã€API ã‚µãƒ¼ãƒãƒ¼ã®æ­£ã—ã„ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ A ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚<br>åå‰è§£æ±ºã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’<a href="https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#hub-and-spoke-with-custom-dns">ä¸Šä½ã® DNS ã‚µãƒ¼ãƒãƒ¼ã«è»¢é€</a>ã—ã¦ã„ã‚‹å ´åˆã¯ã€DNS ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ€ãƒ¼ãŒæ­£ã—ãè¨­å®šãƒ»å‹•ä½œã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><h3 id="ExitCode-53"><a href="#ExitCode-53" class="headerlink" title="ExitCode: 53"></a>ExitCode: 53</h3><p>ExitCode: 53 ã®ã‚¨ãƒ©ãƒ¼ã¯ã€<a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances">Azure æ—¢å®šã® DNS ã‚µãƒ¼ãƒ“ã‚¹</a>ã‚’ä½¿ç”¨ã—ã¦ã€AKS ãƒãƒ¼ãƒ‰ãŒ AKS API ã‚µãƒ¼ãƒãƒ¼ã®å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å (FQDN) ã‚’åå‰è§£æ±ºã§ããªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚</p><h4 id="åŸå› -3"><a href="#åŸå› -3" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>AKS ãƒãƒ¼ãƒ‰ãŒ AKS API ã‚µãƒ¼ãƒãƒ¼ã«æ­£å¸¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚<br>çŠ¶æ³ã¯ ExitCode: 52 ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€ç•°ãªã‚‹ç‚¹ã¯ã€åå‰è§£æ±ºã®çµæœã‚’å¿œç­”ã—ãŸ DNS ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚</p><p>VNet ã«ã‚«ã‚¹ã‚¿ãƒ  DNS ã‚µãƒ¼ãƒãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€Azure ã® DNS ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã£ã¦åå‰è§£æ±ºãŒæä¾›ã•ã‚Œã¾ã™ã€‚<br>Azure æ—¢å®šã® DNS ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹ <code>168.63.129.16</code> ã§åå‰è§£æ±ºãŒæˆåŠŸã—ãªã‹ã£ãŸå ´åˆã«ã€ExitCode: 53 ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><blockquote><p>ã”å‚è€ƒ) IP ã‚¢ãƒ‰ãƒ¬ã‚¹ 168.63.129.16 ã¨ã¯<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/what-is-ip-address-168-63-129-16">https://learn.microsoft.com/ja-jp/azure/virtual-network/what-is-ip-address-168-63-129-16</a></p></blockquote><p>(ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã¯ãªã„) é€šå¸¸ã® AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä¸€éƒ¨ã®æ§‹æˆã§ã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆã¨åŒæ™‚ã« API ã‚µãƒ¼ãƒãƒ¼ã® DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹ãŸã‚ã€API ã‚µãƒ¼ãƒãƒ¼ã®åå‰è§£æ±ºã®çµæœãŒ <code>NXDOMAIN</code> ã«ã¯ãªã‚‰ãªã„æƒ³å®šã§ã™ã€‚<br>ä¸€æ–¹ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆæ™‚ã«ã€ç‹¬è‡ªã® Azure Private DNS Zone ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æŒ‡å®šã—ãŸå ´åˆã§ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p><p>Azure Private DNS Zone ã‚’ä½¿ç”¨ã—ãŸåå‰è§£æ±ºã§ã¯ã€DNS ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ Azure ã® DNS ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾ã—ã¦é€ä¿¡ã—ã¾ã™ã€‚<br>Private DNS Zone å†…ã« AKS API ã‚µãƒ¼ãƒãƒ¼ã® DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„ã¨ã€<code>168.63.129.16</code> ã‹ã‚‰ <code>NXDOMAIN</code> ã®å¿œç­”ãŒè¿”ã•ã‚Œã€ExitCode: 53 ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆæ™‚ã®<code>--private-dns-zone</code> ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦ã€API ã‚µãƒ¼ãƒãƒ¼ã® DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç®¡ç†æ–¹æ³•ãŒå¤‰æ›´å¯èƒ½ã§ã™ã€‚</p><p>ã”å‚è€ƒ) ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ DNS ã‚¾ãƒ¼ãƒ³ã‚’æ§‹æˆã™ã‚‹</p><p><a href="https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#configure-a-private-dns-zone">https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#configure-a-private-dns-zone</a></p></div><h4 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-3"><a href="#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-3" class="headerlink" title="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"></a>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h4><p>ã¯ã˜ã‚ã«ã€å¯¾è±¡ã® AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az aks show -g &lt;RESOURCE GROUP&gt; --name &lt;CLUSTER&gt; --query fqdn</span><br></pre></td></tr></table></figure><p><code>az vmss run-command</code> ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã€VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã§åå‰è§£æ±ºã®æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<br>æ¬¡ã®ã‚ˆã†ã«ã€<code>nslookup</code> ã‚³ãƒãƒ³ãƒ‰ã« API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">az vmss run-command invoke -g &lt;NODE RESOURCE GROUP&gt; -n &lt;VMSS NAME&gt; \</span><br><span class="line">    --command-id RunShellScript --instance-id &lt;INSTANCE_ID&gt; \</span><br><span class="line">    --scripts &quot;nslookup &lt;API Server FQDN&gt;&quot;</span><br></pre></td></tr></table></figure><p><strong>æˆåŠŸã®ä¾‹</strong></p><p><code>&quot;message&quot;</code> ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« <code>nslookup</code> ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚<br><code>Address: 10.240.0.5</code> ã®ã‚ˆã†ã«ã€AKS API ã‚µãƒ¼ãƒãƒ¼ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€åå‰è§£æ±ºã¯æˆåŠŸã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_my-RG_myAKSCluster_japaneast -n aks-nodepool1-22506348-vmss \</span></span><br><span class="line"><span class="bash">    --command-id RunShellScript --instance-id 0 \</span></span><br><span class="line"><span class="bash">    --scripts <span class="string">&quot;nslookup myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\nServer:\t\t168.63.129.16\nAddress:\t168.63.129.16#53\n\nNon-authoritative answer:\nName:\tmyakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io\nAddress: 10.240.0.4\n\n\n[stderr]\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤±æ•—ã®ä¾‹</strong></p><p>IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‡ºåŠ›ã•ã‚Œã¦ãŠã‚‰ãšã€<code>server can&#39;t find &lt;API Server FQDN&gt;</code> ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ <code>NXDOMAIN</code> ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€åå‰è§£æ±ºãŒæˆåŠŸã—ã¦ã„ã¾ã›ã‚“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> az vmss run-command invoke -g MC_my-RG_myAKSCluster_japaneast -n aks-nodepool1-22506348-vmss</span> </span><br><span class="line">    --command-id RunShellScript --instance-id 0 \</span><br><span class="line">    --scripts &quot;nslookup myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io&quot;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;value&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;code&quot;: &quot;ProvisioningState/succeeded&quot;,</span><br><span class="line">      &quot;displayStatus&quot;: &quot;Provisioning succeeded&quot;,</span><br><span class="line">      &quot;level&quot;: &quot;Info&quot;,</span><br><span class="line">      &quot;message&quot;: &quot;Enable succeeded: \n[stdout]\nServer:\t\t168.63.129.16\nAddress:\t168.63.129.16#53\n\n** server can&#x27;t find myakscluster.xxxxxxxxxx.privatelink.japaneast.azmk8s.io: NXDOMAIN\n\n\n[stderr]\n&quot;,</span><br><span class="line">      &quot;time&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã® FQDN ã®åå‰è§£æ±ºã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™ã€‚<br>åå‰è§£æ±ºã®çµæœã‚’å¿œç­”ã—ãŸ DNS ã‚µãƒ¼ãƒãƒ¼ãŒã€Azure ã® DNS ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ã•ã‚Œã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ <code>168.63.129.16</code> ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚<br><code>NXDOMAIN</code> ãŒè¿”ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã«è©²å½“ã™ã‚‹ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒç™ºè¦‹ã§ããªã‹ã£ãŸçŠ¶æ…‹ã¨ãªã‚Šã¾ã™ã€‚</p><p>ã“ã®ã‚ˆã†ãªå ´åˆã¯ã€Private DNS Zone ã®æ§‹æˆã¨ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä½œæˆçŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚<br>AKS ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ VNet ã¨ã€Private DNS Zone ã¨ã®é–“ã«ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒªãƒ³ã‚¯ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚<br>ã¾ãŸã€AKS API ã‚µãƒ¼ãƒãƒ¼ã® FQDN ã«è©²å½“ã™ã‚‹ A ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚<br>ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒªãƒ³ã‚¯ã®æ§‹æˆæ–¹æ³•ã¨ DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä½œæˆã«ã¤ã„ã¦ã¯ã€æ¬¡ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚</p><blockquote><p>ã”å‚è€ƒ) ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ¥ç¶šã‚’ä½¿ç”¨ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#use-a-private-endpoint-connection">https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#use-a-private-endpoint-connection</a></p></blockquote><div class="alert is-warning"><p class="alert-title">è­¦å‘Š</p><p>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ãŠå®¢æ§˜ã«ã¦ç‹¬è‡ªã«ä½œæˆã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åœæ­¢ãƒ»èµ·å‹•ã«ãŠã„ã¦æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p><p>ã“ã®å ´åˆã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åœæ­¢ã¨å†èµ·å‹•ã‚’ã™ã‚‹ã¨ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ãƒªãƒ³ã‚¯ ã‚µãƒ¼ãƒ“ã‚¹ãŒå‰Šé™¤ã•ã‚Œã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®é–“ã®æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã™ã€‚</p><p>ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã«ã¯ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å†ä½œæˆãªã‚‰ã³ã« DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å†ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚</p><p>ä¸‹è¨˜ãƒªãƒ³ã‚¯ã®ã€Œè­¦å‘Šã€ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚ã‚ã›ã¦ã”ç¢ºèªãã ã•ã„ã€‚</p><p><a href="https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#link-the-private-dns-zone-to-the-virtual-network">https://learn.microsoft.com/ja-jp/azure/aks/private-clusters?tabs=azure-portal#link-the-private-dns-zone-to-the-virtual-network</a></p></div><h3 id="ãã®ä»–ã®-ExitCode"><a href="#ãã®ä»–ã®-ExitCode" class="headerlink" title="ãã®ä»–ã® ExitCode"></a>ãã®ä»–ã® ExitCode</h3><p>ä¸Šè¨˜ã§ç´¹ä»‹ã—ãŸ 50 ï½ 53 ã® ExitCode ãŒã€AKS ã«ãŠã„ã¦ç™ºç”Ÿã™ã‚‹ã“ã¨ã®ã‚ã‚‹ä»£è¡¨çš„ãª ExitCode ã¨ãªã‚Šã¾ã™ã€‚</p><p>ã“ã®ã»ã‹ã«ã‚‚ã€ExitCode ã®å®šç¾©è‡ªä½“ã¯ã„ãã¤ã‹ã®ç¨®é¡ãŒã‚ã‚Šã€ã”ãç¨€ã«æœ¬è¨˜äº‹ã§ç´¹ä»‹ã—ãŸã‚‚ã®ã¨ã¯ç•°ãªã‚‹ ExitCode ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚</p><blockquote><p>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒšãƒ¼ã‚¸ã«è¨˜è¼‰ã®ã‚ã‚‹ ExitCode ã§ã¯ã€ExitCode 124 ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚<br>ã€€<br>ã”å‚è€ƒ) ERR_VHD_FILE_NOT_FOUND ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° - Azure / Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-vhdfilenotfound">https://learn.microsoft.com/ja-jp/troubleshoot/azure/azure-kubernetes/error-code-vhdfilenotfound</a></p></blockquote><p>ExitCode ã®ä¸€è¦§ã¯ã€AKS ãƒãƒ¼ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ç”Ÿæˆã§ä½¿ã‚ã‚Œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã«å®šç¾©ãŒã”ã–ã„ã¾ã™ã€‚<br>ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ GitHub ã®ãƒªãƒã‚¸ãƒˆãƒªã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€ã”èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯ä¸‹è¨˜ URL ã‚ˆã‚Šã”ç¢ºèªãã ã•ã„ã€‚</p><blockquote><p>ã”å‚è€ƒ) vmssCSE exit codes<br><a href="https://github.com/Azure/AgentBaker/blob/master/parts/linux/cloud-init/artifacts/cse_helpers.sh">https://github.com/Azure/AgentBaker/blob/master/parts/linux/cloud-init/artifacts/cse_helpers.sh</a></p></blockquote><p>ä¸‡ãŒä¸€ã€æœ¬è¨˜äº‹ã‚„ AKS ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒšãƒ¼ã‚¸ã«è¨˜è¼‰ã®ãªã„ ExitCode ãŒç™ºç”Ÿã—ã€ãŠå®¢æ§˜ã«ã¦ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒé›£ã—ã„å ´åˆã«ã¯ã€ãŠæ°—å…¼ã­ãªã Azure ã‚µãƒãƒ¼ãƒˆã¾ã§ã”ç›¸è«‡ãã ã•ã„ã€‚</p><h2 id="vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ãŒæˆåŠŸã—ãªã‹ã£ãŸãƒãƒ¼ãƒ‰ã®å¾©æ—§"><a href="#vmssCSE-æ‹¡å¼µæ©Ÿèƒ½ãŒæˆåŠŸã—ãªã‹ã£ãŸãƒãƒ¼ãƒ‰ã®å¾©æ—§" class="headerlink" title="vmssCSE æ‹¡å¼µæ©Ÿèƒ½ãŒæˆåŠŸã—ãªã‹ã£ãŸãƒãƒ¼ãƒ‰ã®å¾©æ—§"></a>vmssCSE æ‹¡å¼µæ©Ÿèƒ½ãŒæˆåŠŸã—ãªã‹ã£ãŸãƒãƒ¼ãƒ‰ã®å¾©æ—§</h2><p>VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’â€å†ã‚¤ãƒ¡ãƒ¼ã‚¸åŒ–â€ã™ã‚‹ã“ã¨ã§ã€ã‚ã‚‰ãŸã‚ã¦å®Ÿè¡Œå¯èƒ½ã§ã™ã€‚</p><p>ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚’å¦¨ã’ã‚‹è¦å› ã‚’å–ã‚Šé™¤ã„ãŸã‚ã¨ã¯ã€VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å†ã‚¤ãƒ¡ãƒ¼ã‚¸åŒ–ã‚’è¡Œã„ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ã”ç¢ºèªãã ã•ã„ã€‚<br>å†ã‚¤ãƒ¡ãƒ¼ã‚¸åŒ–ã®æ–¹æ³•ã¯ã€æ¬¡ã® URL ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚</p><blockquote><p>ã”å‚è€ƒ) æ—¢å­˜ã® VM ã® â€œå†ã‚¤ãƒ¡ãƒ¼ã‚¸åŒ–â€<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-upgrade-policy#exceptions-to-upgrade-policies">https://learn.microsoft.com/ja-jp/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-upgrade-policy#exceptions-to-upgrade-policies</a></p></blockquote><p>ã™ã§ã«å­˜åœ¨ã™ã‚‹ VMSS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ãã®ã¾ã¾ã®çŠ¶æ…‹ã§ã€æ–°è¦ãƒãƒ¼ãƒ‰ãŒä½œæˆå¯èƒ½ã§ã‚ã‚‹ã‹ã‚’ç¢ºèªã—ãŸã„ã¨ã„ã†å ´åˆã«ã¯ã€ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã®ã‚¹ã‚±ãƒ¼ãƒ«æ“ä½œã«ã‚ˆã£ã¦ã€ãƒãƒ¼ãƒ‰ã®è¿½åŠ ã‚’ã™ã‚‹ã“ã¨ã‚’ã”æ¤œè¨ãã ã•ã„ã€‚<br>ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã®ã‚¹ã‚±ãƒ¼ãƒ«æ–¹æ³•ã¯ã€æ¬¡ã® URL ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚</p><blockquote><p>ã”å‚è€ƒ) ãƒãƒ¼ãƒ‰ ãƒ—ãƒ¼ãƒ«ã®æ‰‹å‹•ã§ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°<br><a href="https://learn.microsoft.com/ja-jp/azure/aks/manage-node-pools#scale-a-node-pool-manually">https://learn.microsoft.com/ja-jp/azure/aks/manage-node-pools#scale-a-node-pool-manually</a></p></blockquote><h2 id="ã•ã„ã”ã«"><a href="#ã•ã„ã”ã«" class="headerlink" title="ã•ã„ã”ã«"></a>ã•ã„ã”ã«</h2><p>ä»Šå›ç´¹ä»‹ã—ã¾ã—ãŸå†…å®¹ãŒã€AKS ã‚’ã‚ˆã‚Šã”æ´»ç”¨ã„ãŸã ãã†ãˆã§ã®ã”å‚è€ƒã«ãªã‚Šã¾ã—ãŸã‚‰å¹¸ã„ã§ã™ã€‚<br>ã¾ãŸã€AKS ã®ã”åˆ©ç”¨ã«ãŠã„ã¦ã€ãŠå›°ã‚Šã®ç‚¹ã‚„ã”ä¸æ˜ç‚¹ãŒã‚ã‚Šã¾ã—ãŸéš›ã¯ã€ã„ã¤ã§ã‚‚ Azure ã‚µãƒãƒ¼ãƒˆã¾ã§ãŠæ°—å…¼ã­ãªãã”ç›¸è«‡ãã ã•ã„ã€‚</p><hr><p>æœ¬è¨˜äº‹ã®åŸ·ç­†ã«ã‚ãŸã£ã¦ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®æ²ˆã•ã‚“ã¯ã˜ã‚å¤šãã®æ–¹ã€…ã«ã”æ”¯æ´ã‚’ã„ãŸã ãã¾ã—ãŸã€‚<br>ã“ã®å ´ã‚’ãŠå€Ÿã‚Šã—ã€ã”å”åŠ›ã„ãŸã ã„ãŸçš†æ§˜ã«æ·±ãæ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®æ¡äº•ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/ja-jp/azure/aks/intro-kubernetes&quot;&gt;Azure Kubernetes Service (AKS)&lt;/a&gt; ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã€ãƒãƒ¼ãƒ‰ã®æ–°è¦ä½œæˆãŒæˆåŠŸã—ãªã„äº‹è±¡ã‚„ã€åœæ­¢ã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®èµ·å‹•ãŒæˆåŠŸã—ãªã„ã¨ã„ã£ãŸäº‹è±¡ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚&lt;/p&gt;
&lt;p&gt;ã“ã®ã‚ˆã†ãªäº‹è±¡ã¯ã€ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ãŒæˆåŠŸã—ã¦ã„ãªã„å ´åˆã«ç™ºç”Ÿã™ã‚‹ã‚‚ã®ã§ã€å¼Šç¤¾ã‚µãƒãƒ¼ãƒˆäº‹ä¾‹ã«ãŠã„ã¦ã‚‚å¤šãã®ãŠå®¢æ§˜ã‚ˆã‚Šã”ç›¸è«‡ã‚’ã„ãŸã ãã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬è¨˜äº‹ã§ã¯ã€AKS ãƒãƒ¼ãƒ‰ã®åˆæœŸåŒ–ã‚’æ‹…ã† vmssCSE æ‹¡å¼µæ©Ÿèƒ½ã«ã¤ã„ã¦ã®è§£èª¬ã¨ã€ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ãŒæˆåŠŸã—ãªã„ä»£è¡¨çš„ãªè¦å› ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Containers" scheme="https://jpaztech.github.io/blog/tags/Containers/"/>
    
    <category term="Azure Kubernetes Service (AKS)" scheme="https://jpaztech.github.io/blog/tags/Azure-Kubernetes-Service-AKS/"/>
    
  </entry>
  
  <entry>
    <title>ã‚¾ãƒ¼ãƒ³æœªæŒ‡å®šæ™‚ã® VM èµ·å‹•ã‚¾ãƒ¼ãƒ³ã€ãŠã‚ˆã³ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã®ã‚¾ãƒ¼ãƒ³ç•ªå·æŒ‡ã™ç‰©ç†ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦</title>
    <link href="https://jpaztech.github.io/blog/vm/physical-zone/"/>
    <id>https://jpaztech.github.io/blog/vm/physical-zone/</id>
    <published>2023-12-04T04:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.448Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚<br>ä»Šå¹´ã‚‚æ—¥æœ¬ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã®ç¤¾å“¡ãŒãŠå±Šã‘ã™ã‚‹ã€<a href="https://qiita.com/advent-calendar/2023/microsoft-azure-tech">Microsoft Azure Tech Advent Calendar 2023</a> ã®ã€Œã‚·ãƒªãƒ¼ã‚º 2ã€ã€12 æœˆ 4 æ—¥åˆ†ã®è¨˜äº‹ã¨ã—ã¦å…¬é–‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>Advent Calendar ã«ã¯ä»–ã«ã‚‚å¤šãã® Azure ã«é–¢ã™ã‚‹æœ‰ç›Šãªè¨˜äº‹ãŒã”ã–ã„ã¾ã™ã®ã§ã€æ˜¯éã”å‚ç…§ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p><p>æœ¬è¨˜äº‹ã§ã¯ãŠå•ã„åˆã‚ã›é ‚ãã“ã¨ã‚‚å¤šã„ã€ Azure VM ã§å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æœªæŒ‡å®šã®å ´åˆã«ã¯ã‚¾ãƒ¼ãƒ³ç•ªå·ãŒä½•å‡¦ã«ãªã‚‹ã‹ã¯åˆ†ã‹ã‚‰ãªã„ç‚¹ã¨ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã«ã‚¾ãƒ¼ãƒ³ç•ªå·ãŒæŒ‡ã—ç¤ºã™ç‰©ç†ã‚¾ãƒ¼ãƒ³ãŒé•ã†ç‚¹ã«ã¤ã„ã¦è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><hr><h2 id="å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æœªæŒ‡å®šã®å ´åˆã®ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦"><a href="#å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æœªæŒ‡å®šã®å ´åˆã®ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦" class="headerlink" title="å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æœªæŒ‡å®šã®å ´åˆã®ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦"></a>å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æœªæŒ‡å®šã®å ´åˆã®ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦</h2><p>å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«å¯¾å¿œã™ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ Azure VM ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ã”å¸Œæœ›ã®ã‚¾ãƒ¼ãƒ³ä¸Šã« VM ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚<br>ã‚¾ãƒ¼ãƒ³ã¯åŸå‰‡ 1 ï½ 3 ç•ªã®ã‚¾ãƒ¼ãƒ³ç•ªå·ã§æŒ‡å®šãŒå¯èƒ½ã§ã”ã–ã„ã¾ã™ã€‚  </p><blockquote><p>â– ã”å‚è€ƒï¼šå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/availability#availability-zones">https://learn.microsoft.com/ja-jp/azure/virtual-machines/availability#availability-zones</a></p></blockquote><p>ãªãŠã€å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æœªæŒ‡å®šã®å ´åˆã¯ã‚¾ãƒ¼ãƒ³ 1 ï½ 3 ã„ãšã‚Œã‹ã®ã‚¾ãƒ¼ãƒ³ã§ VM ãŒèµ·å‹•ã•ã‚Œã¾ã™ãŒã€ã©ã®ã‚¾ãƒ¼ãƒ³ã§ VM ãŒèµ·å‹•ã•ã‚Œã‚‹ã‹ã¯æŠŠæ¡ã™ã‚‹ã“ã¨ã¯å¶ã„ã¾ã›ã‚“ã€‚<br>VM å‰²ã‚Šå½“ã¦è§£é™¤ã‚’ã—ã¦èµ·å‹•ã™ã‚‹ã“ã¨ã§ã‚¾ãƒ¼ãƒ³ãŒå¤‰æ›´ã¨ãªã‚‹ã“ã¨ã‚‚ã”ã–ã„ã¾ã™ã€‚<br>åŠ ãˆã¦ç¾åœ¨ã©ã®ã‚¾ãƒ¼ãƒ³ã§ VM ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã¨ã„ã£ãŸã“ã¨ã‚‚ç¢ºèªã‚’ã™ã‚‹ã“ã¨ãŒå¶ã„ã¾ã›ã‚“ã€‚<br>ç‰¹å®šã‚¾ãƒ¼ãƒ³ã§ã®ç¨¼åƒãŒå¿…è¦ãªå ´åˆã¯ã€å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦ VM ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã„ãŸã ãã‚ˆã†ã«ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><hr><h2 id="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã«ã‚¾ãƒ¼ãƒ³ç•ªå·ãŒæŒ‡ã—ç¤ºã™ç‰©ç†ã‚¾ãƒ¼ãƒ³ãŒé•ã†ç‚¹ã«ã¤ã„ã¦"><a href="#ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã«ã‚¾ãƒ¼ãƒ³ç•ªå·ãŒæŒ‡ã—ç¤ºã™ç‰©ç†ã‚¾ãƒ¼ãƒ³ãŒé•ã†ç‚¹ã«ã¤ã„ã¦" class="headerlink" title="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã«ã‚¾ãƒ¼ãƒ³ç•ªå·ãŒæŒ‡ã—ç¤ºã™ç‰©ç†ã‚¾ãƒ¼ãƒ³ãŒé•ã†ç‚¹ã«ã¤ã„ã¦"></a>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã«ã‚¾ãƒ¼ãƒ³ç•ªå·ãŒæŒ‡ã—ç¤ºã™ç‰©ç†ã‚¾ãƒ¼ãƒ³ãŒé•ã†ç‚¹ã«ã¤ã„ã¦</h2><p>Azure ãƒãƒ¼ã‚¿ãƒ«ç­‰ã§è¡¨ç¤ºãƒ»æŒ‡å®šã§ãã‚‹ã‚¾ãƒ¼ãƒ³ç•ªå·ã¯ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã«æŒ‡ã—ç¤ºã™ç‰©ç†ã‚¾ãƒ¼ãƒ³ãŒç•°ãªã‚Šã¾ã™ã€‚<br>Azure ãƒãƒ¼ã‚¿ãƒ«ç­‰ã§è¡¨ç¤ºãƒ»æŒ‡å®šã§ãã‚‹ã‚¾ãƒ¼ãƒ³ç•ªå·ã®ã“ã¨ã‚’ã€Œè«–ç†ã‚¾ãƒ¼ãƒ³ã€ã€å®Ÿéš›ã®ç‰©ç†çš„ãªã‚¾ãƒ¼ãƒ³ã®å ´æ‰€ã®ã“ã¨ã‚’ã€Œç‰©ç†ã‚¾ãƒ¼ãƒ³ã€ã¨å‘¼ã³ã¾ã™ã€‚<br>ä¾‹ãˆã°æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç‰©ç†ã‚¾ãƒ¼ãƒ³ãŒ 3 ã¤ã”ã–ã„ã¾ã™ã€‚  </p><ul><li>japaneast-az1 </li><li>japaneast-az2 </li><li>japaneast-az3</li></ul><p>ã“ã®éš›ã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã€ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ã«æŒ‡ã—ç¤ºã™ã‚¾ãƒ¼ãƒ³ãŒé•ã†å ´åˆãŒã”ã–ã„ã¾ã™ã€‚  </p><p><strong>contoso ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å ´åˆ</strong></p><table><thead><tr><th align="left">è«–ç†ã‚¾ãƒ¼ãƒ³ç•ªå·</th><th align="left">å®Ÿéš›ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³</th></tr></thead><tbody><tr><td align="left">1 ç•ª</td><td align="left">japaneast-az1</td></tr><tr><td align="left">2 ç•ª</td><td align="left">japaneast-az2</td></tr><tr><td align="left">3 ç•ª</td><td align="left">japaneast-az3</td></tr></tbody></table><p><strong>hogehoge ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å ´åˆ</strong></p><table><thead><tr><th align="left">è«–ç†ã‚¾ãƒ¼ãƒ³ç•ªå·</th><th align="left">å®Ÿéš›ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³</th></tr></thead><tbody><tr><td align="left">1 ç•ª</td><td align="left">japaneast-az3</td></tr><tr><td align="left">2 ç•ª</td><td align="left">japaneast-az1</td></tr><tr><td align="left">3 ç•ª</td><td align="left">japaneast-az2</td></tr></tbody></table><p>ãã®ãŸã‚ã€ã€Œcontoso ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€ã¨ã€Œhogehoge ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€ã§ã©ã¡ã‚‰ã‚‚ Azure ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰è«–ç†ã‚¾ãƒ¼ãƒ³ 1 ç•ªã« VM ã‚’ä½œæˆã—ãŸã¨ã—ã¦ã‚‚ã€å®Ÿéš›ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¯é•ã†å ´æ‰€ã§ã‚ã‚‹ã¨ã„ã£ãŸã“ã¨ãŒç™ºç”Ÿã—ã¾ã™ã€‚<br>ã“ã‚Œã¯ç‰¹å®šã®ã‚¾ãƒ¼ãƒ³ã«éœ€è¦ãŒåã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæªç½®ã§ã”ã–ã„ã¾ã™ç‚¹ã€ã”ç†è§£ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚  </p><hr><h2 id="è«–ç†ã‚¾ãƒ¼ãƒ³ã¨ç‰©ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’-REST-API-ã§ç¢ºèªã™ã‚‹"><a href="#è«–ç†ã‚¾ãƒ¼ãƒ³ã¨ç‰©ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’-REST-API-ã§ç¢ºèªã™ã‚‹" class="headerlink" title="è«–ç†ã‚¾ãƒ¼ãƒ³ã¨ç‰©ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ REST API ã§ç¢ºèªã™ã‚‹"></a>è«–ç†ã‚¾ãƒ¼ãƒ³ã¨ç‰©ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ REST API ã§ç¢ºèªã™ã‚‹</h2><p>è«–ç†ã‚¾ãƒ¼ãƒ³ç•ªå·ã¨å®Ÿéš›ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã® REST API ã‚’ç”¨ã„ã¦ç¢ºèªã™ã‚‹äº‹ãŒå¯èƒ½ã§ã™ã€‚  </p><p>â– ã”å‚è€ƒï¼šSubscriptions - List Locations<br><a href="https://learn.microsoft.com/ja-jp/rest/api/resources/subscriptions/list-locations">https://learn.microsoft.com/ja-jp/rest/api/resources/subscriptions/list-locations</a></p><p>ä¸Šè¨˜ãƒšãƒ¼ã‚¸ã®ã€Œä½¿ã£ã¦ã¿ã‚‹ã€ã‚’é¸æŠã—ã€å¯¾è±¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå¾Œã«è¡¨ç¤ºã•ã‚ŒãŸç”»é¢ã§ã€Œå®Ÿè¡Œã€ã‚’ã™ã‚‹ã¨ã€å„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¤ã„ã¦ã€ãã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã®è«–ç†ã‚¾ãƒ¼ãƒ³ç•ªå·ã¨å®Ÿéš›ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒ<br>ç¢ºèªå‡ºæ¥ã¾ã™ã€‚<br>ä»¥ä¸‹ã¯å®Ÿè¡Œçµæœä¾‹ã®æŠœç²‹ã§ã™ã€‚ã“ã®çµæœã¯ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¯ã«é•ã†ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;: &quot;/subscriptions/XXXX/locations/japaneast&quot;,</span><br><span class="line">      &quot;name&quot;: &quot;japaneast&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;Region&quot;,</span><br><span class="line">ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ä¸­ç•¥ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;availabilityZoneMappings&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;logicalZone&quot;: &quot;1&quot;,</span><br><span class="line">          &quot;physicalZone&quot;: &quot;japaneast-az2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;logicalZone&quot;: &quot;2&quot;,</span><br><span class="line">          &quot;physicalZone&quot;: &quot;japaneast-az3&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;logicalZone&quot;: &quot;3&quot;,</span><br><span class="line">          &quot;physicalZone&quot;: &quot;japaneast-az1&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€ã“ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§è«–ç†ã‚¾ãƒ¼ãƒ³ 1 ç•ªã‚’é¸ã¶ã¨ã€ç‰©ç†ã‚¾ãƒ¼ãƒ³ japaneast-az2 ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã¨ã„ã£ãŸã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚  </p><hr><h2 id="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–“ã®è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’-REST-API-ã§ç¢ºèªã™ã‚‹"><a href="#ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–“ã®è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’-REST-API-ã§ç¢ºèªã™ã‚‹" class="headerlink" title="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–“ã®è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ REST API ã§ç¢ºèªã™ã‚‹"></a>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–“ã®è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ REST API ã§ç¢ºèªã™ã‚‹</h2><p>åˆ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã¨ã®è«–ç†ã‚¾ãƒ¼ãƒ³åŒå£«ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦ã‚‚å¾Œè¿°ã®é€šã‚Š REST API ã«ã¦ç¢ºèªãŒå¯èƒ½ã§ã™ã€‚<br>ã™ãªã‚ã¡ã€ã€Œcontoso ç¤¾ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€ã®è«–ç†ã‚¾ãƒ¼ãƒ³ 1 ç•ªã¯ã€Œhogehoge ç¤¾ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€ã®è«–ç†ã‚¾ãƒ¼ãƒ³ 2 ç•ªã¨åŒã˜ã§ã‚ã‚‹ã€ã¨ã®ç‚¹ã«ã¤ã„ã¦ç¢ºèªãŒå¯èƒ½ã§ã™ã€‚  </p><p>â– ã”å‚è€ƒï¼šSubscriptions - Check Zone Peers<br><a href="https://learn.microsoft.com/ja-jp/rest/api/resources/subscriptions/check-zone-peers">https://learn.microsoft.com/ja-jp/rest/api/resources/subscriptions/check-zone-peers</a></p><p>ä¸Šè¨˜ãƒšãƒ¼ã‚¸ã®ã€Œä½¿ã£ã¦ã¿ã‚‹ã€ã‚ˆã‚Šã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–“ã®è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><p>ã¾ãšã¯ã“ã®æ¯”è¼ƒç”¨ã® Microsoft.Resources/AvailabilityZonePeering æ©Ÿèƒ½ãŒæœ‰åŠ¹ã‹ç¢ºèªã—ã¾ã™ã€‚<br>Azure Cloud Shell ç­‰ã‚’ç”¨ã„ã¦ã€æ¯”è¼ƒå…ƒã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã¦ä»¥ä¸‹ã® Azure CLI ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az feature show --namespace Microsoft.Resources --name AvailabilityZonePeering --subscription æ¯”è¼ƒå…ƒã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID | jq .properties.state</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã®çµæœã¨ã—ã¦ â€œRegisteredâ€ ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã® Azure CLI ã‚³ãƒãƒ³ãƒ‰ã§æ©Ÿèƒ½ã‚’ç™»éŒ²ã—ã¾ã™ã€‚<br>ãªãŠã€â€Registeredâ€ ã®çŠ¶æ…‹ã«ãªã‚‹ã¾ã§ãŠæ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az feature register --namespace Microsoft.Resources --name AvailabilityZonePeering</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ãƒšãƒ¼ã‚¸ã®ã€Œä½¿ã£ã¦ã¿ã‚‹ã€ã‚’é¸æŠã—ã¦ã€æ¯”è¼ƒå…ƒã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚<br>ãã®å¾Œè¡¨ç¤ºã•ã‚ŒãŸã€ŒREST API ä½¿ã£ã¦ã¿ã‚‹ã€ã®ãƒšãƒ¼ã‚¸ã«ã¦ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã® subscriptionId ã§æ¯”è¼ƒå…ƒã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚  </p><p>ãã—ã¦ã€ã€ŒREST API ä½¿ã£ã¦ã¿ã‚‹ã€ã®ãƒšãƒ¼ã‚¸ã®æœ¬æ–‡ã®ã‚¨ãƒªã‚¢ã«ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ã«ã€æ¯”è¼ƒå¯¾è±¡ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŠã‚ˆã³æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ID ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚<br>ä»¥ä¸‹ã®é€šã‚Šè¤‡æ•°ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;location&quot;: &quot;ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åï¼ˆjapaneast ãªã©ï¼‰&quot;,</span><br><span class="line">  &quot;subscriptionIds&quot;: [</span><br><span class="line">    &quot;subscriptions/æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Aã®ID&quot;,</span><br><span class="line">    &quot;subscriptions/æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Bã®ID&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ãã®å¾Œã€å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’é¸æŠã™ã‚‹ã¨ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ãªçµæœãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;subscriptionId&quot;: &quot;æ¯”è¼ƒå…ƒã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID&quot;,</span><br><span class="line">  &quot;location&quot;: &quot;japaneast&quot;,</span><br><span class="line">  &quot;availabilityZonePeers&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;availabilityZone&quot;: &quot;1&quot;,</span><br><span class="line">      &quot;peers&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;subscriptionId&quot;: &quot;æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Aã®ID&quot;,</span><br><span class="line">          &quot;availabilityZone&quot;: &quot;3&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;subscriptionId&quot;: &quot;æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Bã®ID&quot;,</span><br><span class="line">          &quot;availabilityZone&quot;: &quot;2&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;availabilityZone&quot;: &quot;2&quot;,</span><br><span class="line">      &quot;peers&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;subscriptionId&quot;: &quot;æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Aã®ID&quot;,</span><br><span class="line">          &quot;availabilityZone&quot;: &quot;2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;subscriptionId&quot;: &quot;æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Bã®ID&quot;,</span><br><span class="line">          &quot;availabilityZone&quot;: &quot;1&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;availabilityZone&quot;: &quot;3&quot;,</span><br><span class="line">      &quot;peers&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;subscriptionId&quot;: &quot;æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Aã®ID&quot;,</span><br><span class="line">          &quot;availabilityZone&quot;: &quot;1&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;subscriptionId&quot;: &quot;æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³Bã®ID&quot;,</span><br><span class="line">          &quot;availabilityZone&quot;: &quot;3&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã®çµæœã‚ˆã‚Šã€æ¯”è¼ƒå…ƒã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®è«–ç†ã‚¾ãƒ¼ãƒ³ 1 ã¯ã€  </p><ul><li>æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ A ã§ã¯ã€è«–ç†ã‚¾ãƒ¼ãƒ³ 3</li><li>æ¯”è¼ƒå…ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ B ã§ã¯ã€è«–ç†ã‚¾ãƒ¼ãƒ³ 2</li></ul><p>ã¨åŒã˜ã€ç‰©ç†ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡ã—ã¦ã„ã‚‹ã¨ã„ã£ãŸãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèªãŒã§ãã¾ã—ãŸã€‚  </p><p>ä¸Šè¿°ã®å†…å®¹ãŒãŠå®¢æ§˜ã®ãŠå½¹ã«ç«‹ã¦ã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚&lt;br&gt;ä»Šå¹´ã‚‚æ—¥æœ¬ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã®ç¤¾å“¡ãŒãŠå±Šã‘ã™ã‚‹ã€&lt;a href=&quot;https://qiita.com/advent-calendar/2023/microsoft-azure-tech&quot;&gt;Microsoft</summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
    <category term="Windows" scheme="https://jpaztech.github.io/blog/tags/Windows/"/>
    
    <category term="Linux" scheme="https://jpaztech.github.io/blog/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>å¯ç”¨æ€§ã‚»ãƒƒãƒˆãƒ»å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ãƒ»è¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½µç”¨ã«ã¤ã„ã¦</title>
    <link href="https://jpaztech.github.io/blog/vm/availability_options_with_ppg/"/>
    <id>https://jpaztech.github.io/blog/vm/availability_options_with_ppg/</id>
    <published>2023-12-04T03:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.264Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚<br>Azure VM ã«ãŠã‘ã‚‹å¯ç”¨æ€§ã‚»ãƒƒãƒˆãƒ»å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ãƒ»è¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½µç”¨ã«ã¤ã„ã¦è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>çµè«–ã‹ã‚‰è¨˜è¼‰ã™ã‚‹ã¨ä»¥ä¸‹ã®é€šã‚Šä½µç”¨å¯èƒ½ãƒ»ä¸å¯èƒ½ã¨ã„ã£ãŸçŠ¶æ³ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚  </p><ul><li>ã€Œå¯ç”¨æ€§ã‚»ãƒƒãƒˆã€ã¨ã€Œå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã€ï¼šä½µç”¨ã§ãã¾ã›ã‚“</li><li>ã€Œå¯ç”¨æ€§ã‚»ãƒƒãƒˆã€ã¨ã€Œè¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—ã€ï¼šä½µç”¨å¯</li><li>ã€Œå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã€ã¨ã€Œè¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—ã€ï¼šä½µç”¨å¯</li></ul><p>ä»¥ä¸‹ã«è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>ã¾ãšã€ã€Œå¯ç”¨æ€§ã‚»ãƒƒãƒˆã€ã¨ã€Œå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã€ã¯ã©ã¡ã‚‰ã‚‚ VM ã®å¯ç”¨æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã”ã–ã„ã¾ã™ã€‚  </p><p>ã€Œå¯ç”¨æ€§ã‚»ãƒƒãƒˆã€ã¨ã€Œå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã€ã¯ã„ãšã‚Œã‚‚ä»®æƒ³ãƒã‚·ãƒ³ã®é…ç½®ã‚’åˆ†æ•£ã™ã‚‹ã“ã¨ã§éšœå®³ã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å½±éŸ¿ã‚’åŒæ™‚ã«å—ã‘ã‚‹ã“ã¨ã‚’å›é¿ã™ã‚‹ã¨ã„ã†åŒã˜ç›®çš„ã§åˆ©ç”¨ã•ã‚Œã¾ã™ãŸã‚ã€ä½µç”¨ã™ã‚‹ã“ã¨ã¯å¶ã„ã¾ã›ã‚“ã€‚<br>ã”åˆ©ç”¨ã®éš›ã¯ã©ã¡ã‚‰ã‹ç‰‡æ–¹ã®ã¿ã‚’ã”é¸æŠã„ãŸã ãã“ã¨ã¨ãªã‚Šã¾ã™ã€‚<br>ãªãŠã€å¯ç”¨æ€§ã‚»ãƒƒãƒˆã«ã¤ã„ã¦ã¯å˜ä¸€ã‚¾ãƒ¼ãƒ³å†…ã§åˆ†æ•£ã•ã‚Œã‚‹ä¸€æ–¹ã§ã€å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯é…ç½®ã™ã‚‹ã‚¾ãƒ¼ãƒ³è‡ªä½“ã‚’åˆ†æ•£ã™ã‚‹ãŸã‚ã‚¾ãƒ¼ãƒ³å˜ä½ã®éšœå®³ã«å¯¾ã™ã‚‹è€æ€§ãŒã”ã–ã„ã¾ã™ã€‚  </p><p>ä»–æ–¹ã€ã€Œè¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—ã€ã¯ç‰¹å®šã®è¤‡æ•°ã® VM ã‚’ç‰©ç†çš„ã«è¿‘ã„ä½ç½®ã«é…ç½®ã—ã€VM é–“ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚’å¯èƒ½ãªé™ã‚Šä½æ¸›ã™ã‚‹ã¨ã„ã£ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ãªã‚Šã¾ã™ã€‚<br>ã€Œè¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—ã€ã¯ã€Œå¯ç”¨æ€§ã‚»ãƒƒãƒˆã€ã‚‚ã—ãã¯ã€Œå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã€ã¨ã®ä½µç”¨ãŒå¯èƒ½ã§ã™ã€‚<br>å„æ©Ÿèƒ½ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”å‚ç…§ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚  </p><p>â– ã”å‚è€ƒï¼šAzure Virtual Machines ã®å¯ç”¨æ€§ã‚ªãƒ—ã‚·ãƒ§ãƒ³<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/availability">https://learn.microsoft.com/ja-jp/azure/virtual-machines/availability</a></p><p>â– ã”å‚è€ƒï¼šè¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/co-location">https://learn.microsoft.com/ja-jp/azure/virtual-machines/co-location</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚&lt;br&gt;Azure VM ã«ãŠã‘ã‚‹å¯ç”¨æ€§ã‚»ãƒƒãƒˆãƒ»å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ãƒ»è¿‘æ¥é…ç½®ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½µç”¨ã«ã¤ã„ã¦è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚&lt;br&gt;çµè«–ã‹ã‚‰è¨˜è¼‰ã™ã‚‹ã¨ä»¥ä¸‹ã®é€šã‚Šä½µç”¨å¯èƒ½ãƒ»ä¸å¯èƒ½ã¨ã„ã£ãŸçŠ¶æ³ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚  &lt;/p&gt;</summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
  </entry>
  
  <entry>
    <title>æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã® Azure Firewall ã®ã‚¾ãƒ¼ãƒ³å†—é•·ã«é–¢ã™ã‚‹ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã®è£œè¶³ (Tracking ID:7KYK-R8G)</title>
    <link href="https://jpaztech.github.io/blog/network/fw_notification_7kyk-r8g/"/>
    <id>https://jpaztech.github.io/blog/network/fw_notification_7kyk-r8g/</id>
    <published>2023-12-01T05:30:00.000Z</published>
    <updated>2023-12-26T02:55:51.180Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã§ã™ã€‚<br>2023 å¹´ 11 æœˆ 29 æ—¥ã« Azure Firewall ã§æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã®ä½¿ç”¨ã«é–¢ã™ã‚‹ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãŒã•ã‚Œã¾ã—ãŸ(Tracking ID:7KYK-R8G)ã€‚<br>ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã•ã‚ŒãŸå†…å®¹ã¯è‹±èªã§ã®ã”æ¡ˆå†…ã§ã‚ã‚‹ãŸã‚ã€ã“ã®è¨˜äº‹ã«ã¦è£œè¶³ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><span id="more"></span><h2 id="é€šçŸ¥å†…å®¹ã®æ—¥æœ¬èªæŠ„è¨³"><a href="#é€šçŸ¥å†…å®¹ã®æ—¥æœ¬èªæŠ„è¨³" class="headerlink" title="é€šçŸ¥å†…å®¹ã®æ—¥æœ¬èªæŠ„è¨³"></a>é€šçŸ¥å†…å®¹ã®æ—¥æœ¬èªæŠ„è¨³</h2><p>æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ Azure Firewall ã«é–¢ã™ã‚‹å•é¡Œã«ã¤ã„ã¦ã€è©³ç´°ã‚’ã”å ±å‘Šã„ãŸã—ã¾ã™ã€‚<br>ç¾åœ¨ã€å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦ Azure Firewall ã‚’æ§‹æˆã™ã‚‹éš›ã«ã€æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã‚’ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒå‡ºæ¥ãªã„ã¨ã„ã†å•é¡ŒãŒç™ºç”Ÿã—ã¦ãŠã‚Šã¾ã™ã€‚<br>ã“ã®å•é¡Œã¯å…¨ã¦ã® SKU (basic / standard / premium) ã«å½±éŸ¿ãŒã‚ã‚Šã€ã¾ãŸã€æ–°è¦ã® Azure Firewall ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã ã‘ã§ãªãã€æ—¢å­˜ã® Azure Firewall ã®èµ·å‹•ã«ã‚‚å½±éŸ¿ã‚’åŠã¼ã™å¯èƒ½æ€§ãŒã”ã–ã„ã¾ã™ã€‚<br>ç¾åœ¨äº‹è±¡ã®è§£æ¶ˆã«å‘ã‘ãŸä½œæ¥­ã‚’å®Ÿæ–½ã—ã¦ãŠã‚Šã€ç¾æ™‚ç‚¹ã§æœ¬åˆ¶é™ã¯ 2024 å¹´ 12 æœˆã«è§£é™¤ã•ã‚Œã‚‹äºˆå®šã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚</p><h3 id="å¯¾å¿œãŒå¿…è¦ãªäº‹é …"><a href="#å¯¾å¿œãŒå¿…è¦ãªäº‹é …" class="headerlink" title="å¯¾å¿œãŒå¿…è¦ãªäº‹é …"></a>å¯¾å¿œãŒå¿…è¦ãªäº‹é …</h3><p><strong>æœ¬è¨˜äº‹ã§ã¯é€šçŸ¥å†…å®¹ã‚’ã‚ˆã‚Šã‚ã‹ã‚Šã‚„ã™ãæ•´ç†ã—ã¦ãŠã‚Šã¾ã™ã€‚</strong></p><h4 id="1-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§æ–°è¦ã«å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒã¤-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„å ´åˆï¼š"><a href="#1-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§æ–°è¦ã«å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒã¤-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„å ´åˆï¼š" class="headerlink" title="1 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§æ–°è¦ã«å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒã¤ Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„å ´åˆï¼š"></a>1 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§æ–°è¦ã«å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒã¤ Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„å ´åˆï¼š</h4><p>1-1 ãŠå®¢æ§˜ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å†…ã§ã€æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹è«–ç†ã‚¾ãƒ¼ãƒ³ã®ç•ªå·ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚æ¬¡é …ã®<a href="#%E7%89%A9%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3-2-%E3%81%AB%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0%E3%81%95%E3%82%8C%E3%81%9F%E8%AB%96%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95">ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•</a>ã‚’ã”è¦§ãã ã•ã„ã€‚</p><p>1-2 ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹è«–ç†ã‚¾ãƒ¼ãƒ³ã®ä½¿ç”¨ã‚’é¿ã‘ã¦ãã ã•ã„ã€‚ã“ã®åœ°åŸŸã®ä»–ã®ã‚¾ãƒ¼ãƒ³ã«  Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‹ã€åˆ¥ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹ï¼šã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢æ±éƒ¨ï¼‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚</p><h4 id="2-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã›ãšã«-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š"><a href="#2-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã›ãšã«-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š" class="headerlink" title="2 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã›ãšã« Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š"></a>2 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã›ãšã« Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š</h4><p>2-1 å¿…è¦ãªå¯¾å¿œã¯ã”ã–ã„ã¾ã›ã‚“ã€‚</p><h4 id="3-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å˜ä¸€ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š"><a href="#3-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å˜ä¸€ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š" class="headerlink" title="3 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å˜ä¸€ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦ Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š"></a>3 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å˜ä¸€ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦ Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š</h4><p>3-1 ãŠå®¢æ§˜ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å†…ã§ã€æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹è«–ç†ã‚¾ãƒ¼ãƒ³ã®ç•ªå·ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚æ¬¡é …ã®<a href="#%E7%89%A9%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3-2-%E3%81%AB%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0%E3%81%95%E3%82%8C%E3%81%9F%E8%AB%96%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95">ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•</a>ã‚’ã”è¦§ãã ã•ã„ã€‚</p><p>3-2 ãŠå®¢æ§˜ã® Azure Firewall ãŒç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‚¾ãƒ¼ãƒ³ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹å ´åˆã€<a href="https://learn.microsoft.com/ja-jp/azure/firewall/firewall-faq#-----------------------------:~:text=%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E5%BE%8C%E3%81%AB%E5%8F%AF%E7%94%A8%E6%80%A7%E3%82%BE%E3%83%BC%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B%3F">stop / startã‚’ä½¿ç”¨ã—ã¦å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã®è¨­å®šã‚’æ›´æ–°</a>ã—ã€ä»–ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚</p><h4 id="4-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§è¤‡æ•°ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«ã‚ãŸã£ã¦-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š"><a href="#4-æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§è¤‡æ•°ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«ã‚ãŸã£ã¦-Azure-Firewall-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š" class="headerlink" title="4 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§è¤‡æ•°ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«ã‚ãŸã£ã¦ Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š"></a>4 æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§è¤‡æ•°ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«ã‚ãŸã£ã¦ Azure Firewall ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆï¼š</h4><p>4-1 ãŠå®¢æ§˜ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å†…ã§ã€æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹è«–ç†ã‚¾ãƒ¼ãƒ³ã®ç•ªå·ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚æ¬¡é …ã®<a href="#%E7%89%A9%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3-2-%E3%81%AB%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0%E3%81%95%E3%82%8C%E3%81%9F%E8%AB%96%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95">ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•</a>ã‚’ã”è¦§ãã ã•ã„ã€‚</p><p>4-2 ãŠå®¢æ§˜ã® Azure Firewall ãŒç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‚¾ãƒ¼ãƒ³ã‚’å«ã‚“ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹å ´åˆã§ã‚‚ãã®ã¾ã¾ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ãŒã€ä½•ã‚‰ã‹ã®ç†ç”±ã§ã“ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’<a href="https://learn.microsoft.com/ja-jp/azure/firewall/firewall-faq#azure-firewall-----------------:~:text=Azure%20Firewall%20%E3%81%AE%E5%81%9C%E6%AD%A2%E3%81%A8%E8%B5%B7%E5%8B%95%E3%81%AE%E6%96%B9%E6%B3%95%E3%82%92%E6%95%99%E3%81%88%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84">åœæ­¢</a>ã—ãŸå ´åˆã€ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã‚’é™¤ã„ãŸ<a href="https://learn.microsoft.com/ja-jp/azure/firewall/firewall-faq#-----------------------------:~:text=%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E5%BE%8C%E3%81%AB%E5%8F%AF%E7%94%A8%E6%80%A7%E3%82%BE%E3%83%BC%E3%83%B3%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B%3F">ç•°ãªã‚‹ Availability Zones ã®è¨­å®šã§å†èµ·å‹•</a>ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ä»¥ä¸Šã®æ¡ä»¶ã¨å¿…è¦ãªå¯¾å¿œã‚’ã¾ã¨ã‚ãŸãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚<br><img src="./flow_chart.png"></p><h3 id="ç‰©ç†ã‚¾ãƒ¼ãƒ³-2-ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•"><a href="#ç‰©ç†ã‚¾ãƒ¼ãƒ³-2-ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•" class="headerlink" title="ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•"></a>ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•</h3><p>ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¯ã€Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚„åœ°åŸŸã”ã¨ã«ç•°ãªã‚‹è«–ç†ã‚¾ãƒ¼ãƒ³ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã¾ã™ã€‚ãŠå®¢æ§˜ã®Azureã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã“ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸè«–ç†ã‚¾ãƒ¼ãƒ³ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€<a href="https://learn.microsoft.com/en-us/azure/reliability/availability-zones-overview?tabs=azure-cli#physical-and-logical-availability-zones">æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ‰‹é †</a>ã‚’ã”å®Ÿæ–½ãã ã•ã„ã€‚ï¼ˆç¾åœ¨ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯è‹±èªã®ã¿ã¨ãªã‚Šã¾ã™ã€‚æœ¬ãƒ–ãƒ­ã‚°è¨˜äº‹ã®<a href="#%E7%89%A9%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3%E3%81%A8%E8%AB%96%E7%90%86%E3%82%BE%E3%83%BC%E3%83%B3%E3%81%AE%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95">ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèªæ–¹æ³•</a>ã«ã‚‚æ‰‹é †ã‚’è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã™ã€‚ï¼‰</p><p>æœ¬å•é¡Œã«é–¢ã—ã¦ã€æƒ…å ±ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒè¡Œã‚ã‚ŒãŸéš›ã«ã¯ã€é€Ÿã‚„ã‹ã«æœ€æ–°ã®æƒ…å ±ã‚’ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚<br>ã“ã®åº¦ã¯ã€ãŠå®¢æ§˜ã«ã”ä¸ä¾¿ã‚’ãŠã‹ã‘ã—ã€å¤§å¤‰ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚</p><h2 id="ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèªæ–¹æ³•"><a href="#ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèªæ–¹æ³•" class="headerlink" title="ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèªæ–¹æ³•"></a>ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèªæ–¹æ³•</h2><p>ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªãŒå¯èƒ½ã§ã™ã€‚</p><p>Azure CLI ã®å ´åˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az rest --method get --uri <span class="string">&#x27;/subscriptions/&#123;ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ID&#125;/locations?api-version=2022-12-01&#x27;</span> --query <span class="string">&#x27;value&#x27;</span></span><br></pre></td></tr></table></figure><p>Azure PowerShell ã®å ´åˆ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$subscriptionId</span> = (<span class="built_in">Get-AzContext</span>).Subscription.ID</span><br><span class="line"><span class="variable">$response</span> = <span class="built_in">Invoke-AzRestMethod</span> <span class="literal">-Method</span> GET <span class="literal">-Path</span> <span class="string">&quot;/subscriptions/<span class="variable">$subscriptionId</span>/locations?api-version=2022-12-01&quot;</span></span><br><span class="line"><span class="variable">$locations</span> = (<span class="variable">$response</span>.Content | <span class="built_in">ConvertFrom-Json</span>).value | <span class="built_in">where</span> &#123; <span class="variable">$_</span>.Name <span class="operator">-eq</span> <span class="string">&quot;japaneast&quot;</span> &#125;; <span class="variable">$locations</span></span><br></pre></td></tr></table></figure><p>ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨è«–ç†ã‚¾ãƒ¼ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ±ãŒå–å¾—ã§ãã¾ã™ã€‚ã“ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã”ã¨ã«ç•°ãªã‚Šã¾ã™ã€‚<br>ä»¥ä¸‹ã¯å„ã‚³ãƒãƒ³ãƒ‰ã”ã¨ã®å–å¾—ã—ãŸãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ±ã®æŠœç²‹ã¨ãªã‚Šã¾ã™ã€‚</p><p>Azure CLI ã®å ´åˆ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;availabilityZoneMappings&quot;</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;logicalZone&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;physicalZone&quot;</span>: <span class="string">&quot;japaneast-az2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;logicalZone&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;physicalZone&quot;</span>: <span class="string">&quot;japaneast-az3&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;logicalZone&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;physicalZone&quot;</span>: <span class="string">&quot;japaneast-az1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>Azure PowerShell ã®å ´åˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">id                       : /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/locations/japaneast</span><br><span class="line">name                     : japaneast</span><br><span class="line">type                     : Region</span><br><span class="line">displayName              : Japan East</span><br><span class="line">regionalDisplayName      : (Asia Pacific) Japan East</span><br><span class="line">metadata                 : @&#123;regionType=Physical; regionCategory=Recommended; geography=Japan; geographyGroup=Asia Paci</span><br><span class="line">                           fic; longitude=139.77; latitude=35.68; physicalLocation=Tokyo, Saitama; pairedRegion=System.</span><br><span class="line">                           Object[]&#125;</span><br><span class="line">availabilityZoneMappings : &#123;@&#123;logicalZone=1; physicalZone=japaneast-az2&#125;, @&#123;logicalZone=2; physicalZone=japaneast-az3&#125;,</span><br><span class="line">                            @&#123;logicalZone=3; physicalZone=japaneast-az1&#125;&#125;</span><br></pre></td></tr></table></figure><p>logicalZone ãŒè«–ç†ã‚¾ãƒ¼ãƒ³ã¨ãªã‚Šã€é€šå¸¸ã€ãƒãƒ¼ã‚¿ãƒ«ã‚„ã‚³ãƒãƒ³ãƒ‰ã§è¦‹ãˆã¦ã„ã‚‹ã‚¾ãƒ¼ãƒ³ã®ç•ªå·ã¨ãªã‚Šã¾ã™ã€‚<br>physicalZone ãŒç‰©ç†ã‚¾ãƒ¼ãƒ³ã¨ãªã‚Šã¾ã™ã€‚<br>ä»Šå›ã¯ japaneast-az2 ã¨ç´ã¥ã„ã¦ã„ã‚‹ logicalZone ã®ç•ªå·ã‚’ Azure Firewall ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«æŒ‡å®šã—ãªã„ã‚ˆã†ã«å¯¾å¿œãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚</p><h2 id="Azure-Firewall-ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•"><a href="#Azure-Firewall-ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•" class="headerlink" title="Azure Firewall ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•"></a>Azure Firewall ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªæ–¹æ³•</h2><p>Azure Firewall ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã¯ Azure ãƒãƒ¼ã‚¿ãƒ« &gt; Azure Firewall ãƒªã‚½ãƒ¼ã‚¹ &gt; ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ ãƒ–ãƒ¬ãƒ¼ãƒ‰ &gt; å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã®é …ç›®ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚<br><br>ä»¥ä¸‹ã®ç”»åƒã¯å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã®æŒ‡å®šãŒãªã„ Azure Firewall ã®ç”»é¢ã§ã™ã€‚<br><img src="./azfw_az.png"></p><h2 id="Azure-Firewall-ã®åœæ­¢ãŠã‚ˆã³å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã™ã‚‹é–‹å§‹æ–¹æ³•"><a href="#Azure-Firewall-ã®åœæ­¢ãŠã‚ˆã³å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã™ã‚‹é–‹å§‹æ–¹æ³•" class="headerlink" title="Azure Firewall ã®åœæ­¢ãŠã‚ˆã³å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã™ã‚‹é–‹å§‹æ–¹æ³•"></a>Azure Firewall ã®åœæ­¢ãŠã‚ˆã³å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã™ã‚‹é–‹å§‹æ–¹æ³•</h2><p>Azure Firewall ã® Azure PowerShell ã§ã®åœæ­¢æ–¹æ³•ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$azfw</span> = <span class="built_in">Get-AzFirewall</span> <span class="literal">-Name</span> <span class="string">&quot;ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«å&quot;</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span></span><br><span class="line"><span class="variable">$azfw</span>.Deallocate()</span><br><span class="line"><span class="built_in">Set-AzFirewall</span> <span class="literal">-AzureFirewall</span> <span class="variable">$azfw</span></span><br></pre></td></tr></table></figure><div class="alert is-warning"><p class="alert-title">è­¦å‘Š</p><p>å˜ä¸€ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦ Azure Firewall ã¨åŒæ™‚ã«ä½œæˆã•ã‚ŒãŸ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã¯ä»–ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã§ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚æ–°ãŸã« Standard ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«å¯¾å¿œã™ã‚‹å½¢ã§ä½œæˆã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p></div><p>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä½œæˆã«ã¤ã„ã¦ã®è©³ç´°ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚è€ƒãã ã•ã„ã€‚</p><p><a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/virtual-network-public-ip-address">Azure ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½œæˆã€å¤‰æ›´ã€ã¾ãŸã¯å‰Šé™¤ã™ã‚‹ - Azure Virtual Network | Microsoft Learn</a></p><p> Azure PowerShell ã§å…¨ã¦ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã«å¯¾å¿œã—ãŸ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½œæˆã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§è¡Œãˆã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ip</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    Name = <span class="string">&#x27;æ–°ã—ã„ Public IP å&#x27;</span></span><br><span class="line">    ResourceGroupName = <span class="string">&#x27;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&#x27;</span></span><br><span class="line">    Location = <span class="string">&#x27;japaneast&#x27;</span></span><br><span class="line">    Sku = <span class="string">&#x27;Standard&#x27;</span></span><br><span class="line">    AllocationMethod = <span class="string">&#x27;Static&#x27;</span></span><br><span class="line">    IpAddressVersion = <span class="string">&#x27;IPv4&#x27;</span></span><br><span class="line">    Zone = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">New-AzPublicIpAddress</span> @ip</span><br></pre></td></tr></table></figure><p>ä¾‹ã¨ã—ã¦ã€è«–ç†ã‚¾ãƒ¼ãƒ³ 1 ãŒç‰©ç†ã‚¾ãƒ¼ãƒ³ 2 ã®å ´åˆã«ãŠã„ã¦ã€è«–ç†ã‚¾ãƒ¼ãƒ³ 2, 3ï¼ˆç‰©ç†ã‚¾ãƒ¼ãƒ³ 1, 3ï¼‰ã‚’æŒ‡å®šã—ã¦ Azure Firewall ã‚’ Azure PowerShell ã§é–‹å§‹ã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$azfw</span> = <span class="built_in">Get-AzFirewall</span> <span class="literal">-Name</span> <span class="string">&quot;ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«å&quot;</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span></span><br><span class="line"><span class="variable">$vnet</span> = <span class="built_in">Get-AzVirtualNetwork</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;VNet å&quot;</span></span><br><span class="line"><span class="variable">$pip</span>= <span class="built_in">Get-AzPublicIpAddress</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;Public IP å&quot;</span></span><br><span class="line"><span class="variable">$azfw</span>.Allocate(<span class="variable">$vnet</span>, <span class="variable">$pip</span>)</span><br><span class="line"><span class="variable">$azFw</span>.Zones=<span class="number">2</span>,<span class="number">3</span></span><br><span class="line"><span class="variable">$azfw</span> | <span class="built_in">Set-AzFirewall</span></span><br></pre></td></tr></table></figure><p>ä¾‹ã¨ã—ã¦ã€2 ã¤ã® Public IP ãŒé–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ãŠã‚Šã€ãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ ã‚µãƒ–ãƒãƒƒãƒˆã® Public IP ãŒã‚ã‚‹ Azure Firewall ã‚’è«–ç†ã‚¾ãƒ¼ãƒ³ 2, 3ï¼ˆç‰©ç†ã‚¾ãƒ¼ãƒ³ 1, 3ï¼‰ã‚’æŒ‡å®šã—ã¦ Azure PowerShell ã§é–‹å§‹ã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$azfw</span> = <span class="built_in">Get-AzFirewall</span> <span class="literal">-Name</span> <span class="string">&quot;ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«å&quot;</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span></span><br><span class="line"><span class="variable">$vnet</span> = <span class="built_in">Get-AzVirtualNetwork</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;VNet å&quot;</span></span><br><span class="line"><span class="variable">$pip1</span>= <span class="built_in">Get-AzPublicIpAddress</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;Public IP å&quot;</span></span><br><span class="line"><span class="variable">$pip2</span>= <span class="built_in">Get-AzPublicIpAddress</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;Public IP2 å&quot;</span></span><br><span class="line"><span class="variable">$mgmtPip</span> = <span class="built_in">Get-AzPublicIpAddress</span> <span class="literal">-ResourceGroupName</span> <span class="string">&quot;ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;ãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ ã‚µãƒ–ãƒãƒƒãƒˆã® Public IP å&quot;</span></span><br><span class="line"><span class="variable">$azfw</span>.Allocate(<span class="variable">$vnet</span>, <span class="selector-tag">@</span>(<span class="variable">$pip1</span>,<span class="variable">$pip2</span>), <span class="variable">$mgmtPip</span>)</span><br><span class="line"><span class="variable">$azFw</span>.Zones=<span class="number">2</span>,<span class="number">3</span></span><br><span class="line"><span class="variable">$azfw</span> | <span class="built_in">Set-AzFirewall</span></span><br></pre></td></tr></table></figure><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Azure-Firewall-ã‚’ç‰©ç†ã‚¾ãƒ¼ãƒ³-2-ã®ã¿ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆã®å½±éŸ¿ã¯ä½•ã§ã™ã‹"><a href="#Azure-Firewall-ã‚’ç‰©ç†ã‚¾ãƒ¼ãƒ³-2-ã®ã¿ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆã®å½±éŸ¿ã¯ä½•ã§ã™ã‹" class="headerlink" title="Azure Firewall ã‚’ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã®ã¿ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆã®å½±éŸ¿ã¯ä½•ã§ã™ã‹"></a>Azure Firewall ã‚’ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã®ã¿ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹å ´åˆã®å½±éŸ¿ã¯ä½•ã§ã™ã‹</h3><p>Azure Firewall ãŒå‡¦ç†ã™ã‚‹ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯é‡ãŒå¢—åŠ ã—ãŸéš›ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p><h3 id="SLA-ã«å½±éŸ¿ã‚ã‚Šã¾ã™ã‹"><a href="#SLA-ã«å½±éŸ¿ã‚ã‚Šã¾ã™ã‹" class="headerlink" title="SLA ã«å½±éŸ¿ã‚ã‚Šã¾ã™ã‹"></a>SLA ã«å½±éŸ¿ã‚ã‚Šã¾ã™ã‹</h3><p>ä»Šå›ã®é€šçŸ¥å†…å®¹ã®äº‹è±¡ãŒ SLA ã«å½±éŸ¿ã™ã‚‹ã“ã¨ã¯ã”ã–ã„ã¾ã›ã‚“ã€‚<br>SLA ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã€Œå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã€ã®é …ç›®ã«è¨˜è¼‰ãŒã”ã–ã„ã¾ã™ã€‚</p><p><a href="https://learn.microsoft.com/ja-jp/azure/firewall/features#availability-zones">Azure Firewall Standard ã®æ©Ÿèƒ½</a></p><h3 id="è²»ç”¨ã®å·®ç•°ã¯ã‚ã‚Šã¾ã™ã‹"><a href="#è²»ç”¨ã®å·®ç•°ã¯ã‚ã‚Šã¾ã™ã‹" class="headerlink" title="è²»ç”¨ã®å·®ç•°ã¯ã‚ã‚Šã¾ã™ã‹"></a>è²»ç”¨ã®å·®ç•°ã¯ã‚ã‚Šã¾ã™ã‹</h3><p>ä»Šå›ã®äº‹è±¡ã®ç™ºç”ŸæœŸé–“ã¨ç™ºç”Ÿã—ã¦ã„ãªã„æœŸé–“ã§ã¯ã€Azure Firewall ã®è²»ç”¨ã«å¯¾ã—ã¦ã®é•ã„ã¯ã”ã–ã„ã¾ã›ã‚“ã€‚</p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã§ã™ã€‚&lt;br&gt;2023 å¹´ 11 æœˆ 29 æ—¥ã« Azure Firewall ã§æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç‰©ç†ã‚¾ãƒ¼ãƒ³ #2 ã®ä½¿ç”¨ã«é–¢ã™ã‚‹ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãŒã•ã‚Œã¾ã—ãŸ(Tracking ID:7KYK-R8G)ã€‚&lt;br&gt;ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã•ã‚ŒãŸå†…å®¹ã¯è‹±èªã§ã®ã”æ¡ˆå†…ã§ã‚ã‚‹ãŸã‚ã€ã“ã®è¨˜äº‹ã«ã¦è£œè¶³ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Network" scheme="https://jpaztech.github.io/blog/tags/Network/"/>
    
    <category term="Azure Firewall" scheme="https://jpaztech.github.io/blog/tags/Azure-Firewall/"/>
    
  </entry>
  
  <entry>
    <title>ãŠå•ã„åˆã‚ã›ã®ç™ºè¡Œæ–¹æ³•ã«ã¤ã„ã¦</title>
    <link href="https://jpaztech.github.io/blog/information/How-to-inquiry-to-the-Azure-Support/"/>
    <id>https://jpaztech.github.io/blog/information/How-to-inquiry-to-the-Azure-Support/</id>
    <published>2023-11-27T05:52:00.000Z</published>
    <updated>2023-12-26T02:55:51.156Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã§ã™ã€‚</p><p>ç§ãŸã¡ã¯ã€Azure ã‚’ã”åˆ©ç”¨ã„ãŸã ã„ã¦ã„ã‚‹ãŠå®¢æ§˜ã«ã€Azure ã‚’æ­£å¸¸ã‹ã¤å¿«é©ã«ã”åˆ©ç”¨ã„ãŸã ããŸã‚ã®ã”æ”¯æ´ã‚’å·®ã—ä¸Šã’ã¦ã„ã¾ã™ã€‚<br>ã“ã®åº¦ã€Azure ã‚µãƒãƒ¼ãƒˆã‚’åŠ¹æœçš„ã«åˆ©ç”¨ã™ã‚‹ã‚„ã‚Šæ–¹ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã€ã¨ã„ã†ã”è¦æœ›ã‚’é ‚æˆ´ã—ã¾ã—ãŸã®ã§ã€ä»¥ä¸‹ã«ã‚µãƒãƒ¼ãƒˆã¸ã®ãŠå•ã„åˆã‚ã›æ–¹æ³•ã‚’ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><span id="more"></span><p>æœ¬è³‡æ–™ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãŠå®¢æ§˜ã«ãŠèª­ã¿ã„ãŸã ãã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚  </p><ul><li>ãŠå•ã„åˆã‚ã›ã‚’èµ·ç¥¨ã™ã‚‹ãŸã‚ã®å¥‘ç´„ã‚„ã€ãŠå•ã„åˆã‚ã›ç™ºè¡Œã‹ã‚‰é€£çµ¡ã‚’ã‚‚ã‚‰ãˆã‚‹ã¾ã§ã®å¿œç­”æ™‚é–“ãªã©ã®ãƒ«ãƒ¼ãƒ«ã¨æµã‚Œã‚’çŸ¥ã‚ŠãŸã„</li><li>ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã®ã‚µãƒãƒ¼ãƒˆã‹ã‚‰ã©ã®ã‚ˆã†ãªå†…å®¹ã‚’å¯¾å¿œã—ã¦ã‚‚ã‚‰ãˆã‚‹ã®ã‹çŸ¥ã£ã¦ãŠããŸã„</li><li>Azure ã‚µãƒãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã©ã®ã‚ˆã†ã«èµ·ç¥¨ã™ã‚Œã°åŠ¹ç‡çš„ã«æˆæœãŒå¾—ã‚‰ã‚Œã‚‹ã‹çŸ¥ã‚ŠãŸã„</li></ul><p>ãªãŠã€ä»¥ä¸‹ã«è¨˜è¼‰ã—ã¾ã—ãŸå†…å®¹ã¯ã‚ãã¾ã§ ã€Œä¸€èˆ¬çš„ãªãŠå•åˆã›ã®æµã‚Œã€ ã‚’ã”ç´¹ä»‹ã—ã¦ã„ã¾ã™ã®ã§ã€ã‚‚ã—ã“ã¡ã‚‰ã«è¨˜è¼‰ãŒãªããŠæ‚©ã¿ã®ç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ä¸€æ—¦ãŠå•åˆã›ã‚’èµ·ç¥¨ã„ãŸã ãã‹ã€æ—¢ã«å¯¾å¿œã•ã›ã¦ã„ãŸã ã„ã¦ã„ã‚‹ä»¶ãŒã‚ã‚Œã°ãã¡ã‚‰ã®æ‹…å½“ã‚µãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¾ã§ã€ãŠæ°—å…¼ã­ãªãã”ç›¸è«‡ã‚’ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚</p><hr><h2 id="ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆ-ãŠå•ã„åˆã‚ã›-ã®ä½œæˆ"><a href="#ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆ-ãŠå•ã„åˆã‚ã›-ã®ä½œæˆ" class="headerlink" title="ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ãŠå•ã„åˆã‚ã›) ã®ä½œæˆ"></a>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ãŠå•ã„åˆã‚ã›) ã®ä½œæˆ</h2><p>ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆæ–¹æ³•ã¯å¤§ããåˆ†ã‘ã¦ä»¥ä¸‹ã® 2 ã¤ã®æ–¹æ³•ã«ã¦ä½œæˆå¯èƒ½ã§ã™ã€‚  </p><ol><li>å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰</li><li>ãƒ˜ãƒ«ãƒ—ã¨ã‚µãƒãƒ¼ãƒˆã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹</li></ol><p>ãã‚Œãã‚Œã®æ–¹æ³•ã«ã¤ã„ã¦ã”èª¬æ˜ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><h3 id="å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰"><a href="#å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰" class="headerlink" title="å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰"></a>å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰</h3><p>å•ã„åˆã‚ã›å¯¾è±¡ã®ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚ˆã‚Šã€ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹æ‰‹é †ã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã¡ã‚‰ã®æ‰‹é †ã§ã¯ã€è‡ªå‹•çš„ã«å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®é¸æŠãŒã•ã‚ŒãŸçŠ¶æ…‹ã§ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒç™ºè¡Œã•ã‚Œã¾ã™ã®ã§ã€ã“ã®æ‰‹é †ã‚’æ¨å¥¨ã•ã›ã¦é ‚ã„ã¦ãŠã‚Šã¾ã™ã€‚<br>Azure VM ã®ç”»é¢ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ç”¨ã„ã¦ã€æ‰‹é †ã‚’ã”èª¬æ˜ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><p>ã¾ãšã€Azure ãƒãƒ¼ã‚¿ãƒ«ã«ã¦å•ã„åˆã‚ã›å¯¾è±¡ã®ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚’é–‹ã„ã¦é ‚ãã€å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Š [ã‚µãƒãƒ¼ãƒˆã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°] ã‚’é¸æŠé ‚ã„ãŸä¸Šã§ã€ç™ºç”Ÿã—ã¦ã„ã‚‹å•é¡Œã«è¿‘ã—ã„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’é¸æŠã—ã¾ã™ã€‚  </p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/2023-11-27-13-39-19.png"></p><p>è‡ªå‹•ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€è¡¨ç¤ºã•ã‚ŒãŸå†…å®¹ã«æ²¿ã£ã¦ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚<br>ã“ã¡ã‚‰ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã¦å•é¡Œã®æ”¹å–„ç­‰ãŒã•ã‚Œãªã„å ´åˆã¯ã€ä¸‹éƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ [ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡ã™ã‚‹] ã‚’é¸æŠã™ã‚‹ã“ã¨ã§ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ã«é€²ã¿ã¾ã™ã€‚  </p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/2023-11-27-13-39-44.png"></p><h3 id="ãƒ˜ãƒ«ãƒ—ã¨ã‚µãƒãƒ¼ãƒˆã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹"><a href="#ãƒ˜ãƒ«ãƒ—ã¨ã‚µãƒãƒ¼ãƒˆã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹" class="headerlink" title="ãƒ˜ãƒ«ãƒ—ã¨ã‚µãƒãƒ¼ãƒˆã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹"></a>ãƒ˜ãƒ«ãƒ—ã¨ã‚µãƒãƒ¼ãƒˆã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹</h3><p><a href="https://portal.azure.com/">Azure Portal</a> ã®ç”»é¢å³ä¸Šã€ã‚¯ã‚¨ã‚¹ãƒãƒ§ãƒ³ ãƒãƒ¼ã‚¯ã‹ã‚‰ [ãƒ˜ãƒ«ãƒ—ã¨ã‚µãƒãƒ¼ãƒˆ] ã«é·ç§»ã—ã€ç¶šã„ã¦ [ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ] ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€Azure ã®ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã§ãã¾ã™ã€‚</p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/help_and_support.png"></p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/help_and_support2.png"></p><blockquote><p>ã”å‚è€ƒ) Azure ã‚µãƒãƒ¼ãƒˆè¦æ±‚ã‚’ä½œæˆã™ã‚‹<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-portal/supportability/how-to-create-azure-support-request">https://docs.microsoft.com/ja-jp/azure/azure-portal/supportability/how-to-create-azure-support-request</a></p></blockquote><hr><h3 id="ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-1-å•é¡Œã®èª¬æ˜-ãƒšãƒ¼ã‚¸"><a href="#ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-1-å•é¡Œã®èª¬æ˜-ãƒšãƒ¼ã‚¸" class="headerlink" title="ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 1. å•é¡Œã®èª¬æ˜ ãƒšãƒ¼ã‚¸"></a>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 1. å•é¡Œã®èª¬æ˜ ãƒšãƒ¼ã‚¸</h3><p>ã¾ãšå•é¡Œã®ç¨®é¡ã‚’é¸æŠã—ã¾ã™ã€‚<br>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ç®¡ç†ã€ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®åˆ¶é™ (ã‚¯ã‚©ãƒ¼ã‚¿)ã€èª²é‡‘ã€ã«é–¢ã—ã¦ã¯ç„¡å„Ÿã§ãŠå•ã„åˆã‚ã›ã„ãŸã ã‘ã¾ã™ã€‚</p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/sr_creation.png"></p><p>æŠ€è¡“çš„ãªãŠå•ã„åˆã‚ã›ã«ã¤ã„ã¦ã¯ã€æœ‰å„Ÿã‚µãƒãƒ¼ãƒˆå¥‘ç´„ãŒå¿…è¦ã§ã‚ã‚Šã€â€æŠ€è¡“ (å„ç¨® Azure ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦)â€ ã‚’é¸æŠã—ã¾ã™ã€‚<br>ãªãŠã€å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚ˆã‚Šã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆé ‚ã„ãŸå ´åˆã€å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ç­‰ãŒè‡ªå‹•çš„ã«é¸æŠã•ã‚ŒãŸçŠ¶æ…‹ã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã“ã§ã¯ã€æŠ€è¡“çš„ãªãŠå•ã„åˆã‚ã›ã‚’ã•ã‚Œã‚‹éš›ã®ãƒ•ãƒ­ãƒ¼ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</p><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p><strong>èª²é‡‘ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ã‚¯ã‚©ãƒ¼ã‚¿ã®ã‚µãƒãƒ¼ãƒˆã«ã¤ã„ã¦ã®å‚è€ƒè³‡æ–™ã¯ã“ã¡ã‚‰ã§ã™</strong></p><p>Japan Azure èª²é‡‘ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ã‚µãƒãƒ¼ãƒˆ ãƒ–ãƒ­ã‚° - ã‚µãƒãƒ¼ãƒˆã«ãŠå•ã„åˆã‚ã›ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦</p><p><a href="https://jpazasms.github.io/blog/AzureSubscriptionManagement/20131030a/">https://jpazasms.github.io/blog/AzureSubscriptionManagement/20131030a/</a></p></div><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/sr_creation2.png"></p><h4 id="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³"><a href="#ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³" class="headerlink" title="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³"></a>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</h4><p>å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’å«ã‚€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ­£ã—ãé¸ã¶ã“ã¨ã¯éå¸¸ã«é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚</p><ul><li>ã“ã®ç”»é¢ã«ã¦ã€è‡ªå‹•çš„ã«ã€ä»Šå›ã®ç”»é¢ã‚’é–‹ã„ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ (Azure Portal ã®å³ä¸Šã«è¡¨ç¤º) ãŒãŠå•ã„åˆã‚ã›å¯èƒ½ãªã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒæ¤œç´¢ã•ã‚Œã€é¸æŠå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ã€ã”åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã®ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚’ã—ã¦ãŠã‚Šã€ã‚µãƒãƒ¼ãƒˆã‹ã‚‰ã®æƒ…å ±ã®æç¤ºã‚’è¡Œã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>ãŠå•ã„åˆã‚ã›ã•ã‚Œã‚‹éš›ã«ã¯ã€æœ¬ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã€å¯¾è±¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®æ‰€æœ‰è€…ãƒ»å…±åŒä½œæˆè€…ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…±åŒä½œæˆè€…ã®ã„ãšã‚Œã‹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒ­ãƒ¼ãƒ«ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦ãŠå®¢æ§˜ã®ç’°å¢ƒã«ã¤ã„ã¦æƒ…å ±ã‚’æ¼æ´©ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚</li><li>æœ‰å„Ÿã‚µãƒãƒ¼ãƒˆå¥‘ç´„ã¨ã®ç´ä»˜ãã¯ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å˜ä½ã§è¡Œã£ã¦ã„ã¾ã™ã€‚<br>ã“ã®ãŸã‚ã€é©åˆ‡ãªã‚µãƒãƒ¼ãƒˆ ãƒ¬ãƒ™ãƒ«ã«ã¦ã‚µãƒ¼ãƒ“ã‚¹æä¾›ãŒå—ã‘ã‚‰ã‚Œã¾ã™ã€‚</li></ul><div class="alert is-important"><p class="alert-title">é‡è¦</p><p><strong>ç•°ãªã‚‹ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¸Šã®ãƒªã‚½ãƒ¼ã‚¹ã®èª¿æŸ»ã«ã¤ã„ã¦</strong></p><p>ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç™ºè¡Œã•ã‚Œã‚‹éš›ã€èª¿æŸ»å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰ãŠå•ã„åˆã‚ã›ãã ã•ã„ã¾ã™ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p><p>ç•°ãªã‚‹ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¸Šã®ãƒªã‚½ãƒ¼ã‚¹ã®èª¿æŸ»ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚è©³ã—ãã¯ä»¥ä¸‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚</p><p>ã€€</p><p>ã”å‚è€ƒ) ãŠå•ã„åˆã‚ã›ç™ºè¡Œæ™‚ã¨ã€Œç•°ãªã‚‹ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®èª¿æŸ»ä¾é ¼ã«å¯¾ã—ã¦ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒã‚§ãƒƒã‚¯ãŒå¼·åŒ–ã•ã‚Œã¾ã™</p><p><a href="https://jpaztech.github.io/blog/information/Different-subscriptions-research/">https://jpaztech.github.io/blog/information/Different-subscriptions-research/</a></p><p>ã”å‚è€ƒ) é›»è©±çµŒç”±ã«ãŠã‘ã‚‹ Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®èª¿æŸ»ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒã‚§ãƒƒã‚¯ãŒå³æ ¼åŒ–ã•ã‚Œã¾ã™</p><p><a href="https://jpaztech.github.io/blog/information/Security-check-stricter/">https://jpaztech.github.io/blog/information/Security-check-stricter/</a></p></div><h4 id="ã‚µãƒ¼ãƒ“ã‚¹-ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡"><a href="#ã‚µãƒ¼ãƒ“ã‚¹-ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡" class="headerlink" title="ã‚µãƒ¼ãƒ“ã‚¹ (ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡)"></a>ã‚µãƒ¼ãƒ“ã‚¹ (ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡)</h4><p>ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ã€Azure ã«ãŠã‘ã‚‹ãã‚Œãã‚Œã®ã‚µãƒ¼ãƒ“ã‚¹åã®ã“ã¨ã§ã™ã€‚<br>ã§ãã‚‹é™ã‚Šæ­£ç¢ºã«ã€ã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾ã—ã¦ã®ãŠå•ã„åˆã‚ã›ã§ã‚ã‚‹ã‹é¸æŠã—ã¦ã„ãŸã ãã‚ˆã†ãŠé¡˜ã„ã—ã¾ã™ã€‚  </p><p>ã€ŒAzureã€ã¯ã²ã¨ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ãªãã€æ•°ç™¾ç¨®é¡ã‚‚å­˜åœ¨ã™ã‚‹æ§˜ã€…ãªã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ãªã£ã¦ã„ã¾ã™ã€‚<br>Azure ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã§ã¯ã€ã“ã®è†¨å¤§ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’å€‹ã€…ã®ãƒãƒ¼ãƒ ã§åˆ†æ‹…ã—ã€ã‚ˆã‚Šå°‚é–€çš„ãªå›ç­”ã‚’å·®ã—ä¸Šã’ã‚‰ã‚Œã‚‹ã‚ˆã†ç ”é‘½ã‚’ç©ã‚“ã§ãŠã‚Šã¾ã™ã€‚<br>é©åˆ‡ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¦ã„ãŸã ãã“ã¨ã§ã€å°‚é–€çš„ãªçŸ¥è­˜ã‚’æŒã¤ã‚µãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰ã®æ­£ç¢ºãªã”æ¡ˆå†…ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚  </p><p>ã€Œä½¿ç”¨ä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã¦ã„ã‚‹ã¨ã€ãã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã§ã«ä½œæˆæ¸ˆã¿ã®ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ãŒãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ãŸã‚ã€çµã‚Šè¾¼ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚  </p><h4 id="æ¦‚è¦ã€å•é¡Œã®ç¨®é¡ã¨ã€ã‚µãƒ–ã‚¿ã‚¤ãƒ—"><a href="#æ¦‚è¦ã€å•é¡Œã®ç¨®é¡ã¨ã€ã‚µãƒ–ã‚¿ã‚¤ãƒ—" class="headerlink" title="æ¦‚è¦ã€å•é¡Œã®ç¨®é¡ã¨ã€ã‚µãƒ–ã‚¿ã‚¤ãƒ—"></a>æ¦‚è¦ã€å•é¡Œã®ç¨®é¡ã¨ã€ã‚µãƒ–ã‚¿ã‚¤ãƒ—</h4><p>æ¦‚è¦ã«ã¤ã„ã¦ã¯ã€ç°¡æ½”ã«å•é¡Œã®æ¦‚è¦ã‚’è¨˜è¼‰ä¸‹ã•ã„ã€‚<br>ã“ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«ã€å•é¡Œã®ç¨®é¡ãŒãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã®ã§ã€ã“ã“ã‹ã‚‰ãŠå®¢æ§˜ãŒç›´é¢ã—ã¦ã„ã‚‹å•é¡Œã«è¿‘ã„ã‚‚ã®ã‚’é¸æŠã—ã¾ã™ã€‚<br>ã“ã‚Œã¯ã€é©åˆ‡ãªå°‚ä»»ãƒãƒ¼ãƒ ã«ãŠå•åˆã›ãŒãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ãŸã‚ã®è²´é‡ãªæƒ…å ±ã¨ã—ã¦ä½¿ã‚ã‚Œã¾ã™ã€‚<br>å³å¯†ãªè¡¨ç¾ãŒé›£ã—ã„å ´åˆã«ã¯ã€å¾Œç¶šã®ãƒšãƒ¼ã‚¸ã«ã¦ãƒ†ã‚­ã‚¹ãƒˆ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è©³ç´°ã‚’è¨˜è¼‰å¯èƒ½ã¨ãªã‚Šã¾ã™ã®ã§ã€ã”å®‰å¿ƒãã ã•ã„ã€‚  </p><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p><strong>èµ·ç¥¨ã®å˜ä½ (ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã€ãƒªã‚½ãƒ¼ã‚¹ã”ã¨)</strong></p><p>ã‚µãƒãƒ¼ãƒˆã‚’ã”åˆ©ç”¨ã„ãŸã ãéš›ã«ã¯ã€å•é¡Œã®æœ€å°å˜ä½ã‚’åˆ‡ã‚Šã ã—ãŸã‚‚ã®ã‚’ 1 ä»¶ã¨ã—ã¦ãŠå•åˆã›ãã ã•ã„ã€‚</p><p>ã“ã‚Œã¯ã€ãŠå•åˆã›ã®é‡ã«å¿œã˜ã¦é©åˆ‡ãªã‚µãƒãƒ¼ãƒˆäººå“¡ã‚’é…ç½®ã—ã€ã¾ãŸå¿…è¦ã«å¿œã˜ã¦è¤‡æ•°äººã§ã®å¯¾å¿œã«ã‚ˆã‚Šã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ãªã”é€£çµ¡ã‚’å·®ã—ä¸Šã’ã‚‹ãŸã‚ã§ã‚ã‚Šã€ã‚µãƒãƒ¼ãƒˆã”åˆ©ç”¨ã®çš†æ§˜ã«ãŠé¡˜ã„ã•ã›ã¦é ‚ã„ã¦ãŠã‚Šã¾ã™ã€‚</p><p>åˆ†å‰²ã„ãŸã ãã“ã¨ãŒé©åˆ‡ãªä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p><p><ul><li>åŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã§è¤‡æ•°ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã¦å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ãŒã€ç™ºç”Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç•°ãªã‚‹ãªã©åŒã˜åŸå› ã«ã‚ˆã‚‹ã‚‚ã®ã‹ä¸æ˜ãªå ´åˆ</li><li>1 ã¤ã®å•é¡Œã¨è€ƒãˆã‚‰ã‚Œã‚‹ãŒã€è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹é–“ã«ã‚ãŸã£ã¦å•é¡ŒãŒç™ºç”Ÿã—ã¦ãŠã‚Šã€ã©ã¡ã‚‰ã«å•é¡ŒãŒã‚ã‚‹ã‹ãã‚Œãã‚Œã‹ã‚‰è¦‹è§£ã‚’å—ã‘ãŸã„å ´åˆ (â€» å°‚ä»»éƒ¨é–€ãŒã“ã¨ãªã‚‹ãã‚Œãã‚Œã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰å¯¾å¿œãŒå—ã‘ã‚‰ã‚Œã‚‹ãŸã‚ã€‚ãŠå•ã„åˆã‚ã›ç•ªå·ã‚’ç›¸äº’ã«ã”é€£çµ¡ã„ãŸã ã‘ã¾ã—ãŸã‚‰ã€å†…éƒ¨ã§é€£æºã‚’å–ã£ã¦èª¿æŸ»ã—ã¾ã™ã€‚)</li><li>ãŠå•ã„åˆã‚ã›ã®éç¨‹ã§ã€é–¢é€£ã—ãŸè³ªå•ãŒç™ºç”Ÿã—ãŸãŒå…ƒã®ãŠå•ã„åˆã‚ã›å†…å®¹ã¨ç•°ãªã‚‹å ´åˆ</li></ul></p></div><p>ãªãŠã€è¤‡æ•°ã®ãŠå•åˆã›ã‚’èµ·ç¥¨ã—ãŸæ–¹ãŒè‰¯ã„ã‹åˆ†ã‹ã‚‰ãªã„ã€ã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã©ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ¥ã€…ãªã®ã‹åˆ¤æ–­ãŒã¤ã‹ãªã„ã€ä¸€å•ä¸€ç­”ã«ã—ã¦ã—ã¾ã†ã¨è†¨å¤§ãªé‡ã«ãªã£ã¦ã—ã¾ã†ã€ã¨ã„ã£ãŸå ´åˆã«ã¯ã€ã¾ãšä¸€ä»¶èµ·ç¥¨ã„ãŸã ãã€æ‹…å½“ã®ã‚µãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã”ç›¸è«‡ã‚’ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚</p><h3 id="ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-2-æ¨å¥¨ã•ã‚Œã‚‹è§£æ±ºç­–-ãƒšãƒ¼ã‚¸"><a href="#ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-2-æ¨å¥¨ã•ã‚Œã‚‹è§£æ±ºç­–-ãƒšãƒ¼ã‚¸" class="headerlink" title="ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 2. æ¨å¥¨ã•ã‚Œã‚‹è§£æ±ºç­– ãƒšãƒ¼ã‚¸"></a>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 2. æ¨å¥¨ã•ã‚Œã‚‹è§£æ±ºç­– ãƒšãƒ¼ã‚¸</h3><p>ã“ã®ç”»é¢ã¯ã€ç‰¹ã«å…¥åŠ›ãŒå¿…è¦ãªéƒ¨åˆ†ã¯ç„¡ãã€é–¢é€£ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹æƒ…å ±ãŒæç¤ºã•ã‚Œã‚‹ç®‡æ‰€ã§ã™ã€‚</p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/sr_creation3.png"></p><p>Azure ã«ãŠã„ã¦ã¯ã€ãŠå•ã„åˆã‚ã›ã«ã‚ˆã‚‹ã‚„ã‚Šã¨ã‚Šã«ã¦ãŠæ‰‹é–“ã‚’ã‹ã‘ãšã€æ¥µåŠ›ãŠå®¢æ§˜ã”è‡ªèº«ã§å¿…è¦ãªæƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ãŒå‡ºæ¥ã‚‹ã‚ˆã†ã€å…¬é–‹æƒ…å ±ã®åˆ·æ–°ã‚’ç¶šã‘ã¦ãŠã‚Šã¾ã™ã€‚<br>å¯¾è±¡ãƒšãƒ¼ã‚¸ã§ã¯ã€1ãƒšãƒ¼ã‚¸ç›®ã§è¨˜è¼‰ã„ãŸã ã„ãŸãƒˆãƒ”ãƒƒã‚¯ã«ã¦é–¢é€£ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹æŠ€è¡“è³‡æ–™ã‚„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•ãªã©ã€ãŠå®¢æ§˜ã§ã®è§£æ±ºã‚’ãŠæ‰‹ä¼ã„ã™ã‚‹è³‡æ–™ã‚’æ¤œç´¢ã—ã€æç¤ºã—ã¾ã™ã€‚</p><p>ã¾ãŸã€æœ€è¿‘ç™ºç”Ÿã—ãŸå¤§è¦æ¨¡ãªéšœå®³ã®æƒ…å ±ã‚‚è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã€ãŠå•ã„åˆã‚ã›ã®ã‚„ã‚Šã¨ã‚Šã‚’å¾…ã¤äº‹ãªãæƒ…å ±ãŒå¾—ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚<br>æƒ…å ±ã‚’å‚ç…§ã•ã‚ŒãŸçµæœã€è©²å½“ã—ã¦ã„ãªã„ã€ã‚‚ã—ãã¯ã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰ã®å¯¾å¿œãŒå¿…è¦ãªå ´åˆã€æ¬¡ã¸ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€²ã¿ã¾ã™ã€‚</p><h3 id="ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-3-è¿½åŠ ã®è©³ç´°-ãƒšãƒ¼ã‚¸"><a href="#ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-3-è¿½åŠ ã®è©³ç´°-ãƒšãƒ¼ã‚¸" class="headerlink" title="ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 3. è¿½åŠ ã®è©³ç´° ãƒšãƒ¼ã‚¸"></a>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 3. è¿½åŠ ã®è©³ç´° ãƒšãƒ¼ã‚¸</h3><p>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¾é ¼å†…å®¹ã®è©³ç´°ã‚’å…¥åŠ›ã™ã‚‹ãƒšãƒ¼ã‚¸ã¨ãªã‚Šã¾ã™ã€‚</p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/sr_creation4.png"></p><p><img src="/blog/information/How-to-inquiry-to-the-Azure-Support/sr_creation5.png"></p><h4 id="å•é¡Œã®è©³ç´°"><a href="#å•é¡Œã®è©³ç´°" class="headerlink" title="å•é¡Œã®è©³ç´°"></a>å•é¡Œã®è©³ç´°</h4><p>ã“ã“ã§ã¯ã€ãŠå®¢æ§˜ã®ã”åˆ©ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„ãƒªã‚½ãƒ¼ã‚¹ã«ã¤ã„ã¦ã€ã„ã¤ã‹ã‚‰å•é¡ŒãŒç™ºç”Ÿã—ãŸã®ã‹ã‚„ã€å•é¡Œã®èª¬æ˜ã«ã¤ã„ã¦è©³ç´°ãªè¨˜è¼‰ã‚’ãŠé¡˜ã„ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>ã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè¿…é€Ÿã«å•é¡Œå†…å®¹ã‚’æŠŠæ¡ã—ã€èª¿æŸ»ã‚’è¡Œã†ãŸã‚ã«ã”å”åŠ›ã‚’ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚</p><p><strong>æ—¥æ™‚ æ¬„</strong><br>ã‚¨ãƒ©ãƒ¼ã‚„å•é¡ŒãŒæœ€åˆã«ç™ºç”Ÿã—ãŸæ™‚é–“ã«ã¤ã„ã¦è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚</p><p><strong>èª¬æ˜ æ¬„</strong><br>ä»¥ä¸‹ã‚’å‚è€ƒã«ã€å•é¡Œã®è©³ç´°ã«ã¤ã„ã¦è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚</p><ul><li>ãŠå•ã„åˆã‚ã›ã«ãŠã‘ã‚‹ã‚´ãƒ¼ãƒ«</li><li>å•é¡Œã€ã‚ã‚‹ã„ã¯ã”è³ªå•å†…å®¹</li><li>å†ç¾ã®æ‰‹é † (ã©ã®ã‚ˆã†ãªæ“ä½œã‚’è¡Œã†ã“ã¨ã§å•é¡ŒãŒç™ºç”Ÿã™ã‚‹ã‹)</li><li>å•é¡Œã®é »åº¦ (â—‹æ™‚é–“ã«ä¸€åº¦ã€å®šæœŸçš„/ä¸å®šæœŸ ãªã©)</li><li>å•é¡ŒãŒå‡ºã‚‹ç›´å‰ã«ã€æ§‹æˆã‚„è¨­å®šé¢ã§å¤‰æ›´ã‚’åŠ ãˆãŸã‚‚ã®ãŒã‚ã‚Œã°ã€å¯èƒ½ãªé™ã‚Šè©³ç´°ã«è¨˜è¼‰ãã ã•ã„ã€‚</li><li>è©³ç´°ãªã‚¨ãƒ©ãƒ¼ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ç”»é¢ã‚·ãƒ§ãƒƒãƒˆãªã©ãŒæº–å‚™ã§ãã‚‹å ´åˆã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ãŸã ãã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚(ã‚¨ãƒ©ãƒ¼ã¨åˆ†ã‹ã£ãŸä¸€éƒ¨åˆ†ã®ã¿ã«çœç•¥ã›ãšã€ã‚³ãƒãƒ³ãƒ‰ã‚„æ“ä½œã‚’è¡Œã£ãŸã¨ã“ã‚ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¾ã§ã®å…¨ä½“ã‚’æŠœç²‹ã„ãŸã ãã“ã¨ãŒç¢ºå®Ÿã§ã™)</li><li>ãŠå®¢æ§˜ã«ã¦ãŠè©¦ã—ã„ãŸã ã„ãŸå¯¾ç­–ã‚„ã€å®Ÿæ–½ã•ã‚ŒãŸèª¿æŸ»å†…å®¹ã€æ—¢çŸ¥ã®å›é¿ç­–ã®æœ‰ç„¡</li><li>(ã™ã§ã«ä»–ã®ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’èµ·ç¥¨æ¸ˆã¿ã§é–¢é€£ã—ã¦ã„ã‚‹å ´åˆ) é–¢é€£ã™ã‚‹ãŠå•åˆã›ç•ªå·ã¨å½“è©²ä»¶ã®æ‹…å½“è€…å</li><li>ãŠå•ã„åˆã‚ã›ã®ã‚„ã‚Šã¨ã‚Šã«è¿½åŠ ã•ã‚ŒãŸã„ä»–ã®ã”æ‹…å½“è€…æ§˜ã®é€£çµ¡å…ˆ</li></ul><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p>ãã®ä»–ã®ä¸€èˆ¬çš„ãªãƒ’ã‚¢ãƒªãƒ³ã‚°äº‹é …ã«ã¤ã„ã¦ã¯ã€<a href="https://aka.ms/jpazsupportform">https://aka.ms/jpazsupportform</a> ã« EXCEL ã‚·ãƒ¼ãƒˆã‚’ã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ã€‚</p><p>èµ·ç¥¨ã®éš›ã®ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p><p>(æœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åŸ‹ã‚ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ãŸã ã„ã¦ã‚‚ OK ã§ã™ã€‚)</p></div><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p><strong>éåº¦ãªç•¥èªã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰æ–‡è¨€ã®ä½¿ç”¨ã¯é¿ã‘ã¾ã—ã‚‡ã†</strong></p><p>ä¸€èˆ¬çš„ã« Azure ã®è£½å“åã‚„æ©Ÿèƒ½ã§ã‚ã‚‹ã‚‚ã®ã‚’ã®ããã€ç•¥ç§°ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®æ–‡è¨€ã®ä½¿ç”¨ã«ã‚ˆã‚Šé½Ÿé½¬ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ä¾‹: ã€ŒPoC ç’°å¢ƒã€ã€Œãƒ—ãƒ©ã‚¤ãƒãƒª/ã‚»ã‚«ãƒ³ãƒ€ãƒªã€ãªã©ã€‚</p><p>ã€ŒPoC ã§ã¯ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã‹ã£ãŸãŒã€æœ¬ç•ªç’°å¢ƒã§ã¯å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã€ =&gt; PoC ç’°å¢ƒã€æœ¬ç•ªç’°å¢ƒãŒã©ã®ã‚ˆã†ãªãƒªã‚½ãƒ¼ã‚¹åã¨æ§‹æˆã§ã‚ã‚‹ã‹ã‚’æ˜è¨˜ã—ãŸã‚Šã€åˆ©ç”¨æ–¹æ³•ãªã©ã®é•ã„ã«ã¤ã„ã¦ã‚‚ã”èª¬æ˜ã„ãŸã ãã“ã¨ã§ã€æ¯”è¼ƒèª¿æŸ»ã«å½¹ç«‹ã¤å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p></div><h4 id="é«˜åº¦ãªè¨ºæ–­æƒ…å ±"><a href="#é«˜åº¦ãªè¨ºæ–­æƒ…å ±" class="headerlink" title="é«˜åº¦ãªè¨ºæ–­æƒ…å ±"></a>é«˜åº¦ãªè¨ºæ–­æƒ…å ±</h4><p>Azure ã‚µãƒãƒ¼ãƒˆã§ã¯ã€ãŠå®¢æ§˜ã®ãƒ‡ãƒ¼ã‚¿ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã«é…æ…®ã‚’ã—ã¤ã¤ã€ä¸€éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å¿…è¦ãªç¯„å›²ã§åŸºç›¤ãƒ­ã‚°ã®æŠ½å‡ºã‚’è¡Œã†ã¨ã„ã£ãŸã€é«˜åº¦ãªè¨ºæ–­æƒ…å ±ã¸ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚<br>ã“ã‚Œã«ã‚ˆã‚Šã€ãŠå®¢æ§˜ã«ã¦æ‰‹å‹•ã§æƒ…å ±ã‚’æŠ½å‡ºã—ã€å¼Šç¤¾ã«é€ä¿¡ã„ãŸã ãã¨ã„ã£ãŸæ‰‹é–“ãŒçœã‘ã¾ã™ã€‚<br>åŸºæœ¬çš„ã«ã¯ã€ã“ã¡ã‚‰ã§ã€Œã¯ã„ã€ã‚’é¸æŠã—ã¦ã„ãŸã ãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ Azure ã‚µãƒãƒ¼ãƒˆãŒå‚ç…§ã§ãã‚‹æƒ…å ±ã¯ä»¥ä¸‹ã®é€šã‚Šã¨ãªã‚Šã¾ã™ã€‚  </p><blockquote><p>ã”å‚è€ƒ) Data we use to deliver Azure support<br><a href="https://azure.microsoft.com/en-us/support/legal/support-diagnostic-information-collection/">https://azure.microsoft.com/en-us/support/legal/support-diagnostic-information-collection/</a><br>(â€» ãŠå•ã„åˆã‚ã›ã®ã‚¯ãƒ­ãƒ¼ã‚ºã¨å…±ã«ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã¯å‰Šé™¤ã•ã‚Œã¾ã™)</p></blockquote><h4 id="ã‚µãƒãƒ¼ãƒˆæ–¹æ³•"><a href="#ã‚µãƒãƒ¼ãƒˆæ–¹æ³•" class="headerlink" title="ã‚µãƒãƒ¼ãƒˆæ–¹æ³•"></a>ã‚µãƒãƒ¼ãƒˆæ–¹æ³•</h4><p><strong>é‡è¦åº¦ (é‡å¤§åº¦)</strong><br>å•é¡Œã®çŠ¶æ³ã«ã‚ˆã£ã¦ã€3 ç¨®é¡ã®é‡è¦åº¦ãŒè¨­å®šå¯èƒ½ã§ã™ã€‚<br>ãŠå®¢æ§˜ãŒã”åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹å¥‘ç´„ã¨ã€ã“ã®ç·Šæ€¥åº¦ã«å¿œã˜ã¦ã€åˆå›å¿œç­”æ™‚é–“ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚<br>åˆå›å¿œç­”æ™‚é–“ã¯ã€Microsoft ã®ã‚µãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãŠå®¢æ§˜ã¨é€£çµ¡ã‚’å–ã‚Šã€ã‚µãƒãƒ¼ãƒˆãŒé–‹å§‹ã•ã‚Œã‚‹ã¾ã§ã®æ™‚é–“ã§ã™ã€‚é‡å¤§åº¦ A ä»¥å¤–ã¯å–¶æ¥­æ™‚é–“å†…ã§ã®ã”é€£çµ¡ã¨ãªã‚Šã¾ã™ã€‚</p><ul><li>äº‹æ¥­ã«è»½å¾®ãªå½±éŸ¿ãŒåŠã¶å ´åˆ (é‡å¤§åº¦ C):<br>Standard ã‚µãƒãƒ¼ãƒˆå¥‘ç´„ã®å ´åˆ 8 æ™‚é–“ä»¥å†…</li><li>äº‹æ¥­ã«éƒ¨åˆ†çš„ãªå½±éŸ¿ãŒç™ºç”Ÿã™ã‚‹å ´åˆ (é‡å¤§åº¦ B):<br>Standard ã‚µãƒãƒ¼ãƒˆå¥‘ç´„ã®å ´åˆ 4 æ™‚é–“ä»¥å†…</li><li>äº‹æ¥­ã«å¤§ããªå½±éŸ¿ãŒç™ºç”Ÿã™ã‚‹å ´åˆ (é‡å¤§åº¦ A):<br>Standard ã‚µãƒãƒ¼ãƒˆå¥‘ç´„ã®å ´åˆ 1 æ™‚é–“ä»¥å†…</li></ul><p>è©³ã—ãã¯ã€<a href="https://azure.microsoft.com/ja-jp/support/plans/response/">ã‚µãƒãƒ¼ãƒˆ ãƒ—ãƒ©ãƒ³â€”ã‚µãƒãƒ¼ãƒˆå†…å®¹ã¨å¿œç­”æ€§</a> ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><div class="alert is-important"><p class="alert-title">é‡è¦</p><p><strong>é‡è¦åº¦ A ã«ã¤ã„ã¦</strong></p><p>å¹³æ—¥ã®å¤œé–“ã¨ä¼‘æ—¥ã‚‚å«ã‚ãŸ 24x7 (24 æ™‚é–“ä½“åˆ¶) ã§ã®ã”æ”¯æ´ã§ã‚ã‚Šã€å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã€Œä»Šã™ãã«å¯¾å¿œãŒå¿…è¦ã€ã¨ã„ã†å ´åˆã®åˆ©ç”¨ã‚’æƒ³å®šã—ã¦ãŠã‚Šã¾ã™ã€‚</p><p><ul><li>åŸå‰‡ã¨ã—ã¦ã€äº‹æ¥­ãŒåœæ­¢ã—ã¦ã„ã‚‹ã‚ˆã†ãªå±æ©Ÿçš„éšœå®³ (ä¾‹ : å…¨ç¤¾å“¡ã®ãƒ¡ãƒ¼ãƒ«é€å—ä¿¡ãŒå¤±æ•—ã€å…¨ç¤¾å“¡ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã€ãªã©) ã‹ã‚‰ã®å¾©æ—§ã‚’ç›®æŒ‡ã—ãŸã‚µãƒãƒ¼ãƒˆã¨ãªã‚Šã¾ã™ã€‚</p><p>ã“ã®ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå ´åˆã¯é‡è¦åº¦ B ä»¥ä¸‹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</li><ul><li>å¾©æ—§æ¸ˆã¿ã®å•é¡Œã«ã¤ã„ã¦ã®åŸå› ã®èª¿æŸ»</li><li>ç’°å¢ƒã®æ§‹ç¯‰ä¸­ã‚„ã“ã‚Œã¾ã§ã¨ç•°ãªã‚‹è¨­å®šã¸ã®å¤‰æ›´ã«ä¼´ã†å•é¡Œç™ºç”Ÿã§åˆ‡ã‚Šæˆ»ã—ã«ã‚ˆã£ã¦è§£æ¶ˆå¯èƒ½</li><li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²æ—ã«å½±éŸ¿ãŒå‡ºã¦ã„ã‚‹ã®ã§å¯¾å¿œã‚’åŠ é€Ÿ</li></ul><li>å³æ™‚ã®æƒ…å ±æä¾›ãªã©ãŒå¿…è¦ãªãŸã‚ã€ãŠå®¢æ§˜ã«ã‚‚å¸¸ã«ã”é€£çµ¡ãŒã¤ãä½“åˆ¶ã®ç¶­æŒã‚’ãŠé¡˜ã„ã—ã¦ãŠã‚Šã¾ã™</li><li>éšœå®³ã‹ã‚‰ã®å¾©æ—§å¾Œã«ã¯ã€ãŠå®¢æ§˜ã¨ã®ã”ç›¸è«‡ã®ä¸Šã§é‡è¦åº¦ã‚’å¤‰æ›´ã•ã›ã¦ã„ãŸã ãã¾ã™</li></ul></p></p><p></blockquote><blockquote><p><strong>å¯¾å¿œä¸­ã®æ¡ˆä»¶ã®ç·Šæ€¥åº¦ ã‚’ A (24x7 å¯¾å¿œ) ã«ä¸Šæ˜‡ã•ã›ãŸã„å ´åˆ</strong></p><p>ãŠå•ã„åˆã‚ã›ã®ä»¶ã«ã¤ã„ã¦ç·Šæ€¥æ€§ãŒä¸Šæ˜‡ã—ãŸçµæœã€é‡è¦åº¦ã‚’ A ã«å¤‰æ›´ã•ã‚ŒãŸã„å ´åˆã«ã¯ã€ãŠæ‰‹æ•°ã§ã™ãŒåˆ¥é€”æ–°è¦ã«é‡è¦åº¦ A ã®ãŠå•ã„åˆã‚ã›ã®èµ·ç¥¨ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p><p>æ–°è¦ã®ãŠå•åˆã›ã‚’èµ·ç¥¨ã„ãŸã ãã“ã¨ã§ã€ãã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ç·Šæ€¥å¯¾å¿œæ‹…å½“ã¸å‘¼ã³å‡ºã—ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</p><p>ãã®éš›ã€æ—¢å­˜ã®ãŠå•ã„åˆã‚ã›ã®ãŠå•åˆã›ç•ªå·ã‚’æ–‡ä¸­ã«è¨˜è¼‰ã„ãŸã ãã“ã¨ã§ã€é–¢é€£ã®ãŠå•ã„åˆã‚ã›ã®çµŒç·¯ã‚‚å‚è€ƒã«ã—ã¤ã¤å¯¾å¿œã—ã¾ã™ã€‚</p></div><p><strong>ã”å¸Œæœ›ã®é€£çµ¡æ–¹æ³•</strong><br>ãƒ¡ãƒ¼ãƒ«ã‹é›»è©±ã€ã”å¸Œæœ›ã®é€£çµ¡æ–¹æ³•ã‚’ã”é¸æŠãã ã•ã„ã€‚é¸æŠã—ãŸæ–¹æ³•ã§åˆå›ã®ã”é€£çµ¡ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>ãªãŠã€2 å›ç›®ä»¥é™ã®ã”é€£çµ¡ã¯ã‚µãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒçŠ¶æ³ã«å¿œã˜ã¦ç•°ãªã‚‹ã”é€£çµ¡æ–¹æ³•ã®ãŠé¡˜ã„ã‚’ã•ã›ã¦é ‚ãå ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>ã‚‚ã—ã€ã‚ˆã‚Šç´°ã‹ã„ã”è¦æœ›ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€æ˜¯éãŠå•åˆã›èª¬æ˜æ¬„ã«ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚<br>ç·Šæ€¥åº¦ A ã«ã¤ã„ã¦ã¯é›»è©±ã®ã¿ã§ã®å¯¾å¿œã¨ãªã‚Šã¾ã™ã€‚  </p><p><strong>ã‚µãƒãƒ¼ãƒˆè¨€èª</strong><br>å¯¾å¿œã‚’è¦æœ›ã•ã‚Œã‚‹è¨€èªã‚’ã”é¸æŠãã ã•ã„ã€‚  </p><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p><strong>è‹±èªã§ã®ãŠå•ã„åˆã‚ã›ã«ã¤ã„ã¦</strong></p><p>è‹±èªã§ã®å¯¾å¿œã‚’ã”è¦æœ›ã®éš›ã«ã¯ã€ãŠæ‰‹æ•°ã§ã™ãŒãŠå•åˆã›æœ¬æ–‡ç­‰ã‚‚ã™ã¹ã¦è‹±æ–‡ã§ã®è¨˜è¼‰ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p><p>ã¾ãŸã€ç·Šæ€¥åº¦ B ã‹ã¤ 24x7 ã®ãŠå•åˆã›ã¯ã€ç¾åœ¨ã®ã¨ã“ã‚è‹±èªã®ã¿ã®å¯¾å¿œã¨ãªã‚Šã¾ã™ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚</p></div><h4 id="é€£çµ¡å…ˆæƒ…å ±"><a href="#é€£çµ¡å…ˆæƒ…å ±" class="headerlink" title="é€£çµ¡å…ˆæƒ…å ±"></a>é€£çµ¡å…ˆæƒ…å ±</h4><p>ãŠå®¢æ§˜ã®é€£çµ¡å…ˆã‚’è¨˜è¼‰ã—ã¾ã™ã€‚<br>ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€ä»»æ„ã®ãƒ¡ãƒ¼ãƒ« ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ã”æ‹…å½“è€…åã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã®ã§ã€ãŠé–“é•ãˆç„¡ã„ã‚ˆã†ä»Šä¸€åº¦æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŠã‚ˆã³é›»è©±ç•ªå·ã‹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p><h3 id="ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-4-ç¢ºèªã¨ä½œæˆ-ãƒšãƒ¼ã‚¸"><a href="#ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢-4-ç¢ºèªã¨ä½œæˆ-ãƒšãƒ¼ã‚¸" class="headerlink" title="ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 4. ç¢ºèªã¨ä½œæˆ ãƒšãƒ¼ã‚¸"></a>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”»é¢ - 4. ç¢ºèªã¨ä½œæˆ ãƒšãƒ¼ã‚¸</h3><p>æœ€å¾Œã«ã€ãŠå•ã„åˆã‚ã›ã®ä½œæˆç¢ºèªç”»é¢ã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã‚Œã¾ã§ã«å…¥åŠ›ã„ãŸã ã„ãŸå†…å®¹ã«æ¼ã‚ŒãŒãªã„ã“ã¨ã‚’ã”ç¢ºèªã®ä¸Šã€ãƒã‚±ãƒƒãƒˆä½œæˆã‚’å®Œäº†ã—ã¾ã™ã€‚<br>ãã®å¾Œã€åˆå›å¿œç­”æ™‚é–“å†…ã«ã€ã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰ã®ã”é€£çµ¡å·®ã—ä¸Šã’ã¾ã™ã€‚  </p><hr><h2 id="ãŠå•ã„åˆã‚ã›ã®å®Œäº†-ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚º"><a href="#ãŠå•ã„åˆã‚ã›ã®å®Œäº†-ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚º" class="headerlink" title="ãŠå•ã„åˆã‚ã›ã®å®Œäº† (ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚º)"></a>ãŠå•ã„åˆã‚ã›ã®å®Œäº† (ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚º)</h2><h3 id="ãŠå•ã„åˆã‚ã›ã®çµ‚äº†æ–¹æ³•ã«ã¤ã„ã¦"><a href="#ãŠå•ã„åˆã‚ã›ã®çµ‚äº†æ–¹æ³•ã«ã¤ã„ã¦" class="headerlink" title="ãŠå•ã„åˆã‚ã›ã®çµ‚äº†æ–¹æ³•ã«ã¤ã„ã¦"></a>ãŠå•ã„åˆã‚ã›ã®çµ‚äº†æ–¹æ³•ã«ã¤ã„ã¦</h3><p>å¼Šç¤¾ã®ã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰ã®å›ç­”ã«ã‚ˆã£ã¦ã€ãŠå•ã„åˆã‚ã›ã«è¨˜è¼‰é ‚ã„ãŸå•é¡ŒãŒè§£æ±ºã—ãŸå ´åˆã‚„ã€ãŠå®¢æ§˜ã”è‡ªèº«ã§å•é¡ŒãŒè§£æ±ºã—ãŸå ´åˆã¯ã€è§£æ±ºã—ãŸæ—¨ã‚’ Azure ãƒãƒ¼ã‚¿ãƒ«ã‚„ãƒ¡ãƒ¼ãƒ«ã€ãŠé›»è©±ã«ã¦ã”é€£çµ¡é ‚ãã¾ã™ã‚ˆã†ãŠé¡˜ã„è‡´ã—ã¾ã™ã€‚<br>ãã®å¾Œã€å¼Šç¤¾ã®ã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¦ãŠå•ã„åˆã‚ã›å¯¾å¿œã®çµ‚äº† (ã‚¯ãƒ­ãƒ¼ã‚º) ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚<br>ãªãŠã€ä¸€å®šæœŸé–“ãŠå®¢æ§˜ã‹ã‚‰ã”é€£çµ¡ã‚’é ‚ã‘ãªã‹ã£ãŸå ´åˆã¯ã€å¼Šç¤¾ã®ã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¦ãŠå•ã„åˆã‚ã›ã®ã‚¯ãƒ­ãƒ¼ã‚ºã‚’å®Ÿæ–½ã—ã¾ã™ã€‚  </p><h3 id="ã‚¯ãƒ­ãƒ¼ã‚ºæ¸ˆã¿ã®ãŠå•ã„åˆã‚ã›ã®å†é–‹æ–¹æ³•ã«ã¤ã„ã¦"><a href="#ã‚¯ãƒ­ãƒ¼ã‚ºæ¸ˆã¿ã®ãŠå•ã„åˆã‚ã›ã®å†é–‹æ–¹æ³•ã«ã¤ã„ã¦" class="headerlink" title="ã‚¯ãƒ­ãƒ¼ã‚ºæ¸ˆã¿ã®ãŠå•ã„åˆã‚ã›ã®å†é–‹æ–¹æ³•ã«ã¤ã„ã¦"></a>ã‚¯ãƒ­ãƒ¼ã‚ºæ¸ˆã¿ã®ãŠå•ã„åˆã‚ã›ã®å†é–‹æ–¹æ³•ã«ã¤ã„ã¦</h3><p>ãŠå®¢æ§˜ã®ã‚µãƒãƒ¼ãƒˆå¥‘ç´„ãŒæœ‰åŠ¹ãªå ´åˆã¯ã€ã‚¯ãƒ­ãƒ¼ã‚ºæ¸ˆã¿ã®ãŠå•ã„åˆã‚ã›ã«é–¢ã™ã‚‹è¿½åŠ ã®ã”è³ªå•ã‚„èª¿æŸ»ã‚’å†é–‹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã®ã§ã€ãŠå•ã„åˆã‚ã›å†…å®¹ã«å¯¾è±¡ã®ãŠå•ã„åˆã‚ã›ç•ªå·ã‚’æ˜è¨˜ã®ä¸Šã€æ–°è¦ã§ãŠå•ã„åˆã‚ã›ã‚’èµ·ç¥¨é ‚ãã¾ã™ã‚ˆã†ãŠé¡˜ã„è‡´ã—ã¾ã™ã€‚  </p><h3 id="ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚ºå¾Œã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã¤ã„ã¦"><a href="#ã‚µãƒãƒ¼ãƒˆ-ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚ºå¾Œã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã¤ã„ã¦" class="headerlink" title="ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚ºå¾Œã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã¤ã„ã¦"></a>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ­ãƒ¼ã‚ºå¾Œã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã¤ã„ã¦</h3><p>ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ã«ãƒ¡ãƒ¼ãƒ«ã§ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚’é€ä»˜ã—ã¦ã„ã¾ã™ã€‚<br>ã‚µãƒãƒ¼ãƒˆå¯¾å¿œã®å“è³ªå‘ä¸Šã‚’ç›®çš„ã¨ã—ã¦ã€å„ã‚µãƒãƒ¼ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã®ã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã‚ˆã‚‹å¯¾å¿œå“è³ªã‚’ãŠå®¢æ§˜ã«ã”è©•ä¾¡ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€‚<br>å›ç­”å†…å®¹ã«ã¤ã„ã¦ã¯æ‹…å½“ã—ãŸã‚µãƒãƒ¼ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãªã‚‰ã³ã«æ‹…å½“ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã§å…±æœ‰ã—ã€æ¬¡å›ä»¥é™ã®ã‚ˆã‚Šè‰¯ã„å¯¾å¿œã«ç¹‹ã’ãŸã‚Šã€åŠ±ã¿ã¨ã•ã›ã¦ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€‚ </p><h3 id="Azure-ã¸ã®è£½å“ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚„æ©Ÿèƒ½è¿½åŠ ã®è¦æœ›"><a href="#Azure-ã¸ã®è£½å“ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚„æ©Ÿèƒ½è¿½åŠ ã®è¦æœ›" class="headerlink" title="Azure ã¸ã®è£½å“ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚„æ©Ÿèƒ½è¿½åŠ ã®è¦æœ›"></a>Azure ã¸ã®è£½å“ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚„æ©Ÿèƒ½è¿½åŠ ã®è¦æœ›</h3><p>Azure ã«ãŠã‘ã‚‹è£½å“è‡ªä½“ã®å“è³ªã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã€æ©Ÿèƒ½è¿½åŠ ãƒ»å¤‰æ›´ã¨ã„ã£ãŸã”è¦æœ›ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ã€Œã‚¢ã‚¤ãƒ‡ã‚¢ã€ãƒšãƒ¼ã‚¸ã«ã¦é›†ç´„ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>ã“ã¡ã‚‰ã®ã‚µã‚¤ãƒˆã‹ã‚‰æŠ•ç¨¿ã—ã¦ã„ãŸã ãã“ã¨ã§ã€é–‹ç™ºéƒ¨é–€ã«ç›´æ¥ãŠå£°ã‚’å±Šã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã£ã¦ã„ã¾ã™ã€‚  </p><blockquote><p>ã”å‚è€ƒ) <a href="https://feedback.azure.com/d365community/">https://feedback.azure.com/d365community/</a>  </p></blockquote><div class="alert is-important"><p class="alert-title">é‡è¦</p><p><strong>ã‚µãƒãƒ¼ãƒˆã¨æ©Ÿèƒ½è¦æœ›ã®é•ã„ã«ã¤ã„ã¦</strong></p><p>Azure ã‚µãƒãƒ¼ãƒˆã¯ã€ç¾åœ¨é€²è¡Œå½¢ã®å•é¡Œã«å¯¾ã—ã¦å¯¾å‡¦ã‚’è¡Œã„ã€è£½å“ã‚’ä½¿ã„ç¶šã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ãªæ”¯æ´ã‚’è¡Œã†ã“ã¨ã«æ³¨åŠ›ã—ã¦ã„ã¾ã™ã€‚Azure ãªã©ã®ã‚¯ãƒ©ã‚¦ãƒ‰è£½å“ã«ãŠã„ã¦ã¯ã€ä¸­ãƒ»é•·æœŸçš„ã«è¦‹ãŸæ©Ÿèƒ½æ”¹å–„ã‚„è¿½åŠ ã®ã”è¦æœ›ã€ä¸€éæ€§ã®å•é¡Œã«å¯¾ã—ã¦ã®ä¿®æ­£å®Œäº†ã¾ã§ã®è¿½è·¡ã¯ã‚µãƒãƒ¼ãƒˆã§ã¯è¡Œã£ã¦ãŠã‚Šã¾ã›ã‚“ã€‚ä¸Šè¨˜ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ã‚µã‚¤ãƒˆã§ã¯ã€è£½å“ãŒã‚ˆã‚Šè‰¯ããªã‚‹ã‚ˆã†ãªã”è¦æœ›ã«ã¤ã„ã¦ã€ãã®è³›åŒæ„è¦‹ã‚„æŠ€è¡“çš„ãªå®Ÿç¾æ­£ã¨ãƒ¡ãƒªãƒƒãƒˆã‚’è€ƒãˆã€ä»Šå¾Œã®é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«æ´»ã‹ã™ã¹ãé–‹ç™ºè€…ãŒç›´æ¥å‚ç…§ã—ã¦ãŠã‚Šã¾ã™ã®ã§ã€ãœã²ã¨ã‚‚ç©æ¥µçš„ã«æŠ•ç¨¿ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p><p>ãªãŠã€ã“ã®ã‚ˆã†ãªæ©Ÿèƒ½æ”¹å–„ã¸ã®ã”è¦æœ›ã«ã¤ã„ã¦ã€ä¸­ãƒ»é•·æœŸçš„ã§ã¯ã‚ã£ã¦ã‚‚ã€ãŠå®¢æ§˜ã«ã¨ã£ã¦ Azure ã‚’ç¶™ç¶šåˆ©ç”¨ã™ã‚‹ã«ã‚ãŸã£ã¦æ¥µã‚ã¦å¤§ããªéšœå£ã¨ãªã‚‹ã‚ˆã†ã§ã—ãŸã‚‰ã€ãƒ—ãƒ¬ãƒŸã‚¢ ã‚µãƒãƒ¼ãƒˆã®å¥‘ç´„ã‚’ã„ãŸã ã„ã¦ã„ã‚‹å ´åˆã€æ‹…å½“ã® CSAM (ã‚«ã‚¹ã‚¿ãƒãƒ¼ ã‚µã‚¯ã‚»ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼) ã¾ã§ã”é€£çµ¡ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</p></div><p>ä»¥ä¸ŠãŒ Azure ã‚µãƒãƒ¼ãƒˆã‚’åŠ¹æœçš„ã«ã”åˆ©ç”¨ã„ãŸã ããŸã‚ã®ãŠå•ã„åˆã‚ã›æ–¹æ³•ã€ãŠã‚ˆã³æµã‚Œã¨ãªã‚Šã¾ã™ã€‚  </p><p>ãªãŠã€ãŠå•ã„åˆã‚ã›ã‚’ã•ã‚Œã‚‹ãŠå®¢æ§˜ã«ã¯æ§˜ã€…ãªã”è¦æœ›ãŒã‚ã‚Šã€ã¾ãŸæ§˜ã€…ãªã”äº‹æƒ…ã‚’æŠ±ãˆã¦ã„ã‚‰ã£ã—ã‚ƒã‚‹ã¨æ‹å¯Ÿã—ã¦ãŠã‚Šã¾ã™ã€‚<br>ã€Œã™ãã«é›»è©±ãŒæ¬²ã—ã„ã€ã€ã€Œé›»è©±ã¯çµ¶å¯¾ã«ã—ã¦æ¬²ã—ããªã„ã€ã€ã€Œãƒ¡ãƒ¼ãƒ«ã¯ãƒ†ã‚­ã‚¹ãƒˆãŒè‰¯ã„ã€ã€ã€Œã„ã‚„ HTML ã§å›³ãŒå…¥ã£ã¦ã„ãŸæ–¹ãŒèª­ã¿ã‚„ã™ã„ã€ãªã©ãªã©ã€æ—¥ã€…å¯¾å¿œã•ã›ã¦é ‚ã„ã¦ã„ã‚‹ãªã‹ã§ã€é ‚æˆ´ã™ã‚‹ã”è¦æœ›ã¯å¤šå²ã«æ¸¡ã‚Šã€æ­£åå¯¾ã®ã‚‚ã®ã‚‚ã”ã–ã„ã¾ã™ã€‚</p><p>ç§ãŸã¡ Azure ã‚µãƒãƒ¼ãƒˆã§ã¯ã€ã¾ãšãŠå®¢æ§˜ã¨å¯¾è©±ã•ã›ã¦é ‚ãã“ã¨ãŒå¿…è¦ã§ã‚ã‚Šã€Q ã‚’å…¥ã‚ŒãŸã‚‰ A ãŒå‡ºã¦ãã‚‹ã‚ˆã†ãªæ©Ÿæ¢°çš„ãªã‚µãƒãƒ¼ãƒˆã§ã¯ãªãã€ã”è¦æœ›ã‚’ãŠèãã—ã¦ã€ãã‚Œã«å¯„ã‚Šæ·»ã£ãŸã”æ”¯æ´ã‚’å·®ã—ä¸Šã’ã‚‰ã‚Œã‚Œã°ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚<br>ã‚‚ã—ã€ä¸Šè¨˜ã«ã†ã¾ãã‚ã¦ã¯ã‚ã‚‰ã‚Œãªã„ã‚ˆã†ãªã”è¦æœ›ã‚„ãŠæ‚©ã¿ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ã¾ãšã¯ä¸€ä»¶ãŠå•åˆã›ã‚’ãŠé€ã‚Šã„ãŸã ãã€ãã®ä¸­ã§ãŠæ°—å…¼ã­ãªãæ‹…å½“ã‚µãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¾ã§ã”ç›¸è«‡ãã ã•ã„ã€‚  </p><p>Azure ã‚’ã‚µãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã®è³ªã§ãŠé¸ã³é ‚ã‘ã‚‹ã‚ˆã†ã€ãƒãƒ¼ãƒ ä¸€åŒåŠªã‚ã¦ã¾ã„ã‚Šã¾ã™ã®ã§ã€ã“ã‚Œã‹ã‚‰ã‚‚ã€å¼Šç¤¾ Azure ã‚µãƒ¼ãƒ“ã‚¹ãªã‚‰ã³ã« Azure ã‚µãƒãƒ¼ãƒˆã‚’ã”æ„›é¡§è³œã‚Šã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;ç§ãŸã¡ã¯ã€Azure ã‚’ã”åˆ©ç”¨ã„ãŸã ã„ã¦ã„ã‚‹ãŠå®¢æ§˜ã«ã€Azure ã‚’æ­£å¸¸ã‹ã¤å¿«é©ã«ã”åˆ©ç”¨ã„ãŸã ããŸã‚ã®ã”æ”¯æ´ã‚’å·®ã—ä¸Šã’ã¦ã„ã¾ã™ã€‚&lt;br&gt;ã“ã®åº¦ã€Azure ã‚µãƒãƒ¼ãƒˆã‚’åŠ¹æœçš„ã«åˆ©ç”¨ã™ã‚‹ã‚„ã‚Šæ–¹ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã€ã¨ã„ã†ã”è¦æœ›ã‚’é ‚æˆ´ã—ã¾ã—ãŸã®ã§ã€ä»¥ä¸‹ã«ã‚µãƒãƒ¼ãƒˆã¸ã®ãŠå•ã„åˆã‚ã›æ–¹æ³•ã‚’ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Information" scheme="https://jpaztech.github.io/blog/tags/Information/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’çµŒç”±ã™ã‚‹ã‹ã©ã†ã‹ã®ç¢ºèªæ–¹æ³•</title>
    <link href="https://jpaztech.github.io/blog/network/judge-via-ms-peering/"/>
    <id>https://jpaztech.github.io/blog/network/judge-via-ms-peering/</id>
    <published>2023-11-24T07:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.184Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å±±å´ã§ã™ã€‚<br>ä»Šå›ã¯å¯¾è±¡ã®é€šä¿¡ãŒ Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’çµŒç”±ã™ã‚‹ã‹ã©ã†ã‹ã®ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚</p><h2 id="Microsoft-ãƒ”ã‚¢ãƒªãƒ³ã‚°ã§åºƒå ±ã•ã‚Œã‚‹çµŒè·¯ã«ã¤ã„ã¦"><a href="#Microsoft-ãƒ”ã‚¢ãƒªãƒ³ã‚°ã§åºƒå ±ã•ã‚Œã‚‹çµŒè·¯ã«ã¤ã„ã¦" class="headerlink" title="Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°ã§åºƒå ±ã•ã‚Œã‚‹çµŒè·¯ã«ã¤ã„ã¦"></a>Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°ã§åºƒå ±ã•ã‚Œã‚‹çµŒè·¯ã«ã¤ã„ã¦</h2><p>ExpressRoute ã® Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’ã”åˆ©ç”¨ã®å ´åˆã€ãƒ«ãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®è¨­å®šã§ã©ã®ã‚ˆã†ãªçµŒè·¯ã‚’åºƒå ±ã™ã‚‹ã‹ã‚’è¨­å®šã—ã¾ã™ã€‚</p><p><strong>(ãƒ«ãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®è¨­å®šç”»é¢ - Azure ãƒãƒ¼ã‚¿ãƒ«)</strong><br><img src="/blog/network/judge-via-ms-peering/judge-via-ms-peering-01.png"> </p><p><strong>(å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰)</strong><br>å„ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§åºƒå ±ã•ã‚Œã‚‹çµŒè·¯ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã® PowerShell ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ã”ç¢ºèªã„ãŸã ã‘ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-AzBgpServiceCommunity</span><br></pre></td></tr></table></figure><p><strong>(å‡ºåŠ›ä¾‹ 1)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">$communities = Get-AzBgpServiceCommunity</span><br><span class="line">$communities | format-list</span><br><span class="line"></span><br><span class="line">Name               : Exchange</span><br><span class="line">Id                 : /subscriptions//resourceGroups//providers/Microsoft.Network/bgpServiceCommunities/Exchange</span><br><span class="line">Type               : Microsoft.Network/bgpServiceCommunities</span><br><span class="line">ServiceName        : Exchange</span><br><span class="line">BgpCommunities     : &#123;Exchange, Exchange IPv6&#125;</span><br><span class="line">BgpCommunitiesText : [</span><br><span class="line">                       &#123;</span><br><span class="line">                         &quot;ServiceSupportedRegion&quot;: &quot;Global&quot;,</span><br><span class="line">                         &quot;CommunityName&quot;: &quot;Exchange&quot;,</span><br><span class="line">                         &quot;CommunityValue&quot;: &quot;12076:5010&quot;,</span><br><span class="line">                         &quot;CommunityPrefixes&quot;: [</span><br><span class="line">                           &quot;13.107.6.152/31&quot;,</span><br><span class="line">                           &quot;13.107.18.10/31&quot;,</span><br><span class="line">                           &quot;13.107.128.0/22&quot;,</span><br><span class="line">                           &quot;23.103.160.0/20&quot;,</span><br><span class="line">                           &quot;40.92.0.0/15&quot;,</span><br><span class="line">                           &quot;40.96.0.0/13&quot;,</span><br><span class="line">                           &quot;40.104.0.0/15&quot;,</span><br><span class="line">                           &quot;40.107.0.0/16&quot;,</span><br><span class="line">                           &quot;52.96.0.0/14&quot;,</span><br><span class="line">                           &quot;52.100.0.0/14&quot;,</span><br><span class="line">                           &quot;52.238.78.88/32&quot;,</span><br><span class="line">                           &quot;104.47.0.0/17&quot;,</span><br><span class="line">                           &quot;131.253.33.215/32&quot;,</span><br><span class="line">                           &quot;132.245.0.0/16&quot;,</span><br><span class="line">                           &quot;150.171.32.0/22&quot;,</span><br><span class="line">                           &quot;204.79.197.215/32&quot;,</span><br><span class="line">                           &quot;13.107.128.0/24&quot;,</span><br><span class="line">                           &quot;13.107.129.0/24&quot;,</span><br><span class="line">                           &quot;150.171.32.0/24&quot;,</span><br><span class="line">                           &quot;150.171.34.0/24&quot;,</span><br><span class="line">                           &quot;150.171.35.0/24&quot;,</span><br><span class="line">                           &quot;52.96.38.0/24&quot;</span><br><span class="line">                         ],</span><br><span class="line">                         &quot;IsAuthorizedToUse&quot;: false,</span><br><span class="line">                         &quot;ServiceGroup&quot;: &quot;O365&quot;</span><br><span class="line">                       &#125;,</span><br><span class="line">                       &#123;</span><br><span class="line">                         &quot;ServiceSupportedRegion&quot;: &quot;Global&quot;,</span><br><span class="line">                         &quot;CommunityName&quot;: &quot;Exchange IPv6&quot;,</span><br><span class="line">                         &quot;CommunityValue&quot;: &quot;12076:5010&quot;,</span><br><span class="line">                         &quot;CommunityPrefixes&quot;: [</span><br><span class="line">                           &quot;2603:1006::/40&quot;,</span><br><span class="line">                           &quot;2603:1016::/36&quot;,</span><br><span class="line">                           &quot;2603:1026::/36&quot;,</span><br><span class="line">                           &quot;2603:1036::/36&quot;,</span><br><span class="line">                           &quot;2603:1046::/36&quot;,</span><br><span class="line">                           &quot;2603:1056::/36&quot;,</span><br><span class="line">                           &quot;2620:1ec:4::152/128&quot;,</span><br><span class="line">                           &quot;2620:1ec:4::153/128&quot;,</span><br><span class="line">                           &quot;2620:1ec:c::10/128&quot;,</span><br><span class="line">                           &quot;2620:1ec:c::11/128&quot;,</span><br><span class="line">                           &quot;2620:1ec:d::10/128&quot;,</span><br><span class="line">                           &quot;2620:1ec:d::11/128&quot;,</span><br><span class="line">                           &quot;2620:1ec:8f0::/46&quot;,</span><br><span class="line">                           &quot;2620:1ec:900::/46&quot;,</span><br><span class="line">                           &quot;2620:1ec:a92::152/128&quot;,</span><br><span class="line">                           &quot;2620:1ec:a92::153/128&quot;,</span><br><span class="line">                           &quot;2a01:111:f400::/48&quot;,</span><br><span class="line">                           &quot;2a01:111:f403::/48&quot;</span><br><span class="line">                         ],</span><br><span class="line">                         &quot;IsAuthorizedToUse&quot;: false,</span><br><span class="line">                         &quot;ServiceGroup&quot;: &quot;O365&quot;</span><br><span class="line">                       &#125;</span><br><span class="line">                     ]</span><br><span class="line"></span><br><span class="line">Name               : OtherOffice365Services</span><br><span class="line">Id                 : /subscriptions//resourceGroups//providers/Microsoft.Network/bgpServiceCommunities/OtherOffice365Se</span><br><span class="line">                     rvices</span><br><span class="line">Type               : Microsoft.Network/bgpServiceCommunities</span><br><span class="line">ServiceName        : OtherOffice365Services</span><br><span class="line">BgpCommunities     : &#123;Other Office 365 Services, Other Office 365 Services IPv6&#125;</span><br><span class="line">BgpCommunitiesText : [</span><br><span class="line">                       &#123;</span><br><span class="line">                         &quot;ServiceSupportedRegion&quot;: &quot;Global&quot;,</span><br><span class="line">                         &quot;CommunityName&quot;: &quot;Other Office 365 Services&quot;,</span><br><span class="line">                         &quot;CommunityValue&quot;: &quot;12076:5100&quot;,</span><br><span class="line">                         &quot;CommunityPrefixes&quot;: [</span><br><span class="line">                           &quot;13.107.6.171/32&quot;,</span><br><span class="line">                           &quot;13.107.6.192/32&quot;,</span><br><span class="line">                           &quot;13.107.9.192/32&quot;,</span><br><span class="line">                           &quot;13.107.18.15/32&quot;,</span><br><span class="line">                           &quot;13.107.140.6/32&quot;,</span><br><span class="line">                       (... çœç•¥)</span><br></pre></td></tr></table></figure><p><strong>(å‡ºåŠ›ä¾‹ 2)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$communities = Get-AzBgpServiceCommunity</span><br><span class="line">$communities.BgpCommunities | where &#123; $_.CommunityName -eq &#x27;Exchange&#x27; &#125;</span><br><span class="line"></span><br><span class="line">ServiceSupportedRegion : Global</span><br><span class="line">CommunityName          : Exchange</span><br><span class="line">CommunityValue         : 12076:5010</span><br><span class="line">CommunityPrefixes      : &#123;13.107.6.152/31, 13.107.18.10/31, 13.107.128.0/22, 23.103.160.0/20...&#125;</span><br><span class="line">IsAuthorizedToUse      : False</span><br><span class="line">ServiceGroup           : O365</span><br><span class="line">CommunityPrefixesText  : [</span><br><span class="line">                           &quot;13.107.6.152/31&quot;,</span><br><span class="line">                           &quot;13.107.18.10/31&quot;,</span><br><span class="line">                           &quot;13.107.128.0/22&quot;,</span><br><span class="line">                           &quot;23.103.160.0/20&quot;,</span><br><span class="line">                           &quot;40.92.0.0/15&quot;,</span><br><span class="line">                           &quot;40.96.0.0/13&quot;,</span><br><span class="line">                           &quot;40.104.0.0/15&quot;,</span><br><span class="line">                           &quot;40.107.0.0/16&quot;,</span><br><span class="line">                           &quot;52.96.0.0/14&quot;,</span><br><span class="line">                           &quot;52.100.0.0/14&quot;,</span><br><span class="line">                           &quot;52.238.78.88/32&quot;,</span><br><span class="line">                           &quot;104.47.0.0/17&quot;,</span><br><span class="line">                           &quot;131.253.33.215/32&quot;,</span><br><span class="line">                           &quot;132.245.0.0/16&quot;,</span><br><span class="line">                           &quot;150.171.32.0/22&quot;,</span><br><span class="line">                           &quot;204.79.197.215/32&quot;,</span><br><span class="line">                           &quot;13.107.128.0/24&quot;,</span><br><span class="line">                           &quot;13.107.129.0/24&quot;,</span><br><span class="line">                           &quot;150.171.32.0/24&quot;,</span><br><span class="line">                           &quot;150.171.34.0/24&quot;,</span><br><span class="line">                           &quot;150.171.35.0/24&quot;,</span><br><span class="line">                           &quot;52.96.38.0/24&quot;</span><br><span class="line">                         ]</span><br></pre></td></tr></table></figure><h2 id="å®›å…ˆãŒ-FQDN-ã®å ´åˆ"><a href="#å®›å…ˆãŒ-FQDN-ã®å ´åˆ" class="headerlink" title="å®›å…ˆãŒ FQDN ã®å ´åˆ"></a>å®›å…ˆãŒ FQDN ã®å ´åˆ</h2><p>é€šä¿¡å¯¾è±¡ãŒ IP ã®å ´åˆã€ä¸Šè¨˜ã®æ‰‹é †ã§ IP ã‚’ã”ç¢ºèªã„ãŸã ãã“ã¨ã§å¯¾è±¡ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒç¢ºèªå¯èƒ½ã§ã€ãƒ«ãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®è¨­å®šçŠ¶æ³ã«ã‚ˆã‚Š Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’çµŒç”±ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€å„ã‚µãƒ¼ãƒ“ã‚¹æ¯ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ ExpressRoute ã®å¯¾å¿œçŠ¶æ³ã«ã¤ã„ã¦è¨˜è¼‰ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>  [Office 365 ã® URL ã¨ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›²]<br>  <a href="https://docs.microsoft.com/ja-jp/office365/enterprise/urls-and-ip-address-ranges">https://docs.microsoft.com/ja-jp/office365/enterprise/urls-and-ip-address-ranges</a></p><p>  [Azure ExpressRoute ã¨ Azure Site Recovery]<br>  <a href="https://docs.microsoft.com/ja-jp/azure/site-recovery/concepts-expressroute-with-site-recovery">https://docs.microsoft.com/ja-jp/azure/site-recovery/concepts-expressroute-with-site-recovery</a></p><p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ãŒãªãã€å¯¾è±¡ãŒ FQDN ã®å ´åˆã«ã¯å€‹åˆ¥ã«èª¿æŸ»ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°è¦³ç‚¹ã¨ã—ã¦ã¯ IP ã‚’ç‰¹å®šã„ãŸã ãã“ã¨ã§çµŒç”±ã€éçµŒç”±ãŒåˆ¤æ–­å‡ºæ¥ã¾ã™ãŸã‚ã€èª¿æŸ»ã¨ã—ã¦ã¯å¯¾è±¡ã® FQDN ã«ç´ã¥ã IP æƒ…å ±ã«ã¤ã„ã¦ã”ç¢ºèªã„ãŸã ãå¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚</p><blockquote><p>å¯¾è±¡ã® FQDN ã«ç´ã¥ã IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®èª¿æŸ»ã«ã¤ã„ã¦ã¯ FQDN ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹æ¯ã«èª¿æŸ»ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã®ã§ã€ã”åˆ©ç”¨ã‚µãƒ¼ãƒ“ã‚¹å®›ã¦ã«ãŠå•ã„åˆã‚ã›ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</p></blockquote><p>å¯¾è±¡ã® FQDN ã«ã‚ˆã£ã¦ã¯ IP ãŒå›ºå®šã§ã‚ã‹ã‚‹å ´åˆã‚‚ã‚ã‚Œã°ã€æƒ…å ±å…¬é–‹ã•ã‚Œã¦ãŠã‚‰ãšä¸å®šã®å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚IP ãŒæ˜ç¢ºã«ç‰¹å®šã§ããªã„ã‚ˆã†ãªå ´åˆã«ã¯ Internet çµŒç”±ã§é€šä¿¡ã§ãã‚‹ã‚ˆã†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹æˆã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚</p><p>ä»¥ä¸Šã€ã”å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å±±å´ã§ã™ã€‚&lt;br&gt;ä»Šå›ã¯å¯¾è±¡ã®é€šä¿¡ãŒ Microsoft ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’çµŒç”±ã™ã‚‹ã‹ã©ã†ã‹ã®ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Microsoft-ãƒ”ã‚¢ãƒªãƒ³ã‚°ã§åºƒå ±ã•ã‚Œã‚‹çµŒè·¯ã«ã¤ã„ã¦&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
    <category term="Network" scheme="https://jpaztech.github.io/blog/tags/Network/"/>
    
    <category term="ExpressRoute" scheme="https://jpaztech.github.io/blog/tags/ExpressRoute/"/>
    
  </entry>
  
  <entry>
    <title>Azure Container Instances ã«å›ºå®šã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ä»¥å¤–ã®ä»£æ›¿æ¡ˆ</title>
    <link href="https://jpaztech.github.io/blog/containers/aci-fix-ip/"/>
    <id>https://jpaztech.github.io/blog/containers/aci-fix-ip/</id>
    <published>2023-11-15T03:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.108Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®ã‚·ãƒ³ã§ã™ã€‚</p><p>Azure Container Instances (ACI) ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã¯ã€é™çš„ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ (IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å›ºå®šã™ã‚‹) æ–¹æ³•ãŒã”ã–ã„ã¾ã›ã‚“ã€‚<br>æœ¬è¨˜äº‹ã§ã¯ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹å›ºå®šåŒ–ã«ä»£ã‚ã‚‹ä»£æ›¿æ¡ˆã«ã¤ã„ã¦ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚</p><span id="more"></span><hr><h2 id="ã‚³ãƒ³ãƒ†ãƒŠãƒ¼-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡"><a href="#ã‚³ãƒ³ãƒ†ãƒŠãƒ¼-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡" class="headerlink" title="ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡"></a>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡</h2><p>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¯ã€ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã€ã€ã€Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã€ã€ã€Œãªã—ã€ã®3ã¤ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã€ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã‚’é¸æŠã—ãŸå ´åˆã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®èµ·å‹•æ™‚ã«è‡ªå‹•çš„ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åœæ­¢ã™ã‚‹ã¨ã€ãã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®èµ·å‹•æ™‚ã«ã¯ã€æ–°ã—ã„ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p><p>ã€Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã€ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã‚’é¸æŠã—ãŸå ´åˆã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯æŒ‡å®šã•ã‚ŒãŸä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã€ãã®ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åœæ­¢ã™ã‚‹ã¨ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚æ¬¡å›ã®èµ·å‹•æ™‚ã«ã¯ã€ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§åˆ©ç”¨å¯èƒ½ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè‡ªå‹•çš„ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚å‰å›ä½¿ç”¨ã—ãŸãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã€Œãªã—ã€ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã‚’é¸æŠã—ãŸå ´åˆã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚ç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã€‚</p><div class="alert is-important"><p class="alert-title">é‡è¦</p><p>ã—ãŸãŒã£ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€ACIã®é–‹å§‹ã€èµ·å‹•ã‚‚ã—ãã¯å†èµ·å‹•ã«ã‚ˆã‚Šå¤‰æ›´ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã¾ãŸã€Azure Container Instances ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã¯ã€å›ºå®šã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹æ–¹æ³•ã¯æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p></div><p>ä¸€æ–¹ã§ã€ãŠå®¢æ§˜ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã‚„è¦ä»¶ã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå†èµ·å‹•ã—ã¦ã‚‚åŒã˜IPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«å®Ÿç¾ã—ãŸã„ã¨ã„ã†ã”è¦æœ›ãŒã‚ã‚‹ã‹ã¨å­˜ã˜ã¾ã™ã€‚ä»¥ä¸‹ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡ã”ã¨ã®ä»£æ›¿æ¡ˆã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚</p><h2 id="ãƒ‘ãƒ–ãƒªãƒƒã‚¯-ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦"><a href="#ãƒ‘ãƒ–ãƒªãƒƒã‚¯-ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦" class="headerlink" title="[ãƒ‘ãƒ–ãƒªãƒƒã‚¯] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦"></a>[ãƒ‘ãƒ–ãƒªãƒƒã‚¯] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦</h2><p>ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã‚’é¸æŠã™ã‚‹éš›ã«ã¯ã€DNSåãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹éš›ã«DNSåãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãã®DNSåãƒ©ãƒ™ãƒ«ã‹ã‚‰å§‹ã¾ã‚‹FQDNåãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã®ä»£ã‚ã‚Šã«ã€ã“ã®FQDNåã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚<br>DNSåãƒ©ãƒ™ãƒ«ã®æŒ‡å®šæ‰‹é †ã¯ã€å…¬é–‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ã”ç¢ºèªãã ã•ã„ã¾ã›ã€‚  </p><blockquote><p>ã”å‚è€ƒæƒ…å ±ï¼šAzure portalã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’Azureå†…ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/container-instances/container-instances-quickstart-portal">https://learn.microsoft.com/ja-jp/azure/container-instances/container-instances-quickstart-portal</a></p></blockquote><blockquote><p>ã”å‚è€ƒæƒ…å ±ï¼šAzure CLIã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’Azureã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/container-instances/container-instances-quickstart">https://learn.microsoft.com/ja-jp/azure/container-instances/container-instances-quickstart</a></p></blockquote><h2 id="ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ-ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦"><a href="#ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ-ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦" class="headerlink" title="[ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ] ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦"></a>[ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ] ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã«ã¤ã„ã¦</h2><p>[ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ] ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¨®é¡ã®å ´åˆã€ä»¥ä¸‹2ã¤ã®ä»£æ›¿æ¡ˆã‚’æŒ™ã’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><h3 id="æ¡ˆ1-ã‚³ãƒ³ãƒ†ãƒŠãƒ¼-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰æ®µã«-Application-Gateway-ã‚’é…ç½®ã™ã‚‹"><a href="#æ¡ˆ1-ã‚³ãƒ³ãƒ†ãƒŠãƒ¼-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰æ®µã«-Application-Gateway-ã‚’é…ç½®ã™ã‚‹" class="headerlink" title="æ¡ˆ1: ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰æ®µã« Application Gateway ã‚’é…ç½®ã™ã‚‹"></a>æ¡ˆ1: ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰æ®µã« Application Gateway ã‚’é…ç½®ã™ã‚‹</h3><p>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰æ®µã« Application Gateway ã‚’é…ç½®ã—ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å´å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã¯ãªãã€Application Gateway ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸé™çš„ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚  </p><blockquote><p>ã”å‚è€ƒæƒ…å ±ï¼šã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚°ãƒ«ãƒ¼ãƒ—ã®é™çš„ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ - Azure Container Instances | Microsoft Docs<br><a href="https://learn.microsoft.com/ja-jp/azure/container-instances/container-instances-application-gateway">https://learn.microsoft.com/ja-jp/azure/container-instances/container-instances-application-gateway</a></p></blockquote><div class="alert is-important"><p class="alert-title">é‡è¦</p><p>ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®åœæ­¢ã€èµ·å‹•ã‚‚ã—ãã¯å†èµ·å‹•ã«ã‚ˆã‚Šã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰æ›´ã¨ãªã£ãŸå ´åˆã€æ‰‹å‹•ã§Application Gateway ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è¨­å®šã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã“ã®ä»•çµ„ã¿ã‚’è‡ªå‹•åŒ–ã—ãŸã„å ´åˆã¯ã€Azure Automation ãªã©ã‚’ã”åˆ©ç”¨ã„ãŸã ãã€ãŠå®¢æ§˜ã«ã¦è‡ªå‹•åŒ–ã®ä»•çµ„ã¿ã‚’ã”æ§‹ç¯‰ã„ãŸã ãå¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚</p></div><h3 id="æ¡ˆï¼’-DNS-åã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã‚‹-ã‚³ãƒ³ãƒ†ãƒŠãƒ¼-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•æ™‚ã«-DNS-ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°"><a href="#æ¡ˆï¼’-DNS-åã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã‚‹-ã‚³ãƒ³ãƒ†ãƒŠãƒ¼-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•æ™‚ã«-DNS-ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°" class="headerlink" title="æ¡ˆï¼’: DNS åã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã‚‹ (ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•æ™‚ã« DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°)"></a>æ¡ˆï¼’: DNS åã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã‚‹ (ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•æ™‚ã« DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°)</h3><p>IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä»£ã‚ã‚Šã«ã€å¤–éƒ¨ã‹ã‚‰å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å (FQDN) ã‚’åˆ©ç”¨ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚<br>å®Ÿç¾æ–¹æ³•ã¨ã—ã¦ã€init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ã€ç’°å¢ƒã®åˆæœŸåŒ–ã®ç”¨é€”ãªã©ã§ä½¿ç”¨ã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã§ã™ã€‚<br>init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã€Azure ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«åˆ°é”ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ DNS ã‚¨ãƒ³ãƒˆãƒªã‚’æ›´æ–°ã—ã¾ã™ã€‚ init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¯åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¹ã‚¿ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã€init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‹ã‚‰å‚ç…§å¯èƒ½ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã§ä½¿ç”¨ã•ã‚Œã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åŒã˜ã§ã™ã€‚<br>ä»¥ä¸‹ã¯ã€å®Ÿç¾æ‰‹é †ã¨ãªã‚Šã¾ã™ã€‚</p><p>ï¼‘ã€ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚„ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rg=myResourceGroup</span><br><span class="line">aci_name=myaci</span><br><span class="line">vnet_name=aci-vnet</span><br><span class="line">az group create --name $rg --location japaneast</span><br><span class="line">az network vnet create --resource-group $rg --name aci-vnet --address-prefixes 10.0.0.0/16 --subnet-name aci-subnet --subnet-prefix 10.0.0.0/24</span><br><span class="line">aci_subnet_id=$(az network vnet subnet update --resource-group $rg --name aci-subnet --vnet-name $vnet_name   --delegations Microsoft.ContainerInstance/containerGroups  --query id -o tsv)</span><br></pre></td></tr></table></figure><p>ï¼’ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ DNS ã‚¾ãƒ¼ãƒ³ã‚’æ“ä½œã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‹ã‚‰ã¯è©²å½“ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ DNS ã‚¾ãƒ¼ãƒ³ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã™ã€‚  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scope=$(az group show -n $rg --query id -o tsv)</span><br><span class="line">new_sp=$(az ad sp create-for-rbac --scopes $scope --role Contributor --name acilabsp -o json)</span><br><span class="line">sp_appid=$(echo $new_sp | jq -r &#x27;.appId&#x27;) &amp;&amp; echo $sp_appid</span><br><span class="line">sp_tenant=$(echo $new_sp | jq -r &#x27;.tenant&#x27;) &amp;&amp; echo $sp_tenant</span><br><span class="line">sp_password=$(echo $new_sp | jq -r &#x27;.password&#x27;)</span><br></pre></td></tr></table></figure><p>ï¼“ã€init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã§å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€è©²å½“ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’Azure Filesã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚<br>init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¯ã€è©²å½“ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’Azure Filesã‹ã‚‰ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã¨ã€ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«ã€init ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã§è©²å½“ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">storage_account_name=&quot;acilab$RANDOM&quot;</span><br><span class="line">az storage account create -n $storage_account_name -g $rg --sku Standard_LRS --kind StorageV2</span><br><span class="line">storage_account_key=$(az storage account keys list --account-name $storage_account_name -g $rg --query &#x27;[0].value&#x27; -o tsv)</span><br><span class="line">az storage share create --account-name $storage_account_name --account-key $storage_account_key --name initscript</span><br><span class="line">init_script_filename=init.sh</span><br><span class="line">init_script_path=/tmp/</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; $&#123;init_script_path&#125;$&#123;init_script_filename&#125;</span><br><span class="line">echo &quot;Logging into Azure...&quot;</span><br><span class="line">az login --service-principal -u \$SP_APPID -p \$SP_PASSWORD --tenant \$SP_TENANT</span><br><span class="line">echo &quot;Finding out IP address...&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> my_private_ip=\$(az container show -n \<span class="variable">$ACI_NAME</span> -g \<span class="variable">$RG</span> --query <span class="string">&#x27;ipAddress.ip&#x27;</span> -o tsv) &amp;&amp; <span class="built_in">echo</span> \<span class="variable">$my_private_ip</span></span></span><br><span class="line">my_private_ip=\$(ifconfig eth0 | grep &#x27;inet addr&#x27; | cut -d: -f2 | cut -d&#x27; &#x27; -f 1) &amp;&amp; echo \$my_private_ip</span><br><span class="line">echo &quot;Deleting previous record if there was oneâ€¦&quot;</span><br><span class="line">az network private-dns record-set a delete -n \$HOSTNAME -z \$DNS_ZONE_NAME -g \$RG -y</span><br><span class="line">echo &quot;Creating DNS record...&quot;</span><br><span class="line">az network private-dns record-set a create -n \$HOSTNAME -z \$DNS_ZONE_NAME -g \$RG</span><br><span class="line">az network private-dns record-set a add-record --record-set-name \$HOSTNAME -z \$DNS_ZONE_NAME -g \$RG -a \$my_private_ip</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">az storage file upload --account-name $storage_account_name --account-key $storage_account_key -s initscript --source $&#123;init_script_path&#125;$&#123;init_script_filename&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã® YAML å®šç¾©ã‚’ä½œæˆã—ã¾ã™ã€‚ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create YAML</span></span><br><span class="line">aci_yaml_file=/tmp/acilab.yaml</span><br><span class="line">cat &lt;&lt;EOF &gt; $aci_yaml_file</span><br><span class="line">apiVersion: &#x27;2023-05-01&#x27;</span><br><span class="line">location: $location</span><br><span class="line">name: $aci_name</span><br><span class="line">properties:</span><br><span class="line">  subnetIds:</span><br><span class="line">  - id: $aci_subnet_id</span><br><span class="line">  initContainers:</span><br><span class="line">  - name: azcli</span><br><span class="line">    properties:</span><br><span class="line">      image: mcr.microsoft.com/azure-cli:latest</span><br><span class="line">      command:</span><br><span class="line">      - &quot;/bin/sh&quot;</span><br><span class="line">      - &quot;-c&quot;</span><br><span class="line">      - &quot;/mnt/init/$init_script_filename&quot;</span><br><span class="line">      environmentVariables:</span><br><span class="line">      - name: RG</span><br><span class="line">        value: $rg</span><br><span class="line">      - name: SP_APPID</span><br><span class="line">        value: $sp_appid</span><br><span class="line">      - name: SP_PASSWORD</span><br><span class="line">        secureValue: $sp_password</span><br><span class="line">      - name: SP_TENANT</span><br><span class="line">        value: $sp_tenant</span><br><span class="line">      - name: DNS_ZONE_NAME</span><br><span class="line">        value: $dns_zone_name</span><br><span class="line">      - name: HOSTNAME</span><br><span class="line">        value: $aci_name</span><br><span class="line">      - name: ACI_NAME</span><br><span class="line">        value: $aci_name</span><br><span class="line">      volumeMounts:</span><br><span class="line">      - name: initscript</span><br><span class="line">        mountPath: /mnt/init/</span><br><span class="line">  containers:</span><br><span class="line">  - name: aci-helloworld</span><br><span class="line">    properties:</span><br><span class="line">      image: mcr.microsoft.com/azuredocs/aci-helloworld</span><br><span class="line">      ports:</span><br><span class="line">      - port: 80</span><br><span class="line">        protocol: TCP</span><br><span class="line">      resources:</span><br><span class="line">        requests:</span><br><span class="line">          cpu: 1.0</span><br><span class="line">          memoryInGB: 1.5</span><br><span class="line">  volumes:</span><br><span class="line">  - name: initscript</span><br><span class="line">    azureFile:</span><br><span class="line">      readOnly: false</span><br><span class="line">      shareName: initscript</span><br><span class="line">      storageAccountName: $storage_account_name</span><br><span class="line">      storageAccountKey: $storage_account_key</span><br><span class="line">  ipAddress:</span><br><span class="line">    ports:</span><br><span class="line">    - port: 80</span><br><span class="line">      protocol: TCP</span><br><span class="line">    type: Private</span><br><span class="line">  osType: Linux</span><br><span class="line">tags: null</span><br><span class="line">type: Microsoft.ContainerInstance/containerGroups</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>5ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az container create -g $rg --file $aci_yaml_file</span><br></pre></td></tr></table></figure><p>Nginxã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’DNSåã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ä¾‹ã‚‚ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ </p><blockquote><p>ã”å‚è€ƒæƒ…å ±ï¼šã‚µã‚¤ãƒ‰ã‚«ãƒ¼ ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’ä½¿ç”¨ã—ã¦ Azure Container Instances ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹Docs<br><a href="https://learn.microsoft.com/ja-jp/training/modules/secure-apps-azure-container-instances-sidecar/4-deploy-sidecar">https://learn.microsoft.com/ja-jp/training/modules/secure-apps-azure-container-instances-sidecar/4-deploy-sidecar</a></p></blockquote><h2 id="ã•ã„ã”ã«"><a href="#ã•ã„ã”ã«" class="headerlink" title="ã•ã„ã”ã«"></a>ã•ã„ã”ã«</h2><p>Application Gatewayã¯OSIãƒ¬ã‚¤ãƒ¤ãƒ¼7ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ãªã‚Šã¾ã™ã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰æ®µã«Application Gatewayã‚’é…ç½®ã™ã‚‹æ¡ˆã«ã¤ãã¾ã—ã¦ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å†—é•·åŒ–é…ç½®ã™ã‚‹å ´åˆã§ã‚‚ã€æ§‹æˆã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãå¯¾å¿œå¯èƒ½ã§ã™ã€‚ã¾ãŸã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼æ©Ÿèƒ½ä»¥å¤–ã«ã‚‚ã€TLSçµ‚ç«¯ãªã©ã®æ©Ÿèƒ½ã‚‚å‚™ãˆã¦ã„ã¾ã™ã®ã§ã€æ§˜ã€…ãªã‚·ãƒŠãƒªã‚ªã«å¯¾å¿œå¯èƒ½ã§ã™ã€‚ä¸€æ–¹ã€Application Gatewayã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€æ§‹æˆãŒè¤‡é›‘ã«ãªã‚‹ç‚¹ã¯ç•™æ„ãŒå¿…è¦ã§ã™ã€‚<br>DNSåã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã„ã†æ¡ˆã«ã¤ã„ã¦ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨Azureãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆDNSã‚¾ãƒ¼ãƒ³æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚Œã°ã€ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿç¾å¯èƒ½ã§ã™ã€‚ãŸã ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å (FQDN) ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  </p><p>ä»¥ä¸Šã§ã€Azureã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹IPã‚’å›ºå®šã™ã‚‹ä»£æ›¿æ¡ˆã‚’ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚ æœ¬ç¨¿ãŒãŠå½¹ã«ç«‹ã¦ã‚Œã°å¹¸ã„ã§ã™ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã®ã‚·ãƒ³ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;Azure Container Instances (ACI) ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã¯ã€é™çš„ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ (IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å›ºå®šã™ã‚‹) æ–¹æ³•ãŒã”ã–ã„ã¾ã›ã‚“ã€‚&lt;br&gt;æœ¬è¨˜äº‹ã§ã¯ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹å›ºå®šåŒ–ã«ä»£ã‚ã‚‹ä»£æ›¿æ¡ˆã«ã¤ã„ã¦ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Containers" scheme="https://jpaztech.github.io/blog/tags/Containers/"/>
    
    <category term="Azure Container Instances (ACI)" scheme="https://jpaztech.github.io/blog/tags/Azure-Container-Instances-ACI/"/>
    
  </entry>
  
  <entry>
    <title>Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®å‹•ä½œå¤‰æ›´ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã«é–¢ã™ã‚‹è£œè¶³ (Tracking ID:3T84-PZZ) </title>
    <link href="https://jpaztech.github.io/blog/network/default-outbound-access-for-vms-will-be-retired/"/>
    <id>https://jpaztech.github.io/blog/network/default-outbound-access-for-vms-will-be-retired/</id>
    <published>2023-10-11T06:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.176Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã§ã™ã€‚</p><p>2023 å¹´ 9 æœˆæœ«ã€Azure ãŒæ—¢å®šã§æä¾›ã—ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå‘ã‘ã¸ã®å¤–éƒ¨æ¥ç¶šç”¨ã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã‚’ã€2025 å¹´ 9 æœˆ 30 æ—¥ã®ç¿Œæ—¥ã‹ã‚‰é™å®šçš„ã«çµ‚äº†ã™ã‚‹ã“ã¨ãŒã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã•ã‚Œã¾ã—ãŸ(Tracking ID:3T84-PZZ)ã€‚<br>ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã•ã‚ŒãŸå†…å®¹ã¯è‹±èªã§ã®ã”æ¡ˆå†…ã§ã‚ã£ãŸã‚Šã€å¯¾å‡¦æ–¹æ³•ã®ã”èª¬æ˜ãªã©ã‚’çœç•¥ã•ã›ã¦ã„ãŸã ã„ãŸæ¦‚è¦ã§ã®ã”æ¡ˆå†…ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã®ã§ã€ã“ã®è¨˜äº‹ã«ã¦è£œè¶³ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><h2 id="ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã®æ¦‚è¦"><a href="#ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã®æ¦‚è¦" class="headerlink" title="[ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã®æ¦‚è¦]"></a>[ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã®æ¦‚è¦]</h2><p>2025 å¹´ 10 æœˆ 1 æ—¥ä»¥é™ã«ä½œæˆã•ã‚ŒãŸæ–°ã—ã„ Azure VM ã¯ã€Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ (æ—¢å®šã® SNAT) ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå®›ã¸ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ãŒã§ããªããªã‚Šã¾ã™ã€‚<br>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå®›ã¸ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šãŒå¿…è¦ãªå ´åˆã«ã¯ã€æ˜ç¤ºçš„ãªé€ä¿¡æ¥ç¶šã®è¨­å®šãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚<br><strong>2025 å¹´ 10 æœˆ 1 æ—¥ã‚ˆã‚Šã‚‚å‰ã«ä½œæˆã—ã¦ã„ã‚‹æ—¢å­˜ã® Azure VM ã¯ã€ç¾çŠ¶ã€æœ¬é€šçŸ¥ã®å¯¾è±¡å¤–ã¨ãªã‚‹ãŸã‚å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ãŒæ˜ç¤ºçš„ã«é€ä¿¡æ¥ç¶šã®è¨­å®šã‚’åŠ ãˆã¦ã„ãŸã ãã“ã¨ã‚’æ¨å¥¨ã¨ã—ã¦ã„ã¾ã™ã€‚</strong><br>æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã¨ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«é€ä¿¡æ¥ç¶šã®æŒ‡å®šã‚’ã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€Azure VM ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚å…·ä½“çš„ã«ã¯ã€Azure ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸Šã§ä½¿ã‚ã‚Œã¦ã„ãªã„ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¸€æ™‚çš„ã«å€Ÿã‚Šã¦ SNAT ã‚’è¡Œã„ã¾ã™ã€‚</p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="[FAQ]"></a>[FAQ]</h2><p>Q1. Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã‹ã¯ã©ã®ã‚ˆã†ã«åˆ¤æ–­ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</p><p>A1. å½“ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®ä»¥ä¸‹ã®è¨˜äº‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€Œåˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€ã‚’ã”ç¢ºèªã®ä¸Šã€Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã”åˆ©ç”¨ã„ãŸã ã„ã¦ã„ã‚‹ã‹åˆ¤æ–­ãã ã•ã„ã€‚</p><p><a href="https://jpaztech.github.io/blog/network/snat-options-for-azure-vm/#%E5%88%A4%E5%AE%9A%E3%83%95%E3%83%AD%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88">Azure VM ã®å¤–éƒ¨æ¥ç¶š (SNAT) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ã¾ã¨ã‚ - åˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ | Japan Azure IaaS Core Support Blog</a></p><p>Q2. æ˜ç¤ºçš„ãªé€ä¿¡æ¥ç¶šæ–¹æ³•ãŒæ§˜ã€…ã‚ã‚Šã¾ã™ãŒã€ã©ã®é€ä¿¡æ¥ç¶šæ–¹æ³•ã‚’åˆ©ç”¨ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</p><p>A2. ç¾åœ¨ã€æ˜ç¤ºçš„ãªé€ä¿¡æ¥ç¶šæ–¹æ³•ã¯ã€4 ãƒ‘ã‚¿ãƒ¼ãƒ³ã”ã–ã„ã¾ã™ãŒã€å„æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã£ã¦ç‰¹æ€§ãŒç•°ãªã‚Šã¾ã™ã€‚<br>å½“ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®ä»¥ä¸‹ã®è¨˜äº‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€Œæ§‹æˆã®æ¯”è¼ƒã€ã‚’ã”ç¢ºèªã®ä¸Šã€ãŠå®¢æ§˜ã®é€šä¿¡è¦ä»¶ã«åˆã£ãŸæ˜ç¤ºçš„ãªé€ä¿¡æ¥ç¶šæ–¹æ³•ã‚’ã”åˆ©ç”¨ä¸‹ã•ã„ã€‚</p><p><a href="https://jpaztech.github.io/blog/network/snat-options-for-azure-vm/#%E6%A7%8B%E6%88%90%E3%81%AE%E6%AF%94%E8%BC%83">Azure VM ã®å¤–éƒ¨æ¥ç¶š (SNAT) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ã¾ã¨ã‚ - æ§‹æˆã®æ¯”è¼ƒ | Japan Azure IaaS Core Support Blog</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;2023 å¹´ 9 æœˆæœ«ã€Azure ãŒæ—¢å®šã§æä¾›ã—ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå‘ã‘ã¸ã®å¤–éƒ¨æ¥ç¶šç”¨ã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã‚’ã€2025 å¹´ 9 æœˆ 30 æ—¥ã®ç¿Œæ—¥ã‹ã‚‰é™å®šçš„ã«çµ‚äº†ã™ã‚‹ã“ã¨ãŒã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã•ã‚Œã¾ã—</summary>
      
    
    
    
    
    <category term="Network" scheme="https://jpaztech.github.io/blog/tags/Network/"/>
    
    <category term="Public IP Address" scheme="https://jpaztech.github.io/blog/tags/Public-IP-Address/"/>
    
    <category term="NAT Gateway" scheme="https://jpaztech.github.io/blog/tags/NAT-Gateway/"/>
    
    <category term="Azure Load Balancer" scheme="https://jpaztech.github.io/blog/tags/Azure-Load-Balancer/"/>
    
    <category term="SNAT" scheme="https://jpaztech.github.io/blog/tags/SNAT/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM ã®é€ä¿¡æ¥ç¶š (SNAT) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ã¾ã¨ã‚</title>
    <link href="https://jpaztech.github.io/blog/network/snat-options-for-azure-vm/"/>
    <id>https://jpaztech.github.io/blog/network/snat-options-for-azure-vm/</id>
    <published>2023-09-30T09:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.188Z</updated>
    
    <content type="html"><![CDATA[<p>Azure Networking ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å±±å£ã§ã™ã€‚</p><p>Azure ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå®›ã¦ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ–¹å‘ã®æ¥ç¶š (é€ä¿¡æ¥ç¶š) ã‚’ã„ãã¤ã‹ã®æ–¹æ³•ã§å®Ÿè£…ã§ãã¾ã™ã€‚é¸æŠã®å¹…ãŒã‚ã‚‹ã“ã¨ã¯å–œã°ã—ã„ã§ã™ãŒã€ä¸€æ–¹ã§å†…å®¹ã®æŠŠæ¡ã®ãŒé›£ã—ã„å´é¢ã‚‚å¦ã‚ã¾ã›ã‚“ã€‚ãã“ã§æœ¬è¨˜äº‹ã§ã¯ã€Azure VM ã«ä½¿ãˆã‚‹é€ä¿¡æ¥ç¶šã®æ§‹æˆã‚’ã¾ã¨ã‚ã¦èª¬æ˜ã—ã¾ã™ã€‚ã¾ãŸã€ã‚ã‚‹ Azure VM ãŒã©ã®æ§‹æˆã«è©²å½“ã—ã¦ã„ã‚‹ã‹åˆ¤å®šã™ã‚‹ãŸã‚ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚„ã€å„æ§‹æˆã®ç‰¹å¾´ã«ã¤ã„ã¦ã‚‚ä½µã›ã¦ç´¹ä»‹ã—ã¾ã™ã€‚</p><div class="alert is-info"><p class="alert-title">Note</p><p><span style="color: #c00000;">2023 å¹´ 9 æœˆã€é€ä¿¡æ¥ç¶šã®æ§‹æˆã®ä¸€ã¤ã§ã‚ã‚‹<a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/default-outbound-access">æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹</a>ã®æä¾›çµ‚äº†ãŒã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã•ã‚Œã¾ã—ãŸã€‚</span></p><p>ã“ã‚Œã¯ã€2025 å¹´ 9 æœˆ 30 æ—¥ä»¥é™ã«ä½œæˆã•ã‚ŒãŸ Azure VM ã¯ã€å¾Œè¿°ã® Azure æ—¢å®šã® SNAT ãŒå»ƒæ­¢ã•ã‚Œã€æ˜ç¤ºçš„ãªå¤–éƒ¨æ¥ç¶šãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ãªã„é™ã‚Šã€Azure ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®å¤–éƒ¨é€ä¿¡ãŒè¡Œãˆãªããªã‚‹ã¨ã„ã†å†…å®¹ã§ã™ã€‚å»ƒæ­¢ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã«é–¢ã™ã‚‹è£œè¶³ã«ã¤ã„ã¦ã¯ã€å½“ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®ä»¥ä¸‹ã®è¨˜äº‹ã‚’ã”å‚ç…§ã®ä¸Šã€æŠ€è¡“çš„ãªå†…å®¹ã«ã¤ã„ã¦ã¯ä½µã›ã¦æœ¬è¨˜äº‹ã‚’ã”ç¢ºèªã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚</p><p><a href="https://jpaztech.github.io/blog/network/default-outbound-access-for-vms-will-be-retired/">Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®å‹•ä½œå¤‰æ›´ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã«é–¢ã™ã‚‹è£œè¶³ (Tracking ID:3T84-PZZ)</a></p></div><span id="more"></span><h2 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h2><p>Azure VM ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (VNet) ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒªã‚½ãƒ¼ã‚¹ã¯ã€å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€Web ãƒ–ãƒ©ã‚¦ã‚¶ãŒ TLS/SSL è¨¼æ˜æ›¸ã®å¤±åŠ¹ã‚’æ¤œè¨¼ã™ã‚‹å ´åˆã‚„ã€å¤–éƒ¨ã®æ¨©å¨ DNS ã‚µãƒ¼ãƒãƒ¼ã«å†å¸°å•ã„åˆã‚ã›ã‚’å®Ÿæ–½ã™ã‚‹å ´åˆãªã©ã§ã™ã€‚ã“ã®æ¥ç¶šã¯ã€Azure ã‹ã‚‰å¤–éƒ¨ã«å‡ºã¦ã„ãã‚ˆã†ã«è¦‹ãˆã‚‹ã“ã¨ã‹ã‚‰ã€ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ–¹å‘ã®æ¥ç¶šã‚ã‚‹ã„ã¯ <strong>é€ä¿¡æ¥ç¶š</strong> ã¨å‘¼ã°ã‚Œã¾ã™ã€‚</p><p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ãƒ›ã‚¹ãƒˆã¨é€šä¿¡ã™ã‚‹ãŸã‚ã«ã€ãƒ‘ã‚±ãƒƒãƒˆã®é€ä¿¡å…ƒã¨å®›å…ˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å…±ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ (ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚¢ãƒ‰ãƒ¬ã‚¹) ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«ã€é€ä¿¡æ¥ç¶šã®æ–‡è„ˆã§ã¯ã€å®›å…ˆã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚‹ã“ã¨ãŒç¢ºå®šã—ã¦ã„ã‚‹ãŸã‚ã€é€ä¿¡å…ƒã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã„ã‹ã«ã—ã¦ç¢ºä¿ã™ã‚‹ã‹ãŒé‡è¦ã¨ãªã‚Šã¾ã™ã€‚</p><p>ä¸€èˆ¬ã«ã€ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã¯å¤§ããï¼’ã¤ã‚ã‚Šã¾ã™ã€‚</p><ol><li>é€ä¿¡å…ƒã®ãƒ›ã‚¹ãƒˆ (ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹) ã«ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚ã“ã‚Œã§é€ä¿¡å…ƒãƒ›ã‚¹ãƒˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ« ã‚¢ãƒ‰ãƒ¬ã‚¹å¸¯ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«å‚åŠ ã—ã¦ã„ã‚‹çŠ¶æ…‹ã¨ãªã‚Šã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ä»‹ã—ã¦å®›å…ˆãƒ›ã‚¹ãƒˆã¨ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ„ãƒ¼ãƒ»ã‚¨ãƒ³ãƒ‰ãªé€šä¿¡ãŒè¡Œãˆã¾ã™ã€‚</li><li>é€ä¿¡å…ƒã®ãƒ›ã‚¹ãƒˆã«ã¯ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚ãã®ä»£ã‚ã‚Šã€é€ä¿¡å…ƒãƒ›ã‚¹ãƒˆã®å¤–éƒ¨ã«ã‚ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è£…ç½®ã§ã€é€ä¿¡å…ƒ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ã—ã¾ã™ã€‚</li></ol><p>ã“ã®ã†ã¡ã€Azure ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã®ã¯ 2 ç•ªç›®ã®æ–¹æ³•ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ› (Network Address Translation; NAT) ã¨å‘¼ã°ã‚Œã‚‹æŠ€è¡“ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ç‰¹ã«é€ä¿¡å…ƒã‚’å¤‰æ›ã™ã‚‹ã®ã§é€ä¿¡å…ƒ NAT (Source NAT; SNAT) ã¨å‘¼ã°ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚Azure ã§ã¯ã€ä»®æƒ³åŒ–åŸºç›¤ã«å®Ÿè£…ã•ã‚ŒãŸä»®æƒ³çš„ãªãƒ«ãƒ¼ã‚¿ãƒ¼ (å„ã‚µãƒ–ãƒãƒƒãƒˆã®æœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ–ãƒ« ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ›ã‚¹ãƒˆã•ã‚Œã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤) ãŒã€Azure VM ã®ãƒ‘ã‚±ãƒƒãƒˆã«å¯¾ã—ã¦ SNAT ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ NAT è£…ç½®ã¨å‘¼ã³ã¾ã™ã€‚</p><p>SNAT ã®å®Ÿç¾æ–¹æ³•ã¯ã€ã•ã‚‰ã« 2 ã¤ã®æ–¹å¼ã«ç´°åˆ†åŒ–ã§ãã¾ã™ã€‚</p><ul><li><strong>Basic NAT</strong>: 2 ã¤ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ 1 å¯¾ 1 ã®é–¢ä¿‚ã§å¤‰æ›ã™ã‚‹ NAT ã§ã™ã€‚ç‹­ç¾©ã® NAT ã¨å‘¼ã°ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚NAT è£…ç½®ä¸Šã§ã¯ã€å˜ç´”ã«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¯¾å¿œä»˜ã‘ã‚’è¦šãˆã¦ãŠãã ã‘ã§è‰¯ã„ã®ã§ã€ãã‚Œä»¥ä¸Šã®ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ãŒä¸è¦ã§ã™ã€‚</li><li><strong>NAPT (Network Address Port Translation)</strong>: ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„ãƒãƒ¼ãƒˆç•ªå·ã®æƒ…å ±ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ 1 å¯¾å¤šã®é–¢ä¿‚ã§å¤‰æ›ã§ãã‚‹ NAT ã§ã™ã€‚ãŸã¨ãˆã°ã€è¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«åŒã˜ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã® SNAT ã‚’æä¾›ã§ãã¾ã™ã€‚NAT è£…ç½®ã¯ã€5 ã‚¿ãƒ—ãƒ« (ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€é€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹ã€é€ä¿¡å…ƒãƒãƒ¼ãƒˆç•ªå·ã€å®›å…ˆã‚¢ãƒ‰ãƒ¬ã‚¹ã€å®›å…ˆãƒãƒ¼ãƒˆç•ªå·) ã§ãƒ•ãƒ­ãƒ¼ã‚’ä¸€æ„ã«è­˜åˆ¥ã—ã€ãƒ•ãƒ­ãƒ¼ã”ã¨ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¯¾å¿œä»˜ã‘ã‚’ NAT ãƒ†ãƒ¼ãƒ–ãƒ«ã¨å‘¼ã°ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜éŒ²ã—ã¾ã™ã€‚</li></ul><p>ç‰¹ã«ã€å¾Œè€…ã® NAPT ã«ã‚ˆã‚‹ SNAT ã§ã¯<strong>SNAT ãƒãƒ¼ãƒˆæ¯æ¸‡</strong>ã«ç•™æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>NAPT ã‚’ä½¿ç”¨ã—ã¦è¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å…±é€šã® SNAT ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã¨ã€å½“ç„¶ SNAT å¾Œã®é€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹ã¯åŒã˜ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ã•ã‚‰ã«ã€é€šä¿¡å…ˆã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€å®›å…ˆã‚¢ãƒ‰ãƒ¬ã‚¹ã€å®›å…ˆãƒãƒ¼ãƒˆç•ªå·) ãŒåŒã˜ã§ã‚ã‚‹å ´åˆã¯ã€ãƒ•ãƒ­ãƒ¼ã‚’è­˜åˆ¥ã§ãã‚‹æƒ…å ±ã¯ 5 ã‚¿ãƒ—ãƒ«ã®ã†ã¡é€ä¿¡å…ƒãƒãƒ¼ãƒˆç•ªå· (SNAT ãƒãƒ¼ãƒˆ) ã ã‘ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€åŒä¸€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®›ã¦ã®æ¥ç¶šãŒç™ºç”Ÿã™ã‚‹ãŸã³ã« SNAT ãƒãƒ¼ãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‹ (æ¶ˆè²»ã™ã‚‹) å¿…è¦ãŒã‚ã‚Šã€ãƒãƒ¼ãƒˆç•ªå·ã‚’ä½¿ã„åˆ‡ã‚‹ã¨ãã‚Œä»¥é™ã®é€ä¿¡æ¥ç¶šãŒå¤±æ•—ã—ã¾ã™ã€‚</p><p>SNAT ãƒãƒ¼ãƒˆãŒã©ã®ã‚ˆã†ã«æ¶ˆè²»ã•ã‚Œã‚‹ã‹ã‚’ç¤ºã™ãŸã‚ã€æ¬¡ã®ã‚ˆã†ãªã‚·ãƒŠãƒªã‚ªã‚’è€ƒãˆã¾ã™ã€‚SNAT è£…ç½®ãŒã€ã‚ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ (<code>SNAT</code>) ã‚’ä½¿ã£ã¦ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã ã‘ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸ Azure VM #1 (<code>10.0.0.4</code>) ã¨ #2 (<code>10.0.0.5</code>) ã«å¯¾ã—ã¦ NAPT ã«ã‚ˆã‚‹ SNAT ã‚’æä¾›ã—ã¾ã™ã€‚VM é–“ã§ SNAT ãƒãƒ¼ãƒˆã®å¥ªã„åˆã„ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã€å„ VM ã« 100 å€‹ãšã¤ SNAT ãƒãƒ¼ãƒˆã‚’äº‹å‰ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚</p><p><img src="/blog/network/snat-options-for-azure-vm/snat-port-exhaustion.png" alt="snat-port-exhaustion"></p><p>ã“ã“ã§ã€VM ã‹ã‚‰ Web ã‚µãƒ¼ãƒãƒ¼ (<code>WEB</code>) ã«å¯¾ã™ã‚‹å¤§é‡ã® HTTP ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç™ºç”Ÿã•ã›ã¾ã—ãŸã€‚ã“ã®é€šä¿¡ã¯ã€[ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€å®›å…ˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€å®›å…ˆãƒãƒ¼ãƒˆ] ãŒã™ã¹ã¦åŒä¸€ (<code>TCP, WEB:80</code>) ã§ã‚ã‚‹ã“ã¨ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’è­˜åˆ¥ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ SNAT è£…ç½®ã¯ã€SNAT ãƒãƒ¼ãƒˆã‚’ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«æ¶ˆè²»ã—ã¦ã„ããªãŒã‚‰ SNAT ã‚’è¡Œã„ã¾ã™ã€‚</p><p>ãã—ã¦ã€VM #1 ã‹ã‚‰ã® 101 å€‹ç›®ã®æ¥ç¶šã‚’å—ã‘ä»˜ã‘ãŸæ™‚ã€ä½¿ãˆã‚‹ SNAT ãƒãƒ¼ãƒˆãŒå­˜åœ¨ã—ãªã„ã“ã¨ã«æ°—ãŒä»˜ãã¾ã™ã€‚ãªãœãªã‚‰ã€VM #1 ã«ã¯ 100 å€‹ã® SNAT ãƒãƒ¼ãƒˆã®ã¿ã‚’å‰²ã‚Šå½“ã¦ãŸã‹ã‚‰ã§ã™ã€‚ã“ã‚ŒãŒ SNAT ãƒãƒ¼ãƒˆãŒæ¯æ¸‡ã—ãŸçŠ¶æ…‹ã§ã™ã€‚ä¸€åº¦æ¶ˆè²»ã—ãŸ SNAT ãƒãƒ¼ãƒˆã‚’å†åˆ©ç”¨ã™ã‚‹ã«ã¯ã€æ—¢å­˜ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ VM ã‹ WEB ã‚µãƒ¼ãƒãƒ¼ãŒ FIN/RST ã§çµ‚äº†ã™ã‚‹ã‹ã€SNAT è£…ç½®ä¸Šã®ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§å¼·åˆ¶åˆ‡æ–­ã™ã‚‹ã®ã‚’å¾…ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ãŸã ã—ã€SNAT ãƒãƒ¼ãƒˆæ¯æ¸‡ãŒç™ºç”Ÿã—ãŸã‹ã‚‰ã¨è¨€ã£ã¦ã€ä»–ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„å®›å…ˆã®é€šä¿¡ã«å½±éŸ¿ãŒã§ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ãã¾ã§ SNAT ãƒãƒ¼ãƒˆã¯ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ä¸€è¦ç´ ã«ã™ããšã€5 ã‚¿ãƒ—ãƒ«ã®ä»–ã®å€¤ã§è­˜åˆ¥ã§ãã‚Œã° SNAT ãƒãƒ¼ãƒˆãŒé‡è¤‡ã—ã¦ã‚‚å•é¡Œãªã„ãŸã‚ã§ã™ã€‚ãŸã¨ãˆã°ã€ã“ã®çŠ¶æ³ã§ã‚‚ VM #1 ã‹ã‚‰ DNS ã‚µãƒ¼ãƒãƒ¼ (<code>DNS:53</code>) ã«å¯¾ã™ã‚‹ UDP ã®æ¥ç¶šè¦æ±‚ã¯æˆåŠŸã—ã¾ã™ã€‚</p><p>SNAT ãƒãƒ¼ãƒˆæ¯æ¸‡ã¯ã€åŒã˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¹°ã‚Šè¿”ã™ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã§ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚ãŸã¨ãˆã°æ¬¡ã®ã‚ˆã†ãªã‚·ãƒŠãƒªã‚ªã§ã™ã€‚</p><ul><li>å¤–éƒ¨ã® DNS ã‚µãƒ¼ãƒãƒ¼ã¸ã®å•ã„åˆã‚ã›</li><li>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ãƒ—ãƒ­ã‚­ã‚· ã‚µãƒ¼ãƒãƒ¼ã®åˆ©ç”¨</li><li>ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒªãƒ³ã‚°ã‚’ä½¿ã‚ãªã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ã‚¢ã‚¯ã‚»ã‚¹</li><li>ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€£æº</li></ul><p>æ¯æ¸‡ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã«ã¯ã€SNAT ãƒãƒ¼ãƒˆæ•°ã®ååˆ†ãªç¢ºä¿ã ã‘ã§ãªãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’å†åˆ©ç”¨ã—ãŸã‚Šä¸è¦ãªã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ã“ã¾ã‚ã«åˆ‡æ–­ã™ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚</p><h2 id="æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è¦§"><a href="#æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è¦§" class="headerlink" title="æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è¦§"></a>æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è¦§</h2><p>ãã‚Œã§ã¯ã€å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªæ§‹æˆã‚’å–ã‚Œã°ã€é€ä¿¡æ¥ç¶š (SNAT) ãŒå¯èƒ½ã«ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚2023 å¹´ 9 æœˆç¾åœ¨ã€Azure VM ã®é€ä¿¡æ¥ç¶šã«ä½¿ãˆã‚‹æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚</p><ul><li>ã‚µãƒ–ãƒãƒƒãƒˆã« NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’é–¢é€£ä»˜ã‘ã‚‹</li><li>NIC ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é–¢é€£ä»˜ã‘ã‚‹</li><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§é€ä¿¡è¦å‰‡ã‚’å®šç¾©ã™ã‚‹</li><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡ã‚’å®šç¾©ã™ã‚‹</li><li>æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ â€» 2025 å¹´ 9 æœˆã§å»ƒæ­¢ã€éæ¨å¥¨</li></ul><h2 id="åˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ"><a href="#åˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ" class="headerlink" title="åˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ"></a>åˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</h2><p>ã“ã“ã§ã¯ã€ã‚ã‚‹ Azure VM ãŒã©ã®æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§é€ä¿¡æ¥ç¶šã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã‹åˆ¤å®šã™ã‚‹ãŸã‚ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç¤ºã—ã¾ã™ã€‚</p><p>ã‚ˆã‚Šå³å¯†ã«è¨€ãˆã°ã€ã“ã‚Œã¯ NIC ã«å¯¾ã—ã¦ã®åˆ¤å®šãƒãƒ£ãƒ¼ãƒˆã§ã™ã€‚ãªãœãªã‚‰ã€åŒä¸€ Azure VM ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸ NIC ã§ã‚ã£ã¦ã‚‚ã€NIC ã”ã¨ã«ç•°ãªã‚‹é€ä¿¡æ¥ç¶šã‚’æ§‹æˆã§ãã‚‹ãŸã‚ã§ã™ã€‚ãŸã¨ãˆã°ã€ç•°ãªã‚‹äºŒã¤ã®ã‚µãƒ–ãƒãƒƒãƒˆã«è¶³ã‚’å‡ºã™ Azure VM ã«å¯¾ã—ã€ç‰‡æ–¹ã®ã‚µãƒ–ãƒãƒƒãƒˆã§ã¯ NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ä½¿ã£ãŸé€ä¿¡æ¥ç¶šã‚’ã€ã‚‚ã†ä¸€æ–¹ã®ã‚µãƒ–ãƒãƒƒãƒˆã§ã¯ Azure Firewall ã‚’ä½¿ã£ãŸé€ä¿¡æ¥ç¶šã‚’æ§‹æˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p><p>ã¾ãŸã€æ§‹æˆé–“ã®å„ªå…ˆåº¦ã‚‚è€ƒæ…®ã—ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãŸã¨ãˆã°ã€ã‚ã‚‹ NIC ã«å¯¾ã—ã¦ NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä¸¡æ–¹æ§‹æˆã•ã‚ŒãŸå ´åˆã€NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã«ã‚ˆã‚‹ SNAT ã§é€ä¿¡æ¥ç¶šãŒè¡Œã‚ã‚Œã¾ã™ã€‚å½“è©²ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ä½¿ã†ã¨ã€ã“ã®ã‚ˆã†ãªä¾å­˜é–¢ä¿‚ã‚’åˆ¤æ–­ã§ãã¾ã™ã€‚</p><p><img src="/blog/network/snat-options-for-azure-vm/flowchart-to-determine-snat-scenario.png" alt="flowchart"></p><h3 id="å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°"><a href="#å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°" class="headerlink" title="å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°"></a>å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°</h3><h4 id="ãƒ«ãƒ¼ãƒˆã®ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼Ÿ"><a href="#ãƒ«ãƒ¼ãƒˆã®ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼Ÿ" class="headerlink" title="ãƒ«ãƒ¼ãƒˆã®ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼Ÿ"></a>ãƒ«ãƒ¼ãƒˆã®ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼Ÿ</h4><p>æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒ SNAT ã®å¯¾è±¡ã§ã‚ã‚‹ã‹åˆ¤å®šã—ã¾ã™ã€‚</p><p>Azure ã§ã¯ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å®›ã¦ãŸé€šä¿¡ãŒå¿…ãšã—ã‚‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ SNAT ã•ã‚Œã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ä¸Šã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹é€šä¿¡ã ã‘ãŒã€SNAT ã®å¯¾è±¡ã§ã™ (SNAT ã®å¯¾è±¡ã§ã‚ã‚‹ã“ã¨ã¨ SNAT ã«æˆåŠŸã™ã‚‹ã“ã¨ã¯åˆ¥ã§ã‚ã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æ¥ç¶šä¸å¯ã«ç›¸å½“ã™ã‚‹æ§‹æˆã§ã‚ã‚Œã° SNAT ã«å¤±æ•—ã—ã¾ã™)ã€‚ä¸€æ–¹ã§ã€SNAT ã®å¯¾è±¡ã«ãªã‚‰ãªã„ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã¯ã€æ¬¡ã®ã‚ˆã†ãªçŠ¶æ³ã§ç™ºç”Ÿã—ã¾ã™ã€‚</p><ul><li>VNet ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆ</li><li>å¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚° (ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹æ‹ ç‚¹ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å¼•ãè¾¼ã‚€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ) ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹å ´åˆ</li><li>Azure Firewall ãªã©ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä»®æƒ³ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆ</li><li>ã‚µãƒ¼ãƒ“ã‚¹ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆ</li></ul><p>ã“ã†ã—ãŸã‚·ãƒŠãƒªã‚ªã®åˆ¤æ–­ã¯ã€Azure VM ã«è¨­å®šã•ã‚ŒãŸ<a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/diagnose-network-routing-problem#diagnose-using-azure-portal">æœ‰åŠ¹ãªãƒ«ãƒ¼ãƒˆ</a>ã§ç¢ºèªã§ãã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ãƒ«ãƒ¼ãƒˆã®ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒ [ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ] ã¨ãªã£ã¦ã„ã‚‹å ´åˆã¯  SNAT ã®å¯¾è±¡ã§ã€ãã†ã§ãªã„å ´åˆã¯å¯¾è±¡å¤–ã§ã™ã€‚</p><p>åˆæœŸçŠ¶æ…‹ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒˆ (0.0.0.0/0) ã®ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒ [ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ] ã«å‘ã‘ã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚„ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹æ‹ ç‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ä»¥å¤–ã«å®›ã¦ã‚‰ã‚ŒãŸãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã€ã¤ã¾ã‚Šã»ã¨ã‚“ã©ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒ SNAT ã®å¯¾è±¡ã§ã™ã€‚å½“è©²ã‚¹ãƒ†ãƒƒãƒ—ã®åˆ¤å®šã§ã¯ã€ã“ã®æ—¢å®šã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒˆã‚’ç„¡åŠ¹åŒ–ã‚ã‚‹ã„ã¯ä¸Šæ›¸ãã™ã‚‹ã‚ˆã†ãªãƒ«ãƒ¼ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ã‹ã‚’é‡ç‚¹çš„ã«ç¢ºèªã—ã¦ã„ãŸã ãã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚</p><p>ãŸã¨ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªçŠ¶æ³ã«ã¤ã„ã¦è€ƒãˆã¦ã¿ã¾ã™ã€‚</p><p><img src="/blog/network/snat-options-for-azure-vm/effective-routes-afw.png" alt="effective-routes-afw"></p><ul><li>æ—¢å®šã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒˆãŒç„¡åŠ¹ã¨ãªã‚Šã€ä»£ã‚ã‚Šã«ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒ [ä»®æƒ³ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹] ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒ«ãƒ¼ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€Azure VM ã§ã¯ SNAT ã‚’è©¦ã¿ãšã€ä»®æƒ³ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å´ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‡¦ç† (ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚„ SNAT) ã™ã‚‹æ§‹æˆã ã¨åˆ¤æ–­ã§ãã¾ã™ã€‚</li><li>ãŸã ã—ã€<a href="https://jpaztech.github.io/blog/vm/azure-kms-update/">KMS ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ 3 ã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹</a> ã®ãƒã‚¯ã‚¹ãƒˆãƒ›ãƒƒãƒ—ãŒ [ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ] ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é–¢ã—ã¦ã¯ã€ä»®æƒ³ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚’ä½¿ã‚ãš Azure VM å´ã§ SNAT ã™ã‚‹ã“ã¨ãŒæ„å›³ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚</li></ul><p>ã—ãŸãŒã£ã¦ã€ã“ã®ä¾‹ã§ã®å½“è©²ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®å›ç­”ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚</p><ul><li>KMS ã‚µãƒ¼ãƒãƒ¼å®›ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯: ã¯ã„ (SNAT ã®å¯¾è±¡)</li><li>ãã‚Œä»¥å¤–ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå®›ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯: ã„ã„ãˆ (SNAT ã®å¯¾è±¡å¤–)</li></ul><h4 id="NAT-ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒã‚µãƒ–ãƒãƒƒãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ"><a href="#NAT-ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒã‚µãƒ–ãƒãƒƒãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ" class="headerlink" title="NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒã‚µãƒ–ãƒãƒƒãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ"></a>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒã‚µãƒ–ãƒãƒƒãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ</h4><p>æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã«ã‚ˆã‚‹ SNAT æ§‹æˆã§ã‚ã‚‹ã‹åˆ¤å®šã—ã¾ã™ã€‚ã“ã‚Œã¯ã€NIC ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ç¢ºèªã§ãã¾ã™ã€‚ä»¥ä¸‹ã«ã€Azure Portal ã§ã®ç¢ºèªæ–¹æ³•ã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚</p><ol><li>å¯¾è±¡ã® Azure VM ã® [ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€ NIC ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/ã‚µãƒ–ãƒãƒƒãƒˆã‚’ç¢ºèªã™ã‚‹</li><li>å¯¾è±¡ã®ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã® [ã‚µãƒ–ãƒãƒƒãƒˆ] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€å¯¾è±¡ã‚µãƒ–ãƒãƒƒãƒˆã‚’é–‹ã</li><li>[NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤] ã®é …ç›®ã« NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®åå‰ãŒå­˜åœ¨ã™ã‚Œã°ã€æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã®å›ç­”ã¯ã€Œã¯ã„ã€ã§ã™</li></ol><h4 id="ãƒ‘ãƒ–ãƒªãƒƒã‚¯-IP-ãŒ-NIC-ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ"><a href="#ãƒ‘ãƒ–ãƒªãƒƒã‚¯-IP-ãŒ-NIC-ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ" class="headerlink" title="ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ãŒ NIC ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ"></a>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ãŒ NIC ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿ</h4><p>æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€NIC ã«é–¢é€£ä»˜ã‘ãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ (ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹) ã«ã‚ˆã‚‹ SNAT æ§‹æˆã§ã‚ã‚‹ã‹åˆ¤å®šã—ã¾ã™ã€‚NIC ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¦‹ã¦ã€ãƒ—ãƒ©ã‚¤ãƒãƒª IP æ§‹æˆã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç´ã¥ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p><p>Azure Portal ã§ç¢ºèªã™ã‚‹å ´åˆã¯ã€‚<a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/associate-public-ip-address-vm?tabs=azure-portal">ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é–¢é€£ä»˜ã‘ã®æ‰‹é †</a>ã‚’å‚è€ƒã«ã€æ¬¡ã®ã‚ˆã†ãªæ‰‹é †ã§å®Ÿè¡Œã—ã¾ã™ã€‚</p><ol><li>å¯¾è±¡ã® NIC ã® [IP æ§‹æˆ] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€ãƒ—ãƒ©ã‚¤ãƒãƒªã® IP æ§‹æˆã‚’ç¢ºèªã™ã‚‹</li><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¬„ã«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã®å›ç­”ã¯ã€Œã¯ã„ã€ã§ã™</li></ol><h4 id="é€ä¿¡è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ"><a href="#é€ä¿¡è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ" class="headerlink" title="é€ä¿¡è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ"></a>é€ä¿¡è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ</h4><p>æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€é€ä¿¡è¦å‰‡ã‚’ä½¿ã£ãŸ SNAT æ§‹æˆã§ã‚ã‚‹ã‹åˆ¤å®šã—ã¾ã™ã€‚é€ä¿¡è¦å‰‡ã¯ Standard SKU ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§ã®ã¿åˆ©ç”¨ã§ãã‚‹æ©Ÿèƒ½ã§ã€é€ä¿¡æ¥ç¶šã‚’å®šç¾©ã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã® VM ã«å¯¾ã—ã¦ SNAT ã‚’æä¾›ã—ã¾ã™ã€‚Azure Portal ã§ã®ç¢ºèªæ–¹æ³•ã®ä¾‹ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚</p><ol><li>å¯¾è±¡ã® Azure VM ã® [ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€å¯¾è±¡ã® NIC ã‚’ç¢ºèªã—ã¾ã™</li><li>[è² è·åˆ†æ•£] ã‚¿ãƒ–ã‚’é–‹ãã€æ‰€å±ã—ã¦ã„ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã®ä¸€è¦§ã‚’ç¢ºèªã—ã¾ã™ã€‚</li><li>ç¨®åˆ¥ãŒãƒ‘ãƒ–ãƒªãƒƒã‚¯ã§ SKU ãŒ Standard ã§ã‚ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ã¿ã‚’æŠ½å‡ºã—ã¾ã™ã€‚</li><li>å¯¾è±¡ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã® [é€ä¿¡è¦å‰‡] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã€å¯¾è±¡ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸé€ä¿¡è¦å‰‡ãŒã‚ã‚‹å ´åˆã€æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã®å›ç­”ã¯ã€Œã¯ã„ã€ã§ã™</li></ol><h4 id="è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰-NAT-ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ"><a href="#è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰-NAT-ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ" class="headerlink" title="è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ"></a>è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼Ÿ</h4><p>æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ã®è‡ªå‹•ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡ã«ã‚ˆã‚‹ SNAT æ§‹æˆã§ã‚ã‚‹ã‹åˆ¤å®šã—ã¾ã™ã€‚</p><p>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§ã¯ã€è² è·åˆ†æ•£è¦å‰‡ã‚’å®šç¾©ã™ã‚‹ã¨åŒæ™‚ã«é€ä¿¡æ¥ç¶šã‚’æœ‰åŠ¹åŒ–ã§ãã¾ã™ã€‚ã“ã®æš—é»™çš„ãª SNAT ã¯ã€è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãªã©ã¨å‘¼ã°ã‚Œã¾ã™ã€‚Azure Portal ã§ã®ç¢ºèªæ–¹æ³•ã®ä¾‹ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚</p><ol><li>å¯¾è±¡ã® Azure VM ã® [ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€å¯¾è±¡ã® NIC ã‚’ç¢ºèªã—ã¾ã™</li><li>[è² è·åˆ†æ•£] ã‚¿ãƒ–ã‚’é–‹ãã€æ‰€å±ã—ã¦ã„ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã®ä¸€è¦§ã‚’ç¢ºèªã—ã¾ã™ã€‚</li><li>ç¨®åˆ¥ãŒãƒ‘ãƒ–ãƒªãƒƒã‚¯ã§ã‚ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ã¿ã‚’æŠ½å‡ºã—ã¾ã™ã€‚</li><li>å¯¾è±¡ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã® [è² è·åˆ†æ•£è¦å‰‡] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã€å¯¾è±¡ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã«å®šç¾©ã•ã‚ŒãŸè² è·åˆ†æ•£è¦å‰‡ãŒæ¬¡ã®ã„ãšã‚Œã‹ã«è©²å½“ã—ã¦ã„ã‚Œã°æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã®å›ç­”ã¯ã€Œã¯ã„ã€ã§ã™</li></ol><ul><li>Basic SKU ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®è² è·åˆ†æ•£è¦å‰‡ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹</li><li>Standard SKU ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®è² è·åˆ†æ•£è¦å‰‡ãŒå®šç¾©ã•ã‚Œã¦ãŠã‚Šã€ãã®è² è·åˆ†æ•£è¦å‰‡ã§è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹</li></ul><h4 id="æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ï¼Ÿ"><a href="#æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ï¼Ÿ" class="headerlink" title="æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ï¼Ÿ"></a>æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ï¼Ÿ</h4><p>æœ¬ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€<a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/default-outbound-access">æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹</a> ãŒæœ‰åŠ¹ãªã‚·ãƒŠãƒªã‚ªã§ã‚ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</p><p>æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã¨ã¯ã€æ˜ç¤ºçš„ã«é€ä¿¡æ¥ç¶šã®è¨­å®šã‚’ã—ã¦ã„ãªã„ Azure VM ã«æœ€ä½é™ã®é€ä¿¡æ¥ç¶šã‚’æä¾›ã™ã‚‹ Azure ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã® SNAT æ©Ÿèƒ½ã§ã™ã€‚æ¬¡ã® 2 ã¤ã®æ¡ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™ Azure VM ã¯ã€æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã§ã®é€ä¿¡æ¥ç¶šãŒæœ‰åŠ¹ã§ã™ã€‚</p><ul><li><strong>æ¡ä»¶1</strong>: åŒä¸€ã®å¯ç”¨æ€§ã‚»ãƒƒãƒˆ(â€») ã«å«ã¾ã‚Œã‚‹ã™ã¹ã¦ã® NIC ãŒã€Standard SKU ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ã„ãšã‚Œã«ã‚‚é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ãªã„ã€‚</li><li><strong>æ¡ä»¶2</strong>: ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ« ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã™ã‚‹ VMSS ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã¯ãªã„ã€‚</li></ul><p>â€» å¯ç”¨æ€§ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã¦ã„ãªã„å ´åˆã¯ã€ã€Œå¯ç”¨æ€§ã‚»ãƒƒãƒˆã€ã¨ã€ŒAzure VMã€ã‚’ç½®ãæ›¿ãˆã¦ãã ã•ã„ (1å°ã® Azure VM ã ã‘ãŒæ‰€å±ã™ã‚‹ç–‘ä¼¼çš„ãªå¯ç”¨æ€§ã‚»ãƒƒãƒˆã‚’è€ƒãˆã‚‹)ã€‚åŒæ§˜ã«ã€VMSS ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å ´åˆã¯ã€ã€Œå¯ç”¨æ€§ã‚»ãƒƒãƒˆã€ã¨ã€ŒVMSSã€ã‚’ç½®ãæ›¿ãˆã¦ãã ã•ã„ã€‚</p><p><img src="/blog/network/snat-options-for-azure-vm/default-snat-condition.png" alt="default-snat-condition-1"></p><h4 id="é€ä¿¡æ¥ç¶š-ä¸å¯"><a href="#é€ä¿¡æ¥ç¶š-ä¸å¯" class="headerlink" title="é€ä¿¡æ¥ç¶š ä¸å¯"></a>é€ä¿¡æ¥ç¶š ä¸å¯</h4><p>æœ€å¾Œã«ã€Œé€ä¿¡æ¥ç¶š ä¸å¯ã€ã®ã‚·ãƒŠãƒªã‚ªã«ã¤ã„ã¦è£œè¶³ã—ã¾ã™ã€‚</p><p>ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‹ã‚‰ã‚‚ã‚ã‹ã‚‹ã‚ˆã†ã«ã€Azure ã§ã¯å¤šãã® SNAT ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€å¤šãã®çŠ¶æ³ã§é€ä¿¡æ¥ç¶šãŒå¯èƒ½ã§ã™ã€‚ç‰¹ã«ã€ã¾ã£ãŸã SNAT ã®æ§‹æˆã‚’æ„è­˜ã›ãšã€Azure VM ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã ã‘ã§é€ä¿¡æ¥ç¶šãŒå‹æ‰‹ã«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€Œæ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã€ã¯ã€ç‰¹ç­†ã™ã¹ãæ©Ÿèƒ½ã§ã™ã€‚ãã‚Œã ã‘ã«ã€ã„ã–é€ä¿¡æ¥ç¶šãŒã§ããªããªã£ãŸæ™‚ã«ãƒ‘ãƒ‹ãƒƒã‚¯ã«é™¥ã£ã¦ã—ã¾ã†ã¨ã„ã†ã€è«¸åˆƒã®å‰£ã¨ã—ã¦ã®å´é¢ã‚‚ã‚ã‚Šã¾ã™ã€‚</p><p>å®Ÿéš›ã€æŠ€è¡“ã‚µãƒãƒ¼ãƒˆã§ã‚‚ã€ŒAzure VM ãŒé€ä¿¡æ¥ç¶šã§ããªã„ã€ã§ããªããªã£ãŸã€ã¨ã„ã†é¡ã®ãŠå•ã„åˆã‚ã›ã¯ã€é »ç¹ã«ç›®ã«ã™ã‚‹ã‚·ãƒŠãƒªã‚ªã®ã²ã¨ã¤ã§ã™ã€‚ä¸­ã§ã‚‚ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®æ§‹æˆå¤‰æ›´ä½œæ¥­ã‚’å¥‘æ©Ÿã¨ã—ã¦äº‹è±¡ãŒç™ºç”Ÿã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šãã€éå»ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼é–¢é€£ã® TIPS ã¨ã—ã¦ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚</p><blockquote><p>ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ¼ãƒ«ã«è¿½åŠ ã—ãŸã‚‰å¤–éƒ¨ã¸æ¥ç¶šã§ããªããªã£ãŸ<br>ã“ã¡ã‚‰ã®äº‹è±¡ã«ã¤ã„ã¦ã‚ˆãã‚ã‚‹åŸå› ã¨ã—ã¦ã¯ä»¥ä¸‹ãŒã‚ã‚Šã¾ã™ã€‚</p><ol><li>Standard SKU ã®å†…éƒ¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ¼ãƒ«ã«æ‰€å±ã—ã¦ã„ã‚‹</li></ol><p>å¼•ç”¨: <a href="https://jpaztech.github.io/blog/archive/azurelb-tips/">Azure ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼åˆ©ç”¨æ™‚ã®æ³¨æ„ç‚¹ &gt; ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ¼ãƒ«ã«è¿½åŠ ã—ãŸã‚‰å¤–éƒ¨ã¸æ¥ç¶šã§ããªããªã£ãŸ</a></p></blockquote><p>ã‚‚ã—ã€é€ä¿¡æ¥ç¶šãŒã§ããªã„å ´åˆã‚„ã€ã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¢ƒã«é€ä¿¡æ¥ç¶šã§ããªã„çŠ¶æ³ã«ãªã£ã¦ã—ã¾ã£ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå¯¾å¿œã§äº‹è±¡ãŒç·©å’Œã™ã‚‹ã‹ã”ç¢ºèªãã ã•ã„ã€‚</p><ul><li>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ Azure VM ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã«é–¢é€£ä»˜ã‘ã‚‹</li><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ Azure VM ã® NIC ã«é–¢é€£ä»˜ã‘ã‚‹</li><li>Standard SKU ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‚’åˆ©ç”¨ã—ã¦é€ä¿¡è¦å‰‡ã‚’æ§‹æˆã™ã‚‹</li></ul><h2 id="æ§‹æˆã®æ¯”è¼ƒ"><a href="#æ§‹æˆã®æ¯”è¼ƒ" class="headerlink" title="æ§‹æˆã®æ¯”è¼ƒ"></a>æ§‹æˆã®æ¯”è¼ƒ</h2><p>æ¬¡ã®è¡¨ã¯ã€å„æ§‹æˆã«ã©ã®ã‚ˆã†ãªç‰¹æ€§ãŒã‚ã‚‹ã‹ã‚’ç¤ºã—ãŸã‚‚ã®ã§ã™ã€‚è©³ç´°ã¯å¾Œè¿°ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç¢ºèªã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ãŒã€æ¨ªãã—ã§æ¯”è¼ƒã™ã‚‹éš›ã«å‚è€ƒã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚</p><table><thead><tr><th align="left"></th><th align="left">NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤</th><th align="left">ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¬ãƒ™ãƒ« ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹</th><th align="left">é€ä¿¡è¦å‰‡</th><th align="left">è² è·åˆ†æ•£è¦å‰‡</th><th align="left">æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹</th></tr></thead><tbody><tr><td align="left">æ§‹æˆå˜ä½</td><td align="left">ã‚µãƒ–ãƒãƒƒãƒˆ</td><td align="left">NIC</td><td align="left">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«</td><td align="left">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«</td><td align="left">å¯ç”¨æ€§ã‚»ãƒƒãƒˆ</td></tr><tr><td align="left">ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‰²ã‚Šå½“ã¦</td><td align="left">å›ºå®š</td><td align="left">å›ºå®š</td><td align="left">å›ºå®š</td><td align="left">å›ºå®š</td><td align="left">ãƒ©ãƒ³ãƒ€ãƒ </td></tr><tr><td align="left">NAT æ–¹å¼</td><td align="left">NAPT</td><td align="left">Basic NAT</td><td align="left">NAPT</td><td align="left">NAPT</td><td align="left">NAPT</td></tr><tr><td align="left">æœ€å¤§ SNAT ãƒãƒ¼ãƒˆæ•°</td><td align="left">~64,512*16</td><td align="left"></td><td align="left">64,000</td><td align="left">1,024</td><td align="left">1,024</td></tr><tr><td align="left">ã‚¢ã‚¤ãƒ‰ãƒ« ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ[åˆ†]</td><td align="left">4~120</td><td align="left">4</td><td align="left">4~100</td><td align="left">4</td><td align="left">4</td></tr><tr><td align="left">ãƒ—ãƒ­ãƒˆã‚³ãƒ«</td><td align="left">TCP/UDP</td><td align="left">TCP/UDP/ICMP/ESP</td><td align="left">TCP/UDP</td><td align="left">TCP/UDP</td><td align="left">TCP/UDP</td></tr><tr><td align="left">ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ¥ç¶š</td><td align="left">ãªã—</td><td align="left">ã‚ã‚Š</td><td align="left">ãªã—</td><td align="left">ã‚ã‚Š</td><td align="left">ãªã—</td></tr></tbody></table><ul><li><strong>æ§‹æˆå˜ä½</strong>: åŒã˜é€ä¿¡æ¥ç¶šãŒæ§‹æˆã•ã‚Œã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã§ã™ã€‚ãŸã¨ãˆã°ã€ã‚µãƒ–ãƒãƒƒãƒˆãŒæ§‹æˆå˜ä½ã§ã‚ã‚‹å ´åˆã€ã‚µãƒ–ãƒãƒƒãƒˆå†…ã®ã™ã¹ã¦ã® NIC ã¯åŒã˜æ–¹æ³•ã§é€ä¿¡æ¥ç¶šã•ã‚Œã¾ã™ã€‚</li><li><strong>ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‰²ã‚Šå½“ã¦</strong>: â€œå›ºå®šâ€ ã®æ§‹æˆã§ã¯ã€ç‰¹å®šã® SNAT ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ—ãƒ¼ãƒ«ã‹ã‚‰é€ä¿¡å…ƒ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ‰•ã„å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å®›å…ˆå´ã®ãƒ›ã‚¹ãƒˆã§é€ä¿¡å…ƒã‚’ä½¿ã£ãŸ ACL ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚â€ãƒ©ãƒ³ãƒ€ãƒ â€ ã®æ§‹æˆã§ã¯ã€SNAT ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é™å®šã§ãã¾ã›ã‚“ã€‚Azure VM ã®å‰²ã‚Šå½“ã¦ã‚’åœæ­¢ã™ã‚‹ã¨ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰åŒ–ã—ã¾ã™ã€‚</li><li><strong>NAT æ–¹å¼</strong>: â€œBasic NATâ€ ã¯ã€1å¯¾1 ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ NAT ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚ã“ã‚ŒãŒæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã ã‘ã§ã™ã€‚â€NAPTâ€ ã¯ã€NAPT ã‚’åˆ©ç”¨ã—ãŸ SNAT ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚ã“ã®æ–¹å¼ã§ã¯ã€SNAT ãƒãƒ¼ãƒˆã‚’ä½¿ã„åˆ‡ã‚‹ã¨åŒã˜å®›å…ˆãƒ›ã‚¹ãƒˆã¸ã®åŒæ™‚æ¥ç¶šãŒåˆ¶é™ã•ã‚Œã‚‹ã€Œãƒãƒ¼ãƒˆæ¯æ¸‡ã€ã®å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</li><li><strong>æœ€å¤§ SNAT ãƒãƒ¼ãƒˆæ•°</strong>: NIC ãŒåˆ©ç”¨ã§ãã‚‹æœ€å¤§ã® SNAT ãƒãƒ¼ãƒˆæ•°ã‚’è¡¨ã—ã¾ã™ã€‚NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã§ã¯ã€åˆ©ç”¨çŠ¶æ³ã«å¿œã˜ã¦ SNAT ãƒãƒ¼ãƒˆã‚’å‹•çš„ã«åˆ†é…ã™ã‚‹ãŸã‚ã€ä»–ã® Azure VM ã®ç¨¼åƒçŠ¶æ³ã«ã‚‚å·¦å³ã•ã‚Œã¾ã™ã€‚ç†è«–ä¸Šã€NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤å…¨ä½“ã§æœ€å¤§ 64,512 * 16 = 1,032,192 å€‹ã® SNAT ãƒãƒ¼ãƒˆãŒç¢ºä¿ã§ãã¾ã™ã€‚</li><li><strong>ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</strong>: TCP ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰å‘ã‘ã«ç¢ºç«‹ã—ãŸæ™‚ã®ã‚¢ã‚¤ãƒ‰ãƒ« ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ (åˆ†) ã§ã™ã€‚ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ã‚ˆã‚Šã‚‚é•·ãã‚¢ã‚¤ãƒ‰ãƒ«çŠ¶æ…‹ãŒç¶šãã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã«é–¢ã—ã¦ã¯ã€ãã‚Œä»¥é™ã®æ¥ç¶šãŒä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚ç¯„å›²ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã«é–¢ã—ã¦ã¯ã€è¨­å®šã«ã‚ˆã‚Šå¤‰å‹•ã§ãã¾ã™ã€‚ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®å ´åˆã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã« RST ã‚’é€šçŸ¥ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚</li><li><strong>ãƒ—ãƒ­ãƒˆã‚³ãƒ«</strong>: é€ä¿¡æ¥ç¶šã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚ã™ã¹ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ TCP/UDP ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚ICMP ãŒåˆ©ç”¨ã§ããªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã‚ã‚‹ã®ã§ã€å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã¸ã® ping ç›£è¦–ã®ã‚·ãƒŠãƒªã‚ªã§ã¯æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</li><li><strong>ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ¥ç¶š</strong>: ã€Œãªã—ã€ã®å ´åˆã€é€ä¿¡æ¥ç¶šã®ãŸã‚ã ã‘ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã€Œã‚ã‚Šã€ã®å ´åˆã€å¤–éƒ¨ã‹ã‚‰ã®æ¥ç¶šã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã‚‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒåˆ©ç”¨ã•ã‚Œã¾ã™ã€‚</li></ul><p>ã¾ãŸã€é€ä¿¡æ¥ç¶šã®æ§‹æˆã‚’é¸æŠã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ä½µã›ã¦ã”ç¢ºèªãã ã•ã„ã€‚</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/well-architected/mission-critical/mission-critical-networking-connectivity#internet-egress">Azure ã§ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨æ¥ç¶š - Microsoft Azure Well-Architected Framework | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/load-balancer-outbound-connections">ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šã®é€ä¿¡å…ƒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ› (SNAT) - Azure Load Balancer | Microsoft Learn</a></li></ul><h2 id="æ§‹æˆã®è©³ç´°"><a href="#æ§‹æˆã®è©³ç´°" class="headerlink" title="æ§‹æˆã®è©³ç´°"></a>æ§‹æˆã®è©³ç´°</h2><p>ã“ã“ã‹ã‚‰ã¯ã€é€ä¿¡æ¥ç¶šã®æ§‹æˆã”ã¨ã«ç‰¹å¾´ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ»æ³¨æ„äº‹é …ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚</p><h3 id="NAT-ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤"><a href="#NAT-ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤" class="headerlink" title="NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤"></a>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤</h3><p><img src="/blog/network/snat-options-for-azure-vm/nat-gateway-snat.png" alt="nat-gateway"></p><p>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¯ã€é€ä¿¡æ¥ç¶šã® SNAT ã‚’ä¸»ãªç›®çš„ã¨ã—ã¦è¨­è¨ˆã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚å°‚é–€çš„ãªã‚µãƒ¼ãƒ“ã‚¹ãªã ã‘ã‚ã£ã¦ã€é€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹ã®å›ºå®šåŒ–ã¯ã‚‚ã¡ã‚ã‚“ã€å‹•çš„ãªãƒãƒ¼ãƒˆç¢ºä¿ã«ã‚ˆã‚Šã‚‹ãƒãƒ¼ãƒˆè³‡æºã®æœ‰åŠ¹æ´»ç”¨ãªã©ã€ä»–ã® SNAT æ–¹å¼ã«ã¯ãªã„æ©Ÿèƒ½ã‚’æœ‰ã—ã¾ã™ã€‚</p><p><strong>ç‰¹å¾´</strong></p><ul><li>ãƒ•ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ‰ãª PaaS ã‚µãƒ¼ãƒ“ã‚¹ã§ã€é«˜ã„å¯ç”¨æ€§ã‚’æœ‰ã—ã¾ã™ã€‚æœ€æ–°ã® SLA ã§ã¯ã€å¯ç”¨æ€§ãŒ 99.99% ã‚’ä¸‹å›ã‚‹ã¨ä¸€éƒ¨æ–™é‡‘ã®è¿”é‡‘ (ã‚µãƒ¼ãƒ“ã‚¹ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ) ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</li><li>è¤‡æ•°ã® VM ã§ SNAT ãƒãƒ¼ãƒˆ ãƒ—ãƒ¼ãƒ«ã‚’å…±æœ‰ã—ã€å‹•çš„ã« SNAT ãƒãƒ¼ãƒˆã‚’ç¢ºä¿ã§ãã‚‹ã®ã¯ NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã ã‘ã§ã™ã€‚[<a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/nat-gateway-snat">å‚è€ƒ</a>]</li><li>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã«è¿½åŠ ã§ãã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æœ€å¤§æ•°ã¯ 16 å€‹ã§ã™ã€‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚ãŸã‚Š 64,152 ã® SNAT ãƒãƒ¼ãƒˆãŒç¢ºä¿ã•ã‚Œã‚‹ãŸã‚ã€NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤å…¨ä½“ã§æœ€å¤§ 64,512 * 16 = 1,032,192 ã® SNAT ãƒãƒ¼ãƒˆã‚’ç¢ºä¿ã§ãã¾ã™ã€‚[<a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/nat-gateway-resource#snat-ports">å‚è€ƒ</a>]</li><li>é€ä¿¡æ¥ç¶šã® TCP ã‚¢ã‚¤ãƒ‰ãƒ« ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ 4 åˆ†ã‹ã‚‰æœ€å¤§ 120 åˆ†ã¾ã§ä¼¸ã°ã›ã¾ã™ã€‚[<a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/nat-gateway-resource#tcp-idle-timeout">å‚è€ƒ</a>]</li><li>Azure Monitor ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯ã§ NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã§å‡¦ç†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã€ãƒ‘ã‚±ãƒƒãƒˆæ•°ã€ç¾åœ¨ã®æ¥ç¶šæ•°ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[<a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/nat-metrics">å‚è€ƒ</a>]</li></ul><p><strong>æ§‹æˆæ–¹æ³•</strong></p><ol><li>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚</li><li>å¯¾è±¡ã®ã‚µãƒ–ãƒãƒƒãƒˆã« NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’é–¢é€£ä»˜ã‘ã‚‹ã€‚</li></ol><p><strong>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</strong></p><ul><li>ä¸€èˆ¬çš„ãªé€ä¿¡æ¥ç¶šã®ã‚·ãƒŠãƒªã‚ªå…¨èˆ¬</li><li>å¤§é‡ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®æ¥ç¶šãŒå¿…è¦ã¨ãªã‚‹å ´åˆ</li><li>è¤‡æ•°ã® Azure VM ã§ SNAT ç”¨ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ (SNAT ãƒãƒ¼ãƒˆ) ã‚’å…±æœ‰ã—ãŸã„å ´åˆ</li></ul><p><strong>æ³¨æ„äº‹é …</strong></p><ul><li>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ä½¿ç”¨ã™ã‚‹ NIC ã¯ã€Basic SKU ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ¬ãƒ™ãƒ« ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é–¢é€£ä»˜ã‘ãŸã‚Šã€Basic SKU ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é…ç½®ã§ãã¾ã›ã‚“ã€‚</li><li>ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®é€šä¿¡ã«å¯¾ã™ã‚‹ä¸€èˆ¬çš„ãª NAT è£…ç½®ã¨ã—ã¦åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ã‚ãã¾ã§ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®é€ä¿¡æ¥ç¶šã«ãŠã‘ã‚‹ SNAT æ©Ÿèƒ½ã ã‘ã‚’æä¾›ã—ã¾ã™ã€‚</li><li>ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ–¹å‘ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’å—ã‘ä»˜ã‘ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šæ€§ãŒå¿…è¦ãªå ´åˆã€Application Gateway ã‚„ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ãªã©ã®åˆ©ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚</li><li>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®å¯ç”¨æ€§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€ç‰¹å®šå¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã¸ã®å›ºå®š (zonal) ã¾ãŸã¯éã‚¾ãƒ¼ãƒ³ (regional) ã®ã„ãšã‚Œã‹ã§ã™ã€‚å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ ãƒ¬ãƒ™ãƒ«ã®å†—é•·æ€§ãŒå¿…è¦ãªã‚·ã‚¹ãƒ†ãƒ ã«çµ„ã¿è¾¼ã‚€å ´åˆã¯ã€å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã”ã¨ã«ã‚µãƒ–ãƒãƒƒãƒˆã‚’ä½œæˆã—ã€è¤‡æ•°ã® NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’å„ã‚µãƒ–ãƒãƒƒãƒˆã«é–¢é€£ä»˜ã‘ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚[<a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/nat-availability-zones">å‚è€ƒ</a>]</li><li>ICMP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã›ã‚“ã€‚</li></ul><p><strong>å‚è€ƒæ–‡çŒ®</strong></p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/nat-overview">Azure NAT Gateway ã¨ã¯ | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/nat-gateway-resource">Azure NAT Gateway ãƒªã‚½ãƒ¼ã‚¹ | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/nat-gateway/troubleshoot-nat">Azure NAT Gateway ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° - Azure Virtual Network | Microsoft Learn</a></li></ul><h3 id="ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹-ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯-IP-ã‚¢ãƒ‰ãƒ¬ã‚¹"><a href="#ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹-ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯-IP-ã‚¢ãƒ‰ãƒ¬ã‚¹" class="headerlink" title="ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹"></a>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹</h3><p><img src="/blog/network/snat-options-for-azure-vm/public-ip-address-snat.png" alt="public-ip-address"></p><p>Azure VM ã® NIC ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ (ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹) ã‚’é–¢é€£ä»˜ã‘ã‚‹ã¨ã€ãã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§é€šä¿¡ãŒ SNAT ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚1 å¯¾ 1 ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ NAT (Basic NAT) ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã‚‹ãŸã‚ã€åŸºç›¤å´ã§ã¯ SNAT ãƒãƒ¼ãƒˆã‚’ç®¡ç†ã—ã¾ã›ã‚“ã€‚</p><p><strong>ç‰¹å¾´</strong></p><ul><li>åŸºç›¤ã«å‚™ã‚ã‚‹ SNAT æ©Ÿèƒ½ã®ä¸­ã§ã€å”¯ä¸€ NAPT ã‚’åˆ©ç”¨ã—ãªã„ (SNAT ãƒãƒ¼ãƒˆã‚’ä½¿ã‚ãªã„) æ–¹å¼ã«ã‚ˆã‚‹ SNAT ã§ã™ã€‚SNAT ãƒãƒ¼ãƒˆã®æ¯æ¸‡ã‚’å¿ƒé…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li><li>SNAT ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä¸€ã¤ã® VM ã«å æœ‰ã•ã‚Œã€ä»–ã® VM ã«ä½¿ã‚ã‚Œãªã„ã“ã¨ã‚’ä¿è¨¼ã§ãã¾ã™ã€‚</li><li>æ§‹æˆãŒéå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚</li></ul><p><strong>æ§‹æˆæ–¹æ³•</strong></p><ol><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚</li><li>å¯¾è±¡ã® Azure VM ã® NIC ã«é–¢é€£ä»˜ã‘ã‚‹ã€‚</li></ol><p><strong>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</strong></p><ul><li>å˜ä¸€ã® Azure VM ã«å¯¾ã™ã‚‹é€ä¿¡æ¥ç¶šã®ç¢ºä¿ (NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãªã©ã‚’å°å…¥ã™ã‚‹ã¾ã§ã®ä¸€æ™‚çš„ãªå¯¾ç­–)</li><li>é€ä¿¡æ¥ç¶šã ã‘ã§ãªãã€Azure VM ã¸ã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šã‚‚ç¢ºä¿ã—ãŸã„å ´åˆ</li></ul><p><strong>æ³¨æ„äº‹é …</strong></p><ul><li>Basic SKU ã ã¨ NAT Gateway ã¨å…±å­˜å‡ºæ¥ãªã„ç­‰ã€SKU ä¾å­˜ã®åˆ¶é™ãŒå­˜åœ¨ã—ã¾ã™ã€‚å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ã¸ã®å¯¾å¿œã‚‚è€ƒæ…®ã™ã‚‹ã¨ã€åŸºæœ¬çš„ã«ã¯ Standard SKU ã®ä½¿ç”¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚</li><li>SNAT ãƒãƒ¼ãƒˆã®æ¶ˆè²»ã‚’æ°—ã«ã—ãªãã¦æ¸ˆã‚€åé¢ã€OS ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¹ã‚¿ãƒƒã‚¯ã§ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ« ãƒãƒ¼ãƒˆãŒæ¯æ¸‡ã™ã‚‹å¯èƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«ãƒãƒ¼ãƒˆã®æ¯æ¸‡ãŒç–‘ã‚ã‚Œã‚‹å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ãªæƒ…å ±ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/windows-client/networking/tcp-ip-port-exhaustion-troubleshooting">TCP/IP ãƒãƒ¼ãƒˆæ¯æ¸‡ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° - Windows Client | Microsoft Learn</a></li></ul><p><strong>å‚è€ƒæ–‡çŒ®</strong></p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/load-balancer-outbound-connections">ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šã®é€ä¿¡å…ƒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ› (SNAT) - Azure Load Balancer | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/virtual-network-public-ip-address">Azure ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½œæˆã€å¤‰æ›´ã€ã¾ãŸã¯å‰Šé™¤ã™ã‚‹ - Azure Virtual Network | Microsoft Learn</a></li></ul><h3 id="é€ä¿¡è¦å‰‡"><a href="#é€ä¿¡è¦å‰‡" class="headerlink" title="é€ä¿¡è¦å‰‡"></a>é€ä¿¡è¦å‰‡</h3><p><img src="/blog/network/snat-options-for-azure-vm/auzre-load-balancer-snat.png" alt="auzre-load-balancer-snat"></p><p>é€ä¿¡è¦å‰‡ã¯ Standard SKU ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§åˆ©ç”¨å¯èƒ½ãªé€ä¿¡æ¥ç¶šæ§‹æˆã§ã™ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã« Azure VM ã‚’é…ç½®ã—ã¦é€ä¿¡è¦å‰‡ã‚’å®šç¾©ã™ã‚‹ã¨ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ã£ãŸ SNAT ãŒæä¾›ã•ã‚Œã¾ã™ã€‚</p><p>NAT ã®æ–¹å¼ã«ã¯ NAPT ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«å†…ã® Azure VM ã«å¯¾ã—ã¦ã€å„ã€…ã©ã®ç¨‹åº¦ã® SNAT ãƒãƒ¼ãƒˆæ•°ã‚’å‰²ã‚Šä¸ãˆã‚‹ã‹ã€äºˆã‚è¨­å®šã—ã¦ãŠãã¾ã™ã€‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚ãŸã‚Š 64,000 ã® SNAT ãƒãƒ¼ãƒˆã‚’æŒã¤ã®ã§ã€ã“ã‚Œã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«å†…ã® Azure VM ã§åˆ†é…ã™ã‚‹å½¢ã«ãªã‚Šã¾ã™ã€‚ãŸã¨ãˆã°ã€8 å°ãªã‚‰ 8,000 ãƒãƒ¼ãƒˆãšã¤å‰²ã‚ŠæŒ¯ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p><strong>ç‰¹å¾´</strong></p><ul><li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã®å˜ä½ã§æ§‹æˆã•ã‚Œã‚‹ãŸã‚ã€ã‚µãƒ–ãƒãƒƒãƒˆã‚’ã¾ãŸã„ã§è¤‡æ•°ã® Azure VM ã‚’åŒã˜æ–¹æ³•ã§ SNAT ã§ãã‚‹ã€‚</li><li>é€ä¿¡è¦å‰‡ã§åˆ¶å¾¡ã§ãã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè±Šå¯Œã€‚<ul><li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ« (ã©ã® Azure VM ã‚’å¯¾è±¡ã¨ã™ã‚‹ã‹)</li><li>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ IP æ§‹æˆ (ã©ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ SNAT ã™ã‚‹ã‹)</li><li>SNAT ãƒãƒ¼ãƒˆæ•°ã®å‰²ã‚Šå½“ã¦ (å„ Azure VM ã¸è‡ªå‹•çš„ã«å‡ç­‰ã«å‰²ã‚Šå½“ã¦ã‚‹æ–¹å¼ã‹ã€æ˜ç¤ºçš„ã«å€¤ã‚’å…¥åŠ›ã™ã‚‹æ–¹å¼ãŒé¸æŠã§ãã¾ã™)</li><li>SNAT ã®å¯¾è±¡ã¨ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ« (TCPã€UDPã€ã¾ãŸã¯ä¸¡æ–¹)</li><li>TCP ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (4 åˆ†ã‹ã‚‰æœ€å¤§ 100 åˆ†ã¾ã§)</li><li>ã‚¢ã‚¤ãƒ‰ãƒ« ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã® TCP ãƒªã‚»ãƒƒãƒˆé€ä¿¡ã®æœ‰ç„¡</li></ul></li><li>ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šæ€§ã‚‚ã€è² è·åˆ†æ•£è¦å‰‡ã‚„ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ NAT è¦å‰‡ã‚’ä½œæˆã™ã‚Œã°ç¢ºä¿ã§ãã‚‹ã€‚ä½œæˆã—ãªã‘ã‚Œã°ã€å˜ã«é€ä¿¡æ¥ç¶šã®ã¿ã‚’è¡Œã† SNAT è£…ç½®ã¨ã—ã¦ä½¿ã†ã“ã¨ã‚‚å¯èƒ½ã€‚</li></ul><p><strong>æ§‹æˆæ–¹æ³•</strong></p><ol><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ä»˜ä¸ã—ãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‚’ä½œæˆã™ã‚‹ã€‚</li><li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã«å¯¾è±¡ã® Azure VM ã® NIC ã‚’è¿½åŠ ã™ã‚‹ã€‚</li><li>é€ä¿¡è¦å‰‡ã‚’ä½œæˆã™ã‚‹ã€‚</li></ol><p><strong>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</strong></p><ul><li>SNAT ã¨åŒæ™‚ã«ã€ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ–¹å‘ã®è² è·åˆ†æ•£ã‚‚åŒæ™‚ã«æ§‹æˆã—ãŸã„å ´åˆ (ä¾‹: å¤–éƒ¨ã¸ã® DB ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã¨ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚µãƒ¼ãƒãƒ¼)</li><li>ã‚µãƒ–ãƒãƒƒãƒˆä»¥å¤–ã®å˜ä½ã§ã€è¤‡æ•°ã® Azure VM ã®é€ä¿¡æ¥ç¶šã‚’åˆ¶å¾¡ã—ãŸã„å ´åˆ (ä¾‹: ã‚µãƒ–ãƒãƒƒãƒˆå†…ã®ä¸€éƒ¨ã® Azure VM ã«ã€ã¾ã¨ã‚ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’è¨±å¯ã™ã‚‹)</li></ul><p><strong>æ³¨æ„äº‹é …</strong></p><ul><li>è¤‡æ•°ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ IP æ§‹æˆ) ã‚’ã¾ã¨ã‚ã¦æŒ‡å®šã™ã‚‹ã¨ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«å…¨ä½“ã¨ã—ã¦ã¯ 64,000 x &lt;IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ•°&gt; ã ã‘ SNAT ãƒãƒ¼ãƒˆãŒç”¨æ„ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€ã©ã‚Œã ã‘ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã—ã¦ã‚‚ã€å„ Azure VM ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹æœ€å¤§ã® SNAT ãƒãƒ¼ãƒˆæ•°ã¯ 64,000 ã¾ã§ã§ã™ã€‚</li><li>è² è·åˆ†æ•£è¦å‰‡ã«ã¯ã€æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã£ã¦ SNAT ã‚’æ§‹æˆã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ã€åŒã˜ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ¼ãƒ«ã«ã¯é€ä¿¡è¦å‰‡ãŒä½œæˆã§ããªããªã‚Šã¾ã™ã€‚</li></ul><p><strong>å‚è€ƒæ–‡çŒ®</strong></p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/load-balancer-outbound-connections">ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šã®é€ä¿¡å…ƒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ› (SNAT) - Azure Load Balancer | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/outbound-rules">Azure Load Balancer ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰è¦å‰‡ | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/egress-only">é€ä¿¡å°‚ç”¨ã®ãƒ­ãƒ¼ãƒ‰ ãƒãƒ©ãƒ³ã‚µãƒ¼ã®æ§‹æˆ - Azure Load Balancer | Microsoft Learn</a></li></ul><h3 id="è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰-NAT-ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡"><a href="#è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰-NAT-ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡" class="headerlink" title="è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡"></a>è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹ãªè² è·åˆ†æ•£è¦å‰‡</h3><p>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®è² è·åˆ†æ•£è¦å‰‡ã§è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹ãªå ´åˆã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã«é…ç½®ã—ã¦ã„ã‚‹ Azure VM ã«å¯¾ã—ã¦é€ä¿¡æ¥ç¶šã®æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¾ã™ã€‚SNAT ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€è² è·åˆ†æ•£è¦å‰‡ã«ç´ã¥ã„ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ IP æ§‹æˆ (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹) ã§ã™ã€‚</p><p>Basic SKU ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§ã¯ã€è² è·åˆ†æ•£è¦å‰‡ã®è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ã¯å¿…ãšæœ‰åŠ¹ã§ã™ã€‚ä¸€æ–¹ã§ã€Standard SKU ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®å ´åˆã€è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ã® ON/OFF ã‚’è¨­å®šã™ã‚‹ãƒ•ãƒ©ã‚°é …ç›®ãŒè² è·åˆ†æ•£è¦å‰‡ã«å­˜åœ¨ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€<code>disableOutboundSnat</code> ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ false ã«è¨­å®šã™ã‚‹ã¨è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ãŒæœ‰åŠ¹ã¨ãªã‚Šã¾ã™ã€‚</p><p><strong>ç‰¹å¾´</strong></p><ul><li>è² è·åˆ†æ•£è¦å‰‡ã¨åˆã‚ã›ã¦æ§‹æˆã™ã‚‹æ€§è³ªä¸Šã€ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã¨ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ä¸¡æ–¹ã®æ¥ç¶šæ€§ã‚’ç¢ºä¿ã§ãã¾ã™ã€‚</li><li>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚„é€ä¿¡è¦å‰‡ã‚ˆã‚Šå¤ãã‹ã‚‰å­˜åœ¨ã™ã‚‹é€ä¿¡æ¥ç¶šæ§‹æˆã®ä¸€ã¤ã§ã™ã€‚æ­´å²çš„ãªçµŒç·¯ã‹ã‚‰ã€ç¾åœ¨ã§ã‚‚ã“ã®æ§‹æˆã‚’åˆ©ç”¨ã—ã¦ SNAT ã‚’å®Ÿæ–½ã—ã¦ã„ã‚‹ Azure VM ã¯å°‘ãªãã‚ã‚Šã¾ã›ã‚“ã€‚</li></ul><p><strong>æ§‹æˆæ–¹æ³•</strong></p><ul><li>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‚’ä½œæˆã™ã‚‹</li><li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€å¯¾è±¡ã® Azure VM ã‚’é…ç½®ã™ã‚‹</li><li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã«è² è·åˆ†æ•£è¦å‰‡ã‚’å®šç¾©ã™ã‚‹ (Standard SKU ã®å ´åˆã€è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹)</li></ul><p><strong>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</strong></p><ul><li>è² è·åˆ†æ•£è¦å‰‡ã¨åŒæ™‚ã«ç°¡æ˜“çš„ãªé€ä¿¡æ¥ç¶šã‚’æ§‹æˆã™ã‚‹å ´åˆ</li></ul><p><strong>æ³¨æ„äº‹é …</strong></p><ul><li>Standard SKU ã®å ´åˆã€é€ä¿¡è¦å‰‡ã¨ã®ä½µç”¨ã¯ã§ãã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€è² è·åˆ†æ•£è¦å‰‡ã®è‡ªå‹•ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ NAT ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã«ã¯ã€é€ä¿¡è¦å‰‡ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚</li><li>SNAT ãƒãƒ¼ãƒˆã®å‰²ã‚Šå½“ã¦ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«å†…ã® Azure VM ã®ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ã€è‡ªå‹•ã§ 32 ã‹ã‚‰ 1,024 ã¾ã§å¤‰åŒ–ã—ã¾ã™ã€‚[<a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/load-balancer-outbound-connections#preallocatedports">å‚è€ƒ</a>]</li><li>æœ€å¤§ SNAT ãƒãƒ¼ãƒˆãŒ 1,024 ã§ã‚ã‚‹ãŸã‚ã€å®¹æ˜“ã«ãƒãƒ¼ãƒˆæ¯æ¸‡ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</li></ul><p><strong>å‚è€ƒæ–‡çŒ®</strong></p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/outbound-rules#preventoutbound">Azure Load Balancer ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰è¦å‰‡ | Microsoft Learn</a></li></ul><h3 id="Azure-æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹"><a href="#Azure-æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹" class="headerlink" title="Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹"></a>Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹</h3><p><span style="color: #c00000;"> æœ¬è¨˜äº‹ã®å†’é ­ã§è¿½è¨˜ã—ã¦ã„ã‚‹é€šã‚Šã€2025 å¹´ 10 æœˆ 1 æ—¥ä»¥é™ã€æ–°è¦ Azure VM ã«å¯¾ã—ã¦æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚å…·ä½“çš„ãªå†…å®¹ã‚„å¯¾å¿œæ–¹æ³•ã¯ã€è¿½è¨˜éƒ¨åˆ†ã‚’ã”å‚ç…§ä¸‹ã•ã„ã€‚</span></p><p><img src="/blog/network/snat-options-for-azure-vm/azure-default-snat.png" alt="azure-default-snat"></p><p>ã“ã‚Œã¾ã§ã®é€ä¿¡æ¥ç¶šã®æ§‹æˆã¯ã€æ˜ç¤ºçš„ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ãŸã‚Šã€é–¢é€£ä»˜ã‘ã‚‹ã“ã¨ã§ SNAT ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã™ã‚‹ã‚‚ã®ã§ã—ãŸã€‚ã—ã‹ã—ã€Azure ã«ã¯é€ä¿¡æ¥ç¶šã®æ–¹æ³•ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€Azure VM ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ä»•çµ„ã¿ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã“ã‚Œã‚’ Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã¨å‘¼ã³ã¾ã™ã€‚</p><p>å…·ä½“çš„ã«ã¯ã€Azure ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸Šã§ä½¿ã‚ã‚Œã¦ã„ãªã„ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¸€æ™‚çš„ã«å€Ÿã‚Šã¦ SNAT ã‚’è¡Œã„ã¾ã™ã€‚ãã®ãŸã‚ã€Azure VM ã‚’å‰²ã‚Šå½“ã¦è§£é™¤ &amp; èµ·å‹•ã™ã‚‹ãŸã³ã«ã€SNAT ã«åˆ©ç”¨ã•ã‚Œã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰å‹•ã—ã¾ã™ã€‚</p><p>ãªãŠã€å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã‚ã‚‹ç¨‹åº¦çµã‚Šè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ãªãœãªã‚‰ã€Azure ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸€è¦§ãŒã€ä»¥ä¸‹ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ ã‚µã‚¤ãƒˆã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚å¯¾è±¡ã® Azure VM ãŒå­˜åœ¨ã™ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã€<code>AzureCloud.&lt;ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å&gt;</code> ã§æ¤œç´¢ã™ã‚‹ã¨å€™è£œã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã§ãã¾ã™ã€‚</p><ul><li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=56519">Download Azure IP Ranges and Service Tags â€“ Public Cloud from Official Microsoft Download Center</a></li></ul><p><strong>ç‰¹å¾´</strong></p><ul><li>å”¯ä¸€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚‰ãšã« SNAT ãŒå‡ºæ¥ã‚‹é€ä¿¡æ¥ç¶šã®æ§‹æˆã§ã™ã€‚</li><li>NAPT ã«ã‚ˆã‚Šå®Ÿç¾ã•ã‚Œã¦ãŠã‚Šã€ç¢ºä¿ã•ã‚Œã‚‹ SNAT ãƒãƒ¼ãƒˆæ•°ã¯ NIC (Azure VM) ã‚ãŸã‚Š 1024 ã§å›ºå®šã•ã‚Œã¦ã„ã¾ã™ã€‚</li></ul><p><strong>æ§‹æˆæ–¹æ³•</strong></p><p>å…¸å‹çš„ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªçŠ¶æ³ã§æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ©ç”¨ã•ã‚Œã¾ã™ã€‚æ¡ä»¶ã®è©³ç´°ã¯ã€åˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®ã€Œæ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ï¼Ÿã€ã‚’ã”è¦§ãã ã•ã„ã€‚</p><ul><li>NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®é€ä¿¡è¦å‰‡ã‚’ä½¿ã‚ãšã€ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãª Azure VM ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹ã€‚</li><li>Azure VM ã‚’ Basic SKU ã®å†…éƒ¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã«é…ç½®ã—ã¦ã„ã‚‹ã€‚</li></ul><p><strong>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</strong></p><ul><li>ãƒ†ã‚¹ãƒˆ/é–‹ç™ºç”¨ã® Azure VM ã§é€ä¿¡æ¥ç¶šãŒå¿…è¦ã«ãªã‚‹å ´åˆ</li></ul><p><strong>æ³¨æ„äº‹é …</strong></p><ul><li>æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã§ã¯æœ€å¤§ã§ã‚‚ 1024 ã¾ã§ã—ã‹ SNAT ãƒãƒ¼ãƒˆãŒç¢ºä¿ã•ã‚Œãšã€SNAT ãƒãƒ¼ãƒˆæ¯æ¸‡ã®å•é¡ŒãŒé¡•åœ¨åŒ–ã—ã‚„ã™ã„å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚</li><li>ã¾ãŸã€æ˜ç¤ºçš„ãª SNAT æ–¹æ³•ã®æŒ‡å®šãŒãªã„ã“ã¨ãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚„ç®¡ç†ä¸Šã®å•é¡Œã¨ãªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚</li><li>ä»¥ä¸Šã®ã‚ˆã†ãªèƒŒæ™¯ã‹ã‚‰ã€æœ¬ç•ªç’°å¢ƒã§ã®åˆ©ç”¨ã¯æ¨å¥¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</li></ul><p><strong>å‚è€ƒæ–‡çŒ®</strong></p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/default-outbound-access">Azure ã§ã®æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ - Azure Virtual Network | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/load-balancer/load-balancer-outbound-connections">ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šã®é€ä¿¡å…ƒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ› (SNAT) - Azure Load Balancer | Microsoft Learn</a></li></ul><h2 id="æœ€å¾Œã«"><a href="#æœ€å¾Œã«" class="headerlink" title="æœ€å¾Œã«"></a>æœ€å¾Œã«</h2><p>ä»Šå›ã®è¨˜äº‹ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆé€ä¿¡ã‚’å®Ÿç¾ã™ã‚‹ SNAT ã®ä»•çµ„ã¿ã¨ã€Azure ã§åˆ©ç”¨ã§ãã‚‹ SNAT ã®æ–¹å¼ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚</p><p>ã€Œåˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€ã‚’ä½¿ã†ã¨ã€å¯¾è±¡ã® Azure VM (NIC) ãŒã©ã®æ–¹å¼ã®é€ä¿¡æ¥ç¶šã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã®ã‹ç°¡å˜ã«èª¿ã¹ã‚‰ã‚Œã¾ã™ã€‚é€ä¿¡æ¥ç¶šã§ããªã„æ™‚ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚‚ã€ãœã²ã“ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ´»ç”¨ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚</p><p>ã¾ãŸã€å„é€ä¿¡æ¥ç¶šæ§‹æˆã®æ¯”è¼ƒã«ã¯ã€Œæ©Ÿèƒ½ã®æ¯”è¼ƒã€ã§ç¤ºã—ãŸè¡¨ã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚ãã‚Œãã‚Œã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã™ã¹ã¦ã®å´é¢ã‚’æ˜ ã—å‡ºã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€å¤§ã¾ã‹ã«ã©ã®ã‚ˆã†ãªé•ã„ãŒã‚ã‚‹ã®ã‹ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚</p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;Azure Networking ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å±±å£ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;Azure ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå®›ã¦ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ–¹å‘ã®æ¥ç¶š (é€ä¿¡æ¥ç¶š) ã‚’ã„ãã¤ã‹ã®æ–¹æ³•ã§å®Ÿè£…ã§ãã¾ã™ã€‚é¸æŠã®å¹…ãŒã‚ã‚‹ã“ã¨ã¯å–œã°ã—ã„ã§ã™ãŒã€ä¸€æ–¹ã§å†…å®¹ã®æŠŠæ¡ã®ãŒé›£ã—ã„å´é¢ã‚‚å¦ã‚ã¾ã›ã‚“ã€‚ãã“ã§æœ¬è¨˜äº‹ã§ã¯ã€Azure VM ã«ä½¿ãˆã‚‹é€ä¿¡æ¥ç¶šã®æ§‹æˆã‚’ã¾ã¨ã‚ã¦èª¬æ˜ã—ã¾ã™ã€‚ã¾ãŸã€ã‚ã‚‹ Azure VM ãŒã©ã®æ§‹æˆã«è©²å½“ã—ã¦ã„ã‚‹ã‹åˆ¤å®šã™ã‚‹ãŸã‚ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚„ã€å„æ§‹æˆã®ç‰¹å¾´ã«ã¤ã„ã¦ã‚‚ä½µã›ã¦ç´¹ä»‹ã—ã¾ã™ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[!NOTE]&lt;br&gt;&lt;span style=&quot;color: #c00000;&quot;&gt;2023 å¹´ 9 æœˆã€é€ä¿¡æ¥ç¶šã®æ§‹æˆã®ä¸€ã¤ã§ã‚ã‚‹&lt;a href=&quot;https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/default-outbound-access&quot;&gt;æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹&lt;/a&gt;ã®æä¾›çµ‚äº†ãŒã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã•ã‚Œã¾ã—ãŸã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ã“ã‚Œã¯ã€2025 å¹´ 9 æœˆ 30 æ—¥ä»¥é™ã«ä½œæˆã•ã‚ŒãŸ Azure VM ã¯ã€å¾Œè¿°ã® Azure æ—¢å®šã® SNAT ãŒå»ƒæ­¢ã•ã‚Œã€æ˜ç¤ºçš„ãªå¤–éƒ¨æ¥ç¶šãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ãªã„é™ã‚Šã€Azure ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®å¤–éƒ¨é€ä¿¡ãŒè¡Œãˆãªããªã‚‹ã¨ã„ã†å†…å®¹ã§ã™ã€‚å»ƒæ­¢ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã«é–¢ã™ã‚‹è£œè¶³ã«ã¤ã„ã¦ã¯ã€å½“ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®ä»¥ä¸‹ã®è¨˜äº‹ã‚’ã”å‚ç…§ã®ä¸Šã€æŠ€è¡“çš„ãªå†…å®¹ã«ã¤ã„ã¦ã¯ä½µã›ã¦æœ¬è¨˜äº‹ã‚’ã”ç¢ºèªã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jpaztech.github.io/blog/network/default-outbound-access-for-vms-will-be-retired/&quot;&gt;Azure æ—¢å®šã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã®å‹•ä½œå¤‰æ›´ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã«é–¢ã™ã‚‹è£œè¶³ (Tracking ID:3T84-PZZ)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Network" scheme="https://jpaztech.github.io/blog/tags/Network/"/>
    
    <category term="Public IP Address" scheme="https://jpaztech.github.io/blog/tags/Public-IP-Address/"/>
    
    <category term="NAT Gateway" scheme="https://jpaztech.github.io/blog/tags/NAT-Gateway/"/>
    
    <category term="Azure Load Balancer" scheme="https://jpaztech.github.io/blog/tags/Azure-Load-Balancer/"/>
    
    <category term="SNAT" scheme="https://jpaztech.github.io/blog/tags/SNAT/"/>
    
  </entry>
  
  <entry>
    <title>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã§ä½¿ç”¨ã—ã¦ã„ãŸ VHD ã‹ã‚‰ ARM VM ã‚’ä½œæˆã™ã‚‹æ‰‹é †</title>
    <link href="https://jpaztech.github.io/blog/vm/classic-vhd-to-arm-vm/"/>
    <id>https://jpaztech.github.io/blog/vm/classic-vhd-to-arm-vm/</id>
    <published>2023-09-01T00:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.276Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚<br>Azure ã®ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã¯ 2023 å¹´ 9 æœˆ 6 æ—¥ã‚’æŒã¡ã¾ã—ã¦å»ƒæ­¢ã¨ãªã‚Šã¾ã—ãŸã€‚<br>ãã®ãŸã‚ã“ã‚Œä»¥é™ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ VM ã¯ ARMï¼ˆAzure Resource Managerï¼‰ã® VM ã¨ãªã‚Šã¾ã™ã€‚<br>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã® ARM VM ã¸ã®ç§»è¡Œã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç­‰ãŒã”ã–ã„ã¾ã™ã€‚  </p><p>â– ã”å‚è€ƒï¼š2023 å¹´ 9 æœˆ 6 æ—¥ã¾ã§ã« IaaS ãƒªã‚½ãƒ¼ã‚¹ã‚’ Azure Resource Manager ã«ç§»è¡Œã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/classic-vm-deprecation">https://learn.microsoft.com/ja-jp/azure/virtual-machines/classic-vm-deprecation</a>  </p><p>â– ã”å‚è€ƒï¼šClassic VM ã‹ã‚‰ ARM ã¸ã®ç§»è¡Œã«ã¤ã„ã¦ã®æ³¨æ„äº‹é … (VMã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç·¨)<br><a href="https://jpaztech.github.io/blog/vm/migrate_classic_vm_and_storage">https://jpaztech.github.io/blog/vm/migrate_classic_vm_and_storage</a>  </p><p>ä»–æ–¹ã€ä¸Šè¨˜ã¨ã¯åˆ¥ã®æ–¹æ³•ã¨ã—ã¦ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã§ä½¿ç”¨ã—ã¦ã„ãŸ OS ãƒ‡ã‚£ã‚¹ã‚¯ã® VHD ã‹ã‚‰ ARM VM ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã”ã–ã„ã¾ã™ã®ã§ã€ä»Šå›ã¯ã“ã®æ‰‹é †ã«ã¤ã„ã¦ã”èª¬æ˜ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><div class="alert is-info"><p class="alert-title">Note</p><p>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã§ä½¿ç”¨ã—ã¦ã„ãŸ VHD ã¯ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ä¿å­˜ã•ã‚Œã¦ãŠã‚Šã¾ã™ãŒã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚ 2024 å¹´ 8 æœˆ 31 æ—¥ã«å®Œå…¨ã«å»ƒæ­¢ã•ã‚Œã¾ã™ã€‚</p><p>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§»è¡Œã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã¾ã›ã€‚</p><p>ã€€</p><p>â– ã”å‚è€ƒï¼šã‚¯ãƒ©ã‚·ãƒƒã‚¯ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ Azure Resource Manager ã¸ 2024 å¹´ 8 æœˆ 31 æ—¥ã¾ã§ã«ç§»è¡Œã™ã‚‹</p><p><a href="https://learn.microsoft.com/ja-jp/azure/storage/common/classic-account-migration-overview">https://learn.microsoft.com/ja-jp/azure/storage/common/classic-account-migration-overview</a></p></div><hr><h2 id="æ‰‹é †ã®å¤§ã¾ã‹ãªæµã‚Œ"><a href="#æ‰‹é †ã®å¤§ã¾ã‹ãªæµã‚Œ" class="headerlink" title="æ‰‹é †ã®å¤§ã¾ã‹ãªæµã‚Œ"></a>æ‰‹é †ã®å¤§ã¾ã‹ãªæµã‚Œ</h2><p>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã§ä½¿ç”¨ã—ã¦ã„ãŸ OS ãƒ‡ã‚£ã‚¹ã‚¯ã® VHD ã‹ã‚‰ ARM VM ã‚’ä½œæˆã™ã‚‹æ‰‹é †ã«ã¤ã„ã¦ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ VHD ã‹ã‚‰ãã®ã¾ã¾ã§ã¯ ARM VM ã®ä½œæˆãŒå¶ã„ã¾ã›ã‚“ãŸã‚ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’è¸ã‚€å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚  </p><ol><li>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ VHD ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚ï¼ˆAzCopy ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼‰</li><li>ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã® VHD ã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚</li><li>ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ ARM VM ã‚’ä½œæˆã™ã‚‹ã€‚</li></ol><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-11-01-20.png"></p><p>ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆã®ãŸã‚ã«ã¯ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« VHD ã‚’ä¸€æ—¦ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚å°‘ã—æ‰‹é †ãŒå¤šã„ã§ã™ãŒä¸€ã¤ãšã¤è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>ãã‚Œã§ã¯ã€ãã‚Œãã‚Œã®æ‰‹é †ã®è©³ç´°ã‚’ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><hr><h2 id="1-ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰-ARM-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸-VHD-ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚ï¼ˆAzCopy-ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼‰"><a href="#1-ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰-ARM-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸-VHD-ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚ï¼ˆAzCopy-ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼‰" class="headerlink" title="1. ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ VHD ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚ï¼ˆAzCopy ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼‰"></a>1. ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ VHD ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚ï¼ˆAzCopy ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼‰</h2><p>AzCopy ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ VHD ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚<br>ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã®ãŸã‚ã« <strong>&lt;â‘ ã‚³ãƒ”ãƒ¼å…ƒãƒ‡ã‚£ã‚¹ã‚¯ã® Blob URI&gt;&lt;â‘¡ã‚³ãƒ”ãƒ¼å…ƒ SAS ãƒˆãƒ¼ã‚¯ãƒ³&gt;&lt;â‘¢ã‚³ãƒ”ãƒ¼å…ˆ URL&gt;</strong> ã® 3 ã¤ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã®ã§ã€ä»¥ä¸‹ã®é †ã§ç”¨æ„ã‚’ã—ã¾ã™ã€‚</p><hr><h3 id="1-1-ã‚¯ãƒ©ã‚·ãƒƒã‚¯-VM-ã§ä½¿ç”¨ã—ã¦ã„ãŸ-VHD-ã®-Blob-URI-ã‚’ç‰¹å®šã™ã‚‹ã€‚"><a href="#1-1-ã‚¯ãƒ©ã‚·ãƒƒã‚¯-VM-ã§ä½¿ç”¨ã—ã¦ã„ãŸ-VHD-ã®-Blob-URI-ã‚’ç‰¹å®šã™ã‚‹ã€‚" class="headerlink" title="1-1. ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã§ä½¿ç”¨ã—ã¦ã„ãŸ VHD ã® Blob URI ã‚’ç‰¹å®šã™ã‚‹ã€‚"></a>1-1. ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã§ä½¿ç”¨ã—ã¦ã„ãŸ VHD ã® Blob URI ã‚’ç‰¹å®šã™ã‚‹ã€‚</h3><p>ãƒãƒ¼ã‚¿ãƒ«ã®ä¸Šéƒ¨ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚ˆã‚Šã€Œä»®æƒ³ãƒã‚·ãƒ³ (ã‚¯ãƒ©ã‚·ãƒƒã‚¯)ã€ã‚’æ¤œç´¢ã—ã¦ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-14-32-30.png"></p><p>è¡¨ç¤ºã•ã‚ŒãŸã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã®ä¸€è¦§ã‹ã‚‰å¯¾è±¡ã¨ãªã‚‹ VM ã‚’é¸æŠã—ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-14-33-57.png"></p><p>ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-15-49-14.png"></p><p>å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Šã€Œãƒ‡ã‚£ã‚¹ã‚¯ã€ã‚’é¸æŠã—ã¦ã€OS ãƒ‡ã‚£ã‚¹ã‚¯ã®åå‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-14-34-57.png"></p><p>ãƒ‡ã‚£ã‚¹ã‚¯ã® Blob URI ãŒã€Œå ´æ‰€ã€ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€ã“ã® URI ã‚’ <strong>&lt;â‘ ã‚³ãƒ”ãƒ¼å…ƒãƒ‡ã‚£ã‚¹ã‚¯ã® Blob URI&gt;</strong> ã¨ã—ã¦ãƒ¡ãƒ¢ã—ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-14-36-48.png"></p><p>ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆã¯åŒã˜æ‰‹é †ã§ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ã«ã¤ã„ã¦ã‚‚ URI ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚</p><hr><h3 id="1-2-ã‚³ãƒ”ãƒ¼å…ƒã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™"><a href="#1-2-ã‚³ãƒ”ãƒ¼å…ƒã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™" class="headerlink" title="1-2. ã‚³ãƒ”ãƒ¼å…ƒã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™"></a>1-2. ã‚³ãƒ”ãƒ¼å…ƒã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™</h3><p>å…ˆã®æ‰‹é †ã§ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã®ãƒ‡ã‚£ã‚¹ã‚¯ã® Blob URI ã‚’ <strong>&lt;â‘ ãƒ‡ã‚£ã‚¹ã‚¯ã® Blob URI&gt;</strong> ã¨ã—ã¦ãƒ¡ãƒ¢ã—ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚<br>Blob URI ã‚ˆã‚Šä»¥ä¸‹ã®é€šã‚Šã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåãŒåˆ¤åˆ¥å¯èƒ½ã§ã™ã€‚</p><blockquote><p>https://<strong>&lt;ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå&gt;</strong>.blob.core.windows.net/&lt;ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å&gt;/&lt;VHDå&gt;.vhd</p></blockquote><p>ã“ã¡ã‚‰ã§ç¢ºèªã—ãŸã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’ã€ãƒãƒ¼ã‚¿ãƒ«ã®ä¸Šéƒ¨ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚ˆã‚Šæ¤œç´¢ã—ã¦ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-16-27-20.png"></p><p>è¡¨ç¤ºã•ã‚ŒãŸã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç”»é¢ã«ã¦ã€å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Šã€ŒShared Access Signatureã€ã‚’é¸æŠã—ã€ä»¥ä¸‹ã®ç”»åƒã®ä¾‹ã®ã‚ˆã†ã« SAS ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã— <strong>&lt;â‘¡ã‚³ãƒ”ãƒ¼å…ƒ SAS ãƒˆãƒ¼ã‚¯ãƒ³&gt;</strong> ã¨ã—ã¦ãƒ¡ãƒ¢ã—ã¾ã™ã€‚<br>ã“ã®éš› SAS ã®æœ‰åŠ¹æœŸé™ç­‰ã‚’é©åˆ‡ã«è¨­å®šã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-09-20-13.png"></p><p>ä»¥ä¸Šã§ã‚³ãƒ”ãƒ¼å…ƒã®æº–å‚™ã¯å®Œäº†ã§ã™ã€‚</p><hr><h3 id="1-3-ã‚³ãƒ”ãƒ¼å…ˆ-ARM-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™"><a href="#1-3-ã‚³ãƒ”ãƒ¼å…ˆ-ARM-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™" class="headerlink" title="1-3. ã‚³ãƒ”ãƒ¼å…ˆ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™"></a>1-3. ã‚³ãƒ”ãƒ¼å…ˆ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™</h3><p>ã‚³ãƒ”ãƒ¼å…ˆã® ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚<br>æ—¢ã« ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã¯ã€ãã¡ã‚‰ã‚’ã”åˆ©ç”¨ã„ãŸã ã„ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚</p><p>ãƒãƒ¼ã‚¿ãƒ«ã®ä¸Šéƒ¨ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚ˆã‚Šã€Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚’æ¤œç´¢ã—ã¦ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¸€è¦§ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-15-46-00.png"></p><p>ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ç”»é¢ã®å·¦ä¸Šã«ã‚ã‚‹ã€Œä½œæˆã€ã‚ˆã‚Š ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-15-46-57.png"></p><p>ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã®éš›ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆåœ°åŸŸï¼‰ã¯ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã¨åŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ä½œæˆã—ã¾ã™ã€‚<br>ä¸€æ™‚çš„ãªã‚‚ã®ã§ã™ã®ã§å†—é•·æ€§ã¯ã€ŒLRSã€ã§è‰¯ã„ã‹ã¨å­˜ã˜ã¾ã™ã€‚ãã®ä»–ã®è¨­å®šé …ç›®ã¯æ—¢å®šã®ã¾ã¾ã§å•é¡Œãªã„ã‚‚ã®ã¨å­˜ã˜ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-15-57-23.png"></p><p>ä½œæˆã—ãŸã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã€å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Šã€Œã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã€ã‚’é¸æŠã—ã€ä¸Šéƒ¨ã®ã€Œï¼‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã€ã‹ã‚‰æ–°è¦ Blob ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-16-03-53.png"></p><p>ä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’é¸æŠã—ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®ç”»é¢ã®å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Šã€Œå…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ ãƒˆãƒ¼ã‚¯ãƒ³ã€ã‚’é¸æŠã®ä¸Šã€ä»¥ä¸‹ã®å›³ã®ä¾‹ã®ã‚ˆã†ã«ã‚³ãƒ”ãƒ¼å…ˆã® URL ã‚’ç”Ÿæˆã—ã¾ã™ã€‚<br>ã“ã®éš›ã‚‚ SAS ã®æœ‰åŠ¹æœŸé™ç­‰ã‚’é©åˆ‡ã«è¨­å®šã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚ŒãŸã€ŒBLOB SAS URLã€ãŒ <strong>&lt;â‘¢ã‚³ãƒ”ãƒ¼å…ˆ URL&gt;</strong> ã¨ãªã‚Šã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-15-16-19-19.png"></p><p>ä»¥ä¸Šã§ã‚³ãƒ”ãƒ¼å…ˆã®æº–å‚™ã‚‚å®Œäº†ã—ã¾ã—ãŸã€‚</p><hr><h3 id="1-4-AzCopy-ã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿ç«‹ã¦ã‚‹"><a href="#1-4-AzCopy-ã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿ç«‹ã¦ã‚‹" class="headerlink" title="1-4. AzCopy ã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿ç«‹ã¦ã‚‹"></a>1-4. AzCopy ã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿ç«‹ã¦ã‚‹</h3><p>ç”¨æ„ã—ãŸ <strong>&lt;â‘ ã‚³ãƒ”ãƒ¼å…ƒãƒ‡ã‚£ã‚¹ã‚¯ã® Blob URI&gt;&lt;â‘¡ã‚³ãƒ”ãƒ¼å…ƒ SAS ãƒˆãƒ¼ã‚¯ãƒ³&gt;&lt;â‘¢ã‚³ãƒ”ãƒ¼å…ˆ URL&gt;</strong> ã‚’ä½¿ã£ã¦ã€ã‚³ãƒ”ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ AzCopy ã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚<br>ä»¥ä¸‹ã®é †ã§ä¸¦ã¹ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">azcopy copy &#x27;&lt;â‘ ã‚³ãƒ”ãƒ¼å…ƒãƒ‡ã‚£ã‚¹ã‚¯ã® Blob URI&gt;&lt;â‘¡ã‚³ãƒ”ãƒ¼å…ƒ SAS ãƒˆãƒ¼ã‚¯ãƒ³&gt;&#x27; &#x27;&lt;â‘¢ã‚³ãƒ”ãƒ¼å…ˆ URL&gt;&#x27; --blob-type PageBlob</span><br></pre></td></tr></table></figure><p>å®Ÿéš›ã®æ–‡å­—åˆ—ã®ä¾‹ã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã¨ãªã‚Šã¾ã™ã€‚  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">azcopy copy &#x27;https://classicsasample8.blob.core.windows.net/vhds/os-disk.vhd?sv=2022-11-02&amp;ss=b&amp;srt=sco&amp;sp=rl&amp;se=2023-08-16T10:08:35Z&amp;st=2023-08-16T02:08:35Z&amp;spr=https&amp;sig=saskeyverylongsaskeyverylongsaskeyverylong%3D&#x27; &#x27;https://armsasample8.blob.core.windows.net/newvhd?sp=racwl&amp;st=2023-08-16T02:09:36Z&amp;se=2023-08-16T10:09:36Z&amp;spr=https&amp;sv=2022-11-02&amp;sr=c&amp;sig=hereisasykeyhereisasykeyhereisasykey%3D&#x27; --blob-type PageBlob</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã«ã¦å®Ÿè¡Œã™ã‚‹ AzCopy ã®ã‚³ãƒãƒ³ãƒ‰ãŒç”¨æ„ã§ãã¾ã—ãŸã€‚</p><hr><h3 id="1-5-Cloud-Shell-ã«ã¦-AzCopy-ã‚³ãƒãƒ³ãƒ‰ã§-VHD-ã‚³ãƒ”ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹"><a href="#1-5-Cloud-Shell-ã«ã¦-AzCopy-ã‚³ãƒãƒ³ãƒ‰ã§-VHD-ã‚³ãƒ”ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹" class="headerlink" title="1-5. Cloud Shell ã«ã¦ AzCopy ã‚³ãƒãƒ³ãƒ‰ã§ VHD ã‚³ãƒ”ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹"></a>1-5. Cloud Shell ã«ã¦ AzCopy ã‚³ãƒãƒ³ãƒ‰ã§ VHD ã‚³ãƒ”ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹</h3><p>AzCopy ã¯ã‚³ãƒãƒ³ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼ãªã©ã‚’è¡Œãˆã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§ã™ã€‚<br>ä»Šå›ã¯æ—¢å®šã§ AzCopy ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ Cloud Shell ã‚’åˆ©ç”¨ã—ãŸæ‰‹é †ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>æ—¢ã« AzCopy ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã‚’ãŠæŒã¡ã®å ´åˆã¯ãã¡ã‚‰ã‚’ã”åˆ©ç”¨ã„ãŸã ã„ã¦ã‚‚å•é¡Œã”ã–ã„ã¾ã›ã‚“ã€‚  </p><p>â– ã”å‚è€ƒï¼šAzCopy ã‚’ä½¿ã£ã¦ã¿ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/storage/common/storage-use-azcopy-v10">https://learn.microsoft.com/ja-jp/azure/storage/common/storage-use-azcopy-v10</a></p><p>ã¾ãšã€ãƒãƒ¼ã‚¿ãƒ«å³ä¸Šã® Cloud Shell èµ·å‹•ãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-09-24-27.png"></p><p>åˆã‚ã¦ Cloud Shell ã‚’ã”åˆ©ç”¨é ‚ãå ´åˆã¯ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€è¡¨ç¤ºã•ã‚ŒãŸå†…å®¹ã«æ²¿ã£ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>ãªãŠã€Cloud Shell ã® Bash / PowerShell ã©ã¡ã‚‰ã«ã‚‚ AzCopy ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã©ã¡ã‚‰ã‚’ã”åˆ©ç”¨ã„ãŸã ã„ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚  </p><p>Cloud Shell ãŒèµ·å‹•ã—ãŸã‚‰ç”¨æ„ã—ãŸ AzCopy ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<br>æ­£å¸¸å®Œäº†ã—ãŸå ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ŒNumber of Transfers Completed: 1ã€ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-11-19-12.png"></p><p>ã“ã‚Œã«ã¦ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« VHD ã®ã‚³ãƒ”ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br>ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ã‚‚åˆã‚ã›ã¦ç§»è¡Œã™ã‚‹å ´åˆã¯ã€åŒæ§˜ã®æ‰‹é †ã§ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ã‚‚ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><hr><h2 id="2-ARM-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®-VHD-ã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚"><a href="#2-ARM-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®-VHD-ã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚" class="headerlink" title="2. ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã® VHD ã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚"></a>2. ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã® VHD ã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚</h2><p>æ¬¡ã« ARM VM ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚<br>ãƒãƒ¼ã‚¿ãƒ«ã®ä¸Šéƒ¨ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚ˆã‚Šã€Œãƒ‡ã‚£ã‚¹ã‚¯ã€ã‚’æ¤œç´¢ã—ã¦ã€ãƒ‡ã‚£ã‚¹ã‚¯ã®ä¸€è¦§ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-11-22-38.png"></p><p>å·¦ä¸Šã®ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚</p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-11-23-42.png"></p><p>ãƒ‡ã‚£ã‚¹ã‚¯ã®æ–°è¦ä½œæˆç”»é¢ã«é·ç§»ã™ã‚‹ã®ã§ã€ä»¥ä¸‹ã®å½¢ã§ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚</p><table><thead><tr><th align="left">é …ç›®</th><th align="left">é¸æŠã™ã‚‹å†…å®¹</th></tr></thead><tbody><tr><td align="left">ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</td><td align="left">å½“è©²ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚</td></tr><tr><td align="left">ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—</td><td align="left">ä»»æ„ã§æ§‹ã„ã¾ã›ã‚“ã€‚</td></tr><tr><td align="left">ãƒ‡ã‚£ã‚¹ã‚¯å</td><td align="left">ä»»æ„ã§æ§‹ã„ã¾ã›ã‚“ã€‚</td></tr><tr><td align="left">åœ°åŸŸ</td><td align="left">å…ƒã®ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã¨åŒä¸€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã—ã¾ã™ã€‚</td></tr><tr><td align="left">å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³</td><td align="left">ã‚¾ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ãªã„å ´åˆã¯ã€Œå¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€ã‚’é¸æŠã—ã¾ã™ã€‚</td></tr><tr><td align="left">ã‚½ãƒ¼ã‚¹ã®ç¨®é¡</td><td align="left">ã€Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ BLOBã€ã‚’é¸æŠã—ã¾ã™ã€‚</td></tr><tr><td align="left">ã‚½ãƒ¼ã‚¹ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</td><td align="left">å½“è©²ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚</td></tr><tr><td align="left">ã‚½ãƒ¼ã‚¹ BLOB</td><td align="left">ã€Œå‚ç…§ã€ãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã€ã‚³ãƒ”ãƒ¼ã—ãŸ ARM ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã® VHD ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚ã“ã®éš›ã‚µã‚¤ã‚ºã‚‚ç¢ºèªã§ãã¾ã™ã€‚</td></tr><tr><td align="left">OS ã®ç¨®é¡</td><td align="left">VHD ã®å†…å®¹ã«åˆã‚ã›ã¦ã”é¸æŠãã ã•ã„ã€‚</td></tr><tr><td align="left">VM ã®ä¸–ä»£</td><td align="left">å…ƒãŒã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ãªã®ã§ã€Œç¬¬ 1 ä¸–ä»£ã€ã‚’é¸æŠã—ã¾ã™ã€‚</td></tr><tr><td align="left">VM ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</td><td align="left">æ—¢å®šã®ã€Œx64ã€ã¨ãªã‚Šã¾ã™ã€‚</td></tr><tr><td align="left">ã‚µã‚¤ã‚º</td><td align="left">VHD ã‚ˆã‚Šå¤§ããªã‚µã‚¤ã‚ºã«è¨­å®šã—ã¾ã™ã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç¨®é¡ã¯ä»»æ„ã§æ§‹ã„ã¾ã›ã‚“ã€‚</td></tr></tbody></table><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-11-41-10.png"></p><p>ãã®ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æ—¢å®šã®ã¾ã¾ã§å¤§ä¸ˆå¤«ã§ã™ã®ã§ã€ãƒ‡ã‚£ã‚¹ã‚¯ã®ä½œæˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚<br>ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆã¯åŒæ§˜ã®æ‰‹é †ã§ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ã‚‚ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><hr><h2 id="3-ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰-ARM-VM-ã‚’ä½œæˆã™ã‚‹ã€‚"><a href="#3-ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰-ARM-VM-ã‚’ä½œæˆã™ã‚‹ã€‚" class="headerlink" title="3. ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ ARM VM ã‚’ä½œæˆã™ã‚‹ã€‚"></a>3. ãƒ‡ã‚£ã‚¹ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ ARM VM ã‚’ä½œæˆã™ã‚‹ã€‚</h2><p>æœ€å¾Œã«ä½œæˆã—ãŸ OS ãƒ‡ã‚£ã‚¹ã‚¯ã®ãƒªã‚½ãƒ¼ã‚¹ã®ç”»é¢ã‚’ãƒãƒ¼ã‚¿ãƒ«ã§è¡¨ç¤ºã—ã¾ã™ã€‚<br>ä¸Šéƒ¨ã«ã€ŒVM ã®ä½œæˆã€ãƒœã‚¿ãƒ³ãŒã”ã–ã„ã¾ã™ã®ã§ã€ã“ã¡ã‚‰ã‚’é¸æŠã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-11-44-29.png"></p><p>æ–°è¦ ARM VM ã®ä½œæˆç”»é¢ã«é·ç§»ã„ãŸã—ã¾ã™ã®ã§ã€ãŠå®¢æ§˜ã®ç’°å¢ƒã«åˆã‚ã›ã¦ ARM VM ã®ä½œæˆã‚’å®Ÿæ–½ãã ã•ã„ã¾ã›ã€‚<br>ä½œæˆæ™‚ã«ã€Œãƒ‡ã‚£ã‚¹ã‚¯ã€ã®ã‚¿ãƒ–ã‚ˆã‚Šãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ã®ã‚¢ã‚¿ãƒƒãƒã‚‚å¯èƒ½ã§ã”ã–ã„ã¾ã™ã€‚  </p><p><img src="/blog/vm/classic-vhd-to-arm-vm/2023-08-16-14-38-17.png"></p><hr><p>ä»¥ä¸Šã§ ARM VM ã®ä½œæˆãŒã§ãã¾ã—ãŸã€‚å¿…è¦ã«å¿œã˜ã¦ä¸è¦ã¨ãªã£ãŸ VHD ãªã©ã¯å‰Šé™¤ãã ã•ã„ã¾ã›ã€‚<br>ä¸Šè¨˜ã®å†…å®¹ãŒãŠå½¹ã«ç«‹ã¦ã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚&lt;br&gt;Azure ã®ã‚¯ãƒ©ã‚·ãƒƒã‚¯ VM ã¯ 2023 å¹´ 9 æœˆ 6 æ—¥ã‚’æŒã¡ã¾ã—ã¦å»ƒæ­¢ã¨ãªã‚Šã¾ã—ãŸã€‚&lt;br&gt;ãã®ãŸã‚ã“ã‚Œä»¥é™ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ VM ã¯ ARMï¼ˆAzure Resource Managerï¼‰ã® </summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
    <category term="Windows" scheme="https://jpaztech.github.io/blog/tags/Windows/"/>
    
    <category term="Linux" scheme="https://jpaztech.github.io/blog/tags/Linux/"/>
    
    <category term="HowTo" scheme="https://jpaztech.github.io/blog/tags/HowTo/"/>
    
  </entry>
  
  <entry>
    <title>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ï¼ˆFAQï¼‰</title>
    <link href="https://jpaztech.github.io/blog/vm/self-service-maintenance/"/>
    <id>https://jpaztech.github.io/blog/vm/self-service-maintenance/</id>
    <published>2023-08-18T03:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.492Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚<br>ä»Šå›ã¯ã‚ˆããŠå•ã„åˆã‚ã›ã„ãŸã ã VMï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰ã®ã€Œå†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ã«ä¼´ã„ã€äº‹å‰ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå¯èƒ½ã¨ãªã‚‹ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã‚’è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><ul><li><a href=".#%E3%82%BB%E3%83%AB%E3%83%95%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%AE%E6%A6%82%E8%A6%81">ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®æ¦‚è¦</a></li><li><a href=".#%E5%86%8D%E8%B5%B7%E5%8B%95%E3%82%92%E4%BC%B4%E3%81%86%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E5%AF%BE%E8%B1%A1-VM-%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E8%A1%8C%E3%81%88%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ã®ç¢ºèªã¯ã©ã®ã‚ˆã†ã«è¡Œãˆã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E5%86%8D%E8%B5%B7%E5%8B%95%E3%82%92%E4%BC%B4%E3%81%86%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%AE%E8%A8%88%E7%94%BB%E3%82%92%E3%83%A1%E3%83%BC%E3%83%AB%E9%80%9A%E7%9F%A5%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è¨ˆç”»ã‚’ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E5%86%8D%E8%B5%B7%E5%8B%95%E3%82%92%E4%BC%B4%E3%81%86%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%AE%E9%80%9A%E7%9F%A5%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E3%82%BB%E3%83%AB%E3%83%95%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E9%80%9A%E5%B8%B8%E3%81%AE%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6%E8%A7%A3%E9%99%A4%E3%82%84%E5%86%8D%E8%B5%B7%E5%8B%95%E7%AD%89%E3%81%A7%E3%82%BB%E3%83%AB%E3%83%95%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%AF%E5%AE%8C%E4%BA%86%E3%81%97%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">é€šå¸¸ã®å‰²ã‚Šå½“ã¦è§£é™¤ã‚„å†èµ·å‹•ç­‰ã§ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E5%86%8D%E8%B5%B7%E5%8B%95%E3%82%92%E4%BC%B4%E3%81%86%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E5%AF%BE%E8%B1%A1%E4%B8%80%E8%A6%A7%E3%81%8B%E3%82%89%E5%AF%BE%E8%B1%A1-VM-%E3%81%8C%E6%B6%88%E3%81%88%E3%81%A6%E3%81%84%E3%81%9F%E3%81%AE%E3%81%A7%E3%81%99%E3%81%8C%E4%BD%95%E6%95%85%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ä¸€è¦§ã‹ã‚‰å¯¾è±¡ VM ãŒæ¶ˆãˆã¦ã„ãŸã®ã§ã™ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E5%86%8D%E8%B5%B7%E5%8B%95%E3%82%92%E4%BC%B4%E3%81%86%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%AE%E5%AE%8C%E4%BA%86%EF%BC%88%E6%88%90%E5%8A%9F%EF%BC%89%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å®Œäº†ï¼ˆæˆåŠŸï¼‰ã®ç¢ºèªæ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E3%82%BB%E3%83%AB%E3%83%95%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AF-VM-%E3%81%8C%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œæ™‚ã¯ VM ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E3%82%BB%E3%83%AB%E3%83%95%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E6%9C%9F%E9%96%93%E4%B8%AD%E3%81%AB%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%82%92%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœŸé–“ä¸­ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’ã—ãªã„ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E5%88%A5%E3%81%AE%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E3%81%AF%E3%81%93%E3%81%AE%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%8C%E9%80%9A%E7%9F%A5%E3%81%95%E3%82%8C%E3%81%BE%E3%81%9B%E3%82%93%E3%81%8C%E4%BD%95%E6%95%85%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">åˆ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒé€šçŸ¥ã•ã‚Œã¾ã›ã‚“ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ</a></li><li><a href=".#%E3%83%A1%E3%83%BC%E3%83%AB%E3%81%A7%E3%81%AE%E3%81%BF%E5%AF%BE%E8%B1%A1-VM-%E3%81%8C%E9%80%9A%E7%9F%A5%E3%81%95%E3%82%8C%E3%82%8B%E5%86%8D%E8%B5%B7%E5%8B%95%E3%82%92%E4%BC%B4%E3%81%86%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">ãƒ¡ãƒ¼ãƒ«ã§ã®ã¿å¯¾è±¡ VM ãŒé€šçŸ¥ã•ã‚Œã‚‹å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦</a></li></ul><hr><h2 id="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®æ¦‚è¦"><a href="#ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®æ¦‚è¦" class="headerlink" title="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®æ¦‚è¦"></a>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®æ¦‚è¦</h2><p>Azure ã§ã¯ãŠå®¢æ§˜ã®å®‰å…¨ã®ãŸã‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¯¾å¿œã‚„æ©Ÿèƒ½æ”¹ä¿®ç­‰ã¨ã—ã¦æ—¥ã€…ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’è¡Œã£ã¦ãŠã‚Šã¾ã™ã€‚<br>ãã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ä¸­ã§ã€ç¨€ã«ãŠå®¢æ§˜ã® VM ã®å†èµ·å‹•ã‚’ä¼´ã†å ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>ã“ã®ã‚ˆã†ãªãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ã€Œå†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ã¨å‘¼ã°ã‚Œã¦ãŠã‚Šã¾ã™ã€‚</p><p>â– ã”å‚è€ƒï¼šAzure ã§ã®ä»®æƒ³ãƒã‚·ãƒ³ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-and-updates">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-and-updates</a></p><p>â– ã”å‚è€ƒï¼šè¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®å‡¦ç†<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications</a></p><p>â– ã”å‚è€ƒï¼šAzure IaaS VM ã§å®Ÿæ–½ã•ã‚Œã‚‹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦<br><a href="https://jpaztech.github.io/blog/vm/vm-maintenance/">https://jpaztech.github.io/blog/vm/vm-maintenance/</a></p><p>VM å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ã¯åŸå‰‡ã¨ã—ã¦ã€äº‹å‰ã«ãŠå®¢æ§˜ã®æ–¹ã§ä»»æ„ã®æ™‚é–“ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒæä¾›ã•ã‚Œã¾ã™ã€‚<br>ä»¥ä¸‹ã«ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ã‚ˆãå¯„ã›ã‚‰ã‚Œã‚‹è³ªå•ã®ã”æ¡ˆå†…ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã€å®Ÿéš›ã¯ Azure åŸºç›¤å´ã«ã¦ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ã”ã–ã„ã¾ã›ã‚“ã€‚</p><p>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå®Ÿè¡Œã•ã‚ŒãŸå ´åˆã€ãŠå®¢æ§˜ã® VM ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã®ç‰©ç†ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡å¤–ã®ç‰©ç†ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã«ç§»å‹•ã•ã‚Œã‚‹ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚</p></div><hr><h2 id="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡-VM-ã®ç¢ºèªã¯ã©ã®ã‚ˆã†ã«è¡Œãˆã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ"><a href="#å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡-VM-ã®ç¢ºèªã¯ã©ã®ã‚ˆã†ã«è¡Œãˆã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ" class="headerlink" title="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ã®ç¢ºèªã¯ã©ã®ã‚ˆã†ã«è¡Œãˆã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ"></a>å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ã®ç¢ºèªã¯ã©ã®ã‚ˆã†ã«è¡Œãˆã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</h2><p>ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã®é€šã‚Šã€Azure ãƒãƒ¼ã‚¿ãƒ« / Azure PowerShell / Azure CLI ã‚ˆã‚Šç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p><p>â– ã”å‚è€ƒï¼šãƒãƒ¼ã‚¿ãƒ«ã‚’ä½¿ç”¨ã—ãŸè¨ˆç”»æ¸ˆã¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®å‡¦ç†<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-portal">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-portal</a></p><p>â– ã”å‚è€ƒï¼šPowerShell ã‚’ä½¿ç”¨ã—ãŸè¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å‡¦ç†<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-powershell">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-powershell</a></p><p>â– ã”å‚è€ƒï¼šAzure CLI ã«å¯¾ã™ã‚‹è¨ˆç”»æ¸ˆã¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®å‡¦ç†<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-cli">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-cli</a></p><p>ã§ã¯ã€å®Ÿéš›ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ç¢ºèªã™ã‚‹ä¾‹ã‚’ 2 ã¤ã®æ–¹æ³•ã‚ˆã‚Šã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆäº¤ãˆã¦ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><h3 id="æ–¹æ³•-1-ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡-VM-ã‚’ç¢ºèªã™ã‚‹"><a href="#æ–¹æ³•-1-ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡-VM-ã‚’ç¢ºèªã™ã‚‹" class="headerlink" title="æ–¹æ³• 1: ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ã‚’ç¢ºèªã™ã‚‹"></a>æ–¹æ³• 1: ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ã‚’ç¢ºèªã™ã‚‹</h3><p>ãƒãƒ¼ã‚¿ãƒ«ä¸Šéƒ¨ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚ˆã‚Šã€Œã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã€ã‚’æ¤œç´¢ã—ã¦é¸æŠã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-07-11.png"></p><p>è¡¨ç¤ºã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã®ç”»é¢ã®ã€å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Šã€Œè¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚<br>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç­‰ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¨­å®šã—ã€å¯¾è±¡ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é¸æŠã™ã‚‹ã¨ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®æ¦‚è¦ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-12-02.png"></p><p>ä¸‹éƒ¨ã®ã€Œå½±éŸ¿ã‚’å—ã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã€ã‚¿ãƒ–ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã§ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã¨ãªã‚‹ VM ãŒç¢ºèªã§ãã¾ã™ã€‚<br>ã€ŒçŠ¶æ…‹ã€ã®åˆ—ãŒã€Œå…ˆè¡Œãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ç®¡ç†ã€ã«ãªã£ã¦ã„ã‚‹ VM ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚<br>ã€ŒçŠ¶æ…‹ã€ã®åˆ—ãŒã€Œæ›´æ–°æ¸ˆã¿ã€ã® VMã€ã‚‚ã—ãã¯ãã‚‚ãã‚‚ã€Œå½±éŸ¿ã‚’å—ã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã€è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ VM ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡å¤–ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-34-21.png"></p><h3 id="æ–¹æ³•-2-VM-ä¸€è¦§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡-VM-ã‚’ç¢ºèªã™ã‚‹"><a href="#æ–¹æ³•-2-VM-ä¸€è¦§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡-VM-ã‚’ç¢ºèªã™ã‚‹" class="headerlink" title="æ–¹æ³• 2: VM ä¸€è¦§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ã‚’ç¢ºèªã™ã‚‹"></a>æ–¹æ³• 2: VM ä¸€è¦§ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ã‚’ç¢ºèªã™ã‚‹</h3><p>ãƒãƒ¼ã‚¿ãƒ«ä¸Šéƒ¨ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚ˆã‚Šã€ŒVirtual Machinesã€ã‚’æ¤œç´¢ã—ã¦é¸æŠã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-23-02.png"></p><p>ä¸Šéƒ¨ã®ã€Œãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ãƒœã‚¿ãƒ³ã‚ˆã‚Šã€Œä»®æƒ³ãƒã‚·ãƒ³ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ã‚’é¸æŠã—ã¾ã™ã€‚</p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-25-33.png"></p><p>ä»®æƒ³ãƒã‚·ãƒ³ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸€è¦§ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã¨ãªã£ã¦ã„ã‚‹ VM ãŒã‚ã‚‹ã‹ç¢ºèªãŒã§ãã¾ã™ã€‚</p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-26-41.png"></p><hr><h2 id="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è¨ˆç”»ã‚’ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ"><a href="#å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è¨ˆç”»ã‚’ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ" class="headerlink" title="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è¨ˆç”»ã‚’ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ"></a>å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è¨ˆç”»ã‚’ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</h2><p>ä¸€éƒ¨ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ã¯ã€è¨­å®šã‚’ã—ãªãã¨ã‚‚ç®¡ç†è€…ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã•ã‚Œã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ãŒã€åŸå‰‡ã¨ã—ã¦å†èµ·å‹•ãŒä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒè¨ˆç”»ã•ã‚ŒãŸéš›ã«ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥ã‚’è¡Œã†ã«ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã®ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šã‚’è¡Œã†å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚  </p><p>â– ã”å‚è€ƒï¼šãƒãƒ¼ã‚¿ãƒ«ã®é€šçŸ¥ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-portal#notification-and-alerts-in-the-portal">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-portal#notification-and-alerts-in-the-portal</a></p><blockquote><p>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼æŠœç²‹ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼<br>ä»®æƒ³ãƒã‚·ãƒ³é–¢é€£ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥ã¯ã€Azure portal ã® [ã‚µãƒ¼ãƒ“ã‚¹ã®æ­£å¸¸æ€§] ã§ä½¿ç”¨ã§ãã¾ã™ã€‚<br>ä¸€éƒ¨ã®ç‰¹å®šã®ä»®æƒ³ãƒã‚·ãƒ³ã®è¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ã‚·ãƒŠãƒªã‚ªã§ã¯ã€Azure ãŒå¾“æ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†è€…ã€å…±åŒç®¡ç†è€…ã€ãŠã‚ˆã³ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ‰€æœ‰è€…ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã®ãƒ¡ãƒ¼ãƒ« (Service Health ä»¥å¤–) ã‚’é€ä¿¡ã—ã¦ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é€šçŸ¥ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼  </p></blockquote><p>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«é™ã‚‰ãšã€ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚¢ãƒ©ãƒ¼ãƒˆã¯ Azure ã‚µãƒ¼ãƒ“ã‚¹è‡ªä½“ã®æ­£å¸¸æ€§ã‚’ç›£è¦–ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚<br>ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚¢ãƒ©ãƒ¼ãƒˆã«ã¤ã„ã¦ã¯åˆ¥é€”å¼Šç¤¾ã®è§£èª¬ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚‚ã”ã–ã„ã¾ã™ã®ã§ã€å‚è€ƒã¨ã—ã¦ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><p>â– ã”å‚è€ƒï¼šã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®šæ‰‹é †ã¨æ¨å¥¨è¨­å®šã«ã¤ã„ã¦<br><a href="https://jpazmon-integ.github.io/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/">https://jpazmon-integ.github.io/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/</a></p><p>ã§ã¯ã€å®Ÿéš›ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’è¡Œã†ãŸã‚ã®æ‰‹é †ã«ã¤ã„ã¦ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’äº¤ãˆã¦ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><p>ãƒãƒ¼ã‚¿ãƒ«ä¸Šéƒ¨ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚ˆã‚Šã€Œã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã€ã‚’æ¤œç´¢ã—ã¦é¸æŠã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-07-11.png"></p><p>ä¸Šéƒ¨ã®ã€Œã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã‚¢ãƒ©ãƒ¼ãƒˆã®ä½œæˆã€ã‚’ãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-29-10.png"></p><p>ã‚¹ã‚³ãƒ¼ãƒ—ã«ã¦å¯¾è±¡ã¨ã™ã‚‹ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-30-10.png"></p><p>æ¡ä»¶ã«ã¦ã€VM ãŠã‚ˆã³ VMSS ã«é–¢ã™ã‚‹å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã‚’è¡Œã†ãŸã‚ã€ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</p><ul><li>ã‚µãƒ¼ãƒ“ã‚¹ï¼šVirtual Machines ãŠã‚ˆã³ Azure Virtual Machine Scale Sets ã‚’é¸æŠã€‚  </li><li>åœ°åŸŸï¼šä»»æ„ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã€‚</li><li>ã‚¤ãƒ™ãƒ³ãƒˆã®ç¨®é¡ï¼šè¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é¸æŠã€‚</li></ul><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-30-54.png"></p><p>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¦ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒè¨ˆç”»ã•ã‚ŒãŸéš›ã«ã©ã®ã‚ˆã†ã«é€šçŸ¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã®ã‹è¨­å®šã—ã¾ã™ã€‚<br>æ—¢ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ã‚°ãƒ«ãƒ¼ãƒ—ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ã‚°ãƒ«ãƒ¼ãƒ—ã®é¸æŠã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚<br>æ–°è¦ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’è¡Œã†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹éš›ã¯ã€ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆã€ã‚’é¸æŠã„ãŸã ãã€ä»»æ„ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸é€šçŸ¥ã‚’è¡Œã†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ–°è¦ä½œæˆã—ã¦ãã ã•ã„ã€‚</p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-31-57.png"></p><p>æœ€å¾Œã«è©³ç´°ã«ã¦ã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã®åå‰ã‚’è¨­å®šã—ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-32-53.png"></p><p>ã“ã‚Œã§å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒè¨ˆç”»ã•ã‚ŒãŸéš›ã«ã€ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’è¡Œã†ã‚¢ãƒ©ãƒ¼ãƒˆãŒä½œæˆã§ãã¾ã—ãŸã€‚</p><hr><h2 id="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"><a href="#å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ" class="headerlink" title="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"></a>å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</h2><p>ä»¥ä¸‹ã¯ã€å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã®ã‚µãƒ³ãƒ—ãƒ«ã¨ãªã‚Šã¾ã™ã€‚<br>ã€Œã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã€ã®ã€Œè¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ã‚ˆã‚Šç¢ºèªé ‚ãã“ã¨ãŒå¯èƒ½ã§ã”ã–ã„ã¾ã™ã€‚<br><strong>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ¯ã«å†…å®¹ã¯å¤‰ã‚ã‚Šã¾ã™ã®ã§ã€å®Ÿéš›ã«é€šçŸ¥ã•ã‚ŒãŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥å†…å®¹ã®ã”ç¢ºèªã‚’ãŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚</strong> </p><blockquote><p>Dear Azure customer,</p><p>One or more Azure Virtual Machines (VMs) associated with your subscription require a maintenance update to migrate these VMs to newer hardware. While the vast majority of platform maintenance causes no interruption to your services, this update will require a reboot.  </p><p>This maintenance has two phases: the self-service phase and a scheduled maintenance phase.  </p><p>Azure Service Health provides you with the current status of each VM that requires maintenance and allows you to initiate the self-service maintenance proactively â€“ any time between now and July 26, 2023 (23:59 UTC). If self-service maintenance has not been completed by then, Azure will automatically initiate maintenance on any VM that still requires it, sometime between July 27, 2023 (00:00 UTC) to August 02, 2023 (23:59 UTC). This scheduled maintenance will be performed one update domain at a time, to limit impact to environments configured for high availability.  </p><p>You can view a list of Affected Resources for this event under the ServiceHealth/PlannedMaintenance tab in the Azure portal  </p><p>You should expect each VM to be unavailable for up to 15 minutes after initiating the maintenance and note that operating system and data disks will be retained, but temporary storage will be lost during this maintenance. If you are using Dv1 or DSv1 VM sizes, please refer to the documentation <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-previous-gen">here</a> to understand performance changes if any.  </p><p>If you are using Proximity Placement Groups, please refer to the documentation <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/co-location#planned-maintenance-and-proximity-placement-groups">here</a> to understand how to verify the alignment of your resources and to take appropriate action if some resources are not aligned.  </p><p>We apologize for any impact that this maintenance may have. We strive to minimize the impact of platform maintenance, and to provide you with as much visibility and control as possible.  </p></blockquote><hr><h2 id="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ"><a href="#ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ" class="headerlink" title="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ"></a>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ</h2><p>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ã€é€šå¸¸ã®å†èµ·å‹•æ“ä½œã¨ã¯åˆ¥ã®æ“ä½œãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚<br>å…·ä½“çš„ãªå®Ÿè¡Œæ–¹æ³•ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã®é€šã‚Šã€Azure ãƒãƒ¼ã‚¿ãƒ« / Azure PowerShell / Azure CLI ã‚ˆã‚Šå®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚<br>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é–‹å§‹ã™ã‚‹ã¨ VM ãŒå†èµ·å‹•ã—ã¾ã™ã®ã§ã”ç•™æ„ãã ã•ã„ã€‚  </p><p>â– ã”å‚è€ƒï¼šãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ VM ã«å¯¾ã™ã‚‹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é–‹å§‹ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-portal#start-maintenance-on-your-vm-from-the-portal">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-portal#start-maintenance-on-your-vm-from-the-portal</a></p><p>â– ã”å‚è€ƒï¼šPowerShell ã‚’ä½¿ç”¨ã—ã¦ VM ã«å¯¾ã™ã‚‹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é–‹å§‹ã™ã‚‹<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-powershell#start-maintenance-on-your-vm-using-powershell">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-powershell#start-maintenance-on-your-vm-using-powershell</a></p><p>â– ã”å‚è€ƒï¼šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é–‹å§‹ã™ã‚‹ï¼ˆAzure CLIï¼‰<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-cli#start-maintenance">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications-cli#start-maintenance</a></p><p>ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰å®Ÿè¡Œã™ã‚‹ä¾‹ã¨ã—ã¦ã€å…ˆè¿°ã®ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã®è¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å¯¾è±¡ VM ç¢ºèªç”»é¢ã‚ˆã‚Šã€ã€Œå…ˆè¡Œãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ç®¡ç†ã€ãƒœã‚¿ãƒ³ã‚’æ¨ã™ã“ã¨ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹ç”»é¢ã«é·ç§»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-34-58.png"></p><p>ä»¥ä¸‹ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹ç”»é¢ã®ä¾‹ã¨ãªã‚Šã¾ã™ã€‚<br>ã€Œãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é–‹å§‹ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’é¸æŠé ‚ãã“ã¨ã§ã€ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-35-59.png"></p><p>ãªãŠã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã¨ãªã£ã¦ã„ã‚‹ VM ã«ã¤ã„ã¦ã¯å¯¾è±¡ VM ã®æ¦‚è¦ç”»é¢ã«ã‚‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒªãƒœãƒ³ãŒä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã¦ãŠã‚Šã€ã“ã®ãƒªãƒœãƒ³ã‚’é¸æŠé ‚ãã“ã¨ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹ã«é€²ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚  </p><p><img src="/blog/vm/self-service-maintenance/2023-07-26-13-38-00.png"></p><hr><h2 id="é€šå¸¸ã®å‰²ã‚Šå½“ã¦è§£é™¤ã‚„å†èµ·å‹•ç­‰ã§ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ"><a href="#é€šå¸¸ã®å‰²ã‚Šå½“ã¦è§£é™¤ã‚„å†èµ·å‹•ç­‰ã§ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ" class="headerlink" title="é€šå¸¸ã®å‰²ã‚Šå½“ã¦è§£é™¤ã‚„å†èµ·å‹•ç­‰ã§ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ"></a>é€šå¸¸ã®å‰²ã‚Šå½“ã¦è§£é™¤ã‚„å†èµ·å‹•ç­‰ã§ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ</h2><p>ã¾ãšã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå®Ÿè¡Œã•ã‚Œã€å®Œäº†æ™‚ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡å¤–ã®ç‰©ç†ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã« VM ãŒç§»å‹•ã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¦ã„ã‚‹æ–¹æ³•ã¨ã—ã¦ã¯ã€ä¸Šè¨˜ã®ã€Œã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é–‹å§‹ã€ã®æ–¹æ³•ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚  </p><p>ä»–æ–¹ã€ã€Œå‰²ã‚Šå½“ã¦è§£é™¤ã€ãŠã‚ˆã³ã€Œå†ãƒ‡ãƒ—ãƒ­ã‚¤ã€æ“ä½œã‚’è¡Œã£ã¦ã„ãŸã ã„ãŸå ´åˆã¯ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡å¤–ã®ç‰©ç†ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã« VM ãŒç§»å‹•ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã€çµæœã¨ã—ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†çŠ¶æ…‹ã¨ãªã‚‹å¯èƒ½æ€§ãŒã”ã–ã„ã¾ã™ã€‚<br>ã—ã‹ã—ãªãŒã‚‰ã€å¼•ãç¶šããƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã®ç‰©ç†ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã§ VM ãŒç¨¼åƒã™ã‚‹ã“ã¨ã‚‚ã”ã–ã„ã¾ã™ã€‚</p><p>ãªãŠã€ã€Œãƒãƒ¼ã‚¿ãƒ«ã§ã®å†èµ·å‹•ã€ã‚„ã€ŒOS å†…éƒ¨ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ / å†èµ·å‹•ã€ã®å ´åˆã€VM ã®ç‰©ç†ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ç§»å‹•ã¯èµ·ãã¾ã›ã‚“ãŸã‚ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†ã¨ã¯ãªã‚‰ãªã„ã‚‚ã®ã¨å­˜ã˜ã¾ã™ã€‚  </p><p>ã™ãªã‚ã¡ã€ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’è¡Œã†å ´åˆã¯å…ˆè¿°ã®ã€Œã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é–‹å§‹ã€ã®æ–¹æ³•ã§å®Ÿæ–½ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><hr><h2 id="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ä¸€è¦§ã‹ã‚‰å¯¾è±¡-VM-ãŒæ¶ˆãˆã¦ã„ãŸã®ã§ã™ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ"><a href="#å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ä¸€è¦§ã‹ã‚‰å¯¾è±¡-VM-ãŒæ¶ˆãˆã¦ã„ãŸã®ã§ã™ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ" class="headerlink" title="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ä¸€è¦§ã‹ã‚‰å¯¾è±¡ VM ãŒæ¶ˆãˆã¦ã„ãŸã®ã§ã™ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ"></a>å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ä¸€è¦§ã‹ã‚‰å¯¾è±¡ VM ãŒæ¶ˆãˆã¦ã„ãŸã®ã§ã™ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ</h2><p>ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã®é€šã‚Šã€VM ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã‹ã‚‰å¤–ã‚Œã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚<br>ã‚ˆãã‚ã‚‹ã‚·ãƒŠãƒªã‚ªã¨ã—ã¦ã¯ã€ãŠå®¢æ§˜ã®æ–¹ã§ VM ã®å‰²ã‚Šå½“ã¦è§£é™¤ãŠã‚ˆã³èµ·å‹•ãŒè¡Œã‚ã‚ŒãŸã“ã¨ã§ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡å¤–ã®ç‰©ç†ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã« VM ãŒç§»å‹•ã—ãŸã“ã¨ã«ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡å¤–ã¨ãªã‚‹ã¨ã„ã£ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚<br>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ã‹ã‚‰è¡¨ç¤ºãŒæ¶ˆãˆã¦ã„ã‚‹ VM ã«ã¤ã„ã¦ã¯ã€ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒä¸è¦ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã®ã§ã€ç‰¹ã«ã”å¯¾å¿œã‚’ã„ãŸã ãå¿…è¦ã¯ã”ã–ã„ã¾ã›ã‚“ã€‚</p><p>â– ã”å‚è€ƒï¼šã‚ˆãå¯„ã›ã‚‰ã‚Œã‚‹è³ªå•<br><a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications#faq">https://learn.microsoft.com/ja-jp/azure/virtual-machines/maintenance-notifications#faq</a></p><blockquote><p>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼æŠœç²‹ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼<br>Q: VM ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ å•é¡Œã®åŸå›   </p><p>A: VM ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œãªã„ç†ç”±ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚  </p><p>1.Microsoft ç¤¾å†…ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚ŒãŸã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚<br>2.VM ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã€‚ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ã‚¦ã‚§ãƒ¼ãƒ–ãŒçµ‚äº†ã—ã¦ã„ã‚‹ã‹ã€å–ã‚Šæ¶ˆã—&gt;ã¾ãŸã¯å¤‰æ›´ãŒè¡Œã‚ã‚ŒãŸãŸã‚ã€VM ãŒå½±éŸ¿ã‚’å—ã‘ãªããªã£ã¦ã„ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚<br><strong>3.ã‚ãªãŸã¯ VM ã®å‰²ã‚Šå½“ã¦ã‚’è§£é™¤ã—ã€ãã®å¾Œã€VM ã‚’èµ·å‹•ã—ã¾ã—ãŸã€‚ ãã‚Œã‚’è¡Œã†ã¨ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ã‚¦ã‚§ãƒ¼ãƒ–ã‚’è¨ˆç”»ã—ã¦ã„ãªã„å ´æ‰€ã« VM ãŒç§»å‹•ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ ãã®ãŸã‚ã€VM ã«ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</strong><br>4.VM ãƒªã‚¹ãƒˆ ãƒ“ãƒ¥ãƒ¼ã« [ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹] åˆ—ãŒè¿½åŠ ã•ã‚Œã¦ã„ãªã„ã€‚ ã“ã®åˆ—ã¯æ—¢å®šã®ãƒ“ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ãŒã€æ—¢å®šä»¥å¤–ã®åˆ—ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«æ§‹æˆã—ã¦ã„ã‚‹ãŠå®¢æ§˜ã¯ã€VM ãƒªã‚¹ãƒˆ ãƒ“ãƒ¥ãƒ¼ã« [ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹] åˆ—ã‚’æ‰‹å‹•ã§è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼  </p></blockquote><hr><h2 id="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å®Œäº†ï¼ˆæˆåŠŸï¼‰ã®ç¢ºèªæ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"><a href="#å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å®Œäº†ï¼ˆæˆåŠŸï¼‰ã®ç¢ºèªæ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ" class="headerlink" title="å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å®Œäº†ï¼ˆæˆåŠŸï¼‰ã®ç¢ºèªæ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"></a>å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å®Œäº†ï¼ˆæˆåŠŸï¼‰ã®ç¢ºèªæ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</h2><p>å…ˆè¿°ã®ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸æ€§ã®è¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å¯¾è±¡ VM ç¢ºèªç”»é¢ä¸Šã§ã€ã€Œå½±éŸ¿ã‚’å—ã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã€ã®ä¸€è¦§ã‚’ã”ç¢ºèªã„ãŸã ãã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®çŠ¶æ…‹ã§ã‚ã‚Œã°ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå®Œäº†ï¼ˆæˆåŠŸï¼‰ã—ã¦ã„ã‚‹ã¨è€ƒãˆã¦ã„ãŸã ã„ã¦å·®ã—æ”¯ãˆã”ã–ã„ã¾ã›ã‚“ã€‚</p><ul><li>å¯¾è±¡ã® VMã€€ã«ã¤ã„ã¦ã€ŒçŠ¶æ…‹ã€ã®åˆ—ãŒã€Œæ›´æ–°æ¸ˆã¿ã€ã¨è¡¨ç¤ºã•ã¦ã„ã¦ã„ã‚‹ã€‚</li><li>ã‚‚ã—ãã¯ã€å¯¾è±¡ã® VM ãŒã€Œå½±éŸ¿ã‚’å—ã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã€ã®ä¸€è¦§è¡¨ç¤ºã‹ã‚‰æ¶ˆãˆã¦ã„ã‚‹ã€‚</li></ul><p><img src="/blog/vm/self-service-maintenance/2023-07-26-14-46-32.png"></p><hr><h2 id="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œæ™‚ã¯-VM-ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ"><a href="#ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œæ™‚ã¯-VM-ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ" class="headerlink" title="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œæ™‚ã¯ VM ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ"></a>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œæ™‚ã¯ VM ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ</h2><p>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ VM ãŒã€Œå‰²ã‚Šå½“ã¦è§£é™¤æ¸ˆã¿ã€ã®çŠ¶æ…‹ã§ã¯å®Ÿè¡ŒãŒå¶ã„ã¾ã›ã‚“ã€‚<br>ã€Œå®Ÿè¡Œä¸­ã€ã‚„ã€Œåœæ­¢æ¸ˆã¿ï¼ˆOS å†…éƒ¨ã‹ã‚‰ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³å®Œäº†ï¼‰ã€ã®çŠ¶æ…‹ã§ã‚ã‚Œã°ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯å®Ÿè¡Œå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚  </p><hr><h2 id="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœŸé–“ä¸­ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’ã—ãªã„ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ"><a href="#ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœŸé–“ä¸­ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’ã—ãªã„ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ" class="headerlink" title="ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœŸé–“ä¸­ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’ã—ãªã„ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ"></a>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœŸé–“ä¸­ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’ã—ãªã„ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ</h2><p>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å®Ÿè¡Œå¯èƒ½ãªæœŸé–“ãŒçµ‚äº†ã™ã‚‹ã¨ã€äºˆå®šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ãƒ•ã‚§ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã€‚<br>ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœŸé–“ä¸­ã«ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®Ÿè¡Œã›ãšã«ã€äºˆå®šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ãƒ•ã‚§ãƒ¼ã‚ºã«å…¥ã£ãŸå ´åˆã¯ã€è‡ªå‹•çš„ã«å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚<br>ã“ã®å ´åˆã€äºˆå®šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ãŠå®¢æ§˜ã®æ–¹ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ã¯å¶ã„ã¾ã›ã‚“ç‚¹ã€ã”äº†æ‰¿ãã ã•ã„ã¾ã›ã€‚  </p><hr><h2 id="åˆ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒé€šçŸ¥ã•ã‚Œã¾ã›ã‚“ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ"><a href="#åˆ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒé€šçŸ¥ã•ã‚Œã¾ã›ã‚“ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ" class="headerlink" title="åˆ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒé€šçŸ¥ã•ã‚Œã¾ã›ã‚“ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ"></a>åˆ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒé€šçŸ¥ã•ã‚Œã¾ã›ã‚“ãŒä½•æ•…ã§ã™ã‹ï¼Ÿ</h2><p>å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ã¯ã€ã‚ãã¾ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ãŒã‚ã‚‹ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã®ã¿é€šçŸ¥ã•ã‚Œã¾ã™ã€‚<br>ãã®ãŸã‚ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®é€šçŸ¥ãŒã•ã‚Œã¦ã„ãªã„ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é–¢ã—ã¦ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ãŒç„¡ã„ã¨è€ƒãˆã¦é ‚ã„ã¦å·®ã—æ”¯ãˆã”ã–ã„ã¾ã›ã‚“ã€‚</p><hr><h2 id="ãƒ¡ãƒ¼ãƒ«ã§ã®ã¿å¯¾è±¡-VM-ãŒé€šçŸ¥ã•ã‚Œã‚‹å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦"><a href="#ãƒ¡ãƒ¼ãƒ«ã§ã®ã¿å¯¾è±¡-VM-ãŒé€šçŸ¥ã•ã‚Œã‚‹å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦" class="headerlink" title="ãƒ¡ãƒ¼ãƒ«ã§ã®ã¿å¯¾è±¡ VM ãŒé€šçŸ¥ã•ã‚Œã‚‹å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦"></a>ãƒ¡ãƒ¼ãƒ«ã§ã®ã¿å¯¾è±¡ VM ãŒé€šçŸ¥ã•ã‚Œã‚‹å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦</h2><p>ç¨€ã§ã¯ã”ã–ã„ã¾ã™ãŒã€å†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ã€Azure ãƒãƒ¼ã‚¿ãƒ«ç­‰ã§ã¯å¯¾è±¡ VM ã®ç¢ºèªãŒå¶ã‚ãšã€ãƒ¡ãƒ¼ãƒ«ã§ã®ã¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾è±¡ VM ãŒé€šçŸ¥ã•ã‚Œã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>ã“ã®å ´åˆã¯ã€ãã®ãƒ¡ãƒ¼ãƒ«å†…ã«å¯¾è±¡ VM ã®é€šçŸ¥ã‚’è¡Œã£ãŸæ—¨ã‚„ã©ã®ã‚ˆã†ãªå¯¾å¿œãŒå¿…è¦ã‹ã¨ã„ã£ãŸå†…å®¹ãŒè¨˜è¼‰ã•ã‚Œã¦ãŠã‚Šã¾ã™ãŸã‚ã€é€šçŸ¥ã«è¨˜è¼‰ã®å†…å®¹ã‚’ã”ç¢ºèªã„ãŸã ãã”å¯¾å¿œã‚’ãŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚</p><hr><p>ä»¥ä¸Šã®é€šã‚Šã€ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦è§£èª¬ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚<br>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ã”ä¸æ˜ç‚¹ãŒã”ã–ã„ã¾ã™å ´åˆã¯ã€å¯¾è±¡ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã¦ã„ã‚‹ TrackingIDï¼ˆè¿½è·¡ IDï¼‰ã‚’æ·»ãˆã¦ã€Azure æŠ€è¡“ã‚µãƒãƒ¼ãƒˆçª“å£ã«ãŠå•ã„åˆã‚ã›ã‚’é ‚ã‘ã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚&lt;br&gt;ä»Šå›ã¯ã‚ˆããŠå•ã„åˆã‚ã›ã„ãŸã ã VMï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰ã®ã€Œå†èµ·å‹•ã‚’ä¼´ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ã«ä¼´ã„ã€äº‹å‰ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå¯èƒ½ã¨ãªã‚‹ã‚»ãƒ«ãƒ•ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã‚’è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚&lt;/p</summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
    <category term="Windows" scheme="https://jpaztech.github.io/blog/tags/Windows/"/>
    
    <category term="Linux" scheme="https://jpaztech.github.io/blog/tags/Linux/"/>
    
    <category term="HowTo" scheme="https://jpaztech.github.io/blog/tags/HowTo/"/>
    
  </entry>
  
  <entry>
    <title>Azure Windows VM ã® KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦</title>
    <link href="https://jpaztech.github.io/blog/vm/kms-troubleshooting/"/>
    <id>https://jpaztech.github.io/blog/vm/kms-troubleshooting/</id>
    <published>2023-08-17T08:30:00.000Z</published>
    <updated>2023-12-26T02:55:51.428Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚<br>Azure ä¸Šã§ç¨¼åƒã™ã‚‹ Windows VM ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ãŸã‚ã«ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆãŒ KMS ã‚µãƒ¼ãƒãƒ¼ï¼ˆKMS ãƒ›ã‚¹ãƒˆ ã‚µãƒ¼ãƒãƒ¼ï¼‰ã‚’æä¾›ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼è¦æ±‚ã¯ KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (Windows VM) ã‹ã‚‰ KMS ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦å®šæœŸçš„ã‹ã¤è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚<br>Azure Windows VM ã‹ã‚‰ Azure ã® KMS ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦é©åˆ‡ãªçµŒè·¯ã§é€šä¿¡ãŒè¡Œãˆãªã„ç’°å¢ƒç­‰ã«ãŠã„ã¦ã¯ã€KMS ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒå¤±æ•—ã—ç¶šã‘ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼åˆ‡ã‚Œã«é–¢ã™ã‚‹è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚<br>æœ¬ä»¶ã«ã¤ã„ã¦å¤šãã®ãŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ãã¾ã™ãŸã‚ã€KMS ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç­‰ã«ã¤ã„ã¦ä»¥ä¸‹ã®å†…å®¹ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><ul><li><p><a href="./#KMS-%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E8%AA%8D%E8%A8%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E8%A7%A3%E8%AA%AC">KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã¤ã„ã¦ã®è§£èª¬</a></p><ul><li><a href="./#KMS-%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E8%AA%8D%E8%A8%BC%E3%81%AE%E6%A6%82%E8%A6%81">KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®æ¦‚è¦</a></li><li><a href="./#KMS-%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E8%AA%8D%E8%A8%BC%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E8%A8%AD%E5%AE%9A%E3%81%8A%E3%82%88%E3%81%B3%E9%80%9A%E4%BF%A1%E8%A6%81%E4%BB%B6">KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«å¿…è¦ãªè¨­å®šãŠã‚ˆã³é€šä¿¡è¦ä»¶</a></li><li><a href="./#%E8%87%AA%E5%8B%95%E7%9A%84%E3%81%AA%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E8%AA%8D%E8%A8%BC%E3%81%8A%E3%82%88%E3%81%B3%E6%9C%89%E5%8A%B9%E6%9C%9F%E9%99%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">è‡ªå‹•çš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŠã‚ˆã³æœ‰åŠ¹æœŸé™ã«ã¤ã„ã¦</a></li><li><a href="./#%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E8%AA%8D%E8%A8%BC%E5%88%87%E3%82%8C%E3%81%AE%E5%BD%B1%E9%9F%BF">ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼åˆ‡ã‚Œã®å½±éŸ¿</a></li></ul></li><li><p><a href="./#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E6%96%B9%E6%B3%95">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•</a></p><ul><li><a href="./#%E6%89%8B%E5%8B%95%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E8%AA%8D%E8%A8%BC%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C">æ‰‹å‹•ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ</a></li><li><a href="./#%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E7%8A%B6%E6%85%8B%E3%81%8A%E3%82%88%E3%81%B3%E8%A8%AD%E5%AE%9A%E7%A2%BA%E8%AA%8D">ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ…‹ãŠã‚ˆã³è¨­å®šç¢ºèª</a></li><li><a href="./#KMS-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%B8%E3%81%AE%E5%90%8D%E5%89%8D%E8%A7%A3%E6%B1%BA%E3%81%8A%E3%82%88%E3%81%B3%E7%96%8E%E9%80%9A%E7%A2%BA%E8%AA%8D%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C">KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®åå‰è§£æ±ºãŠã‚ˆã³ç–é€šç¢ºèªã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ</a></li><li><a href="./#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%AD%E3%82%B0%E3%81%A7%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%83%AD%E3%82%B0%E3%82%92%E8%A6%8B%E3%82%8B">ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ­ã‚°ã‚’è¦‹ã‚‹</a></li></ul></li><li><p><a href="./#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%81%AE%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3">ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³</a></p><ul><li><a href="./#KMS-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E4%B8%80%E6%99%82%E7%9A%84%E3%81%AA%E8%B2%A0%E8%8D%B7">KMS ã‚µãƒ¼ãƒãƒ¼ã®ä¸€æ™‚çš„ãªè² è·</a></li><li><a href="./#%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB%E8%A3%BD%E5%93%81%E3%81%A7%E9%80%9A%E4%BF%A1%E3%82%92%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B">ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã§é€šä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹</a></li><li><a href="./#%E5%BC%B7%E5%88%B6%E3%83%88%E3%83%B3%E3%83%8D%E3%83%AA%E3%83%B3%E3%82%B0%E7%92%B0%E5%A2%83%EF%BC%88%E3%82%AA%E3%83%B3%E3%83%97%E3%83%AC%E3%83%9F%E3%82%B9%E7%AD%89%E3%82%92%E7%B5%8C%E7%94%B1%E3%81%97%E7%9B%B4%E6%8E%A5%E9%80%9A%E4%BF%A1%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%EF%BC%89">å¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ç’°å¢ƒï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç­‰ã‚’çµŒç”±ã—ç›´æ¥é€šä¿¡ã¨ãªã£ã¦ã„ãªã„ï¼‰</a></li><li><a href="./#Standard-SKU-%E3%81%AE-Azure-Load-Balancer-%E9%85%8D%E4%B8%8B%E3%81%AE-VM-%E3%81%A7%E5%A4%96%E9%83%A8%E6%8E%A5%E7%B6%9A%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84">Standard SKU ã® Azure Load Balancer é…ä¸‹ã® VM ã§å¤–éƒ¨æ¥ç¶šãŒã§ããªã„</a></li><li><a href="./#Tokens-dat-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%A0%B4%E6%90%8D">Tokens.dat ãƒ•ã‚¡ã‚¤ãƒ«ã®ç ´æ</a></li></ul></li><li><p><a href="./#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB%EF%BC%88%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E8%A6%81%E5%9B%A0%E7%AD%89%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%EF%BC%89">ã•ã„ã”ã«ï¼ˆãã®ä»–ã®è¦å› ç­‰ã«ã¤ã„ã¦ï¼‰</a></p></li></ul><hr><h2 id="KMS-ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã¤ã„ã¦ã®è§£èª¬"><a href="#KMS-ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã¤ã„ã¦ã®è§£èª¬" class="headerlink" title="KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã¤ã„ã¦ã®è§£èª¬"></a>KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã¤ã„ã¦ã®è§£èª¬</h2><p>å…ˆè¿°ã®é€šã‚Šã€Azure ä¸Šã® Windows VM ã¯å®šæœŸçš„ã‹ã¤è‡ªå‹•çš„ã« KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒè¡Œã‚ã‚Œã¾ã™ã€‚<br>KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã¤ã„ã¦ã©ã®ã‚ˆã†ã«è¡Œã‚ã‚Œã‚‹ã®ã‹ã¨ã„ã£ãŸæ¦‚è¦ãªã©ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><hr><h3 id="KMS-ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®æ¦‚è¦"><a href="#KMS-ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®æ¦‚è¦" class="headerlink" title="KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®æ¦‚è¦"></a>KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®æ¦‚è¦</h3><p>Azure ä¸Šã§ç¨¼åƒã™ã‚‹ Windows VM ã¯å¾“é‡èª²é‡‘åˆ¶ã¨ãªã£ã¦ãŠã‚Šã€åŸå‰‡ç¨¼åƒæ™‚ã®å¾“é‡èª²é‡‘ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ–™ãŒå«ã¾ã‚Œã¦ãŠã‚Šã¾ã™ã€‚<br>ã‚²ã‚¹ãƒˆ OS ã¨ãªã‚‹ Windows ã‹ã‚‰ã¯ KMSï¼ˆKey Management Servicesï¼‰ã‚µãƒ¼ãƒãƒ¼ã«ã€å®šæœŸçš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒè¡Œã‚ã‚Œã¾ã™ã€‚<br>ã“ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆã® KMS ã‚µãƒ¼ãƒãƒ¼ã¯ Azure ä¸Šã«ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆãŒã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>ãã®ãŸã‚ã€ãŠå®¢æ§˜ã®ã”åˆ©ç”¨ã® Windows VM ã‹ã‚‰ KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®é€šä¿¡çµŒè·¯ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚</p><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p>Azure ä¸Šã«ãŠå®¢æ§˜ã”è‡ªèº«ã§ KMS ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã®å½¹å‰²ã‚’æ‹…ã† KMS ãƒ›ã‚¹ãƒˆã‚’æ§‹ç¯‰ã„ãŸã ãå ´åˆã¯ã€ãã®ã‚µãƒ¼ãƒãƒ¼ã§ã¯ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒã¨åŒæ§˜ã« KMS ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ç”¨ã® MAK ã‚­ãƒ¼ï¼ˆKMS ãƒ›ã‚¹ãƒˆ ã‚­ãƒ¼ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’å®Ÿæ–½ã™ã‚‹æ‰‹é †ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚  </p></div><hr><h3 id="KMS-ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«å¿…è¦ãªè¨­å®šãŠã‚ˆã³é€šä¿¡è¦ä»¶"><a href="#KMS-ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«å¿…è¦ãªè¨­å®šãŠã‚ˆã³é€šä¿¡è¦ä»¶" class="headerlink" title="KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«å¿…è¦ãªè¨­å®šãŠã‚ˆã³é€šä¿¡è¦ä»¶"></a>KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«å¿…è¦ãªè¨­å®šãŠã‚ˆã³é€šä¿¡è¦ä»¶</h3><p>Azure VM ã‹ã‚‰ KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€šä¿¡ã¯ã€<strong>TCP å®›å…ˆãƒãƒ¼ãƒˆ 1688</strong> ã§ä»¥ä¸‹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚</p><blockquote><p><strong>kms.core.windows.net</strong> ã‚‚ã—ãã¯ <strong>azkms.core.windows.net</strong></p></blockquote><p>ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ä»¥ä¸‹ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã„ãšã‚Œã‹ã«åå‰è§£æ±ºã•ã‚Œã¾ã™ã€‚</p><blockquote><p><strong>20.118.99.224, 40.83.235.53, 23.102.135.246</strong></p></blockquote><p>ãªãŠã€KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚µãƒ¼ãƒãƒ¼è‡ªä½“ã¯ Azure ä¸Šã«ã”ç”¨æ„ã‚’ã—ã¦ãŠã‚Šã¾ã™ãŒã€ä¸Šè¨˜ã®é€šã‚Šã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§åå‰è§£æ±ºã•ã‚Œã¾ã™ã®ã§ã€VM ã‹ã‚‰ã¯ Internet æ–¹å‘ã¨ã—ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚  </p><p>é‡è¦ãªç‚¹ã¨ã—ã¦ã€åŸå‰‡ VM ã‹ã‚‰ç›´æ¥ KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€šä¿¡ã‚’è¡Œã£ã¦ã„ãŸã ãå¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚<br>ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒã‚’çµŒç”±ã—ãŸãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®é€šä¿¡ã§ã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒå¤±æ•—ã™ã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚<br>ã“ã®ç‚¹ã«ã¤ã„ã¦ã¯å¾Œè¿°ã®ã€Œå¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ç’°å¢ƒï¼ˆç›´æ¥é€šä¿¡ã¨ãªã£ã¦ã„ãªã„ï¼‰ã€ã‚’ã”å‚ç…§ãã ã•ã„ã€‚<br>ä¸‹å›³ã¯ KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®æˆåŠŸãƒ»å¤±æ•—ã®ä¾‹ã‚’è¡¨ã—ãŸå›³ã¨ãªã‚Šã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-04-16-23-05.png"></p><div class="alert is-success"><p class="alert-title">ãƒ’ãƒ³ãƒˆ</p><p>KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼é€šä¿¡ã«ã¤ã„ã¦ã¯ã€NSGï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰ã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†æš—é»™çš„ãªãƒ«ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ã¾ã™ã€‚</p><p>ä¾‹å¤–çš„ã«ã‚µãƒ–ãƒãƒƒãƒˆã«å¯¾ã—ã¦ 0.0.0.0/0 ã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã€æš—é»™çš„ãªãƒ«ãƒ¼ãƒ«ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€æ˜ç¤ºçš„ã«è¨±å¯ãƒ«ãƒ¼ãƒ«ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚  </p></div><p>ã¾ãŸã€OS æ¯ã« KMS å°‚ç”¨ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚­ãƒ¼ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚<br>Azure ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸ VM ç­‰ã§ã¯æ—¢å®šã§ã“ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šã€å¯¾å¿œã¯ä¸è¦ã§ã”ã–ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚·ãƒŠãƒªã‚ªã«è©²å½“ã™ã‚‹å ´åˆã¯æ‰‹å‹•ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ¼ã®å…¥åŠ›ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚</p><ul><li>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚’ãƒãƒ«ãƒ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚­ãƒ¼ (MAK) ã®ä½¿ç”¨ã‹ã‚‰ KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¤‰æ›ã™ã‚‹</li><li>Windows ã®è£½å“ç‰ˆ (OEM/Retail) ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¤‰æ›ã™ã‚‹</li><li>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãŒä»¥å‰ã« KMS ãƒ›ã‚¹ãƒˆã§ã‚ã£ãŸå ´åˆ KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¤‰æ›ã™ã‚‹</li></ul><p>â– ã”å‚è€ƒï¼šã‚­ãƒ¼ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ (KMS) ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ ã‚­ãƒ¼<br><a href="https://learn.microsoft.com/ja-jp/windows-server/get-started/kms-client-activation-keys">https://learn.microsoft.com/ja-jp/windows-server/get-started/kms-client-activation-keys</a></p><hr><h3 id="è‡ªå‹•çš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŠã‚ˆã³æœ‰åŠ¹æœŸé™ã«ã¤ã„ã¦"><a href="#è‡ªå‹•çš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŠã‚ˆã³æœ‰åŠ¹æœŸé™ã«ã¤ã„ã¦" class="headerlink" title="è‡ªå‹•çš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŠã‚ˆã³æœ‰åŠ¹æœŸé™ã«ã¤ã„ã¦"></a>è‡ªå‹•çš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŠã‚ˆã³æœ‰åŠ¹æœŸé™ã«ã¤ã„ã¦</h3><p>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã¯æ—¢å®šã§ã¯ä»¥ä¸‹ã®é–“éš”ã§è‡ªå‹•çš„ã«èªè¨¼ã•ã‚Œã¾ã™ã€‚  </p><ul><li>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ï¼š2 æ™‚é–“ã« 1 å›ã®é »åº¦</li><li>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ï¼š7 æ—¥ã« 1 å›ã®é »åº¦</li></ul><p>ã¾ãŸã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã¯æ¯å›å¿…ãšæˆåŠŸã™ã‚‹å¿…è¦ã¯ãªãã€ä¸€åº¦èªè¨¼ã•ã‚Œã‚Œã° 180 æ—¥ã®æœ‰åŠ¹æœŸé™ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚<br>èªè¨¼ã«æˆåŠŸã™ã‚‹åº¦ã«æœ‰åŠ¹æœŸé™ãŒå†ã³ 180 æ—¥ã‹ã‚‰ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚  </p><p>ã¤ã¾ã‚Šã€æ­£å¸¸ãªçŠ¶æ³ã§ã‚ã‚Œã°å®šæœŸçš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã‚ˆã£ã¦ã€180 æ—¥ã®æœ‰åŠ¹æœŸé™ãŒæ¯å›æ›´æ–°ã•ã‚Œã‚‹ã¨ã„ã†å½¢ã¨ãªã‚Šã¾ã™ã€‚</p><hr><h3 id="ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼åˆ‡ã‚Œã®å½±éŸ¿"><a href="#ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼åˆ‡ã‚Œã®å½±éŸ¿" class="headerlink" title="ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼åˆ‡ã‚Œã®å½±éŸ¿"></a>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼åˆ‡ã‚Œã®å½±éŸ¿</h3><p>Windows 8 / Windows Server 2012 ä»¥é™ã® OS ã®å ´åˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®å½±éŸ¿ã«ã¤ã„ã¦è¨˜è¼‰ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>ä¸Šè¨˜æœŸé–“å†…ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒæˆåŠŸã—ãªã„å ´åˆã¯ã€é€šçŸ¥ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼åˆ‡ã‚ŒçŠ¶æ…‹ï¼‰ã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã®éš›ã®å½±éŸ¿ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã¨ãªã‚Š VM ã¸ã®æ¥ç¶šä¸å¯ã‚„ä½¿ç”¨ä¸å¯ã«ãªã‚‹ã¨ã„ã£ãŸå½±éŸ¿ã¯ã”ã–ã„ã¾ã›ã‚“ã€‚<br>ã—ã‹ã—ãªãŒã‚‰ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒåˆ‡ã‚Œã‚‹å‰ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒæˆåŠŸã¨ãªã‚‹ã‚ˆã†ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><ol><li>ç”»é¢ã®å³ä¸‹ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒå¿…è¦ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ï¼ˆé€ã‹ã—æ–‡å­—ï¼‰ ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li><li>å£ç´™ã®å³ä¸‹ã« OS ã®æƒ…å ±ã‚’ç¤ºã™æ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ï¼ˆWindows 8 / Windows Server 2012 åŠã³ 2012 R2 ã®ã¿ï¼‰</li><li>ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«è¨­å®šå†…ã®é …ç›®ã¯è¨­å®šå¤‰æ›´ä¸å¯ã¨ãªã‚Šã¾ã™ã€‚</li><li>è‡ªèº«ãŒ KMS ãƒ›ã‚¹ãƒˆã®å ´åˆã€KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èªè¨¼ãŒè¡Œãˆã¾ã›ã‚“ã€‚</li></ol><hr><h2 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•"><a href="#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•" class="headerlink" title="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•"></a>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•</h2><p>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æœ‰åŠ¹æœŸé™ãŒè¿‘ã¥ãã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã©ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚  </p><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-11-38-39.png" alt="Windows ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®æœ‰åŠ¹æœŸé™ãŒã‚‚ã†ã™ãåˆ‡ã‚Œã¾ã™ [è¨­å®š] ã§ Windows ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™"></p><p>ã¾ãŸã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒåˆ‡ã‚ŒãŸéš›ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚‚ã®ã¨å­˜ã˜ã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-11-39-40.png" alt="Windows ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™"></p><p>ã“ã®å ´åˆã¯ã€ä½•ã‹ã‚‰ã®ç†ç”±ã§è‡ªå‹•çš„ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒç¹°ã‚Šè¿”ã—å¤±æ•—ã—ã¦ãŠã‚Šã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒã¾ã‚‚ãªãåˆ‡ã‚Œã‚‹ / åˆ‡ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ã¨ã„ã£ãŸçŠ¶æ³ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ </p><p>ã‚ˆãã‚ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®å¤±æ•—ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ã€Œ0xC004F074ã€ã‚„ã€Œ0x8007139Fã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚<br>ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ä¸€ç™ºã§åŸå› ç©¶æ˜ãŒã§ãã‚‹ã®ãŒæœ›ã¾ã—ã„ã§ã™ãŒã€æç¸®ãªãŒã‚‰ KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ 1 ã¤ãšã¤åŸå› åˆ‡ã‚Šåˆ†ã‘ç­‰ã‚’è¡Œã†å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚<br>ãã®ãŸã‚ã€ã¾ãšã¯å…ˆè¿°ã®å¿…è¦ãªé€šä¿¡è¦ä»¶ç­‰ãŒå¯èƒ½ãªçŠ¶æ³ã‹ã”ç¢ºèªã„ãŸã ãã“ã¨ãŒå¿…è¦ã§ã™ã€‚<br>ä»¥ä¸‹ã«æ­£å¸¸ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’è¡Œã†ãŸã‚ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•ã‚’è§£èª¬ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><p>â– ã”å‚è€ƒï¼šAzure Windows ä»®æƒ³ãƒã‚·ãƒ³ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«é–¢ã™ã‚‹å•é¡Œã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/virtual-machines/troubleshoot-activation-problems">https://learn.microsoft.com/ja-jp/troubleshoot/azure/virtual-machines/troubleshoot-activation-problems</a></p><hr><h3 id="æ‰‹å‹•ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ"><a href="#æ‰‹å‹•ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ" class="headerlink" title="æ‰‹å‹•ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ"></a>æ‰‹å‹•ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ</h3><p>ã¾ãšã¯ã€æ‰‹å‹•ã§ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒæ­£å¸¸ã«æˆåŠŸã™ã‚‹ã‹ã”ç¢ºèªé ‚ãã®ãŒè‰¯ã„ã‹ã¨å­˜ã˜ã¾ã™ã€‚<br>åˆ¥é€”è¨­å®šãªã©ã®ä¿®æ­£ç­‰ã‚’è¡Œã£ãŸå¾Œã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒæˆåŠŸã™ã‚‹ã‹ç¢ºèªã™ã‚‹éš›ã«ã‚‚ã“ã¡ã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚<br>ç®¡ç†è€…ç‰¹æ¨©ã® Windows PowerShell ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>..<span class="number">12</span> | <span class="built_in">ForEach-Object</span> &#123; <span class="built_in">Invoke-Expression</span> <span class="string">&quot;<span class="variable">$env:windir</span>\system32\cscript.exe <span class="variable">$env:windir</span>\system32\slmgr.vbs /ato&quot;</span> ; <span class="built_in">start-sleep</span> <span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure><p>ã“ã¡ã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€KMS ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’ 5 ç§’æ¯ã« 12 å›å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚<br>1 å›ã®ã¿ã®å®Ÿè¡Œã®å ´åˆã€ä¸€æ™‚çš„ãªå•é¡Œã§å¤±æ•—ã™ã‚‹ã“ã¨ãŒã”ã–ã„ã¾ã™ãŸã‚è¤‡æ•°å›ã®å®Ÿè¡Œã¨ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>æˆåŠŸã—ãŸå ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚  </p><blockquote><p>Windows(R)ã€ServerDatacenter ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ– (12345678-1234-1234-1234-1234-12345678) â€¦ è£½å“ãŒæ­£å¸¸ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã•ã‚Œã¾ã—ãŸã€‚</p></blockquote><hr><h3 id="ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ…‹ãŠã‚ˆã³è¨­å®šç¢ºèª"><a href="#ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ…‹ãŠã‚ˆã³è¨­å®šç¢ºèª" class="headerlink" title="ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ…‹ãŠã‚ˆã³è¨­å®šç¢ºèª"></a>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ…‹ãŠã‚ˆã³è¨­å®šç¢ºèª</h3><p>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ…‹ãŠã‚ˆã³è¨­å®šç¢ºèªã‚’è¡Œã†ã«ã¯ PowerShell ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript c:\windows\system32\slmgr.vbs /dlv</span><br></pre></td></tr></table></figure><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-11-37-28.png"></p><p>ä¸Šè¨˜ã®ã‚ˆã†ã«ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®çŠ¶æ…‹ã‚„ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆã®æƒ…å ±ã®ç¢ºèªãŒå¯èƒ½ã§ã”ã–ã„ã¾ã™ã€‚  </p><p>ãªãŠã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚ŒãŸçŠ¶æ…‹ãªã©ã§ã¯ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆ KMS ã‚µãƒ¼ãƒãƒ¼ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œãªã„ã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚<br>ãã®ã‚ˆã†ãªå ´åˆã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹æ–¹æ³•ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆ KMS ã‚µãƒ¼ãƒãƒ¼ã®æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚  </p><ul><li><strong>Event Viewer (Local) &gt; Windows Logs &gt; Application</strong> ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã®ã‚¤ãƒ™ãƒ³ãƒˆ ID 12288 ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆã‚’ç¢ºèªã™ã‚‹ã€‚</li><li>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆ KMS ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç¢ºèª</span></span><br><span class="line">reg query <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SoftwareProtectionPlatform&quot;</span> /v KeyManagementServiceName</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆ KMS ã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ãƒˆç•ªå·ã‚’ç¢ºèª</span></span><br><span class="line">reg query <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SoftwareProtectionPlatform&quot;</span> /v KeyManagementServicePort</span><br></pre></td></tr></table></figure><p>ã‚‚ã—ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆ KMS ã‚µãƒ¼ãƒãƒ¼ã‚’ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å›ºå®šã§æŒ‡å®šã—ã¦ã—ã¾ã£ã¦ã„ã‚‹å ´åˆãªã©ã€KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å…ˆã®ä¿®æ­£ãŒå¿…è¦ãªå ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¿®æ­£å¯èƒ½ã§ã™ã€‚<br>ãªãŠã€ä¿®æ­£å¾Œã«è¨­å®šã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã«å…ˆè¿°ã®æ‰‹å‹•ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚‚åˆã‚ã›ã¦ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript c:\windows\system32\slmgr.vbs /skms azkms.core.windows.net:<span class="number">1688</span></span><br></pre></td></tr></table></figure><hr><h3 id="KMS-ã‚µãƒ¼ãƒãƒ¼ã¸ã®åå‰è§£æ±ºãŠã‚ˆã³ç–é€šç¢ºèªã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ"><a href="#KMS-ã‚µãƒ¼ãƒãƒ¼ã¸ã®åå‰è§£æ±ºãŠã‚ˆã³ç–é€šç¢ºèªã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ" class="headerlink" title="KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®åå‰è§£æ±ºãŠã‚ˆã³ç–é€šç¢ºèªã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ"></a>KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®åå‰è§£æ±ºãŠã‚ˆã³ç–é€šç¢ºèªã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ</h3><p>KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒå¤±æ•—ã—ã¦ã„ã‚‹åŸå› ã¨ã—ã¦ã€åå‰è§£æ±ºãŒã§ãã¦ã„ãªã„ã¨ã„ã£ãŸäº‹ã‚„ã€ç–é€šãŒå¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã”ã–ã„ã¾ã™ã€‚<br>ã“ã®ç‚¹ã®åŸå› åˆ‡ã‚Šåˆ†ã‘ã®ãŸã‚ã«ã¯ä»¥ä¸‹ã® PowerShell ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><ul><li>DNS ã§ã®åå‰è§£æ±ºã®ç¢ºèª</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤ã„æƒ…å ±ã§ã®åå‰è§£æ±ºã‚’æŠ‘æ­¢ã™ã‚‹ãŸã‚ DNS ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢</span></span><br><span class="line">ipconfig /flushdns</span><br><span class="line"></span><br><span class="line"><span class="comment"># KMS ã‚µãƒ¼ãƒãƒ¼ã®åå‰è§£æ±ºãŒå¯èƒ½ã‹ç¢ºèªã™ã‚‹</span></span><br><span class="line">nslookup kms.core.windows.net</span><br><span class="line">nslookup azkms.core.windows.net</span><br></pre></td></tr></table></figure><p>æˆåŠŸã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« KMS ã‚µãƒ¼ãƒãƒ¼ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒåå‰è§£æ±ºã•ã‚Œã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-11-43-58.png"></p><p>åå‰è§£æ±ºãŒã§ãã¦ã„ãªã„å ´åˆã¯ã€DNS ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã®è¦‹ç›´ã—ã‚„ãƒãƒ¼ãƒˆ 53 UDP ã§ã® DNS ã®é€šä¿¡ãŒã§ãã¦ã„ã‚‹ã‹ã¨ã„ã£ãŸç‚¹ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚</p><ul><li>KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒãƒ¼ãƒˆ 1688 ã§ã®ç–é€šç¢ºèª</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Test-NetConnection</span> <span class="literal">-ComputerName</span> kms.core.windows.net <span class="literal">-Port</span> <span class="number">1688</span></span><br><span class="line"><span class="built_in">Test-NetConnection</span> <span class="literal">-ComputerName</span> azkms.core.windows.net <span class="literal">-Port</span> <span class="number">1688</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãª <strong>TcpTestSucceeded : True</strong> ã®çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-11-43-05.png"></p><p>ã“ã¡ã‚‰ã®é€šä¿¡ãŒæˆåŠŸã—ãªã„å ´åˆã¯ã€OS å†…éƒ¨ã‚„çµŒç”±ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§ã®é€šä¿¡ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ç­‰ã®åŸå› ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ãŸã‚ã€å¾Œè¿°ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãªã©ã§ã“ã®é€šä¿¡ã‚’æˆåŠŸã•ã›ã‚‹ã‚ˆã†ã«ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚</p><hr><h3 id="ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ­ã‚°ã‚’è¦‹ã‚‹"><a href="#ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ­ã‚°ã‚’è¦‹ã‚‹" class="headerlink" title="ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ­ã‚°ã‚’è¦‹ã‚‹"></a>ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ­ã‚°ã‚’è¦‹ã‚‹</h3><p>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®æˆåŠŸãƒ»å¤±æ•—ã«ã¤ã„ã¦ã¯ Windows OS å†…ã® Event Viewer ã‚’ç”¨ã„ã¦ã€<br> <strong>Event Viewer (Local) &gt; Windows Logs &gt; Application</strong><br>ã‚ˆã‚Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚ˆã‚Šã”ç¢ºèªã„ãŸã ãã“ã¨ãŒå¯èƒ½ã§ã”ã–ã„ã¾ã™ã€‚<br>ä»¥ä¸‹ã«ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ä½¿ã‚ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ ID ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p><ul><li>12288ï¼šKMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ KMS ã‚µãƒ¼ãƒãƒ¼ã«èªè¨¼ã‚’è¦æ±‚ã—ãŸéš›ã®ãƒ­ã‚°</li></ul><p>ã‚¤ãƒ™ãƒ³ãƒˆ ID 12288 ã¯ KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ KMS ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’è¦æ±‚ã—ãŸéš›ã®ãƒ­ã‚°ã¨ãªã‚Šã¾ã™ã€‚<br>å¾Œè¿°ã®ã€Œ12289ï¼šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®çµæœè¡¨ç¤ºã€ã¨å¯¾ã«ãªã‚‹ãƒ­ã‚°ã§ã”ã–ã„ã¾ã™ã®ã§ã€ã€Œ12288ï¼šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼é–‹å§‹ã€ã¯ã‚ã‚‹ãŒã€Œ12289ï¼šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®çµæœè¡¨ç¤ºã€ãŒç„¡ã„ã¨ã„ã£ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®çŠ¶æ³ã‚’æ„å‘³ã—ã¾ã™ã€‚  </p><ol><li>KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ KMS ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ããªã‹ã£ãŸã“ã¨</li><li>KMS ã‚µãƒ¼ãƒãƒ¼ãŒå¿œç­”ã—ãªã‹ã£ãŸã“ã¨</li><li>KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ KMS ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚’å—ä¿¡ã—ãªã‹ã£ãŸã“ã¨</li></ol><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-13-40-29.png"></p><ul><li>12289ï¼šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®çµæœè¡¨ç¤º</li></ul><p>ã‚¤ãƒ™ãƒ³ãƒˆ ID 12289 ã¯ KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚<br>ä»¥ä¸‹ã®å›³ã®é€šã‚Š Info ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ 3 å€‹ç›®ã®ãƒ•ãƒ©ã‚°ãŒã€Œ1ã€ã®å ´åˆã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼æˆåŠŸã§ã™ã€‚<br>ã€Œ0ã€ã¨ãªã£ã¨ã‚‹å ´åˆã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å¤±æ•—ã¨ãªã‚Šã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-13-40-57.png"></p><p>â– ã”å‚è€ƒï¼šä¾¿åˆ©ãª KMS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚¤ãƒ™ãƒ³ãƒˆ<br><a href="https://learn.microsoft.com/ja-jp/windows-server/get-started/activation-troubleshoot-kms-general#useful-kms-client-events">https://learn.microsoft.com/ja-jp/windows-server/get-started/activation-troubleshoot-kms-general#useful-kms-client-events</a></p><ul><li>8198, 8200ï¼šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®å¤±æ•—</li></ul><p>ã‚¤ãƒ™ãƒ³ãƒˆ ID 8198, 8200 ã¯ KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®å¤±æ•—æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã®ã‚ã‚‹ãƒ­ã‚°ã¨ãªã‚Šã¾ã™ã€‚  </p><p>å¾Œè¿°ã®<a href="./#KMS-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E4%B8%80%E6%99%82%E7%9A%84%E3%81%AA%E8%B2%A0%E8%8D%B7">ã€ŒKMS ã‚µãƒ¼ãƒãƒ¼ã®ä¸€æ™‚çš„ãªè² è·ã€</a>ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¨˜è¼‰ã®é€šã‚Šã€ä¸€æ™‚çš„ãª KMS ã‚µãƒ¼ãƒãƒ¼ã®è² è·ã®å•é¡Œã§è¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã”ã–ã„ã¾ã™ãŒã€ã€Œ12289ï¼šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®çµæœè¡¨ç¤ºã€ã«ã¦æ­£å¸¸ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ç„¡è¦–å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>ãã®ãŸã‚ã€ã€Œ8198, 8200ï¼šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®å¤±æ•—ã€ã¯å¸¸ã«ç™ºç”Ÿã—ã¦ãŠã‚‰ãšå˜ç™ºçš„ãªå ´åˆã¯ã€ç„¡è¦–ã„ãŸã ã„ã¦å•é¡Œã”ã–ã„ã¾ã›ã‚“ã€‚</p><hr><h2 id="ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³"><a href="#ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³" class="headerlink" title="ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³"></a>ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³</h2><p>ãŠå®¢æ§˜ã‹ã‚‰ã€Œãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒå¤±æ•—ã™ã‚‹ã€ã¨ã„ã£ãŸå ´åˆã«ã€ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŠã‚ˆã³ãã®å¯¾å‡¦æ–¹æ³•ã«ã¤ã„ã¦ã”æ¡ˆå†…ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><hr><h3 id="KMS-ã‚µãƒ¼ãƒãƒ¼ã®ä¸€æ™‚çš„ãªè² è·"><a href="#KMS-ã‚µãƒ¼ãƒãƒ¼ã®ä¸€æ™‚çš„ãªè² è·" class="headerlink" title="KMS ã‚µãƒ¼ãƒãƒ¼ã®ä¸€æ™‚çš„ãªè² è·"></a>KMS ã‚µãƒ¼ãƒãƒ¼ã®ä¸€æ™‚çš„ãªè² è·</h3><p>Azure ã®KMS ã‚µãƒ¼ãƒãƒ¼ã¯å…¨ä¸–ç•Œã® Azure ä¸Šã® Windows OS ã‚’èªè¨¼ã—ã¦ã„ã‚‹é–¢ä¿‚ã§ã€ç¨€ã«è² è·ãŒé›†ä¸­ã™ã‚‹ã¨ã„ã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å¿œç­”ãŒã§ããªã„å ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>ä¸€èˆ¬çš„ã«ã¯ã€ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãŒæ•°æ—¥ã«ï¼‘å›ã€ã¨ã„ã£ãŸé »åº¦ã§è¨˜éŒ²ã•ã‚Œã‚‹ã«ç•™ã¾ã‚Šã¾ã™ãŒã€å ´åˆã«ã‚ˆã£ã¦ã¯ä¸¸ 1 æ—¥ç¶™ç¶šã™ã‚‹ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚<br>Azure ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã§ã‚‚ã€éšæ™‚ KMS ã®è£œå¼·ä½œæ¥­ã‚’è¡Œã£ã¦ã„ã¾ã™ãŒã€å¸¸æ™‚ 100 ï¼…æˆåŠŸã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã‚‚ã®ã§ã¯ã”ã–ã„ã¾ã›ã‚“ã€‚<br>ã“ã®ç†ç”±ã¨ã—ã¦ã¯ã€å…ˆè¿°ã®é€šã‚Š Windows ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã¯ãã®å¾Œãƒªãƒˆãƒ©ã‚¤ã•ã‚Œã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¤±åŠ¹æœŸé–“å†…ã§æ¯å›å¤±æ•—ã—ç¶šã‘ãªã‘ã‚Œã°ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒå¤±åŠ¹ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã¤ã¾ã‚Šãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å¤±æ•—ã®ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãŒæ’å¸¸çš„ã«ã§ã¯ãªãã€ä¸€æ™‚çš„ã«è¨˜éŒ²ã•ã‚Œã‚‹ã ã‘ã§ã‚ã‚‹å ´åˆã€ç„¡è¦–å¯èƒ½ã§ã™ã€‚  </p><p>ä»–æ–¹ã€ä¸€æ™‚çš„ã§ã¯ãªãå¸¸ã«æ¯å›ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å¤±æ•—ãŒå¤±æ•—ã—ã¦ã„ã‚‹å ´åˆã¯åˆ¥ã®åŸå› ãŒã‚ã‚‹ã‚‚ã®ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ãŸã‚ã€åˆ¥é€”ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå¿…è¦ã§ã”ã–ã„ã¾ã™ã€‚</p><hr><h3 id="ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã§é€šä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹"><a href="#ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã§é€šä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹" class="headerlink" title="ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã§é€šä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹"></a>ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã§é€šä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹</h3><p>KMS ã®é€šä¿¡ãŒ Azure Firewall ç­‰ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã‚’çµŒç”±ã—ã¦ã„ã‚‹å ´åˆã€ã“ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®é€šä¿¡ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã”ã–ã„ã¾ã™ã€‚  </p><p><img src="/blog/vm/kms-troubleshooting/2023-08-04-16-25-28.png"></p><p>ã“ã®ã‚ˆã†ãªå ´åˆã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><ul><li>è§£æ±ºæ–¹æ³• 1ï¼šUDR ã‚’ç”¨ã„ã¦ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’çµŒç”±ã—ãªã„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†</li></ul><p>UDR ã‚’ç”¨ã„ã¦ KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®é€šä¿¡ã«ã¤ã„ã¦ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’çµŒç”±ã—ãªã„ã‚ˆã†ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã™ã‚‹æ–¹æ³•ã¨ãªã‚Šã¾ã™ã€‚<br>è¨­å®šæ–¹æ³•ã«ã¤ã„ã¦ã¯ã€<a href="./#%E5%BC%B7%E5%88%B6%E3%83%88%E3%83%B3%E3%83%8D%E3%83%AA%E3%83%B3%E3%82%B0%E7%92%B0%E5%A2%83%EF%BC%88%E3%82%AA%E3%83%B3%E3%83%97%E3%83%AC%E3%83%9F%E3%82%B9%E7%AD%89%E3%82%92%E7%B5%8C%E7%94%B1%E3%81%97%E7%9B%B4%E6%8E%A5%E9%80%9A%E4%BF%A1%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%EF%BC%89">ã€Œå¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ç’°å¢ƒï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç­‰ã‚’çµŒç”±ã—ç›´æ¥é€šä¿¡ã¨ãªã£ã¦ã„ãªã„ï¼‰ã€</a> ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è§£æ±ºæ–¹æ³•ã¨åŒã˜ã«ãªã‚Šã¾ã™ã®ã§ã€ãã¡ã‚‰ã‚’ã”å‚ç…§ãã ã•ã„ã€‚  </p><p><img src="/blog/vm/kms-troubleshooting/2023-08-04-16-27-07.png"></p><ul><li>è§£æ±ºæ–¹æ³• 2ï¼šãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®é€šä¿¡ã‚’è¨±å¯ã™ã‚‹</li></ul><p>å…ˆè¿°ã®é€šã‚Šã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã«ã¯ä»¥ä¸‹ã®é€šä¿¡è¦ä»¶ãŒå¿…è¦ã§ã”ã–ã„ã¾ã™ã®ã§ã€ãŠä½¿ã„ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è£½å“ã§ Azure VM ã‹ã‚‰ã®ä»¥ä¸‹ã®é€šä¿¡ã‚’è¨±å¯ã™ã‚‹è¨­å®šã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚  </p><table><thead><tr><th>é …ç›®</th><th>é€šä¿¡è¦ä»¶</th></tr></thead><tbody><tr><td>ãƒ‰ãƒ¡ã‚¤ãƒ³</td><td>kms.core.windows.net ãŠã‚ˆã³ azkms.core.windows.net</td></tr><tr><td>IP ã‚¢ãƒ‰ãƒ¬ã‚¹</td><td>20.118.99.224, 40.83.235.53, 23.102.135.246</td></tr><tr><td>ãƒãƒ¼ãƒˆ</td><td>1688</td></tr><tr><td>ãƒ—ãƒ­ãƒˆã‚³ãƒ«</td><td>TCP</td></tr></tbody></table><p><img src="/blog/vm/kms-troubleshooting/2023-08-04-16-29-13.png"></p><p>ä¸Šæ‰‹ãæ”¹å–„ã•ã‚Œãªã„å ´åˆã¯åŸå› åˆ‡ã‚Šåˆ†ã‘ã®ãŸã‚ã«ã€Œè§£æ±ºæ–¹æ³• 1ï¼šUDR ã‚’ç”¨ã„ã¦ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’çµŒç”±ã—ãªã„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ã€ã®æ–¹ã‚’å®Ÿæ–½ã—ã¦ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p><hr><h3 id="å¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ç’°å¢ƒï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç­‰ã‚’çµŒç”±ã—ç›´æ¥é€šä¿¡ã¨ãªã£ã¦ã„ãªã„ï¼‰"><a href="#å¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ç’°å¢ƒï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç­‰ã‚’çµŒç”±ã—ç›´æ¥é€šä¿¡ã¨ãªã£ã¦ã„ãªã„ï¼‰" class="headerlink" title="å¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ç’°å¢ƒï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç­‰ã‚’çµŒç”±ã—ç›´æ¥é€šä¿¡ã¨ãªã£ã¦ã„ãªã„ï¼‰"></a>å¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ç’°å¢ƒï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç­‰ã‚’çµŒç”±ã—ç›´æ¥é€šä¿¡ã¨ãªã£ã¦ã„ãªã„ï¼‰</h3><p>KMS ã‚µãƒ¼ãƒãƒ¼ã¯ Azure ä¸Šã® VM ã‹ã‚‰ã®ç›´æ¥é€šä¿¡ã®ã¿ã‚’å—ã‘ä»˜ã‘ã‚‹å‹•ä½œã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚<br>ãã®ãŸã‚ã€Azure VM ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹é€šä¿¡ã‚’å¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ã‚’ç”¨ã„ã¦ VPN / ExpressRoute ã‚’é€šéã—ã€ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒã‚’çµŒç”±ã™ã‚‹ã‚ˆã†ãªè¨­å®šã‚’é ‚ã„ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒå¤±æ•—ã„ãŸã—ã¾ã™ã€‚  </p><p><img src="/blog/vm/kms-troubleshooting/2023-08-07-09-11-09.png"></p><p>ã“ã®ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒã§ KMS ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ãªè¨­å®šã‚’ã—ãŸã¨ã—ã¦ã‚‚ã€å®Ÿéš›ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼å®Ÿè¡Œã«ã¦èªè¨¼ãŒã§ããªã„çŠ¶æ³ã¨ãªã‚Šã¾ã™ã®ã§ç•™æ„ãã ã•ã„ã€‚</p><p>â– ã”å‚è€ƒï¼šå¼·åˆ¶ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ã‚’ä½¿ç”¨ã—ãŸãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®å•é¡Œ<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/virtual-machines/custom-routes-enable-kms-activation">https://learn.microsoft.com/ja-jp/troubleshoot/azure/virtual-machines/custom-routes-enable-kms-activation</a></p><ul><li>è§£æ±ºæ–¹æ³•ï¼šUDR ã‚’ç”¨ã„ã¦ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’çµŒç”±ã—ãªã„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†</li></ul><p>Azure ä¸Šã® VNET ã«å±ã™ã‚‹ Subnet å˜ä½ã§ UDRï¼ˆUser Defined Routeï¼‰ã‚’ç”¨ã„ã¦ã€ç‰¹å®š IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®é€šä¿¡ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚<br>ã™ãªã‚ã¡ã€KMS ã‚µãƒ¼ãƒãƒ¼ï¼ˆ20.118.99.224, 40.83.235.53, 23.102.135.246ï¼‰ã¸ã®é€šä¿¡ã®ã¿ã€ç›´æ¥é€šä¿¡ã¨ã™ã‚‹ãŸã‚ã« Next Hop ã‚’ Internet ã«ã—ã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-07-09-13-02.png"></p><p>ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ã“ã®è¨­å®šã‚’è¡Œã†ã€å…·ä½“çš„ãªæ‰‹é †ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><p>ã¾ãšã¯å¯¾è±¡ã® Azure VM ã®ç”»é¢ã«ã¦å³å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Šã€Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã‚’é¸æŠè‚¢ã—ã€å¯¾è±¡ã®ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ / ã‚µãƒ–ãƒãƒƒãƒˆã®ãƒªãƒ³ã‚¯ã‚’é¸æŠã—ã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-15-26-12.png"></p><p>å¯¾è±¡ã® Subnet ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒˆ ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’é¸æŠã—ã¾ã™ã€‚</p><p><img src="/blog/vm/kms-troubleshooting/2023-08-02-16-26-20.png"></p><p>å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ˆã‚Šã€Œãƒ«ãƒ¼ãƒˆã€ã‚’é¸æŠã—ã€Œè¿½åŠ ã€ã‚ˆã‚Šã€KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€šä¿¡ã®ã¿ã€ç›´æ¥é€šä¿¡ã¨ã™ã‚‹ãŸã‚ã« Next Hop ã‚’ Internet ã¨ã™ã‚‹ãƒ«ãƒ¼ãƒˆã‚’ 3 ã¤ãã‚Œãã‚Œä½œæˆã—ã¾ã™ã€‚<br>ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«ã¯ã€ãã‚Œãã‚Œä»¥ä¸‹ã®å€¤ã‚’ã”å…¥åŠ›ãã ã•ã„ã€‚  </p><table><thead><tr><th>ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹</th></tr></thead><tbody><tr><td>20.118.99.224/32</td></tr><tr><td>40.83.235.53/32</td></tr><tr><td>23.102.135.246/32</td></tr></tbody></table><p><img src="/blog/vm/kms-troubleshooting/2023-08-03-11-26-51.png"></p><p>ã“ã‚Œã§ã€KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®é€šä¿¡ã‚’ç›´æ¥ KMS ã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã™ã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¨­å®šãŒã§ãã¾ã—ãŸã€‚</p><hr><h3 id="Standard-SKU-ã®-Azure-Load-Balancer-é…ä¸‹ã®-VM-ã§å¤–éƒ¨æ¥ç¶šãŒã§ããªã„"><a href="#Standard-SKU-ã®-Azure-Load-Balancer-é…ä¸‹ã®-VM-ã§å¤–éƒ¨æ¥ç¶šãŒã§ããªã„" class="headerlink" title="Standard SKU ã® Azure Load Balancer é…ä¸‹ã® VM ã§å¤–éƒ¨æ¥ç¶šãŒã§ããªã„"></a>Standard SKU ã® Azure Load Balancer é…ä¸‹ã® VM ã§å¤–éƒ¨æ¥ç¶šãŒã§ããªã„</h3><p>Standard SKU ã® Azure Load Balancer é…ä¸‹ã® VM ã®å ´åˆã€å¤–éƒ¨æ¥ç¶šãŒã§ããªã„çŠ¶æ…‹ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã«ä¼´ã„ KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®é€šä¿¡ãŒã§ããªã„å ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>ã¾ãŸã€å¯ç”¨æ€§ã‚»ãƒƒãƒˆã® VM ã®å ´åˆã€åŒä¸€å¯ç”¨æ€§ã‚»ãƒƒãƒˆå†…ã®åˆ¥ã® VM ãŒ Standard SKU ã® Azure Load Balancer é…ä¸‹ã«ã‚ã‚‹ã¨ã€åŒã˜ãå¤–éƒ¨é€šä¿¡ãŒã§ããªã„çŠ¶æ³ãŒç™ºç”Ÿã—ã¾ã™ã€‚  </p><p>ã“ã®ã‚ˆã†ãª Standard SKU ã® Azure Load Balancer é…ä¸‹ã® VM ã®å ´åˆã¯ã€KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€šä¿¡ãŒã§ãã‚‹ã‚ˆã†ã«æ˜ç¤ºçš„ã«å¤–éƒ¨æ¥ç¶šã®ãƒãƒªã‚·ãƒ¼ã‚’æ§‹æˆã™ã‚‹å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚<br>ã“ã¡ã‚‰ã®ã‚·ãƒŠãƒªã‚ªã«ã¤ã„ã¦ã¯åˆ¥é€”è§£èª¬ã‚’è¡Œã£ã¦ã„ã‚‹ãƒ–ãƒ­ã‚°è¨˜äº‹ãŒã”ã–ã„ã¾ã™ã®ã§ã€ã“ã¡ã‚‰ã‚’ã”å‚ç…§ãã ã•ã„ã¾ã›ã€‚</p><p>â– ã”å‚è€ƒï¼šAzure VM ã®å¤–éƒ¨æ¥ç¶š (SNAT) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ã¾ã¨ã‚<br><a href="https://jpaztech.github.io/blog/network/snat-options-for-azure-vm/">https://jpaztech.github.io/blog/network/snat-options-for-azure-vm/</a></p><hr><h3 id="Tokens-dat-ãƒ•ã‚¡ã‚¤ãƒ«ã®ç ´æ"><a href="#Tokens-dat-ãƒ•ã‚¡ã‚¤ãƒ«ã®ç ´æ" class="headerlink" title="Tokens.dat ãƒ•ã‚¡ã‚¤ãƒ«ã®ç ´æ"></a>Tokens.dat ãƒ•ã‚¡ã‚¤ãƒ«ã®ç ´æ</h3><p>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’è¡Œã£ãŸã¨ã“ã‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Œã‚¨ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ‰: 0xC004E015 / 0xC004D301 / 0xC004E002ã€ã¨ã„ã£ãŸã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚  </p><p><img src="/blog/vm/kms-troubleshooting/2023-08-07-09-13-40.png" alt="ç¾åœ¨ Windows ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’è¡Œãˆã¾ã›ã‚“ã€‚å¾Œã§ã‚‚ã†ä¸€åº¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚ ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ‰: 0xC004E015"></p><p>ã“ã®å ´åˆã¯ Tokens.dat ãƒ•ã‚¡ã‚¤ãƒ«ã®ç ´æãŒç™ºç”Ÿã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã”ã–ã„ã¾ã™ã€‚<br>ä»¥ä¸‹ã®å…¬é–‹æƒ…å ±ã®æ‰‹é †ã§ã€Tokens.dat ãƒ•ã‚¡ã‚¤ãƒ«ã®å†æ§‹ç¯‰ã‚’è¡Œã£ãŸå¾Œã«ã€æ‰‹å‹•ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãŒæˆåŠŸã™ã‚‹ã‹ãŠè©¦ã—ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p><p>â– ã”å‚è€ƒï¼šTokens.dat ãƒ•ã‚¡ã‚¤ãƒ«ã®å†æ§‹ç¯‰<br><a href="https://learn.microsoft.com/ja-jp/windows-server/get-started/activation-rebuild-tokens-dat-file">https://learn.microsoft.com/ja-jp/windows-server/get-started/activation-rebuild-tokens-dat-file</a></p><hr><h2 id="ã•ã„ã”ã«ï¼ˆãã®ä»–ã®è¦å› ç­‰ã«ã¤ã„ã¦ï¼‰"><a href="#ã•ã„ã”ã«ï¼ˆãã®ä»–ã®è¦å› ç­‰ã«ã¤ã„ã¦ï¼‰" class="headerlink" title="ã•ã„ã”ã«ï¼ˆãã®ä»–ã®è¦å› ç­‰ã«ã¤ã„ã¦ï¼‰"></a>ã•ã„ã”ã«ï¼ˆãã®ä»–ã®è¦å› ç­‰ã«ã¤ã„ã¦ï¼‰</h2><p>ä»¥ä¸ŠãŒãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŠã‚ˆã³ã€ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãªã‚Šã¾ã™ãŒã€ç¨€ã«ä¸Šè¨˜ä»¥å¤–ã®è¦å› ã§ã‚‚ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®å¤±æ•—ã®å¯èƒ½æ€§ã‚‚ã”ã–ã„ã¾ã™ã€‚  </p><p>ã€ä¾‹ã€‘</p><ul><li>OS å†…éƒ¨ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§ã® KMS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼é€šä¿¡ã®ãƒ–ãƒ­ãƒƒã‚¯</li><li>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ¼ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„</li></ul><p>ã“ã‚Œã‚‰ã®ã‚·ãƒŠãƒªã‚ªã«è©²å½“ã—ãªã„å¯èƒ½æ€§ã‚‚ã”ã–ã„ã¾ã™ã®ã§ã€ä¸Šè¨˜ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§æ”¹å–„ã—ãªã„å ´åˆã¯ã€å®Ÿæ–½ã—ãŸãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å†…å®¹ã‚„å¯¾è±¡ã® VM ã®æƒ…å ±ãªã©ã‚’æ·»ãˆã¦å¼Šç¤¾ã®æŠ€è¡“ã‚µãƒãƒ¼ãƒˆçª“å£ã«ãŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚<br>ä¸Šè¿°ã®å†…å®¹ãŒçš†æ§˜ã®ãŠå½¹ã«ç«‹ã¤ã“ã¨ã‚’é¡˜ã£ã¦ãŠã‚Šã¾ã™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚&lt;br&gt;Azure ä¸Šã§ç¨¼åƒã™ã‚‹ Windows VM ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã®ãŸã‚ã«ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆãŒ KMS ã‚µãƒ¼ãƒãƒ¼ï¼ˆKMS ãƒ›ã‚¹ãƒˆ ã‚µãƒ¼ãƒãƒ¼ï¼‰ã‚’æä¾›ã—ã¦ãŠã‚Šã¾ã™ã€‚&lt;br&gt;KMS ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼è¦æ±‚ã¯</summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
    <category term="Windows" scheme="https://jpaztech.github.io/blog/tags/Windows/"/>
    
    <category term="HowTo" scheme="https://jpaztech.github.io/blog/tags/HowTo/"/>
    
    <category term="KMS" scheme="https://jpaztech.github.io/blog/tags/KMS/"/>
    
  </entry>
  
  <entry>
    <title>Azure Files ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦ã§ã™</title>
    <link href="https://jpaztech.github.io/blog/vm/azure-files-user-mount/"/>
    <id>https://jpaztech.github.io/blog/vm/azure-files-user-mount/</id>
    <published>2023-08-16T08:30:00.000Z</published>
    <updated>2023-12-26T02:55:51.264Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚<br>ä»Šå›ã¯ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€Azure Files ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦ã¨ãªã£ã¦ãŠã‚Šã¾ã™ç‚¹ã«ã¤ã„ã¦ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  </p><p>ãŠå®¢æ§˜ã‚ˆã‚Šã€ŒWindows ç’°å¢ƒã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ A ã§ãƒã‚¦ãƒ³ãƒˆã—ãŸ Azure Files ã«ã¤ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ B ã‚ˆã‚Šå‚ç…§ãŒã§ããªã„ã€‚ã€ã¨ã„ã†ãŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ãã“ã¨ãŒã”ã–ã„ã¾ã™ã€‚<br>ã“ã¡ã‚‰ã¯ä»•æ§˜ã¨ãªã£ã¦ãŠã‚Šã€ãƒã‚¦ãƒ³ãƒˆã‚’è¡Œã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä»¥å¤–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã¯ Azure Files ã®ãƒã‚¦ãƒ³ãƒˆå…ˆã‚’å‚ç…§ã§ããªã„ã‚‚ã®ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚<br>ãã®ãŸã‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã«ãƒã‚¦ãƒ³ãƒˆã‚’è¡Œã£ã¦ã„ãŸã ãå¿…è¦ãŒã”ã–ã„ã¾ã™ç‚¹ã€ã”ç•™æ„ãã ã•ã„ã¾ã›ã€‚</p><p>ãªãŠã€IIS ã¨ã„ã£ãŸãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ Azure Files ã‚’å‚ç…§ã•ã›ã‚‹å ´åˆã¯ã€System ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ Azure Files ã®ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦ãªå ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>ã—ã‹ã—ãªãŒã‚‰ã€System ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã® Azure Files ã®ãƒã‚¦ãƒ³ãƒˆã¯æ°¸ç¶šåŒ–ãŒå¶ã„ã¾ã›ã‚“ãŸã‚ã€èµ·å‹•ã®åº¦ã«ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦ã¨ãªã‚Šã¾ã™ç‚¹ã”ç•™æ„ãã ã•ã„ã¾ã›ã€‚  </p><p>ç°¡å˜ã§ã¯ã”ã–ã„ã¾ã™ãŒã€Azure Files ã®ãƒã‚¦ãƒ³ãƒˆã«ã¤ã„ã¦è§£èª¬ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚<br>Azure Files è‡ªä½“ã«ã¤ã„ã¦ã®è©³ç´°ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã¾ã›ã€‚  </p><p>â– ã”å‚è€ƒï¼šAzure Files ã¨ã¯<br><a href="https://learn.microsoft.com/ja-jp/azure/storage/files/storage-files-introduction">https://learn.microsoft.com/ja-jp/azure/storage/files/storage-files-introduction</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å¯Œç”°ã§ã™ã€‚&lt;br&gt;ä»Šå›ã¯ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€Azure Files ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦ã¨ãªã£ã¦ãŠã‚Šã¾ã™ç‚¹ã«ã¤ã„ã¦ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚  &lt;/p&gt;
&lt;p&gt;ãŠå®¢æ§˜ã‚ˆã‚Šã€ŒWindows ç’°å¢ƒã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ A ã§ãƒã‚¦ãƒ³</summary>
      
    
    
    
    
    <category term="Windows" scheme="https://jpaztech.github.io/blog/tags/Windows/"/>
    
    <category term="Azure Files" scheme="https://jpaztech.github.io/blog/tags/Azure-Files/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM ã®ä½œæˆ/èµ·å‹•/åœæ­¢ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•</title>
    <link href="https://jpaztech.github.io/blog/vm/vm-create-activity-log/"/>
    <id>https://jpaztech.github.io/blog/vm/vm-create-activity-log/</id>
    <published>2023-07-31T09:00:00.000Z</published>
    <updated>2023-12-26T02:55:51.532Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å‰ç”°ã§ã™ã€‚</p><p>ä»Šå›ã¯ã€ã‚ˆããŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€Azure VM ã®ä½œæˆè€…ãŒä¸æ˜ãªå ´åˆã®ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚<br>æœ¬ãƒ–ãƒ­ã‚°ã§ã¯ Azure VM ã‚’ä¾‹ã«ç´¹ä»‹ã„ãŸã—ã¾ã™ãŒã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã©ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã§ã‚‚å¿œç”¨ãŒå¯èƒ½ãªå†…å®¹ã¨ãªã‚Šã¾ã™ã®ã§ã€çš†æ§˜ã®ã”å‚è€ƒã¨ãªã‚Šã¾ã—ãŸã‚‰å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚</p><hr><h2 id="ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½ã«ã¤ã„ã¦"><a href="#ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½ã«ã¤ã„ã¦" class="headerlink" title="ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½ã«ã¤ã„ã¦"></a>ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½ã«ã¤ã„ã¦</h2><p>Azure VM ã®ä½œæˆè€…ã®ç‰¹å®šã«ã¯ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã‚’åˆ©ç”¨ã„ãŸã—ã¾ã™ã€‚<br>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã¨ã¯ã€Azure ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  ãƒ­ã‚°ã§ã‚ã‚Šã€æ§˜ã€…ãªæ“ä½œã€ã‚¤ãƒ™ãƒ³ãƒˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’è¨˜éŒ²ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>æœ¬ä»¶ã§ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ Azure VM ç­‰ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆã®ä»–ã€VM ã®èµ·å‹•ã€åœæ­¢ãªã©ã®å±¥æ­´ã‚‚è¨˜éŒ²ã•ã‚Œã¾ã™ã®ã§ã€ä¸€åº¦ã¯ç›®ã«ã—ãŸã“ã¨ã®ã‚ã‚‹æ–¹ã‚‚å¤šã„æ©Ÿèƒ½ã‹ã¨å­˜ã˜ã¾ã™ã€‚<br>ä»Šå›ã¯æ•°ã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã‹ã‚‰ã€VM ã®ä½œæˆæ™‚ã«è¨˜éŒ²ã•ã‚Œã‚‹å†…å®¹ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚</p><p>å‚è€ƒ) Azure Monitor ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°<br><a href="https://learn.microsoft.com/ja-jp/azure/azure-monitor/essentials/activity-log?tabs=powershell">https://learn.microsoft.com/ja-jp/azure/azure-monitor/essentials/activity-log?tabs=powershell</a></p><hr><h2 id="ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£-ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•"><a href="#ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£-ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•" class="headerlink" title="ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•"></a>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•</h2><p>ã§ã¯æ—©é€Ÿã€VM ä½œæˆæ™‚ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã¾ã„ã‚Šã¾ã™ã€‚<br>ä»Šå›ã¯ç‰¹å®šã® Azure VM ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã‚ˆã‚Šç¢ºèªã‚’è¡Œã„ã¾ã™ãŒã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã¯ãƒªã‚½ãƒ¼ã‚¹ ã‚°ãƒ«ãƒ¼ãƒ—ãŠã‚ˆã³ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å˜ä½ã§ã®ç¢ºèªã‚‚å¯èƒ½ã§ã”ã–ã„ã¾ã™ã®ã§ã€çŠ¶æ³ã«åˆã‚ã›ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é¸å®šã„ãŸã ã‘ã‚Œã°ã¨å­˜ã˜ã¾ã™ã€‚</p><p>ã¾ãŸã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã¯çµã‚Šè¾¼ã‚“ã æœŸé–“å†…ã®ãƒ­ã‚°ã«é–¢ã—ã€CSV å½¢å¼ã«ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã”ã–ã„ã¾ã™ã®ã§ã€ã”éƒ½åˆã®è‰¯ã„æ‰‹æ³•ã«ã¦ã”ç¢ºèªã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p><p>[Virtual Machine] ã‚ˆã‚Š [ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°] ã‚’é¸æŠã—ã¾ã™ã€‚<br><img src="/blog/vm/vm-create-activity-log/activitylog001.png"></p><p>æ¤œç´¢æœŸé–“ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç›´è¿‘ 6 æ™‚é–“ã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€VM ã‚’ä½œæˆã—ãŸãŠãŠã‚ˆãã®æ—¥æ™‚ã§ [ã‚«ã‚¹ã‚¿ãƒ ] ã‚ˆã‚Šçµã‚Šè¾¼ã¿ã‚’è¡Œã„ã¾ã™ã€‚<br>çµã‚Šè¾¼ã¿ãŒé›£ã—ã„å ´åˆã€ãƒ­ã‚°ã®ä¿å­˜æœŸé–“ã§ã‚ã‚‹ 90 æ—¥é–“ã¨ãªã‚‹ã‚ˆã†æ—¥æ™‚ã‚’æŒ‡å®šã—ã¾ã™ã€‚<br><img src="/blog/vm/vm-create-activity-log/activitylog002.png"></p><p>æœ€ã‚‚å¤ã„ [Create or Update Virtual Machine] ã®é …ç›®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚<br><img src="/blog/vm/vm-create-activity-log/activitylog003.png"></p><p>è¡¨ç¤ºã•ã‚ŒãŸé …ç›®ã®ã†ã¡ã€[ã‚¤ãƒ™ãƒ³ãƒˆé–‹å§‹è€…] ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ VM ã®ä½œæˆè€…ã¨ãªã‚Šã¾ã™ã€‚<br><img src="/blog/vm/vm-create-activity-log/activitylog004.png"></p><p>ãªãŠã€ä¸Šè¨˜ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦æ³¨æ„ç‚¹ãŒ 2 ç‚¹ã”ã–ã„ã¾ã™ã€‚</p><ol><li><p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã®ä¿å­˜æœŸé–“ã«ã¤ã„ã¦<br>ã“ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã¯å˜ç‹¬ã§ã®ä¿å­˜æœŸé–“ãŒ 90 æ—¥ã¨ãªã‚Šã¾ã™ãŸã‚ã€ã“ã‚Œã‚’è¶…éã—ã¦ãŠã‚Šã€ã‹ã¤åˆ¥ã®å ´æ‰€ã¸ã®ãƒ­ã‚°ã®é€€é¿ã‚’å®Ÿæ–½ã—ã¦ã„ãªã„å ´åˆã€ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ãŒå¶ã„ã¾ã›ã‚“ã®ã§ã€äºˆã‚ã”äº†æ‰¿ã„ãŸã ã‘ã‚Œã°ã¨å­˜ã˜ã¾ã™ã€‚</p></li><li><p>[Create or Update Virtual Machine] ã®è©²å½“é …ç›®ã«ã¤ã„ã¦<br>ä¸Šè¨˜ã®é …ç›®ã«ã¤ãã¾ã—ã¦ã¯ã€VM ã®ä½œæˆã®ä»–ã€VM ã®ã‚µã‚¤ã‚ºå¤‰æ›´ç­‰ã®éš›ã«ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹ãƒ­ã‚°ã¨ãªã‚Šã¾ã™ã€‚<br>ã“ã®ãŸã‚ã€ä¸Šè¨˜åç§°ã®ã‚ˆã‚Šå¤ã„ãƒ­ã‚°ãŒã”ã–ã„ã¾ã™å ´åˆã¯ã€å†åº¦ã”ç¢ºèªã‚’ã„ãŸã ãå¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚</p></li></ol><hr><h2 id="ãã®ä»–ã€ã‚ˆãåˆ©ç”¨ã•ã‚Œã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£-ãƒ­ã‚°"><a href="#ãã®ä»–ã€ã‚ˆãåˆ©ç”¨ã•ã‚Œã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£-ãƒ­ã‚°" class="headerlink" title="ãã®ä»–ã€ã‚ˆãåˆ©ç”¨ã•ã‚Œã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°"></a>ãã®ä»–ã€ã‚ˆãåˆ©ç”¨ã•ã‚Œã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°</h2><p>VM ã®ä½œæˆè€…ã®ã»ã‹ã€VM ã®èµ·å‹•ã€å‰²ã‚Šå½“ã¦è§£é™¤ã‚’å®Ÿæ–½ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¢ºèªæ–¹æ³•ã«ã¤ãã¾ã—ã¦ã‚‚å¤šããŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ãã¾ã™ã“ã¨ã‹ã‚‰ã€ä½µã›ã¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã®å‡ºåŠ›å†…å®¹ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚</p><h3 id="â– -VM-ã®èµ·å‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼"><a href="#â– -VM-ã®èµ·å‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼" class="headerlink" title="â–  VM ã®èµ·å‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼"></a>â–  VM ã®èµ·å‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3><p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã®å‡ºåŠ›ã®ã†ã¡ã€Start Virtual Machine ãŒè©²å½“ã—ã¾ã™ã€‚<br>ã‚¤ãƒ™ãƒ³ãƒˆé–‹å§‹è€…ãŒ VM ã‚’èµ·å‹•ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™ã€‚<br><img src="/blog/vm/vm-create-activity-log/activitylog005.png"></p><h3 id="â– -VM-ã®å‰²ã‚Šå½“ã¦è§£é™¤ã®å®Ÿæ–½ãƒ¦ãƒ¼ã‚¶ãƒ¼"><a href="#â– -VM-ã®å‰²ã‚Šå½“ã¦è§£é™¤ã®å®Ÿæ–½ãƒ¦ãƒ¼ã‚¶ãƒ¼" class="headerlink" title="â–  VM ã®å‰²ã‚Šå½“ã¦è§£é™¤ã®å®Ÿæ–½ãƒ¦ãƒ¼ã‚¶ãƒ¼"></a>â–  VM ã®å‰²ã‚Šå½“ã¦è§£é™¤ã®å®Ÿæ–½ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3><p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã®å‡ºåŠ›ã®ã†ã¡ã€Deallocate Virtual Machine ãŒè©²å½“ã—ã¾ã™ã€‚<br>ã‚¤ãƒ™ãƒ³ãƒˆé–‹å§‹è€…ãŒ VM ã®å‰²ã‚Šå½“ã¦è§£é™¤ã‚’å®Ÿæ–½ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™ã€‚<br> <img src="/blog/vm/vm-create-activity-log/activitylog006.png"></p><hr><h2 id="ãŠã‚ã‚Šã«"><a href="#ãŠã‚ã‚Šã«" class="headerlink" title="ãŠã‚ã‚Šã«"></a>ãŠã‚ã‚Šã«</h2><p>ã„ã‹ãŒã§ã—ãŸã§ã—ã‚‡ã†ã‹ã€‚<br>ä»¥ä¸ŠãŒ Azure VM ã®ä½œæˆè€…ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã‹ã‚‰ç‰¹å®šã™ã‚‹æ–¹æ³•ã§ã”ã–ã„ã¾ã—ãŸã€‚<br>ã“ã®ä»–ã«ã‚‚ Azure VM ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ ãƒ­ã‚°ã«ã¯æ§˜ã€…ãªå†…å®¹ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã®ã§ã€æ·»ä»˜ã„ãŸã—ã¾ã—ãŸå¼Šç¤¾ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å«ã‚ãœã²ã”æ´»ç”¨ã„ãŸã ã‘ã‚Œã°ã¨å­˜ã˜ã¾ã™ã€‚<br>æœ¬è¨˜äº‹ãŒçš†æ§˜ã®ãŠå½¹ã«ç«‹ã¤å†…å®¹ã¨ãªã£ã¦ãŠã‚Šã¾ã—ãŸã‚‰å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®å‰ç”°ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå›ã¯ã€ã‚ˆããŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€Azure VM ã®ä½œæˆè€…ãŒä¸æ˜ãªå ´åˆã®ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚&lt;br&gt;æœ¬ãƒ–ãƒ­ã‚°ã§ã¯ Azure VM ã‚’ä¾‹ã«ç´¹ä»‹ã„ãŸã—ã¾ã™ãŒã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
    <category term="HowTo" scheme="https://jpaztech.github.io/blog/tags/HowTo/"/>
    
  </entry>
  
  <entry>
    <title>ã‚²ã‚¹ãƒˆ OS å†…ã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã—ãªã„ã§ãã ã•ã„</title>
    <link href="https://jpaztech.github.io/blog/vm/avoiding-changes-to-DNS-and-IP-in-GuestOS/"/>
    <id>https://jpaztech.github.io/blog/vm/avoiding-changes-to-DNS-and-IP-in-GuestOS/</id>
    <published>2023-07-31T08:30:00.000Z</published>
    <updated>2023-12-26T02:55:51.264Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®æ–°è¦‹ã§ã™ã€‚</p><p>Azure VM ã®ã‚²ã‚¹ãƒˆ OS å†…ã‹ã‚‰ DNS ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚„ ã‚²ã‚¹ãƒˆ OS è‡ªä½“ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã®ã‚ˆã†ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã—ãŸéš›ã«ã€Azure VM ã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¦ã—ã¾ã£ãŸã¨ã„ã†ãŠå•ã„åˆã‚ã›ã‚’ã„ãŸã ãã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br>æœ¬è¨˜äº‹ã§ã¯ã€Azure VM ã®ã‚²ã‚¹ãƒˆ OS å†…ã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯éæ¨å¥¨ã§ã‚ã‚‹ã“ã¨ã¨ã€å¤‰æ›´ã—ã¦ã—ã¾ã£ãŸå ´åˆã®å¯¾å‡¦æ³•ã¨ã€æ¨å¥¨ã—ã¦ã„ã‚‹æ‰‹é †ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚ â€¯ </p><p>ä»¥ä¸‹å…¬é–‹è³‡æ–™ã«ã‚‚ã”ã–ã„ã¾ã™ã‚ˆã†ã«ã€ Azure VM ã§ã¯ã‚²ã‚¹ãƒˆ OS å†…éƒ¨ã§ DNS ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚„ ã‚²ã‚¹ãƒˆ OS è‡ªä½“ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®šã¯åŸå‰‡å¤‰æ›´ã—ãªã„ã‚ˆã†ãŠé¡˜ã„ã—ã¦ã„ã¾ã™ã€‚ â€¯ </p><blockquote><p>ã”å‚è€ƒ) <a href="https://docs.microsoft.com/ja-jp/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances#specify-dns-servers">DNS ã‚µãƒ¼ãƒãƒ¼ã®æŒ‡å®š </a><br>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼æŠœç²‹ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼<br>DNS ã‚µãƒ¼ãƒãƒ¼ã® IP ãªã©ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€VM å†…ã§ç›´æ¥ç·¨é›†ã—ãªã„ã§ãã ã•ã„ã€‚<br>ã“ã‚Œã¯ã€ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’äº¤æ›ã—ãŸã¨ãã®ã‚µãƒ¼ãƒ“ã‚¹å›å¾©æ™‚ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ¶ˆå»ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚<br>ã“ã‚Œã¯ã€Windows VM ã¨ Linux VM ã®ä¸¡æ–¹ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚<br>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼</p></blockquote><blockquote><p>ã”å‚è€ƒ) <a href="https://docs.microsoft.com/ja-jp/azure/virtual-network/virtual-network-network-interface-addresses#private">Azure ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¿½åŠ ã€å¤‰æ›´ã€å‰Šé™¤</a><br>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼æŠœç²‹ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼<br>å¿…è¦ãŒãªã„é™ã‚Šã€ä»®æƒ³ãƒã‚·ãƒ³ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ã‚·ã‚¹ãƒ†ãƒ å†…ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ‰‹å‹•ã§è¨­å®šã—ãªã„ã§ãã ã•ã„ã€‚<br>ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ </p></blockquote><p>Azure VM ã«ã¯ã€å¿…ãš 1 å€‹ä»¥ä¸Šã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹(NIC) ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>Azure VM ã®ã‚²ã‚¹ãƒˆ OS å´ã® NIC ã«è¨­å®šã•ã‚Œã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ DHCP ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ Azure å´ã® NIC ã§æŒ‡å®šã—ãŸ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚<br>ã‚‚ã—ã€Azure VM ã®ã‚²ã‚¹ãƒˆ OS å†…ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã—ãŸå ´åˆã€Azure å´ã§ä¿æŒã—ã¦ã„ã‚‹ NIC ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨æ•´åˆæ€§ãŒå–ã‚Œãªããªã‚Šã€ä¸€åˆ‡ã®é€šä¿¡ãŒå‡ºæ¥ãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ â€¯ </p><h1 id="ã‚²ã‚¹ãƒˆ-OS-ã‹ã‚‰ç›´æ¥è¨­å®šã‚’å¤‰æ›´ã—ãŸã“ã¨ã§æ¥ç¶šä¸å¯ã¨ãªã£ã¦ã—ã¾ã£ãŸå ´åˆã®å¯¾å‡¦ç­–"><a href="#ã‚²ã‚¹ãƒˆ-OS-ã‹ã‚‰ç›´æ¥è¨­å®šã‚’å¤‰æ›´ã—ãŸã“ã¨ã§æ¥ç¶šä¸å¯ã¨ãªã£ã¦ã—ã¾ã£ãŸå ´åˆã®å¯¾å‡¦ç­–" class="headerlink" title="ã‚²ã‚¹ãƒˆ OS ã‹ã‚‰ç›´æ¥è¨­å®šã‚’å¤‰æ›´ã—ãŸã“ã¨ã§æ¥ç¶šä¸å¯ã¨ãªã£ã¦ã—ã¾ã£ãŸå ´åˆã®å¯¾å‡¦ç­–"></a>ã‚²ã‚¹ãƒˆ OS ã‹ã‚‰ç›´æ¥è¨­å®šã‚’å¤‰æ›´ã—ãŸã“ã¨ã§æ¥ç¶šä¸å¯ã¨ãªã£ã¦ã—ã¾ã£ãŸå ´åˆã®å¯¾å‡¦ç­–</h1><p>â€¯<br>Azure VM ã®ã‚²ã‚¹ãƒˆ OS å†…ã§ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã®å¤‰æ›´ã‚’ã—ãŸã“ã¨ã«ã‚ˆã‚Šæ¥ç¶šã«å¤±æ•—ã—ãŸéš›ã®å¯¾å‡¦æ³•ã¨ã—ã¦ã¯ã€ã¾ãšã€å†èµ·å‹•ã‚’ã™ã‚‹ã“ã¨ã§è§£æ±ºã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ </p><p>å†èµ·å‹•å¾Œã‚‚å¾©æ—§ã—ãªã„å ´åˆã¯ã€ä¸€èˆ¬çš„ã« NIC ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã“ã¨ã§å¾©æ—§å¯èƒ½ã§ã™ã€‚<br>NIC ãƒªã‚»ãƒƒãƒˆã®æ‰‹é †ã¯ã€ä»¥ä¸‹ã®å…¬é–‹æƒ…å ±ã‚’ã”å‚ç…§ãã ã•ã„ã€‚<br>â€¯<br>ã”å‚è€ƒ) <a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/virtual-machines/reset-network-interface">Azure Windows VM ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹æ–¹æ³•</a>â€¯ </p><h1 id="æ¨å¥¨ã—ã¦ã„ã‚‹-DNS-ã‚µãƒ¼ãƒãƒ¼ã®å¤‰æ›´æ‰‹é †"><a href="#æ¨å¥¨ã—ã¦ã„ã‚‹-DNS-ã‚µãƒ¼ãƒãƒ¼ã®å¤‰æ›´æ‰‹é †" class="headerlink" title="æ¨å¥¨ã—ã¦ã„ã‚‹ DNS ã‚µãƒ¼ãƒãƒ¼ã®å¤‰æ›´æ‰‹é †"></a>æ¨å¥¨ã—ã¦ã„ã‚‹ DNS ã‚µãƒ¼ãƒãƒ¼ã®å¤‰æ›´æ‰‹é †</h1><p>â€¯<br>DNS ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã¯ Azure ä¸Šã§å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€è‡ªå‹•çš„ã«Azure VM ã®ã‚²ã‚¹ãƒˆ OS å†…ã®æƒ…å ±ã‚‚å¤‰æ›´ã•ã‚Œã¾ã™ã€‚<br>ãã®ãŸã‚ã€DNS ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã€Azure ä¸Šã§ DNS ã‚µãƒ¼ãƒãƒ¼ã‚’å¤‰æ›´ã™ã‚‹ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>DNS ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šå¤‰æ›´ã®æ‰‹é †ã¯ã€ä»¥ä¸‹ã®å…¬é–‹æƒ…å ±ã‚’ã”å‚ç…§ãã ã•ã„ã€‚ </p><p>ã”å‚è€ƒ) <a href="https://learn.microsoft.com/ja-jp/azure/virtual-network/virtual-network-network-interface?tabs=network-interface-portal#change-dns-servers">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®ä½œæˆã€å¤‰æ›´ã€å‰Šé™¤ | DNS ã‚µãƒ¼ãƒãƒ¼ã®å¤‰æ›´</a>â€¯ </p><h1 id="æ¨å¥¨ã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ-IP-ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´æ‰‹é †"><a href="#æ¨å¥¨ã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ-IP-ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´æ‰‹é †" class="headerlink" title="æ¨å¥¨ã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´æ‰‹é †"></a>æ¨å¥¨ã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´æ‰‹é †</h1><p>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚ Azure ä¸Šã§å¤‰æ›´ã™ã‚‹ã“ã¨ã§ ã‚²ã‚¹ãƒˆ OS å†…ã®æƒ…å ±ã‚‚å¤‰æ›´ã•ã‚Œã‚‹ãŸã‚ã€Azure ä¸Šã§å¤‰æ›´ã™ã‚‹ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€é™çš„å‰²ã‚Šå½“ã¦ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€ã‚µãƒ–ãƒãƒƒãƒˆã®ç¯„å›²å†…ã§ã®ä»»æ„ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚<br>åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å‰²ã‚Šå½“ã¦ãŸã„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯æŒ‡å®šã§ããªã„ã®ã§ã€å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ VM ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’äºˆã‚åˆ¥ã®ã‚‚ã®ã«å¤‰æ›´ã™ã‚‹ãªã©ã—ã¦å¯¾å¿œã„ãŸã ãã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã®è¨­å®šå¤‰æ›´ã®æ‰‹é †ã¯ã€ä»¥ä¸‹ã®å…¬é–‹è³‡æ–™ã‚’ã”å‚ç…§ãã ã•ã„ã€‚ </p><p>ã”å‚è€ƒ) <a href="https://docs.microsoft.com/ja-jp/azure/virtual-network/ip-services/virtual-networks-static-private-ip-arm-pportal#change-private-ip-address-to-static">é™çš„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤ VM ã‚’ä½œæˆã™ã‚‹</a></p><h1 id="ã•ã„ã”ã«"><a href="#ã•ã„ã”ã«" class="headerlink" title="ã•ã„ã”ã«"></a>ã•ã„ã”ã«</h1><p>â€¯<br>ã“ã®è¨˜äº‹ã§ã¯ã€Azure VM ã®ã‚²ã‚¹ãƒˆ OS ã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒéæ¨å¥¨ã§ã‚ã‚‹ã“ã¨ã¨ã€å¤‰æ›´ã—ã¦ã—ã¾ã£ãŸå ´åˆã®å¯¾å‡¦æ³•ã«ã¤ã„ã¦ãŠä¼ãˆã—ã¾ã—ãŸã€‚<br>æ¥ç¶šå¤±æ•—ã®ç™ºç”Ÿã‚’é˜²ããŸã‚ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã¯ã€åŸå‰‡ Azure ä¸Šã‹ã‚‰å¤‰æ›´ã™ã‚‹ã‚ˆã†ãŠé¡˜ã„ã—ã¾ã™ã€‚<br>æœ¬ç¨¿ãŒå°‘ã—ã§ã‚‚çš†æ§˜ã®ä¸€åŠ©ã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚ </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€‚Azure ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« ã‚µãƒãƒ¼ãƒˆ ãƒãƒ¼ãƒ ã®æ–°è¦‹ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;Azure VM ã®ã‚²ã‚¹ãƒˆ OS å†…ã‹ã‚‰ DNS ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚„ ã‚²ã‚¹ãƒˆ OS è‡ªä½“ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã®ã‚ˆã†ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã—ãŸéš›ã«ã€Azure VM ã¸ã®æ¥ç¶šã«å¤±æ•—ã—</summary>
      
    
    
    
    
    <category term="VM" scheme="https://jpaztech.github.io/blog/tags/VM/"/>
    
    <category term="Windows" scheme="https://jpaztech.github.io/blog/tags/Windows/"/>
    
  </entry>
  
</feed>
